/*
 * Copyright (C) 2009, Nokia gate5 GmbH Berlin
 *
 * These coded instructions, statements, and computer programs contain
 * unpublished proprietary information of Nokia gate5 GmbH, and are
 * copy protected by law. They may not be disclosed to third parties
 * or copied or duplicated in any form, in whole or in part, without
 * the specific, prior written permission of Nokia gate5 GmbH.
 */ 

this.nokia=this.nokia||{};nokia.places=nokia.places||{comm:{},data:{},utils:{},search:{},widgets:{},ui:{modules:{},templates:{blue:{},general:{},mobileHTML5:{},wordpress:{},st:{}}}};nokia.places.utils.enums={CssUrlModes:{NONE:"none",AGGREGATED:"aggregated",NON_AGGREGATED:"nonAggregated"}};
nokia.places.utils.util=function(){function d(b,d){var a=b,c;for(c in d)d.hasOwnProperty(c)&&(a=a.replace("{"+c+"}",d[c]));return a}function i(b,d){return function(){return b.apply(d,arguments)}}function f(b,g,a){var c=new Date;a&&c.setDate(c.getDate()+a);document.cookie=d("{NAME}={VALUE}{EXPIRES}",{NAME:b,VALUE:encodeURI(g),EXPIRES:a?"":"; expires="+c.toUTCString()})}function k(b){if(document.cookie.length){var d=document.cookie.indexOf(b+"=");if(-1!==d)return d=d+b.length+1,b=document.cookie.indexOf(";",
d),-1===b&&(b=document.cookie.length),decodeURI(document.cookie.substring(d,b))}return""}var g={en:"gb",da:"dk",cs:"cz",el:"gr",hi:"in",ko:"kr",sv:"se",zh:"cn"};return{mixin:function(b,d){for(var a=Array.prototype.slice.call(arguments,1),c=a.shift();c;){for(var e in c)c.hasOwnProperty(e)&&(b[e]=c[e]);c=a.shift()}return b},replace:d,inherit:function(b,d,a){var c=function(){};c.prototype=b.prototype;d.prototype=new c;for(var e in a)a.hasOwnProperty(e)&&(d.prototype[e]=a[e])},trim:function(b){return b.replace(/(^\s+)|(\s+$)/g,
"")},setCookie:f,getCookie:k,clearCookie:function(b){f(b,"",-1)},createTempUserId:function(){var b=k("ppTmpUser");b||(b=Math.floor(1E8*Math.random())+""+(new Date).getTime(),f("ppTmpUser",b,360));return b},addProtocolToUrl:function(b){0!==b.indexOf("http://")&&0!==b.indexOf("https://")&&(b="http://"+b);return b},ensureReplaced:function(b,d){return 0===b.indexOf("$")?d:b},removeTags:function(b){return"string"===typeof b?b.replace(/<([a-zA-Z0-9]*|\n)+>/g,"").replace(/<\/([a-zA-Z0-9]*|\n)+>/g,""):b},
escapeTags:function(b){return"string"===typeof b?b.replace(/</g,"&lt;").replace(/>/g,"&gt;"):b},extendWith:function(b,d){for(var a in d)d.hasOwnProperty(a)&&typeof("function"===d[a])&&(b[a]=i(d[a],b))},getBrowserLanguage:function(){var b="undefined"===typeof window?"en":window.navigator.userLanguage||window.navigator.language||"en";if(2===b.length){var d=g[b];return d?[b,d].join("-"):[b,b].join("-")}return b},getDefaultDialect:function(b){return g[b]?g[b]:b},toArray:function(b){return b instanceof
Array?b:[b]}}}();
nokia.places.settings=function(){function d(){var a=this.jslocation||nokia.maps;if(a&&a.util&&a.util.services)return a.util.services}function i(c){var b=d(),c=g(c,{S_URL:a,APPID:e,TOKEN:p,LANG:w});return b?b.addNlpParams(c):c}var f=nokia.places.utils.util,k=nokia.Settings,g=f.replace,b=f.ensureReplaced,n=b("http://api.places.maps.ovi.com/rest/v1/places","http://api.places.maps.ovi.com/rest/v1/places"),a=b("http://places.nlp.nokia.com/places/v1","http://s.pbapi.places.public.devbln.europe.nokia.com/places/v1"),c=
b("http://geo.nlp.nokia.com/search/6.2","http://geo.nlp.nokia.com/search/6.2"),e="",p="",o=b("${cnContext}",!1),h="&app_id={APPID}&app_code={TOKEN}",j=[];j.push("callback=nokia.places.comm.data.clb['{CALLBACK_ID}']");d()?h="":j.push(h);j.push("Accept-Language={LANG}");var j=j.join("&"),l="{S_URL}/discover/search/?"+j+"&",m="{S_URL}/suggest/?"+j+"&",q="{S_URL}/discover/explore/places?"+j+"&",o=o?"":"&int=true",s="{S_URL}/places/{PLACE_ID}?"+j,r="{S_URL}/places/{PLACE_ID}/media/images?offset={START}&size={LIMIT}&"+
j,t="{S_URL}/places/{PLACE_ID}/media/reviews?offset={START}&size={LIMIT}&"+j,u="{S_URL}/places/{PLACE_ID}/related/recommended?size={LIMIT}&"+j,x="{S_URL}/reversegeocode.json?prox={LAT},{LONG},1000&gen=1&mode=retrieveAddresses&jsoncallback=nokia.places.comm.data.clb['{CALLBACK_ID}']"+h+"&language={LANG}"+o,v="{S_URL}/geocode.json?gen=1&searchtext={LOC}&jsoncallback=nokia.places.comm.data.clb['{CALLBACK_ID}']"+h+o,w=f.getBrowserLanguage();k&&(e=k.appId,p=k.authenticationToken,k.addObserver("appId",
function(a){a!==e&&(e=a)}),k.addObserver("authenticationToken",function(a){a!==p&&(p=a)}));f=function(){};f.prototype={getPlaceUrl:function(a){var c=i(s);return g(c,{PLACE_ID:a})},getPlaceImagesUrl:function(a,c,e){var b=i(r);return g(b,{PLACE_ID:a,START:c||0,LIMIT:e||5})},getReviewsUrl:function(a,c){var e=i(t);return g(e,{PLACE_ID:a,LIMIT:c.limit||"5",START:c.start||"0"})},getRecommendationsUrl:function(a,c){var e=i(u);return g(e,{PLACE_ID:a,LIMIT:c||5})},getRatingUrl:function(a){return g("{S_URL}/{PLACE_ID}/ugc/ratings.js;callback={CALLBACK_ID}?",
{PLACE_ID:a,S_URL:n})},getRatingPostUrl:function(a){return g("{S_URL}/{PLACE_ID}/ugc/ratings?",{PLACE_ID:a,S_URL:n})},getSearchUrl:function(){return i(l)+"&"},getCategorySearchUrl:function(){return i(q)+"&"},getSuggestUrl:function(){return i(m)+"&"},getLocale:function(){return w},getClbTemplate:function(){return"callback=nokia.places.comm.data.clb['{CALLBACK_ID}']"},getReverseGeoUrl:function(a,b){var q=g(x,{LAT:a,LONG:b,S_URL:c,APPID:e,TOKEN:p,LANG:w}),h=d();return h?h.addNlpParams(q):q},getGeoCodeUrl:function(a){var a=
g(v,{LOC:a,S_URL:c,APPID:e,TOKEN:p,LANG:w}),b=d();return b?b.addNlpParams(a):a},setPlacesServerUrl:function(c){a=c},getPlacesServerUrl:function(){return a},getServices:d,setLocale:function(a){w=a},setAppContext:function(a){e=a.appId;p=a.authenticationToken;if(k){k.set("appId",e);k.set("authenticationToken",p)}},getAppContext:function(){return{appId:e,authToken:p}},commTimeout:1E4,revision:b("-1","0"),version:b("beta5-SNAPSHOT","0")};f.prototype.constructor=f;return new f}();
nokia.places.comm.core=function(){function d(d){d&&d.parentNode&&d.parentNode.removeChild(d)}function i(){var d=k.getElementById(f);d||(d=k.createElement("div"),d.setAttribute("id",f),d.style.display="none",k.body.appendChild(d));return d}var f="nokiaPlacesTransport",k=document;return{get:function(f,b){var n=i(),a=k.createElement("script");a.setAttribute("src",f);a.setAttribute("type","text/javascript");"Microsoft Internet Explorer"===navigator.appName?a.onreadystatechange=function(){if("loaded"===
this.readyState||"complete"===this.readyState)d(this),"function"===typeof b&&b()}:a.onload=function(){d(this);"function"===typeof b&&b()};n.appendChild(a);return a},post:function(f,b,n,a){var c=i(),e=k.createElement("iframe");e.style.display="none";c.appendChild(e);setTimeout(function(){var c=e.contentWindow||e.contentDocument;e.doc=c.document?c.document:c;c=e.doc.createElement("form");c.method="post";c.action=f;c.setAttribute("accept-charset","utf-8");c.setAttribute("enctype","multipart/form-data");
c.setAttribute("encoding","multipart/form-data");var o=e.doc.createElement("input");o.type="text";o.name="user-id";o.value=a||"";c.appendChild(o);o=e.doc.createElement("input");o.type="text";o.name="entity";o.value=b;c.appendChild(o);e.doc.body.appendChild(c);var h=function(){setTimeout(function(){d(e)},1);"function"===typeof n&&n()};e.onload=function(){h()};e.onreadystatechange=function(){"complete"===this.readyState&&h()};c.submit()},1)}}}();
nokia.places.comm.data=function(){function d(){return""+ ++n}function i(a,c){var e=function(d,o){d&&400<=d.status&&(d={responseStatus:d.status,message:d.error_description||d.message},o="ERROR",window.console&&"function"===typeof window.console.error&&window.console.error("Error "+d.responseStatus+" - "+d.message));"function"===typeof c&&c(d,o||"OK");clearTimeout(e.timeout);delete b[a]};e.timeout=setTimeout(function(){window.console&&"function"===typeof window.console.error&&window.console.error("Timeout - cannot connect to the server");
e(null,"ERROR")},g.commTimeout);return e}var f=nokia.places,k=f.comm.core,g=f.settings,b={},n=100;return{performRequest:function(a,c,e){e=e||d();a=a.replace("{CALLBACK_ID}",e);b[e]=i(e,c);k.get(a,null,e);return e},performNoCbRequest:function(a){k.get(a)},performPostRequest:function(a,c,e,b){k.post(a,c,e,b)},abortRequest:function(a){if("undefinded"===typeof a||!b[a])return!1;b[a].timeout&&clearTimeout(b[a].timeout);b[a]=function(){delete b[a]}},getCallBackId:d,getSeed:function(){return n},clb:b}}();
(function(d){d.ovi=this.ovi||{};d.ovi.player={};d.ovi.player.places={};d.ovi.player.places.Com={};d.ovi.player.places.Com.data=function(d,f){nokia.places.comm.data.clb[""+d.callback](f)}})(this);
nokia.places.data.dataTransformer=function(){function d(a){return{latitude:a[0],longitude:a[1]}}function i(a){if(a instanceof Array)return{topLeft:{latitude:a[3],longitude:a[0]},bottomRight:{latitude:a[1],longitude:a[2]}}}function f(a){if(a)return{name:a.title,categoryId:a.id,icon:a.icon}}function k(c){var e;if(!c)return!1;if((e=c.results)&&e.next){var p=c.results.next;c.results.getNext=function(c){if(c&&c.onComplete){var e=c.onComplete;p+="&"+n.getClbTemplate();return b(p,function(c,b){"function"===
typeof e&&(b===a&&(c=k(c)),e(c,b))})}}}delete c.next;e=c.items||c.results.items;if(c.search){c.search.context&&(c.search.location=c.search.context.location,delete c.search.context);var o=c.search.location;o.position&&(o.position=d(o.position));o.bbox&&(o.boundingBox=i(o.bbox),delete o.bbox)}if(e)for(var o=0,h=e.length;o<h;o++){var j=e[o],l=j.href.match(/([\w\d]{8}-[\w\d]{32})/),g=j.category;g.icon=j.icon.replace(/(_\d{2})?\.icon/,".icon");j.id?(j.placeId=j.id,delete j.id):l&&l[1]&&(j.placeId=l[1]);
j.position=d(j.position);j.bbox&&(j.boundingBox=i(j.bbox),delete j.bbox);j.category=f(g);delete j.refId;delete j.type}return c}function g(c){if(!c)return!1;if(c.next){var e=c.next;c.getNext=function(c){if(c&&c.onComplete){var h=c.onComplete;e+="&"+n.getClbTemplate();return b(e,function(c,e){"function"===typeof h&&(e===a&&(c=g(c)),h(c,e))})}}}delete c.next;delete c.create;if(c.items)for(var d=0,o=c.items.length;d<o;d++){var h=c.items[d];if(h){var j=h.supplier;h.supplier={name:j.title,supplierId:j.id,
icon:j.icon};delete h.id}}return c}var b=nokia.places.comm.data.performRequest,n=nokia.places.settings,a="OK";return{transformPlace:function(a){if(!a)return!1;a.location.position=d(a.location.position);a.location.bbox&&(a.location.bbox=i(a.location.bbox));if(a.media){var e=a.media;e.reviews&&(e.reviews.available?e.reviews=g(e.reviews):delete e.reviews);e.editorials&&(e.editorials=g(e.editorials));e.images&&(e.images.available?e.images=g(e.images):delete e.images);e.links&&(e.links=g(e.links));e.images||
e.editorials||e.reviews||e.links?a.media=e:delete a.media}if(e=a.supplier)a.supplier={name:e.title,supplierId:e.id};for(var e=0,b=a.categories.length;e<b;e++)a.categories[e]=f(a.categories[e]);delete a.refId;return a},transformSearchResults:k,transformReverseGeo:function(a){if(a){var e={location:{}};e.location.position={latitude:parseFloat(a.Location.DisplayPosition.Latitude),longitude:parseFloat(a.Location.DisplayPosition.Longitude)};var b=e.location,a=a.Location.Address,d={},h,j,l;for(l in a)if(a.hasOwnProperty(l))if(j=
a[l],"AdditionalData"!==l)h="Label"===l?"text":"Country"===l?"countryCode":l.charAt(0).toLowerCase()+l.substr(1),d[h]=j;else{h=0;for(var f=j.length;h<f;h++){var q=j[h];"CountryName"===q.key?d.country=q.value:"StateName"===q.key&&(d.state=q.value)}}b.address=d;e.name=e.location.address.text;return e}},transformMediaObject:g,transformRating:function(a){var e={average:0,count:0};a&&(e={average:a.rating||0,count:a.ratingCount||0});return e}}}();
nokia.places.manager=function(){function d(c){if(c){var e=c.placeId,b=c.onComplete;if(e&&"function"===typeof b)return c=f.getPlaceImagesUrl(e,c.start,c.limit),g(c,function(c,e){e===a&&(c=n.transformMediaObject(c));b(c,e)})}}var i=nokia.places,f=i.settings,k=i.comm.data.performPostRequest,g=i.comm.data.performRequest,b=i.utils.util,n=i.data.dataTransformer,a="OK";return{getPlaceData:function(c){if(c){var e=c.onComplete;if((c.placeId||c.href)&&e)return c=c.href?c.href+"&"+f.getClbTemplate():f.getPlaceUrl(c.placeId),
g(c,function(c,b){b===a&&(c=n.transformPlace(c));"function"===typeof e&&e(c,b)})}},getRating:function(a){if(a){var e=a.placeId,d=a.onComplete;if(e&&d)return a=f.getRatingUrl(e),g(a,function(a,c){var e={count:0,average:0};if(a&&a.averageRatings&&a.averageRatings.averageRating)for(var l=b.toArray(a.averageRatings.averageRating),f,q=0,k=l.length;q<k;q++)f=l[q],"OVERALL"===f.ratingType&&(e=n.transformRating(f));d(e,c)})}},getReviews:function(c){if(c){var e=c.placeId,b=c.onComplete;if(e&&b)return c=f.getReviewsUrl(e,
c),g(c,function(c,e){"function"===typeof b&&(e===a&&(c=n.transformMediaObject(c)),b(c,e))})}},getMedia:d,getImages:d,postRating:function(a){if(a){var e=a.placeId,b=parseInt(a.ratingValue,10);if(e&&b){var b=5<b?5:1>b?1:b,e=f.getRatingPostUrl(e),b="{ratings:{rating:[{value:"+b+",type:'OVERALL'}]}}",d=i.utils.util.createTempUserId();k(e,b,a.onComplete,d)}}}}}();
nokia.places.search.nsp=function(){function d(a){var c=[],b=a.searchCenter;a.limit&&c.push("size="+encodeURIComponent(a.limit));a.searchTerm&&c.push("q="+encodeURIComponent(a.searchTerm));a.category&&c.push("cat="+encodeURIComponent(a.category));"object"===typeof a.boundingBox&&"object"===typeof a.boundingBox.topLeft&&"object"===typeof a.boundingBox.bottomRight?c.push("X-Map-Viewport="+a.boundingBox.topLeft.longitude+","+a.boundingBox.bottomRight.latitude+","+a.boundingBox.bottomRight.longitude+","+
a.boundingBox.topLeft.latitude):b&&("number"===typeof b.longitude&&"number"===typeof b.latitude)&&c.push("at="+b.latitude+","+b.longitude);return c.join("&")}function i(e,f){var k=a.getSearchUrl()+d(e);return b.performRequest(k,function(a,b){b===c&&(a=n.transformSearchResults(a),e.onComplete(a,b))},f)}function f(e,f){var k=a.getCategorySearchUrl()+d(e);return b.performRequest(k,function(a,b){b===c&&(a=n.transformSearchResults(a),e.onComplete(a,b))},f)}function k(e,f){var k=a.getSuggestUrl()+d(e);
return b.performRequest(k,function(a,b){if(b===c)e.onComplete(a,b)},f)}var g=nokia.places,b=g.comm.data,n=g.data.dataTransformer,a=g.settings,c="OK";return{search:function(a,c){var d=a.useGeoLocation,h,j,l={latitude:0,longitude:0},g=b.getCallBackId(),q=!0===c?k:a.category?f:i;try{h=navigator?navigator.geolocation:null}catch(n){}!j&&d&&h?(h.getCurrentPosition(function(c){j={latitude:c.coords.latitude,longitude:c.coords.longitude};a.searchCenter=j;q(a,g)},function(){a.searchCenter=l;q(a,g)},{timeout:6E3}),
j=l):(a.searchCenter=j||a.searchCenter||l,q(a,g));return g}}}();
nokia.places.search.manager=function(){var d=nokia.places,i=d.settings,f=d.search.nsp,k=d.comm.data.performRequest,g=d.data.dataTransformer;return{findPlaces:function(b){if(b&&b.searchTerm&&b.onComplete)return f.search(b)},findPlacesByCategory:function(b){if(b&&b.category&&b.onComplete)return f.search(b)},suggestPlaces:function(b){if(b&&b.searchTerm&&b.onComplete)return f.search(b,!0)},findRecommendations:function(b){if(b){var d=b.placeId,a=b.onComplete;if(d&&"function"===typeof a)return b=i.getRecommendationsUrl(d,
b.limit),k(b,function(c,b){"OK"===b?a(g.transformSearchResults(c),b):a({},b)})}},reverseGeoCode:function(b){var b=b||{},d=b.latitude,a=b.longitude,c=b.onComplete,b=i.getReverseGeoUrl(b.latitude,b.longitude);if(d&&a&&"function"===typeof c)return k(b,function(a){if(a&&a.Response&&a.Response.View)if(a.Response.View.length){for(var a=a.Response.View[0].Result,b,d=0,h=a.length;d<h;d++)if(b=a[d],b.Location.Address.Street){c(g.transformReverseGeo(b),"OK");return}c(g.transformReverseGeo(a[0]),"OK")}else c("",
"OK");else c(a?a.Details:"","ERROR")})},geoCode:function(b){var b=b||{},d=b.address,a=b.searchTerm,c=b.onComplete,e,f=[];if(b.onComplete&&(a||d)){if(d)for(e in d)d.hasOwnProperty(e)&&f.push(d[e]);else f.push(a);a=encodeURIComponent(f.join(","));b=i.getGeoCodeUrl(a);return k(b,function(a){a&&a.Response?a.Response.View&&a.Response.View[0]&&a.Response.View[0].Result?c(g.transformReverseGeo(a.Response.View[0].Result[0]),"OK"):c(null,"OK"):c(a,"ERROR")})}}}}();
nokia.places.utils.dom=function(){function d(a){return j.getElementById(a)}function i(a){return"string"===typeof a?d(a):a}function f(a,c){for(var b in c)c.hasOwnProperty(b)&&("class"===b?a.className=c[b]:a[b]=c[b]);return a}function k(a,c){var b=i(a);if(b)for(var e=m.call(arguments,1),h=0,d=e.length;h<d;h++)e[h]&&b.appendChild(e[h])}function g(a){(a=i(a))&&a.parentNode&&a.parentNode.removeChild(a)}function b(a){if(a=i(a))for(;a.hasChildNodes();)b(a.firstChild);g(a)}function n(a){if(a=i(a))for(;a.hasChildNodes();)b(a.firstChild)}
function a(a,c,b){c="_"+c+"Handlers";a&&(a[c]=a[c]||[],a[c].push(b));return!0}function c(a){var a=a||window.event,c=a.relatedTarget;c||("mouseout"===a.type?c=a.toElement:"mouseover"===a.type&&(c=a.fromElement));return c}function e(a,c){for(;c&&c!==a;)c=c.parentNode;return c===a}function p(a,b){return function(h){var d=c(h);e(a,d)||b(h)}}function o(a,c,b,e){var a=i(a),h;h=a.removeEventListener?function(a,c,b,e){if(a=i(a)){if("mouseenter"===c||"mouseleave"===c)c="mouseenter"===c?"mouseover":"mouseout";
"mousewheel"===c&&a.removeEventListener("DOMMouseScroll",b,"undefined"!==typeof e?e:!1);a.removeEventListener(c,b,"undefined"!==typeof e?e:!1)}}:a.detachEvent?function(a,c,b){(a=i(a))&&a.detachEvent("on"+c,b)}:function(a,c){var b=i(a);b&&delete b["on"+c]};l.utils.dom.removeEvent=h;h(a,c,b,e)}function h(a,c){return!!i(a).className.match(RegExp("(\\s|^)"+c+"(\\s|$)","g"))}var j=document,l=nokia.places,m=Array.prototype.slice;return{byId:d,create:function(a,c,b){a=j.createElement(a);a=f(a,c);b&&"object"===
typeof b&&b.appendChild?a.appendChild(b):"string"===typeof b&&a.appendChild(j.createTextNode(b));return a},createFragment:function(){return j.createDocumentFragment()},append:k,remove:g,removeChildNodes:n,destroy:b,addEvent:function(c,b,e,h){var c=i(c),d;if(c&&(c.addEventListener?d=function(c,b,e,h){if(c=i(c))if(h="undefined"!==typeof h?h:!1,"mouseenter"===b||"mouseleave"===b){var d="mouseenter"===b?"mouseover":"mouseout",e=p(c,e);c.addEventListener(d,e,h);a(c,b,e)}else a(c,b,e),c.addEventListener(b,
e,h),"mousewheel"===b&&c.addEventListener("DOMMouseScroll",e,h);return e}:c.attachEvent&&(d=function(c,b,e){var h=i(c);if(h){var d=function(){e.call(c,window.event,arguments)};a(h,b,d);h.attachEvent("on"+b,d);return d}}),d))return l.utils.dom.addEvent=d,d(c,b,e,h)},removeEvent:o,removeAllEvents:function(a,c){var b=i(a),e="_"+c+"Handlers",h=b[e],d;if(h){for(var j=0,f=h.length;j<f;j++)d=h[j],o(b,c,d);b[e]=[]}},hasClass:h,addClass:function(a,c){var b=i(a),e=m.call(arguments,1),d=[];if(b){for(var j=0,
f=e.length;j<f;j+=1)h(b,e[j])||d.push(e[j]);d.length&&(b.className+=(b.className.length?" ":"")+d.join(" "));return d.length}},removeClass:function(a,c){var b=i(a),e=m.call(arguments,1);if(b){var h=b.className.split(/\s+/),d=e.length,j=0;if(d){for(;d--;)for(var f=h.length-1;0<=f;f--)e[d]===h[f]&&(h.splice(f,1),j++);b.className=h.join(" ")}else b.className="";return j}},hide:function(){for(var a,c,b=arguments.length;b--;)if(a=i(arguments[b]))c=a.style.display,a._lastDisplay="none"!==c?c:"",a.style.display=
"none"},show:function(){for(var a,c=arguments.length;c--;)if(a=i(arguments[c]))a.style.display=a._lastDisplay||""},invisible:function(a){var a=i(a),c;a&&(c=a.style.visibility,a._lastVisibility="hidden"!==c?c:"",a.style.visibility="hidden")},visible:function(a){if(a=i(a))a.style.visibility=a._lastVisibility||""},setText:function(a,c){var b=i(a);b&&(n(b),k(b,j.createTextNode(c)))},setHtml:function(a,c){var b=i(a);b&&(b.innerHTML=c)},byTagName:function(a,c){return(c||j).getElementsByTagName(a)},stopPropagation:function(a){a=
a||window.event;a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation()},extendNodeAttributes:f,isContainedWithin:e,getMouseRelatedTarget:c,getEventSource:function(a){a=a||window.event;return a.target||a.srcElement},preventDefault:function(a){a=a||window.event;a.returnValue=!1;a.preventDefault&&a.preventDefault()},elem:i,moveChildNodes:function(a,c){for(var b=c.firstChild;b;)k(a,b),b=c.firstChild}}}();
nokia.places.utils.css=function(){var d=nokia.places.utils.dom,i,f={};return{loadCss:function(k){var g=d.byTagName("head")[0];if(g&&!f[k]){var b=d.create("link",{rel:"stylesheet",type:"text/css",href:k});g.hasChildNodes()&&!i&&(i=g.firstChild);i?g.insertBefore(b,i):d.append(g,b);f[k]=!0}}}}();
nokia.places.utils.loader=function(){var d,i,f;function k(a){o[a]||(o[a]={state:d,callbacks:[]});return o[a]}function g(a){a=a.split(".");if(3===a.length)return{origin:a[0],group:a[1],name:a[2]}}function b(a,c){var b=p.settings.getTemplateGroupUrl(c),e=o[c];e.state=i;p.comm.core.get(b,function(){e.state=f;var b=p.ui.templates[c][a];p.i18n.applyGroupTransl(c);for(var h=0,d=e.callbacks.length;h<d;h++)e.callbacks[h](b);e.callbacks=[]})}function n(a){var c=p.settings.getI18nUrl(a),b=o[a];b.state=i;p.comm.core.get(c,
function(){h=a;for(var c=0,e=b.callbacks.length;c<e;c++)b.callbacks[c]();delete o[a]})}function a(a,c){var b=k(a);b.state===f?c():b.callbacks.push(c)}function c(a){if("string"===typeof a)return a=a.split("."),3===a.length&&"nokia"===a[0]?!0:!1}function e(a){var a=g(a),c=p.ui.templates;if(c[a.group])return c[a.group][a.name]}var p=nokia.places,o={};d=1;i=2;f=3;var h;return{isNokiaTemplate:c,getNokiaTemplate:function(a,h){if(c(a)){var d=g(a),f=k(d.group);if(p.ui.templates[d.group]){var n=e(a);n?h(n,
!0):(f.callbacks.push(function(a){h(a,!0)}),f.state!==i&&b(d.name,d.group));return}}h(a,!1)},getLocaleMap:function(c,b){if("string"!==typeof c)return!1;var e=k(c);h&&h===c?b(c):(a(c,b),e.state!==i&&n(c))},defer:a}}();
nokia.places.settings=function(){function d(){var a=this.jslocation||nokia.maps;if(a&&a.util&&a.util.services)return a.util.services}var i=nokia.places,f=i.utils.util,k=f.ensureReplaced,g=f.replace,b=k("${cnContext}",!1),n={"cs-cz":1,"da-dk":1,"de-de":1,"el-gr":1,"en-gb":1,"en-us":1,"es-es":1,"fi-fi":1,"fr-fr":1,"hi-in":1,"hr-hr":1,"hu-hu":1,"id-id":1,"is-is":1,"it-it":1,"ko-kr":1,"nl-nl":1,"no-no":1,"pl-pl":1,"pt-pt":1,"pt-br":1,"ro-ro":1,"ru-ru":1,"sk-sk":1,"sv-se":1,"th-th":1,"tr-tr":1,"zh-cn":1,
"zh-hk":1,"zh-tw":1},a={zh:"CHI",es:"SPA",fr:"FRE",it:"ITA",de:"GER",ru:"RUS"},c=document.getElementsByTagName("script"),e=k("jsPlacesAPI.js","jsPlacesAPI.js"),p=function(){for(var a=c.length;a--;){var b=c[a].src;if(-1!==b.indexOf(e))return b.replace(e,"")}return""}(),o="token={TOKEN}&appId={APPID}&";d()&&(o="");var h=k("${cssUrl}","../src/main"),j=(p?p:"../target/uncompressed/")+"assets/places",l=k("http://{NO}.maptile.lbs.ovi.com/maptiler/v2/maptile/newest/","http://{NO}.maptile.lbs.ovi.com/maptiler/v2/maptile/newest/"),
m=k("http://{NO}.mrsmon.lbs.ovi.com/maptiler/v2/traffictile/newest/","http://{NO}.mrsmon.lbs.ovi.com/maptiler/v2/traffictile/newest/"),q="{TYPE}.day{TYPEEXT}/{ZOOM}/{X}/{Y}/{TILE_SIZE}/png8?"+o+"lg={LG}",s=parseInt(k("4",4),10),r=0,t={fb:"http://www.facebook.com/sharer.php?api_key=102468629021&u={URL}&t={TITLE}",tw:"http://twitter.com/home?status={TITLE} {URL} (via @nokia)"},k=function(){};f.inherit(i.settings.constructor,k,{setCssUrl:function(a){h=a},getAggregatedCssUrl:function(a){return g("{S_RES}/css/{CSS_NAME}",
{S_RES:this.getStaticResUrl(),CSS_NAME:a})},getCssUrl:function(a){return g("{S_RES}/css/{CSS_NAME}",{S_RES:h,CSS_NAME:a})},setStaticResUrl:function(a){j=a},getStaticResUrl:function(){return j},getTileUrl:function(c){var b=this.getLocale().split("-")[0],e=this.getAppContext(),h=s,j=l+q,f=d();c.TYPEEXT="";c.APPID=e.appId;c.TOKEN=e.authToken;"grey"===c.TYPE?(h=10,c.TYPEEXT=".grey",c.TYPE="normal",j=m+q):"transit"===c.TYPE&&(c.TYPEEXT=".transit",c.TYPE="normal");c.NO=++r%h+1;if(10===s||".grey"===c.TYPEEXT)c.NO=
String.fromCharCode(97+c.NO);c.LG=a[b]||"";j=g(j,c);return f?f.addNlpParams(j,!0):j},getShareUrl:function(a){return g("http://maps.ovi.com/services/place/{ID}",{ID:a})},get3rdPartyShareUrl:function(a,c,b){if(a=t[a])return g(a,{URL:encodeURIComponent(b),TITLE:encodeURIComponent(c)})},getTemplateGroupUrl:function(a){return g("{S_RES}/templates/{G_NAME}/{GROUP}.js",{S_RES:this.getStaticResUrl(),G_NAME:a,GROUP:a,LANG:this.getLocale()})},getI18nUrl:function(a){a=a||this.getLocale();a=a.toLowerCase();if(!n[a]){var a=
a.split("-")[0],c=f.getDefaultDialect(a),a=[a,c].join("-");n[a]||(a="en_gb")}a=a.replace("-","_");return g("{S_RES}/i18n/{LANG}.js",{S_RES:this.getStaticResUrl(),LANG:a})},getNavigateToUrl:function(a,c){return g("http://maps.nokia.com/services/directions?x0={LAT1}&y0={LON1}&x1={LAT2}&y1={LON2}&route_type=fastest&transport_mode=car&maptype=normal.day",{LAT1:a.latitude||0,LON1:a.longitude||0,LAT2:c.latitude,LON2:c.longitude})},getCnContext:function(){return b},getMapsNamespace:function(){return window.jslocation||
nokia.maps},mapIconAnchor:{x:13,y:32}});k.prototype.constructor=k;return new k}();
nokia.places.i18n=function(){function d(b){for(var a in g)g.hasOwnProperty(a)&&(b=b.replace(RegExp("___"+a+"___","g"),g[a]||""));return b}function i(b){var a,c,e;for(a in k.ui.templates[b])k.ui.templates[b].hasOwnProperty(a)&&(c=k.ui.templates[b][a],e=d(c.getRawHtml()),c.setI18nHtml(e))}function f(){for(var b in k.ui.templates)k.ui.templates.hasOwnProperty(b)&&i(b)}var k=nokia.places,g={},b;return{setMap:function(d,a){g=a||{};b!==d&&(f(),b=d)},getValue:function(b){return g[b]||""},getRatingTitle:function(b){switch(b){case 1:return this.getValue("places.rating.awful");
case 2:return this.getValue("places.rating.poor");case 3:return this.getValue("places.rating.okay");case 4:return this.getValue("places.rating.prettyCool");case 5:return this.getValue("places.rating.excelent")}},applyTranslation:d,applyTranslations:f,applyGroupTransl:i}}();var jsMotif=jsMotif||{};
jsMotif.errors={LVL:{log:3,warn:2,critical:1},MSG:{undefData:"Undefined data",undefModule:"Undefined module",wrongSrcNode:"This node type cannot have src attribute",reqRelNotFound:"Cannot found required rel %s1 in %s2 module",noTargetNode:"target node unknown"}};jsMotif.dom=nokia.places.utils.dom;
jsMotif.selector=function(){function d(a){return a.replace(/(^\s+)|(\s+$)/g,"")}function i(a){var c=-1,e,f,k,h,j;if("!"===a.charAt(0))j=b["!"],k=d(a.substr(1,a.length));else{for(var g in b)b.hasOwnProperty(g)&&(f=a.lastIndexOf(g),f>c&&(c=f,e=g));-1!==c&&(j=b[e],h=d(a.substr(c,a.length).split(e)[1]).replace(/(^\')|(^\")|(\'$)|(\"$)/g,""),k="!"!==e?d(a.substr(0,c)):h)}return{valuePath:k,toValue:h,action:j}}function f(a,c){var b=c.join("");""!==b&&(a=a[b]);return a}function k(a){a=a.replace(/([\]\)\.]+)\./g,
function(a,b){return b?b+"":a});n[a.charAt(a.length-1)]||(a+=".");return a}function g(a,c){if("string"!==typeof a)return c;for(var b=this,d=[],f=[],a=k(a),h=0,j=a.length;h<j;h++){var g=a.charAt(h);n[g]?b=n[g](b,d,f,g):d.push(g);if("undefined"===typeof b)return c}return b}var b={"==":function(a,c){return a==c},"!=":function(a,c){return a?a!=c:!1},">=":function(a,c){return a>=c},"<=":function(a,c){return a<=c},">":function(a,c){return a>c},"<":function(a,c){return a<c},"!":function(a){return!a}},n=
{".":function(a,c,b,d){if(b.length)c.push(d);else{if(a instanceof Array){for(var b=0,d=a.length,g=[];b<d;b++)g.push(f(a[b],c));a=g}else a=f(a,c);c.splice(0,c.length)}return a},"(":function(a){return a},")":function(a,c,b,d){if(b.length)return c.push(d),a;c=c.join("");if("function"===typeof a[c])return a[c]()},"[":function(a,c,b,d){b.length?c.push(d):(a=f(a,c),c.splice(0,c.length));b.push(d);return a},"]":function(a,c,b,d){b.pop();if(b.length)c.push(d);else{b=c.join("");if(isNaN(b)){for(var b=i(b),
d=[],f=0,h=a.length;f<h;f++){var j=a[f],k=g.call(j,b.valuePath);b.action(k,b.toValue)&&d.push(j)}a=d}else""!==b&&(a=a[parseInt(b,10)]);c.splice(0,c.length)}return a}};return{resolveCondition:function(a){if("string"!==typeof a)return!1;var c;if(g.call(this,a,!1))return!0;a=i(a);return a.action?(c=g.call(this,a.valuePath),a.action(c,a.toValue)):!1},getData:g}}();
jsMotif.Template=function(){var d=jsMotif.errors,i=jsMotif.dom,f=jsMotif.selector,k=function(a){return a&&"{"===a.charAt(0)&&"}"===a.charAt(a.length-1)?a.substr(1).substr(0,a.length-2):!1},g=function(a,c,b){b=b.cloneNode(!0);this.renderObject(b,c);i.append(a,b)},b=function(a,c,b){a=(a=a.match(/(\S+)\(\)/))?a[1]:void 0;if(a&&this.predefinedFunctions[a])return this.predefinedFunctions[a].call(b,c)},n=function(a,c,e,d){d&&(c=decodeURI(c));c=k(c);if(!1!==c)return d=f.getData.call(e,c),"undefined"===typeof d&&
(d=b.call(this,c,e,a)),d},a=function(a,c,b,e){var d=this;return c.replace(/(\{[^\{\}]+\})/g,function(c,h){var j=n.call(d,a,h,b,e);return"undefined"!==typeof j?j:""})},c=function(c,b,e){b=a.call(this,c,b,e);if("undefined"!==typeof b)return b instanceof Array&&(b=b.join(", ")),c.innerHTML=b;i.hide(c);return!1},e=function(c,b,e){b=a.call(this,c,b,e,!0);e=c.nodeName.toLowerCase();"string"===typeof b&&("a"===e||"link"===e?c.href=b:c.src=b);return b},p=function(c,b,e){(b=a.call(this,c,b,e,!0))&&c.setAttribute("href",
"mailto:"+b);return b},o=function(c,b,e){if(b=a.call(this,c,b,e,!0))c.className+=" "+b;return b},h=function(a,c,e){c=k(c);if(!1!==c){var d=b.call(this,c,e);"undefined"===typeof d&&(d=f.resolveCondition.call(e,c));if(!d)return i.hide(a),!1}},j=function(a,c,b){c=n.call(this,a,c,b);if(c instanceof Array&&0!==c.length){b=i.createFragment();i.moveChildNodes(b,a);for(var e=0,d=c.length;e<d;e++)c[e]._index=e+1,g.call(this,a,c[e],b)}else i.hide(a);return!1},l=function(a,c){var b=i.byId(c);b&&(i.moveChildNodes(a,
b.cloneNode(!0)),a.removeAttribute("tpl"))},m=function(a,c,b){var c=this.eventMap[c],e=function(a,c,b){return function(e){a.handler.call(c,b,e)}};if(c)for(var d=0,h=c.length;d<h;d++){var j=c[d];j&&(j.name&&"function"===typeof j.handler)&&i.addEvent(a,j.name,e(j,a,b))}},q=function(a){this.targetElem=i.elem(a.targetNode)||i.elem(a.template);this.mapping=[];var b=i.elem(a.template);this.templateBody=b?b.innerHTML:a.template;this.debug=a.debug||0;this.predefinedFunctions=a.functions||{};this.attributes=
[];this.registerAttr("tpl",l);this.registerAttr("if",h);this.registerAttr("each",j);this.registerAttr("fill",c);this.registerAttr("url",e);this.registerAttr("rel",m);this.registerAttr("mailto",p);this.registerAttr("addClass",o);this.eventMap={};this.addEventMap(a.events);a=i.create("div",{});a.innerHTML=this.templateBody;this.fragment=i.createFragment();i.moveChildNodes(this.fragment,a)},s=function(a){for(var a=a.childNodes,c,b,e=0,d=a.length;e<d;e++)c=a[e],"#text"!==c.nodeName&&"#comment"!==c.nodeName&&
((b=c.getAttribute("rel"))&&(this[b]=c),c.hasChildNodes()&&s.call(this,c))};q.prototype={render:function(a,c,b){this.jsonObject=a;(c=c?i.elem(c):this.targetElem)?(b||(c.innerHTML=""),g.call(this,c,a,this.fragment),this.targetElem=c):this.errorLog(d.LVL.critical,d.MSG.noTargetNode,this)},fetch:function(a){this.jsonObject=a;var c=i.create("div",{});g.call(this,c,a,this.fragment);return c.innerHTML},registerAttr:function(a,c){this.attributes.push({name:a,handler:c})},addEvent:function(a,c,b){a&&(c&&
b)&&(this.eventMap[a]||(this.eventMap[a]=[]),this.eventMap[a].push({name:c,handler:b}))},addEventMap:function(a){if(a&&a instanceof Array)for(var c=0,b=a.length;c<b;c++){var e=a[c];this.addEvent(e.rel,e.name,e.handler)}},getRelMap:function(a){var c={};s.call(c,a);return c},renderObject:function(a,c){if(!a)return!1;var b=a.childNodes,e=0,d=0,h,j,f,g;if(a.getAttribute){e=0;for(d=this.attributes.length;e<d;e++)if(j=this.attributes[e],f=j.name,h=a.getAttribute(f))h=j.handler.call(this,a,h,c),!1!==g&&
(g=h),"rel"!==f&&("tpl"!==f&&"src"!==f&&"href"!==f)&&a.removeAttribute(f)}if(!1===g)return!1;e=0;for(d=b.length;e<d;e++)f=b[e],"#text"!==f.nodeName&&"#comment"!==f.nodeName&&this.renderObject(f,c)},errorLog:function(a,c){var b=Array.prototype.slice.call(arguments,1);if(this.debug>=a&&"object"===typeof window.console){if(a===d.LVL.log)return window.console.log.apply(window.console,b);if(a===d.LVL.warn)return window.console.warn.apply(window.console,b);if(a===d.LVL.critical)return window.console.error.apply(window.console,
b)}}};return q}();
nokia.places.ui.templateFunctions=function(){function d(d,f){return d.description.length>f.description.length?-1:1}var i=nokia.places,f=jsMotif.selector;return{formattedAddress:function(d){return d.vicinity?d.vicinity:d.location.address.text},addressLine:function(d){return(d.vicinity?d.vicinity:d.location.address.text).replace(/<br\/>/g,", ")},primaryFax:function(d){return f.getData.call(d,"contacts.fax[0].value","")},primaryMobile:function(d){return f.getData.call(d,"contacts.phone[label==mobile].value","")},
primaryEmail:function(d){return f.getData.call(d,"contacts.email[0].value","")},primaryPhone:function(d){return f.getData.call(d,"contacts.phone[0].value","")},sendSMS:function(d){return d.view?"sms:enter number?body="+d.view:""},primaryURL:function(d){return(d=f.getData.call(d,"contacts.website[0].value",""))?i.utils.util.addProtocolToUrl(d):""},primaryURLLabel:function(d){d=f.getData.call(d,"contacts.website[0].value","");return 25<d.length?i.i18n.getValue("places.bubble.website"):d},reviewDate:function(d){if(d&&
(d=d.date)&&d.split){var d=d.split("T")[0],f=new Date(d);isNaN(f)&&(d=d.split("-"),f=new Date(d[0],d[1]-1,d[2]));return f.toLocaleDateString()}return""},reviewMetaData:function(d){var f=i.i18n.getValue("places.reviews.metaData");return i.utils.util.replace(f,{AUTHOR:d.user.name,DATE:i.ui.templateFunctions.reviewDate(d)})},primaryDescriptions:function(i){i=f.getData.call(i,"media.editorials.items[supplier.supplierId!=primeplace]",[]);i.sort(d);return 2<i.length?i.slice(0,2):i},isPlace:function(d){var f=
RegExp(/([\w\d]{8}-[\w\d]{32})/);return d.href?f.test(d.href):d.placeId?f.test(d.placeId):!1},iconCategory:function(){return""},indexDigits:function(d){return 9>=d._index?"one-digit":9<d._index&&99>=d._index?"two-digits":"three-digits"}}}();
nokia.places.ui.Template=function(){var d=nokia.places,i=jsMotif.Template,f=jsMotif.dom,k=d.utils.util,g=d.settings,b=d.utils.enums.CssUrlModes,n=+new Date,a=function(a){if("string"===typeof a){var c=a.split(".");if(3===c.length&&"nokia"===c[0]&&(a=c[1],c=c[2],d.ui.templates[a]))return d.ui.templates[a][c]}},c=function(a,c){var e=c.getName(),i=c.getGroup();!1!==a&&f.addClass(a,"nokia-places-"+i+"-"+e);var n=this._params.css;if(n===b.NON_AGGREGATED)e=g.getCssUrl(i+"/"+e+".css");else{if(n===b.NONE)return;
e=g.getAggregatedCssUrl("ovi-places-"+i+".css")}e&&d.utils.css.loadCss(e)},e=function(a){if("function"===typeof a)for(var c=0,b=this.length;c<b;c++)a.call(this[c],c)},p=function(b){var e=a(b.template);e&&(b.template=e.getHtml(),this.inboundTemplate=e);i.call(this,b);this._params=b;this.registerAttr("tpl",this.onAttrTpl);this.registerAttr("module",this.onAttrModule);this.moduleParams=b.moduleParams||{};this.modules={};this.stopRendering=["Reviews"];var f=this.predefinedFunctions,g=d.ui.templateFunctions,
n;for(n in g)g.hasOwnProperty(n)&&(f[n]||(f[n]=g[n]));if(e&&(b.targetNode||b.map))c.call(this,b.targetNode||!1,e)};d.utils.util.inherit(i,p,{onAttrModule:function(a,c,b){if(d.ui.modules[c]){b=d.utils.util.mixin({data:b,node:a},this.moduleParams[c]);b.template=this;var b=new d.ui.modules[c](b),e=(n++).toString(36);a._moduleKey=e;this.modules[e]={name:c,module:b};if(b.selfRendering)return!1}else this.errorLog(jsMotif.errors.LVL.critical,jsMotif.errors.MSG.undefModule,a)},render:function(a,c){this.modules=
[];i.prototype.render.call(this,a,c);this.inboundTemplate&&f.addClass(this.targetElem,"nokia-places-"+this.inboundTemplate.getGroup()+"-"+this.inboundTemplate.getName())},onAttrTpl:function(b,d){var e=a(d);if(e){var g=f.create("div",{});g.innerHTML=e.getHtml();f.moveChildNodes(b,g);b.removeAttribute("tpl");c.call(this,b,e)}else return!1},renderObject:function(a,c){if(!a)return!1;i.prototype.renderObject.call(this,a,c);if(a._moduleKey){var b=this.modules[a._moduleKey].module;b.setRelMap(this.getRelMap(a));
b.checkRequiredRel()&&b.initModule(this)}},getModules:function(a){var c=[],b,d;for(d in this.modules)this.modules.hasOwnProperty(d)&&(b=this.modules[d],b.name===a&&c.push(b.module));k.extendWith(c,{each:e});return c},showSpinner:function(){this.spinnerElem||(this.spinnerElem=f.create("div",{className:"nokia-spinner"}),f.append(this.targetElem,this.spinnerElem));f.show(this.spinnerElem)},hideSpinner:function(){if(!this.spinnerElem)return!1;f.hide(this.spinnerElem)}});return p}();
nokia.places.ui.modules.common=function(){return{getDefaultZoomLevel:function(){return 16},splitText:function(d){var i=[];if(d){var f=d.text,k=d.chars,d=d.words;f&&k?(i.push(f.substring(0,k)),k<f.length-1&&i.push(f.substring(k))):f&&d?(f=f.split(" "),i.push(f.slice(0,d).join(" ")),d<f.length-1&&i.push(f.slice(d).join(" "))):i.push(f)}return i},md5:function(d){function i(a,c){var b,d,e,h,f;e=a&2147483648;h=c&2147483648;b=a&1073741824;d=c&1073741824;f=(a&1073741823)+(c&1073741823);return b&d?f^2147483648^
e^h:b|d?f&1073741824?f^3221225472^e^h:f^1073741824^e^h:f^e^h}function f(a,c,b,d,e,h,f){a=i(a,i(i(c&b|~c&d,e),f));return i(a<<h|a>>>32-h,c)}function k(a,c,b,d,e,h,f){a=i(a,i(i(c&d|b&~d,e),f));return i(a<<h|a>>>32-h,c)}function g(a,c,b,d,e,h,f){a=i(a,i(i(c^b^d,e),f));return i(a<<h|a>>>32-h,c)}function b(a,c,b,d,e,h,f){a=i(a,i(i(b^(c|~d),e),f));return i(a<<h|a>>>32-h,c)}function n(a){var c="",b="",d;for(d=0;3>=d;d++)b=a>>>8*d&255,b="0"+b.toString(16),c+=b.substr(b.length-2,2);return c}var a=[],c,e,p,
o,h,j,l,m,d=function(a){for(var a=a.replace(/\r\n/g,"\n"),c="",b=0;b<a.length;b++){var d=a.charCodeAt(b);128>d?c+=String.fromCharCode(d):(127<d&&2048>d?c+=String.fromCharCode(d>>6|192):(c+=String.fromCharCode(d>>12|224),c+=String.fromCharCode(d>>6&63|128)),c+=String.fromCharCode(d&63|128))}return c}(d),a=function(a){var c,b=a.length;c=b+8;for(var d=16*((c-c%64)/64+1),e=Array(d-1),h=0,f=0;f<b;)c=(f-f%4)/4,h=8*(f%4),e[c]|=a.charCodeAt(f)<<h,f++;c=(f-f%4)/4;e[c]|=128<<8*(f%4);e[d-2]=b<<3;e[d-1]=b>>>
29;return e}(d);h=1732584193;j=4023233417;l=2562383102;m=271733878;for(d=0;d<a.length;d+=16)c=h,e=j,p=l,o=m,h=f(h,j,l,m,a[d+0],7,3614090360),m=f(m,h,j,l,a[d+1],12,3905402710),l=f(l,m,h,j,a[d+2],17,606105819),j=f(j,l,m,h,a[d+3],22,3250441966),h=f(h,j,l,m,a[d+4],7,4118548399),m=f(m,h,j,l,a[d+5],12,1200080426),l=f(l,m,h,j,a[d+6],17,2821735955),j=f(j,l,m,h,a[d+7],22,4249261313),h=f(h,j,l,m,a[d+8],7,1770035416),m=f(m,h,j,l,a[d+9],12,2336552879),l=f(l,m,h,j,a[d+10],17,4294925233),j=f(j,l,m,h,a[d+11],22,
2304563134),h=f(h,j,l,m,a[d+12],7,1804603682),m=f(m,h,j,l,a[d+13],12,4254626195),l=f(l,m,h,j,a[d+14],17,2792965006),j=f(j,l,m,h,a[d+15],22,1236535329),h=k(h,j,l,m,a[d+1],5,4129170786),m=k(m,h,j,l,a[d+6],9,3225465664),l=k(l,m,h,j,a[d+11],14,643717713),j=k(j,l,m,h,a[d+0],20,3921069994),h=k(h,j,l,m,a[d+5],5,3593408605),m=k(m,h,j,l,a[d+10],9,38016083),l=k(l,m,h,j,a[d+15],14,3634488961),j=k(j,l,m,h,a[d+4],20,3889429448),h=k(h,j,l,m,a[d+9],5,568446438),m=k(m,h,j,l,a[d+14],9,3275163606),l=k(l,m,h,j,a[d+
3],14,4107603335),j=k(j,l,m,h,a[d+8],20,1163531501),h=k(h,j,l,m,a[d+13],5,2850285829),m=k(m,h,j,l,a[d+2],9,4243563512),l=k(l,m,h,j,a[d+7],14,1735328473),j=k(j,l,m,h,a[d+12],20,2368359562),h=g(h,j,l,m,a[d+5],4,4294588738),m=g(m,h,j,l,a[d+8],11,2272392833),l=g(l,m,h,j,a[d+11],16,1839030562),j=g(j,l,m,h,a[d+14],23,4259657740),h=g(h,j,l,m,a[d+1],4,2763975236),m=g(m,h,j,l,a[d+4],11,1272893353),l=g(l,m,h,j,a[d+7],16,4139469664),j=g(j,l,m,h,a[d+10],23,3200236656),h=g(h,j,l,m,a[d+13],4,681279174),m=g(m,h,
j,l,a[d+0],11,3936430074),l=g(l,m,h,j,a[d+3],16,3572445317),j=g(j,l,m,h,a[d+6],23,76029189),h=g(h,j,l,m,a[d+9],4,3654602809),m=g(m,h,j,l,a[d+12],11,3873151461),l=g(l,m,h,j,a[d+15],16,530742520),j=g(j,l,m,h,a[d+2],23,3299628645),h=b(h,j,l,m,a[d+0],6,4096336452),m=b(m,h,j,l,a[d+7],10,1126891415),l=b(l,m,h,j,a[d+14],15,2878612391),j=b(j,l,m,h,a[d+5],21,4237533241),h=b(h,j,l,m,a[d+12],6,1700485571),m=b(m,h,j,l,a[d+3],10,2399980690),l=b(l,m,h,j,a[d+10],15,4293915773),j=b(j,l,m,h,a[d+1],21,2240044497),
h=b(h,j,l,m,a[d+8],6,1873313359),m=b(m,h,j,l,a[d+15],10,4264355552),l=b(l,m,h,j,a[d+6],15,2734768916),j=b(j,l,m,h,a[d+13],21,1309151649),h=b(h,j,l,m,a[d+4],6,4149444226),m=b(m,h,j,l,a[d+11],10,3174756917),l=b(l,m,h,j,a[d+2],15,718787259),j=b(j,l,m,h,a[d+9],21,3951481745),h=i(h,c),j=i(j,e),l=i(l,p),m=i(m,o);return(n(h)+n(j)+n(l)+n(m)).toLowerCase()},stripBrackets:function(d){return d&&"{"===d.charAt(0)&&"}"===d.charAt(d.length-1)?d.substr(1).substr(0,d.length-2):!1}}}();
nokia.places.ui.modules.Module=function(){var d=nokia.places.utils.dom,i=function(d){this.params=d;this.setRelMap(d.relMap);this.data=d.data;this.element=d.node;this.template=d.template};i.prototype={name:"",getRequiredRel:function(){return[]},checkRequiredRel:function(){var d=this.getRequiredRel();if(d.length)for(var i=0,g=d.length;i<g;i++)if(!this.relMap[d[i]])return this.template.errorLog(jsMotif.errors.LVL.critical,jsMotif.errors.MSG.reqRelNotFound.replace(/%s1/,d[i]).replace(/%s2/,this.name)),
!1;return!0},hide:function(){d.hide(this.element)},show:function(){d.show(this.element)},initModule:function(){},setRelMap:function(d){this.relMap=d}};return i}();
nokia.places.ui.modules.MapBase=function(){function d(a){g.preventDefault(a)}function i(){this.centerOffset={x:0,y:0};var a;this.params&&this.params.centerOffset&&(a=f.ui.templateFunctions.isPlace(this.data)?this.params.centerOffset.place:this.params.centerOffset.address);a&&(this.centerOffset={x:a.x||0,y:a.y||0})}var f=nokia.places,k=f.ui.modules.Module,g=f.utils.dom,b=f.i18n,n={map:{name:"normal",jslName:"NORMAL",lang:"places.mapview.map"},satellite:{name:"hybrid",jslName:"SATELLITE",lang:"places.mapview.satellite"},
terrain:{name:"terrain",jslName:"TERRAIN",lang:"places.mapview.terrain"},transit:{name:"transit",jslName:"SMART_PT",lang:"places.mapview.pt"},traffic:{name:"grey",jslName:"TRAFFIC",lang:"places.mapview.traffic"}},a=["map","satellite","terrain","transit","traffic"],c=function(a){this.tileType=a.tileType||"map";this.zoom=a.zoom||16;k.call(this,a)};f.utils.util.inherit(k,c,{name:"Map",getRequiredRel:function(){return["map-container"]},setMap:function(){},render:function(){},getElemWidth:function(){return this.relMap["map-container"].offsetWidth||
0},getElemHeight:function(){return this.relMap["map-container"].offsetHeight||0},getTileTypes:function(){return n},initModule:function(a){var c=this,b=c.getElemWidth(),d=c.getElemHeight();if(b&&d){if(i.call(this),this.customIconUrl=this.params.iconUrl,this.customIconAnchor=this.params.iconAnchor,this.setupZoomControls(),this.setupTileControl(),this.setZoom(this.zoom),this.initialized=!0,"function"===typeof a.onReady)a.onReady()}else setTimeout(function(){c.initModule(c.params)},50);!0===this.params.autoResize&&
g.addEvent(window,"resize",function(){c.render()},!0)},setupTileControl:function(){var c=this.relMap["tile-switch"],b=this;c&&(this.setTileType(this.tileType),g.addEvent(c,"click",function(){for(var c=0,d=a.length;c<d;c++)if(b.tileType===a[c]){b.setTileType(a[(c+1)%d]);break}}))},modifyZoom:function(a){if("number"===typeof a&&!(0===this.zoom&&0>a||20===this.zoom&&0<=a))this.setZoom(this.zoom+a),this.render()},setupZoomControls:function(){var a=this;this.zoomOut=this.relMap["zoom-in"];this.zoomIn=
this.relMap["zoom-out"];this.zoomOut&&(g.addEvent(this.zoomOut,"click",function(){a.modifyZoom(1)}),g.addEvent(this.zoomOut,"mousedown",d));this.zoomIn&&(g.addEvent(this.zoomIn,"click",function(){a.modifyZoom(-1)}),g.addEvent(this.zoomIn,"mousedown",d))},setTileType:function(c){this.tileType=c||"map";this.render();if(c=this.relMap["tile-switch"])for(var d=0,f=a.length;d<f;d++)if(this.tileType===a[d]){g.setText(c,b.getValue(n[a[(d+1)%f]].lang));break}},setZoom:function(a){"number"===typeof a?(g.removeClass(this.zoomOut,
"limit"),g.removeClass(this.zoomIn,"limit"),this.zoom=a<this.minZoom?this.minZoom:20<a?20:a,a===this.minZoom?g.addClass(this.zoomIn,"limit"):20===a&&g.addClass(this.zoomOut,"limit")):this.zoom=16}});return c}();
nokia.places.ui.modules.MapLite=function(){function d(a){return{x:a.longitude/360+0.5,y:Math.min(1,Math.max(0,0.5-Math.log(Math.tan(Math.PI/4+Math.PI/2*a.latitude/180))/Math.PI/2))}}function i(a,c,e){var a=Math.pow(2,a),f=a*b,c=d({latitude:c,longitude:e}),e={};e.x=Math.floor(c.x*a);e.y=Math.floor(c.y*a);e.offsetX=Math.round(c.x*f-e.x*b);e.offsetY=Math.round(c.y*f-e.y*b);return e}function f(a,d,f,g){a=e.getTileUrl({X:a,Y:d,ZOOM:f,TILE_SIZE:b,TYPE:g||"normal"});return c.create("img",{src:a,"class":"tile"})}
function k(a,c,d){var e={};e.x=0<a-d.offsetX?b-Math.abs(a-d.offsetX)%b:Math.abs(a-d.offsetX)%b;0>e.x&&(e.x+=b);e.y=0<c-d.offsetY?b-Math.abs(c-d.offsetY)%b:Math.abs(c-d.offsetY)%b;0>e.y&&(e.y+=b);return e}function g(a,c,d){return{x:Math.ceil((c+a.x)/b)+(0>a.x?1:0),y:Math.ceil((d+a.y)/b)+(0>a.y?1:0)}}var b=256,n=nokia.places,a=n.ui.modules.MapBase,c=n.utils.dom,e=n.settings,p=n.ui.modules.common,o=function(c){a.call(this,c)};n.utils.util.inherit(a,o,{setMap:function(){var a=this.data.location.position,
c=this.data.location.bbox,e=p.getDefaultZoomLevel(),f=this.data.icon+".web.map.png";if(c){var n;n=this.getElemWidth();var o=this.getElemHeight(),r=c.bottomRight,c=d(c.topLeft),r=d(r);n=n>=o?Math.floor(Math.log(n/(b*(r.x-c.x)))/Math.LN2):Math.floor(Math.log(o/(b*(r.y-c.y)))/Math.LN2);this.zoom=n}if(this.relMap["map-container"]&&this.initialized){n=1;for(var t=!1,r=this.relMap["map-container"],o=r.offsetWidth,r=r.offsetHeight,c=o/2,u=r/2;!t;){var t=i(n,a.latitude,a.longitude),t=k(c,u,t),t=g(t,o,r),
x=Math.pow(2,n);(t=t.x<=x&&t.y<=x)||n++}this.minZoom=n;this.coordinates=a;this.pinImg.src=this.customIconUrl||f;this.setZoom(this.zoom||e);this.render()}},render:function(){c.removeChildNodes(this.tileWrapper);var a=this.relMap["map-container"];n.ui.templateFunctions.isPlace(this.data)?c.removeClass(a,"nokia-map-address"):c.addClass(a,"nokia-map-address");if(!this.coordinates)return!1;a.style.width="auto";var d=this.getElemWidth(),l=this.getElemHeight(),p=(d+this.centerOffset.x)/2,q=(l+this.centerOffset.y)/
2,o=i(this.zoom,this.coordinates.latitude,this.coordinates.longitude),r=k(p,q,o),t=g(r,d,l),u=this.getTileTypes();a.style.width=d+"px";a.style.height=l+"px";this.tileWrapper.style.width=t.x*b+"px";this.tileWrapper.style.height=t.y*b+"px";this.tileWrapper.style.left=-r.x+"px";this.tileWrapper.style.top=-r.y+"px";a=Math.ceil((p-o.offsetX)/b);q=Math.ceil((q-o.offsetY)/b);d=Math.pow(2,this.zoom);for(l=0;l<t.y;l+=1)for(p=0;p<t.x;p+=1)c.append(this.tileWrapper,f((p-a+o.x)%d,(l-q+o.y)%d,this.zoom,u[this.tileType].name));
this.setPinPosition(this.customIconAnchor||e.mapIconAnchor,this.relMap["map-container"])},initModule:function(){var b=this;a.prototype.initModule.call(this,{onReady:function(){var a=b.relMap["map-container"];a.style.overflow="hidden";a.style.position="relative";b.tileWrapper=c.create("div",{"class":"tiles-wrapper"});b.tileWrapper.style.position="absolute";b.tileWrapper.style.lineHeight="1px";b.mapControls=c.create("div",{"class":"icons"});b.addPin();b.addWatermark();c.append(a,b.tileWrapper,b.mapControls);
b.setMap()}})},addPin:function(){this.pinImg=c.create("img",{"class":"pin"});this.pinImg.style.position="absolute";c.append(this.mapControls,this.pinImg)},addWatermark:function(){var a=c.create("div",{"class":"nokia-place-map-watermark"}),b=c.create("span",{},"\u00a9 2013 Nokia");c.append(a,b);c.append(this.mapControls,a)},setPinPosition:function(a,c){if(a&&"number"===typeof a.x&&"number"===typeof a.y){var c=c||this.relMap["map-container"],b=this.getElemWidth.call(this,c),d=this.getElemHeight.call(this,
c);this.pinImg.style.left=Math.round((b+this.centerOffset.x)/2-a.x)+"px";this.pinImg.style.top=Math.round((d+this.centerOffset.y)/2-a.y)+"px"}}});return o}();
nokia.places.ui.modules.MapJSL=function(){var d=nokia.maps,i=nokia.places,f=i.ui.modules.MapBase,k=i.settings,g=function(b){f.call(this,b)};i.utils.util.inherit(f,g,{setMap:function(){var b=this.data.location.position,f=this.data.location.bbox,a=this.data.icon+".web.map.png",c=this.customIconAnchor||k.mapIconAnchor;if(this.initialized){this.minZoom=0;var e=this.centerOffset,g=0<=e.y?e.y:0,i=0>e.x?Math.abs(e.x):0,h=0>e.y?Math.abs(e.y):0;this.jslMap.setPadding(g,i,h,0<=e.x?e.x:0);this.coordinates=new d.geo.Coordinate(b.latitude,
b.longitude,null,!0);f?(b=f.topLeft,f=f.bottomRight,b=new d.geo.Coordinate(b.latitude,b.longitude,null,!0),f=new d.geo.Coordinate(f.latitude,f.longitude,null,!0),this.jslMap.zoomTo(new d.geo.BoundingBox(b,f),!1)):this.jslMap.setCenter(this.coordinates);this.pinImg=new d.map.Marker(this.coordinates,{icon:this.customIconUrl||a,anchor:{x:c.x,y:c.y}});this.jslMap.objects.add(this.pinImg);this.setZoom(this.zoom||16);this.render()}},render:function(){if(this.initialized){var b=this.getTileTypes();this.jslMap.setZoomLevel(this.zoom);
this.jslMap.set("baseMapType",this.jslMap[b[this.tileType].jslName])}},initModule:function(){var b=this,g=this.relMap["map-container"];f.prototype.initModule.call(this,{onReady:function(){try{d.util.ApplicationContext.set("defaultLanguage",k.getLocale())}catch(a){}b.jslMap=new d.map.Display(g,{components:[new d.map.component.Behavior]});b.jslMap.addObserver("zoomLevel",function(a,d,f){b.setZoom(f)});b.setMap()}})}});return g}();
nokia.places.ui.modules.Map=function(){var d=nokia.maps||{},i=nokia.places.ui.modules;return function(f){return d.map?new i.MapJSL(f):new i.MapLite(f)}}();
nokia.places.ui.modules.ShareMenu=function(){var d=nokia.places,i=d.ui.modules.Module,f=d.utils.dom,k=d.settings,g=function(b){i.call(this,b)};d.utils.util.inherit(i,g,{name:"ShareMenu",initModule:function(){f.hide(this.relMap["sharemenu-share-container"]);var b=this,d=b.data.view,a=b.data.name,c=b.relMap["sharemenu-share"],e=b.relMap["sharemenu-input"],g=b.relMap["sharemenu-cancel"],i=b.relMap["sharemenu-booking-cancel"],h=b.relMap["sharemenu-link"],j=b.relMap["sharemenu-link-container"],l=b.relMap["sharemenu-share-container"],
m=b.relMap["share-facebook"],q=b.relMap["share-twitter"],s=b.relMap["sharemenu-booking-container"],r=b.relMap["sharemenu-booking-link"],t=b.relMap["navigate-to-link"],u=navigator.geolocation;f.hide(s);r&&(f.addEvent(r,"click",function(){f.hide(j);f.show(s)}),f.addEvent(i,"click",function(a){f.preventDefault(a);f.hide(s);f.show(j)}));h&&(h.href=d);m&&(k.getCnContext()?f.hide(m):m.href=k.get3rdPartyShareUrl("fb",a,d));q&&(k.getCnContext()?f.hide(q):q.href=k.get3rdPartyShareUrl("tw",a,d));t&&(u?f.addEvent(t,
"click",function(){u.getCurrentPosition(function(a){a=k.getNavigateToUrl(a.coords,b.data.location.position);a=a+("&n1="+b.data.name);window.open(a)},function(){var a=k.getNavigateToUrl({},b.data.location.position),a=a+("&n0=&n1="+b.data.name);window.open(a)},{timeout:4E3})}):(a=k.getNavigateToUrl({},b.data.location.position),a+="&n0=&n1="+b.data.name,t.href=a));g&&(c&&e&&l)&&(e&&(e.value=d),f.addEvent(c,"click",function(a){f.show(l);f.hide(j);e.select();f.preventDefault(a)}),f.addEvent(g,"click",
function(a){f.preventDefault(a);f.hide(l);f.show(j)}))}});return g}();
nokia.places.ui.modules.CategorySearch=function(){function d(a){var c=this;return function(){var d={category:a,limit:c.maxResults,searchCenter:"function"===typeof c.searchCenter?c.searchCenter():c.searchCenter,boundingBox:"function"===typeof c.boundingBox?c.boundingBox():c.boundingBox,onComplete:function(a){c.onResults(a);c.listComponent&&c.listComponent.setData(a)}};c.onSearchStart();b.findPlacesByCategory(d)}}var i=nokia.places,f=i.ui.modules.Module,k=i.utils.dom,g=i.i18n,b=i.search.manager,n=function(a){f.call(this,
a);this._params=a;this.maxResults=a.maxResults||20;this.searchCenter=a.searchCenter;this.boundingBox=a.boundingBox;this.onResults=a.onResults||function(){};this.onSearchStart=a.onSearchStart||function(){};a.resultList&&this.registerResultList(a.resultList)};i.utils.util.inherit(f,n,{name:"CategorySearch",initModule:function(){var a,c;for(c in this.relMap)this.relMap.hasOwnProperty(c)&&c&&(a=this.relMap[c],a.setAttribute("title",g.getValue(c)),k.addEvent(a,"click",d.call(this,c)))},registerResultList:function(a){a&&
a.setData&&(this.listComponent=a)}});return n}();
nokia.places.ui.modules.SearchBox=function(){function d(a){a=j.trim(a);if(w){var c=r.parse(s.getItem(u))||{};c[a]||(c[a]=1);s.setItem(u,r.stringify(c))}}function i(){return{latitude:0,longitude:0}}function f(a){a=a.replace(/[\$\u0021-\u0025\u0027-\u002B\u003A-\u0040\u005B-\u0060\u007B-\u007E\u2000-\u206F\u2E00-\u2E7F]/g,"");a=a.replace(/(^\s+)|(\s+$)/g,"");a=a.replace(/[ ]{2,}/gi," ");return a.replace(/([\.&])+/g,"$1").replace(/\./g,"\\$1")}function k(a,c){for(var b=[],d=f(c),d=RegExp(d,"gim"),e=
0,h=a.length;e<h;e++)a[e].match(d)&&b.push(a[e]);return b}function g(a){var c=[],a=j.trim(a);if(w){var b=r.parse(s.getItem(u));if(b){for(var d in b)b.hasOwnProperty(d)&&c.push(d);return k(c,a)}}return c||[]}function b(a,c){return function(){for(var b=h.byTagName("dd",a.listElement),d=0,e=b.length;d<e;d++)h.removeClass(b[d],t);h.addClass(this,t);a.searchInput.value=c}}function n(a,c,b){return function(){d(c);a.selectedSearchModel=b;a.select(c)&&a.search()}}function a(a){var c={},b={},d={},e={},f=a.suggestions||
{},h=f.limits||{},g=f.handlers||{},j=h.maxSaved,n=h.maxSuggestions,k=h.maxSearched,h=h.maxFavourites;b.maxSaved=0===j?0:j||3;b.maxSuggestions=0===n?0:n||3;b.maxSearched=0===k?0:k||3;b.maxFavourites=0===h?0:h||3;e.limits=b;d.onSuggestions=g.onSuggestions;d.onSearchSuggestions=g.onSearchSuggestions;d.onSelect=g.onSelect;e.handlers=d;e.showAddress=f.showAddress;e.favorites=f.favourites;e.keyInterval=f.keyInterval||x;c.suggestions=e;c.searchCenter=a.searchCenter||i;c.boundingBox=a.boundingBox||function(){};
c.onResults=a.onResults;c.onSearchStart=a.onSearchStart;c.searchParams=a.searchParams;c.useGeoLocation=a.useGeoLocation;c.limit=a.maxResults||20;this.settings=c}function c(a,c,d){if(a.length){var e=this.listElements[c.name],g=h.create("dt",{"class":"title"},q.getValue(c.lang)),i,j,k,l,p,d=RegExp("("+f(d)+")","gi");h.append(e,g);c===v.SEARCH&&(this.searchSuggestions=[]);for(var o=0,m=a.length;o<m;o++)g=h.create("dd"),c===v.SEARCH?(p=a[o],this.searchSuggestions[o]=p,g._searchIndex=o,l=p.title,k=l.replace(d,
"<strong>$1</strong>"),this.settings.suggestions.showAddress&&(j=h.create("span",{"class":"suggestion-address"}),j.innerHTML=p.vicinity.replace(/<br\/>/g,", "))):(l=a[o],k=l.replace(d,"<strong>$1</strong>")),i=h.create("span",{"class":"suggestion"}),g.title=l,h.addEvent(g,"click",n(this,l,p)),h.addEvent(g,"mouseover",b(this,l)),h.setHtml(i,k),h.append(e,g),h.append(g,i,j);this.showSuggestions()}}function e(){var a=this.relMap["searchbox-input"],c=this.relMap["searchbox-button"],b=this;h.addEvent(a,
"keydown",function(c){var e=a.value;switch(c.keyCode){case 13:case 39:d(e);b.select(e)&&b.search();break;case 27:case 37:b.empty();break;case 38:b.navigateList(-1);break;case 40:b.navigateList(1);break;case 9:break;default:b.inputTimer&&clearTimeout(b.inputTimer),b.inputTimer=setTimeout(function(){b.suggest()},b.settings.suggestions.keyInterval)}});h.addEvent(document,"mousewheel",function(a){var c=0;a.wheelDelta?c=-a.wheelDelta:a.detail&&(c=a.detail);c&&b.navigateList(c)});h.addEvent(b.listElement,
"mouseenter",function(){b.suggestionsHover=!0});h.addEvent(b.listElement,"mouseleave",function(){b.suggestionsHover=!1});h.addEvent(a,"blur",function(){b.suggestionsHover||b.empty()});c&&h.addEvent(c,"click",function(){b.search()});this.searchInput=a}var p=nokia.places,o=p.ui.modules.Module,h=p.utils.dom,j=p.utils.util,l=p.comm.data,m=p.search.manager,q=p.i18n,s=window.localStorage,r=window.JSON,t="selected",u="nokia.places.suggestions",x=400,v={CURRENT:{name:"suggest-current",lang:"places.search.currentlocation"},
STORAGE:{name:"suggest-saved",lang:"places.search.saved"},SUGGESTION:{name:"suggest-nokia",lang:"places.search.suggestions"},SEARCH:{name:"suggest-search",lang:"places.search.results"},FAVOURITE:{name:"suggest-favorites",lang:"places.search.favourites"}},w=function(){var a=!!s&&!!r;if(a)try{s.setItem(u,null)}catch(c){a=!1}return a}(),y=function(c){o.call(this,c);a.call(this,c);this.currentLocation=null;c.resultList&&this.registerResultList(c.resultList)};p.utils.util.inherit(o,y,{name:"SearchBox",
getRequiredRel:function(){return["searchbox-input"]},initModule:function(){this.listElement=this.relMap["searchbox-list"];e.call(this);this.listElements={};var a=this.settings.suggestions,c=a.limits;this.listElement=this.relMap["searchbox-list"];this.hideSuggestions();for(var b in v)if(v.hasOwnProperty(b)&&("STORAGE"!==b||c.maxSaved))if("SUGGESTION"!==b||c.maxSuggestions)if("SEARCH"!==b||c.maxSearched)if(!("FAVOURITE"===b&&(!c.maxFavourites||!a.favouritesProvider))){var d=v[b],f=void 0;this.listElements[d.name]=
f=h.create("dl",{"class":d.name});h.append(this.listElement,f)}},search:function(){var a=this.settings;this.empty();this.abortRequest();this.inputTimer&&clearTimeout(this.inputTimer);if(a.onResults||this.listComponent){var c=this,b=p.utils.util.mixin({limit:a.limit,searchTerm:c.searchInput.value,searchCenter:a.searchCenter(),boundingBox:a.boundingBox(),useGeoLocation:a.useGeoLocation,onComplete:function(b,d){if("OK"!==d)return!1;if(a.onResults)a.onResults(b);c.listComponent&&c.listComponent.setData(b)}},
a.searchParams);if(a.onSearchStart&&"function"===typeof a.onSearchStart)a.onSearchStart();b.searchTerm&&1<=b.searchTerm.length&&(this._searchReqId=m.findPlaces(b))}},abortRequest:function(){l.abortRequest(this._searchReqId);l.abortRequest(this._suggestionsReqId);l.abortRequest(this._suggestionsSearchReqId)},suggest:function(){var a=this.searchInput.value,b=this.settings,d=b.suggestions,e=d.handlers,f=e.onSuggestions,h=e.onSearchSuggestions,e=b.searchCenter(),i=b.boundingBox(),j=d.limits,n=this;3>
a.length||(this.empty(),j.maxSuggestions&&(l.abortRequest(this._suggestionsReqId),this._suggestionsReqId=m.suggestPlaces({searchTerm:a,searchCenter:e,boundingBox:i,useGeoLocation:b.useGeoLocation,onComplete:function(b){b&&(b=b.suggestions.slice(0,j.maxSuggestions),c.call(n,b,v.SUGGESTION,a),f&&f(b))}})),j.maxSearched&&(l.abortRequest(this._suggestionsSearchReqId),this._suggestionsSearchReqId=m.findPlaces({searchTerm:a,searchCenter:e,boundingBox:i,useGeoLocation:b.useGeoLocation,onComplete:function(b,
d,e){if(b){b=b.results.items.slice(0,j.maxSearched);c.call(n,b,v.SEARCH,a,e);h&&h(b)}}})),j.maxSaved&&(b=g(a).slice(0,j.maxSaved),c.call(this,b,v.STORAGE,a)),j.maxFavourites&&d.favouritesProvider&&(b=k(d.favouritesProvider(),a).slice(0,j.maxFavourites),c.call(this,b,v.FAVOURITE,a)),this.currentLocation&&c.call(this,[this.currentLocation.text],v.CURRENT,a))},select:function(a){var c=this.settings.suggestions.handlers.onSelect;this.searchInput.value=a||this.searchInput.value;return c?(c(a,this.selectedSearchModel),
!1):!0},navigateList:function(a){var a=0<a?1:-1,c=h.byTagName("dd",this.listElement),b=c.length,d=-1;if(b){for(var e=0;e<b;e++)if(h.hasClass(c[e],t)){d=e;h.removeClass(c[e],t);break}d+=a;d===b?d=0:-1===d&&(d=b-1);a=c[d];h.addClass(a,t);c=a._searchIndex;this.selectedSearchModel="number"===typeof c?this.searchSuggestions[c]:void 0;this.searchInput.value=a.title}},empty:function(){var a=this.listElements,c,b;for(b in a)a.hasOwnProperty(b)&&(c=a[b],h.removeChildNodes(c));this.hideSuggestions()},showSuggestions:function(){if(this.params.onShowSuggestions)this.params.onShowSuggestions();
h.addClass(this.template.targetElem,"suggest");h.show(this.listElement)},hideSuggestions:function(){if(this.params.onHideSuggestions)this.params.onHideSuggestions();h.removeClass(this.template.targetElem,"suggest");h.hide(this.listElement)},registerResultList:function(a){a&&a.setData&&(this.listComponent=a)},setCurrentLocation:function(a){this.currentLocation=a}});return y}();
nokia.places.ui.modules.MobileGallery=function(){var d,i,f,k;function g(a,c){if(!c)return s=a,!0;q.removeClass(c,"mobile-gallery-elno-"+s);s+=+a;q.addClass(c,"mobile-gallery-elno-"+s)}function b(){g(3);var a=this;l.manager.getImages({placeId:this.data.placeId,onComplete:function(c,b){"OK"===b&&0<c.available&&(a.images=c.items,a.render(),q.show(a.element))}})}function n(a){var c,b=[];c=d+"/public/convert";b.push("uri="+encodeURIComponent(a));b.push("key="+nokia.places.ui.modules.common.md5(i+":"+a));
b.push("width="+f);b.push("height="+k);b.push("format=png");return c+"?"+b.join("&")}function a(){var a=this.relMap["gallery-list"].childNodes,c,b,d,e=this,f=function(){var a=this.offsetWidth>this.offsetHeight?"mobile-gallery-image-max-height":"mobile-gallery-image-max-width",c=e.onLoadElements.shift();q.addClass(c,a);c.style.backgroundImage="url('"+this.src+"')"};this.listElements=[];this.images.reverse();for(var h=function(a){return function(){g(-1,a.parentNode);q.hide(a)}},i=0,j=a.length;i<j;i++)b=
this.listElements.length,c=a[i],"#text"!==c.nodeName&&("#comment"!==c.nodeName&&"gallery-img"===c.getAttribute("rel"))&&(!this.images[b]||!this.images[b].src?(g(-1,c.parentNode),q.hide(c)):(d=document.createElement("img"),d.onerror=h(c),d.onload=f,d.src=n(this.images[b].src),c._imageindex=b,this.onLoadElements.push(c),this.listElements.push(c)))}function c(a,c,b){return function(){a.call(c,b)}}function e(a,b){var d={},e=this.images[a._imageindex],f,h,g,i,j;i=0;for(j=b.length;i<j;i++)f=b[i],d[f.name]||
(d[f.name]=[]),d[f.name].push(f.handler);for(g in d)if(d.hasOwnProperty(g)){f=d[g];q.removeAllEvents(a,g);i=0;for(j=f.length;i<j;i++)h=f[i],q.addEvent(a,g,c(h,a,e))}}function p(){var a=document.documentElement;return{width:Math.max(a.scrollWidth,a.scrollWidth,a.offsetWidth,a.offsetWidth,a.clientWidth,a.clientWidth),height:Math.max(a.scrollHeight,a.scrollHeight,a.offsetHeight,a.offsetHeight,a.clientHeight,a.clientHeight)}}function o(){var a=document.documentElement;return{width:a.clientWidth,height:a.clientHeight}}
function h(a){if(!a)return!1;var c=this.relMap["gallery-fullscreen"];if(c){var b=p();this.loadOverlay();c.scrollLeft=a._imageindex*b.width}}function j(){for(var a=this,c,b=function(){h.call(a,this)},d=a.template.eventMap["gallery-img"],f=0,g=this.listElements.length;f<g;f++)c=this.listElements[f],d&&e.call(a,c,d),q.addEvent(c,"click",b)}var l=nokia.places,m=l.ui.modules.Module,q=l.utils.dom,s=3,r=function(a){m.call(this,a);this.firstVisible=0};d="http://imager.vcdn.nokia.com";i="iof12i3j1oij321ooiasjdoi12";
k=f=400;l.utils.util.inherit(m,r,{onLoadElements:[],listElements:[],bigImages:[],overlayMoved:!1,name:"MobileGallery",getRequiredRel:function(){return["gallery-list","gallery-img"]},render:function(){a.call(this);j.call(this)},destroyOverlay:function(){var a=this.relMap["gallery-overlay"];q.hide(this.relMap["gallery-fullscreen"]);q.hide(a)},loadOverlay:function(){var a=this.relMap["gallery-fullscreen"],c=this.relMap["gallery-fullscreen-inner"],b=this.relMap["gallery-overlay"],d=this;if(!b||!a)return!1;
if(!0===this.overlayMoved)return q.show(a),q.show(b),!0;q.addEvent(a,"click",function(){d.destroyOverlay()},!1);q.addEvent(b,"click",function(){d.destroyOverlay()},!1);document.body.appendChild(a);document.body.appendChild(b);this.overlayMoved=!0;var e,f,h=this.images.length,g=p(),i=o();c.style.width=h*g.width+"px";for(var j=function(a,c){return function(){d.centerImage(a,c)}},n=0;n<h;n++)e=document.createElement("div"),e.className="mobile-gallery-big-image-container",e.style.width=g.width+"px",f=
document.createElement("img"),f.className="mobile-gallery-big-image",f.src=this.images[n].src,f.style.maxWidth=i.width-30+"px",f.style.maxHeight=i.height+"px",f.onload=j(f,i),this.bigImages.push(f),e.appendChild(f),c.appendChild(e);q.addEvent(window,"resize",function(){d.setSizes()},!0);b.style.display="block";a.style.display="block"},setSizes:function(){var a=o(),c=this.bigImages.length;this.relMap["gallery-fullscreen-inner"].style.width=c*a.width+"px";for(var b=0;b<c;b++)this.bigImages[b].style.maxWidth=
a.width-30+"px",this.bigImages[b].style.maxHeight=a.height+"px",this.centerImage(this.bigImages[b],a)},centerImage:function(a,c){a.style.top=c.height/2-a.offsetHeight/2+"px";a.style.left=c.width/2-a.offsetWidth/2+"px"},initModule:function(){q.hide(this.element);b.call(this)}});return r}();
nokia.places.ui.modules.Gallery=function(){function d(){var a=this;p.manager.getImages({placeId:this.data.placeId,limit:this.params.limit||j,onComplete:function(c,b){"OK"===b&&0<c.available&&(a.images=c.items,a.render(),h.show(a.element))}})}function i(a){var c=this.relMap["gallery-img-provider"];c&&(a?(h.setText(c,a.name),h.show(c)):h.hide(c))}function f(a){if(!a||!a.src)return!1;var c=this.relMap["gallery-big-img"];c&&(c.src=a.src,this.previewIndex=a._imageindex,i.call(this,this.images[this.previewIndex].supplier),
this.showPreview())}function k(a,c,b){return function(){a.call(c,b)}}function g(a,c){var b={},d=this.images[a._imageindex],e,f,g,i,j;i=0;for(j=c.length;i<j;i++)e=c[i],b[e.name]||(b[e.name]=[]),b[e.name].push(e.handler);for(g in b)if(b.hasOwnProperty(g)){e=b[g];h.removeAllEvents(a,g);i=0;for(j=e.length;i<j;i++)f=e[i],h.addEvent(a,g,k(f,a,d))}}function b(){for(var a=this,c,b=function(){f.call(a,this)},d=a.template.eventMap["gallery-img"],e=0,i=this.listElements.length;e<i;e++)c=this.listElements[e],
d&&g.call(a,c,d),h.addEvent(c,"click",b)}function n(){var a=this,c=this.relMap["gallery-big-close"],b=this.relMap["gallery-big-next"],d=this.relMap["gallery-big-previous"],e=this.relMap["gallery-overlay"],f=this.relMap["gallery-big-img"],g=a.images.length-1;c&&h.addEvent(c,"click",function(){a.hidePreview()});b&&h.addEvent(b,"click",function(){var c;a.images[a.previewIndex+1]?(c=a.images[a.previewIndex+1],a.previewIndex++):(c=a.images[0],a.previewIndex=0);f.src=c.src;i.call(a,c.supplier)});d&&h.addEvent(d,
"click",function(){var c;a.images[a.previewIndex-1]?(c=a.images[a.previewIndex-1],a.previewIndex--):(c=a.images[g],a.previewIndex=g);f.src=c.src;i.call(a,c.supplier)});e&&h.addEvent(e,"click",function(){a.hidePreview()})}function a(){var a=this;this.relMap["gallery-previous"]&&h.addEvent(this.relMap["gallery-previous"],"click",function(){h.show(a.relMap["gallery-next"]);var c=a.listElements.length,b=a.listElements[c-1];a.imgCounter--;b.src="";b.src=a.images[a.imgCounter-c].src;a.relMap["gallery-list"].insertBefore(b,
a.listElements[0]);a.listElements=[a.listElements.pop()].concat(a.listElements.slice());0===a.imgCounter-c&&h.hide(a.relMap["gallery-previous"])});this.relMap["gallery-next"]&&h.addEvent(a.relMap["gallery-next"],"click",function(){(!a.images[a.imgCounter+1]||!a.images[a.imgCounter+1].src)&&h.hide(a.relMap["gallery-next"]);h.show(a.relMap["gallery-previous"]);var c=a.listElements[0];c.src="";c.src=a.images[a.imgCounter++].src;h.append(a.relMap["gallery-list"],c);a.listElements=a.listElements.slice(1);
a.listElements.push(c)})}function c(){var a=document.documentElement;return{width:Math.max(a.scrollWidth,a.scrollWidth,a.offsetWidth,a.offsetWidth,a.clientWidth,a.clientWidth),height:Math.max(a.scrollHeight,a.scrollHeight,a.offsetHeight,a.offsetHeight,a.clientHeight,a.clientHeight)}}function e(){var a=0.5*(window.innerHeight||document.documentElement.clientHeight),c;c=document;c=Math.max(c.body.scrollTop,c.documentElement.scrollTop);return a+c}var p=nokia.places,o=p.ui.modules.Module,h=p.utils.dom,
j=20,l=["gallery-full-screen","gallery-big-previous","gallery-big-img","gallery-big-next","gallery-big-close"],m=function(a){o.call(this,a);this.firstVisible=0};p.utils.util.inherit(o,m,{listElements:[],name:"Gallery",getRequiredRel:function(){return["gallery-list","gallery-img"]},render:function(){var c=this.relMap["gallery-list"].childNodes,d=this.relMap["gallery-big-img"],e,f=this.images[0];this.listElements=[];h.hide(this.relMap["gallery-next"]);h.hide(this.relMap["gallery-previous"]);d&&(d.src=
f.src,i.call(this,f.supplier));for(var f=0,g=c.length;f<g;f++)e=this.listElements.length,d=c[f],"#text"!==d.nodeName&&("#comment"!==d.nodeName&&"gallery-img"===d.getAttribute("rel"))&&(!this.images[e]||!this.images[e].src?h.hide(d):(d.src=this.images[e].src,d._imageindex=e,this.listElements.push(d)));this.images[e+1]&&this.images[e+1].src&&h.show(this.relMap["gallery-next"]);this.imgCounter=this.listElements.length;b.call(this);a.call(this);n.call(this)},showPreview:function(){for(var a=this.relMap["gallery-full-screen"],
b=this.relMap["gallery-overlay"],d=c(),f=this.relMap["gallery-preview-box"],g=this.relMap["gallery-big-next"],i=this.relMap["gallery-big-previous"],j=0,n=l.length;j<n;j++){var k=l[j];this.relMap[k]&&h.show(this.relMap[k])}if(a&&(document.body.appendChild(a),b&&(b.style.width=d.width+"px",b.style.height=d.height+"px",this.onresHandler=h.addEvent(window,"resize",function(){var a=c();b.style.width=a.width+"px";b.style.height=a.height+"px";f.style.top=e()+"px"})),f))1===this.images.length?h.hide(g,i):
h.show(g,i),f.style.top=e()+"px"},hidePreview:function(){for(var a=0,c=l.length;a<c;a++){var b=l[a];this.relMap[b]&&h.hide(this.relMap[b])}this.onresHandler&&h.removeEvent(window,"resize",this.onresHandler);(a=this.relMap["gallery-full-screen"])&&this.element.appendChild(a)},initModule:function(){this.hidePreview();h.hide(this.element);d.call(this)}});return m}();
nokia.places.ui.modules.List=function(){function d(){var a=this.relMap["list-data"],c=a.getAttribute("each"),d=f.ui.modules.common.stripBrackets(c),g;d?(g=jsMotif.selector.getData.call(this.data,d),g=b.toArray(g),this.displayData={listData:g},a.setAttribute("each",c.replace(d,"listData"))):this.displayData={listData:[]}}function i(a,c){var b=g.create("li",{},c),d=this;g.addEvent(b,"click",function(){d.renderPage(a)});return b}var f=nokia.places,k=f.ui.modules.Module,g=f.utils.dom,b=f.utils.util,n=
function(a){k.call(this,a);this.selfRendering=!0;this.onRenderPage=a.onRenderPage||function(){};this.perPage=a.perPage||10};f.utils.util.inherit(k,n,{name:"List",getRequiredRel:function(){return["list-data"]},getPageData:function(a){var c=this.displayData.listData.length,a=(a-1)*this.perPage,b=a+this.perPage;return this.displayData.listData.slice(a,b>=c?c:b)},renderPage:function(a){this.page=a;var c=this.getPageData(a);this.selfRenderTemplate.render({listData:c});this.onRenderPage(c,a)},initModule:function(){var a=
this,c=b.mixin({},this.template._params,{template:this.element,targetNode:null});d.call(this);this.selfRenderTemplate=new f.ui.Template(c);this.selfRenderTemplate.registerAttr("rel",function(c,b,d){"list-pagination"===b&&a.fillPagination.call(a,c,d)});this.renderPage(1)},fillPagination:function(a){var c=Math.ceil(this.displayData.listData.length/this.perPage);if(1<c){var b=g.create("ul",{"class":"list-pagination"});if(1!==this.page){var d=i.call(this,this.page-1,"<");g.append(b,d)}for(d=1;d<=c;d++){var f=
i.call(this,d,""+d);this.page===d&&g.addClass(f,"current");g.append(b,f)}this.page<c&&(c=i.call(this,this.page+1,">"),g.append(b,c));g.append(a,b)}}});return n}();
nokia.places.ui.modules.Reviews=function(){function d(){var b=this;f.manager.getReviews({placeId:this.data.placeId,start:this.start,limit:this.limit,onComplete:function(a){a&&b.render(a)}})}function i(){var b=this;g.addEvent(this.relMap["reviews-next"],"click",function(){b.start+=b.limit;d.call(b)});g.addEvent(this.relMap["reviews-previous"],"click",function(){b.start-=b.limit;0>b.start&&(b.start=0);d.call(b)})}var f=nokia.places,k=f.ui.modules.Module,g=f.utils.dom,b=function(b){this.selfRendering=
!0;this.limit=b.limit||3;this.start=b.start||0;k.call(this,b)};f.utils.util.inherit(k,b,{name:"Reviews",start:0,render:function(b){g.show(this.element);this.reviewsTpl||(this.reviewsTpl=new f.ui.Template({template:this.element,moduleParams:{Rating:{enabled:!1}},css:this.template._params.css}),this.reviewsTpl.eventMap=this.template.eventMap);this.reviewsTpl.render(b);this.setRelMap(this.reviewsTpl.getRelMap(this.element));i.call(this);var a=this.start+this.limit-1,c=this.relMap["reviews-next"],d=this.relMap["reviews-previous"],
b=b.available;c&&(!b||a>=b-1?g.hide(c):g.show(c));d&&(!b||0>=this.start?g.hide(d):g.show(d))},initModule:function(){g.hide(this.element);d.call(this)}});return b}();
nokia.places.ui.modules.Expandable=function(){var d=nokia.places,i=d.ui.modules.Module,f=d.utils.dom,k=function(d){i.call(this,d);this.maxLength=d.maxLength||250};d.utils.util.inherit(i,k,{getRequiredRel:function(){return["expand-text","expand-show"]},initModule:function(){var g=this.relMap["expand-text"],b=this.relMap["expand-show"],i=this.relMap["expand-hide"],a=g.innerHTML,c=d.ui.modules.common.splitText({text:g.innerHTML,chars:this.maxLength});c[1]?(f.setHtml(g,c[0]+"..."),f.addEvent(b,"click",
function(){f.setHtml(g,a);f.hide(this);i&&f.show(i)}),i&&(f.addEvent(i,"click",function(){f.setHtml(g,c[0]+"...");f.hide(this);f.show(b)}),f.hide(i))):f.hide(b,i)}});return k}();
nokia.places.ui.modules.Advertisement=function(){function d(b){var d=this.storefrontTemplate.jsonObject;this.adManager&&this.adManager.actionLogger.log(b.action,"",d.ad)}var i=nokia.places,f=i.ui.modules.Module,k=i.utils.dom,g=function(b){f.call(this,b);this.selfRendering=!0};i.utils.util.inherit(f,g,{name:"Advertisement",getRequiredRel:function(){return["ad-storefront","ad-placement"]},initModule:function(){var b=this.params||{},f=this;this.adManager=b.adManager;this.hideAdFront("ad-storefront");
this.hideAdFront("ad-placement");b.htmlContent&&this.setHtmlContent(b.htmlContent,b.css);if(b=this.relMap["ad-storefront"])this.storefrontTemplate=new i.ui.Template({template:b.innerHTML,targetNode:b,events:[{rel:"action-link",name:"click",handler:function(a){d.call(f,a)}}]}),this.storefrontTemplate.render({})},setRouteActionForShareModule:function(b,f){var a=this.relMap["navigate-to-link"];a&&k.addEvent(a,"click",function(){d.call(f,b)})},setRouteAction:function(b){var d=this;this.template.getModules("ShareMenu").each(function(){d.setRouteActionForShareModule.call(this,
b,d)})},setStoreFront:function(b){this.storefrontTemplate&&this.storefrontTemplate.render(b);for(var b=b.ad.ctas,d,a=0,c=b.length;a<c;a++)d=b[a],"ROUTE"===d.action&&this.setRouteAction(d);this.showAdFront("ad-storefront");this.hideAdFront("ad-placement")},setHtmlContent:function(b,d){var a=this.relMap["ad-placement"];if(a&&b){d&&i.utils.css.loadCss(d);if("string"===typeof b)a.innerHTML=b,this.showAdFront("ad-placement");else try{k.append(a,b),this.showAdFront("ad-placement")}catch(c){this.template.errorLog(1,
"Ad could not be injected")}this.hideAdFront("ad-storefront");return a}},hideAdFront:function(b){(b=this.relMap[b])&&k.hide(b)},showAdFront:function(b){(b=this.relMap[b])&&k.show(b)}});return g}();
nokia.places.ui.modules.Recommendations=function(){function d(){var b=this;i.search.manager.findRecommendations({placeId:this.data.placeId,searchCenter:this.data.location.position,onComplete:function(d){b.render(d.results)}},!0)}var i=nokia.places,f=i.ui.modules.Module,k=i.utils.dom,g=function(b){this.selfRendering=!0;this.maxReviews=b.maxReviews;f.call(this,b)};i.utils.util.inherit(f,g,{name:"Reviews",start:0,render:function(b){if(!b)return!1;k.show(this.element);var d=new i.ui.Template({template:this.element,
moduleParams:{Rating:{enabled:!1}},css:this.template._params.css});d.eventMap=this.template.eventMap;d.render({recommendations:b});this.setRelMap(d.getRelMap(this.element))},initModule:function(){k.hide(this.element);d.call(this)}});return g}();
nokia.places.ui.modules.Rating=function(){function d(a,b,d){var f=this;return function(){f.ratingEnabled&&(f.updateVisuals(d),f.updateText(b))}}function i(a,b){var d=this,g=d.data.placeId;return function(){d.ratingEnabled&&!d.uiOnly?(d.updateText(f.i18n.getValue("places.rating.thanks")),n.postRating({placeId:g,ratingValue:b,onComplete:function(){n.getRating({placeId:g,onComplete:function(a){if(a){var c={average:a.average,count:a.count};d.setRating(c);d.onRated&&(a.placeId=g,d.onRated(c))}else d.hide()}})}})):
d.uiOnly&&d.setRating({value:b})}}var f=nokia.places,k=f.ui.modules.Module,g=f.utils.dom,b=f.i18n,n=f.manager,a=function(a){k.call(this,a);this.ratingEnabled=!1;this.onRated=a.onRated;this.uiOnly=!!a.uiOnly};f.utils.util.inherit(k,a,{name:"Rating",getRequiredRel:function(){return["rating-star1","rating-star2","rating-star3","rating-star4","rating-star5"]},initModule:function(){var a=0<=this.data.averageRating?this.data.averageRating:this.data.ratings?this.data.ratings:this.data.rating;"number"===
typeof a&&(a={average:a});this.setRating(a);this.assignEvents();this.updateText(b.getValue("places.rating.rateIt"))},assignEvents:function(){for(var a=this,e=this.relMap["rating-list"],f=1;6>f;f++){var k=this.relMap["rating-star"+f],h=b.getRatingTitle(f);g.addEvent(k,"mouseover",d.call(a,k,h,f));g.addEvent(k,"mousedown",i.call(a,k,f))}g.addEvent(e,"mouseout",function(){a.ratingEnabled&&!a.uiOnly&&a.updateVisuals(a.rating.average)});g.addEvent(a.element,"mouseout",function(){a.ratingEnabled&&(a.updateText(b.getValue("places.rating.rateIt")),
a.updateCount(a.rating.count))});g.addEvent(a.element,"mousemove",function(b){var d=a.relMap["rating-text"];if(d&&!0===a.ratingEnabled&&!0!==a.uiOnly){var e=0,f=0;if(b.pageX||b.pageY)e=b.pageX,f=b.pageY;else if(b.clientX||b.clientY)e=b.clientX,f=b.clientY;d.style.left=e+18+"px";d.style.top=f+15+"px"}})},setRating:function(a){this.rating=a||{average:0,count:0};this.updateCount(this.rating.count);this.updateVisuals(this.rating.average);this.updateValue(this.rating.average)},updateVisuals:function(a){for(var b=
0.5<=a%1,d,f=1;6>f;f++)d=this.relMap["rating-star"+f],g.removeClass(d),f<=a?g.addClass(d,"full"):f<a+1&&b&&g.addClass(d,"half");0<a||this.uiOnly||(this.rating?this.updateCount(this.rating.count):this.updateCount(""))},updateValue:function(a){var b=this.relMap["rating-value"];b&&("number"===typeof a?(a=parseFloat(a).toFixed(2),g.setText(b,a),g.show(b)):g.hide(b))},updateCount:function(a){var b=this.relMap["rating-count"],d=this.relMap["rating-first"],f=typeof a;b&&("number"===f?(g.setText(b,"("+a+
")"),g.show(b)):g.hide(b));d&&("number"===f?g.hide(d):this.uiOnly||g.show(d))},updateText:function(a){var b=this.relMap["rating-text"];b&&("string"===typeof a?(g.setText(b,a),g.show(b)):g.hide(b))},enable:function(){this.ratingEnabled=!0},disable:function(){this.ratingEnabled=!1}});return a}();
nokia.places.ui.modules.Accordion=function(){function d(a){for(var a=a.childNodes,b,e,f=0,g=a.length;f<g;f++)b=a[f],"#text"!==b.nodeName&&"#comment"!==b.nodeName&&!b._moduleKey&&(e=b.getAttribute("rel"),"accordion-header"===e?this.header.push(b):"accordion-body"===e&&this.body.push(b),b.hasChildNodes()&&d.call(this,b))}function i(a,c){return function(){a&&("none"===a.style.display?(g.show(a),g.addClass(c,b)):(g.hide(a),g.removeClass(c,b)))}}var f=nokia.places,k=f.ui.modules.Module,g=f.utils.dom,b=
"selected",n=function(a){k.call(this,a);this.toOpen=a.open||[1]};f.utils.util.inherit(k,n,{name:"Accordion",getRequiredRel:function(){return["accordion-header","accordion-body"]},initModule:function(){var a,c;this.relElements={header:[],body:[]};d.call(this.relElements,this.element);for(var e=0,f=this.relElements.header.length;e<f;e++)a=this.relElements.header[e],c=this.relElements.body[e],g.addEvent(a,"click",i(c,a)),"all"!==this.toOpen?g.hide(c):g.addClass(a,b);if(this.toOpen instanceof Array){e=
0;for(f=this.toOpen.length;e<f;e++)c=this.toOpen[e]-1,a=this.relElements.header[c],c=this.relElements.body[c],a&&c&&(g.show(c),g.addClass(a,b))}}});return n}();
nokia.places.widgets.Widget=function(){function d(){var a=this.template.inboundTemplate;g.removeClass(this.template.targetElem,"nokia-places-"+a.getGroup()+"-"+a.getName())}var i=nokia.places,f=i.ui.Template,k=i.utils.loader,g=i.utils.dom,b={setData:function(a,b){this.data=a;var d=this.template;d.render(a,b);d.hideSpinner();this.show();this.onRender(a)},hide:function(){g.hide(this.template.targetElem)},show:function(){g.show(this.template.targetElem)},getData:function(a,b){return a?jsMotif.selector.getData.call(this.data,
a,b||!1):this.data},displayOnMap:function(a,b,d){var d=this.mapBinding=d||this.mapBinding,f=nokia.places.settings.getMapsNamespace();if(f&&d&&a&&b){var g=d.addComponent(new f.map.component.InfoBubbles),h=d.getViewBounds(),b=new f.geo.Coordinate(b.latitude,b.longitude,null,!0);if(g&&b&&(this._infoBubble=g.openBubble("",b,this.onMapBubbleClose),this.mapBinding.set("curr_bubble",this._infoBubble),g=this._infoBubble.contentNode))this.setData(a,g),h.contains(b)||d.setCenter(b)}}},n=function(a){var b=this,
d=a.onReady||function(){},f=a.locale||i.settings.getLocale();a.appId&&a.authenticationToken&&i.settings.setAppContext(a);b.onRender=a.onRender||function(){};b.onMapBubbleClose=a.onMapBubbleClose||function(){};b._parameters=a||{};b.setTemplate(a.template,f,function(){b.applyReadyFunctions();d.call(b)});b.mapBinding=b._parameters.map};n.prototype={applyReadyFunctions:function(){var a=i.utils.util.mixin({},b,this.getWidgetReadyFunctions());i.utils.util.extendWith(this,a)},getWidgetReadyFunctions:function(){return b},
setTemplate:function(a,b,e,n){var o=this;b?i.settings.setLocale(b):b=i.settings.getLocale();o.template&&o.template.inboundTemplate&&d.call(o);k.getNokiaTemplate(a,function(d,j){k.getLocaleMap(b,function(){var b=g.byId(a),c=b?b.innerHTML:a,k;if(j){if(o._parameters.template=a,"function"===typeof d.getConfig){b=d.getConfig();k=i.utils.util.mixin({},b,o._parameters);if(o._parameters.moduleParams&&b.moduleParams)for(var s in k.moduleParams)k.moduleParams.hasOwnProperty(s)&&(k.moduleParams[s]=i.utils.util.mixin({},
b.moduleParams[s]||{},o._parameters.moduleParams[s]||{}));k.events&&b.events&&(k.events=k.events.concat(b.events))}}else b&&!o._parameters.targetNode&&(o._parameters.targetNode=a),o._parameters.template=i.i18n.applyTranslation(c);k=k||o._parameters;o.template=new f(k);o.data&&!0===n&&o.setData(o.data);e&&"function"===typeof e&&e();o.onTemplateChanged()})})},onTemplateChanged:function(){}};return n}();
nokia.places.widgets.Place=function(){var d=nokia.places,i=d.manager,f=d.widgets.Widget,k=function(b,a){i.getPlaceData({placeId:b.placeId,href:b.href,onComplete:a})},g={setPlace:function(b){var a=this;a.mapBinding?a.displayOnMap(b):(a.template.showSpinner(),k(b,function(b,d){"OK"!==d?(a.hide(),a.onNoData()):(a.onData(b),a.setData(b))}))},displayOnMap:function(b,a){var c=this;k(b,function(b,d){if("OK"!==d)c.hide(),c.onNoData();else if("object"!==typeof b)c.onNoData();else c.onData(b),f.prototype.getWidgetReadyFunctions().displayOnMap.call(c,
b,b.location.position,a)})}},b=function(b){var b=b||{},a=this,c=b.onReady||function(){};b.template||(b.template=b.map?"nokia.blue.bubble":"nokia.blue.place");a.onData=b.onData||function(){};a.onNoData=b.onNoData||function(){};b.onReady=function(){b.placeId||b.href?a.setPlace(b):a.hide();c.call(a)};f.call(a,b)};d.utils.util.inherit(f,b,{getWidgetReadyFunctions:function(){return g}});return b}();
nokia.places.widgets.CategorySearch=function(){function d(){this.csearch=this.template.getModules("CategorySearch")[0]}var i=nokia.places,f=i.widgets.Widget,k={},g=function(b){var g=this,a=b.onReady||function(){},c=b.onResults||function(){};b.template||(b.template="nokia.general.categorysearch");b.map&&(b.searchCenter=function(){return b.map.center},b.boundingBox=function(){return b.map.getViewBounds()});b.onResults=function(a,b){g.data=a;c.call(g,a,b)};b.moduleParams={CategorySearch:b};b.onReady=
function(){g.setData({});d.call(g);a.call(g)};f.call(g,b)};i.utils.util.inherit(f,g,{onTemplateChanged:function(){d.call(this)},getWidgetReadyFunctions:function(){return k}});return g}();
nokia.places.widgets.SearchBox=function(){function d(){this.sb=this.template.getModules("SearchBox")[0]}var i=nokia.places,f=i.widgets.Widget,k={search:function(){this.sb.search()},abortRequest:function(){this.sb.abortRequest()},suggest:function(){this.sb.suggest()},select:function(b){this.sb.select(b)},navigateList:function(b){this.sb.navigateList(b)},showSuggestions:function(){this.sb.showSuggestions()},hideSuggestions:function(){this.sb.hideSuggestions()},setCurrentLocation:function(b){this.sb.setCurrentLocation(b)},
registerResultList:function(b){this.sb.registerResultList(b)}},g=function(b){var g=this,a=b.onReady||function(){},c=b.onResults||function(){};b.template||(b.template="nokia.general.searchbox");b.map&&(b.searchCenter=function(){return b.map.center},b.boundingBox=function(){return b.map.getViewBounds()});b.onResults=function(a,b){g.data=a;c.call(g,a,b)};b.moduleParams={SearchBox:b};b.onReady=function(){g.setData({});d.call(g);a.call(g)};f.call(g,b)};i.utils.util.inherit(f,g,{onTemplateChanged:function(){d.call(this)},
getWidgetReadyFunctions:function(){return k}});return g}();
nokia.places.widgets.ResultList=function(){function d(){this.pl=this.template.getModules("List")[0]}function i(){this.pl||d.call(this)}function f(a,b){return function(){b(a)}}var k=nokia.places,g=k.widgets.Widget,b={renderPage:function(a){this.pl.renderPage(a)},displayOnMap:function(a,b){var d=a||this.mapBinding,g=nokia.maps,i=this.getCurrentPageData(),h,j,k,m;if(g&&d&&i){d.objects.clear();d.get("curr_bubble")&&d.getComponentById("InfoBubbles").removeBubble(d.get("curr_bubble"));h=0;for(j=i.length;h<
j;h++)k=i[h],m=k.position,m=new g.geo.Coordinate(m.latitude,m.longitude,null,!0),m=new g.map.StandardMarker(m,{text:h+1}),b&&m.addListener("click",f(k,b)),d.objects.add(m)}},getCurrentPage:function(){return this.pl.page},setData:function(a,b){delete this.pl;if(a instanceof Array){for(var d=a,f={results:[]},i=0,h=d.length;i<h;i++)f.results.push({place:d[i]});a=f}g.prototype.getWidgetReadyFunctions().setData.call(this,a,b)},getCurrentPageData:function(){return this.pl?this.pl.getPageData(this.pl.page):
jsMotif.selector.getData.call(this.data,"results[].place",[])}},n=function(a){var b=this,e=a.onReady||function(){};a.template||(a.template="nokia.general.resultlist");a.moduleParams=k.utils.util.mixin({},{List:k.utils.util.mixin({},a,{onRenderPage:function(d,e){i.call(b);if(a.onRenderPage)a.onRenderPage(d,e)}}),Rating:{enabled:!1}},a.moduleParams||{});a.onReady=function(){a.data&&b.setData(a.data);d.call(b);e.call(b)};g.call(b,a)};k.utils.util.inherit(g,n,{getWidgetReadyFunctions:function(){return b},
onTemplateChanged:function(){d.call(this)}});return n}();