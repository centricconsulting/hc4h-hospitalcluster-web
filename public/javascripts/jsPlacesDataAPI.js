/*
 * Copyright (C) 2009, Nokia gate5 GmbH Berlin
 *
 * These coded instructions, statements, and computer programs contain
 * unpublished proprietary information of Nokia gate5 GmbH, and are
 * copy protected by law. They may not be disclosed to third parties
 * or copied or duplicated in any form, in whole or in part, without
 * the specific, prior written permission of Nokia gate5 GmbH.
 */ 

this.nokia=this.nokia||{};nokia.places=nokia.places||{comm:{},data:{},utils:{},search:{},widgets:{},ui:{modules:{},templates:{blue:{},general:{},mobileHTML5:{},wordpress:{},st:{}}}};nokia.places.utils.enums={CssUrlModes:{NONE:"none",AGGREGATED:"aggregated",NON_AGGREGATED:"nonAggregated"}};
nokia.places.utils.util=function(){function g(c,e){var d=c,b;for(b in e)e.hasOwnProperty(b)&&(d=d.replace("{"+b+"}",e[b]));return d}function l(c,e){return function(){return c.apply(e,arguments)}}function i(c,e,d){var b=new Date;d&&b.setDate(b.getDate()+d);document.cookie=g("{NAME}={VALUE}{EXPIRES}",{NAME:c,VALUE:encodeURI(e),EXPIRES:d?"":"; expires="+b.toUTCString()})}function j(c){if(document.cookie.length){var e=document.cookie.indexOf(c+"=");if(-1!==e)return e=e+c.length+1,c=document.cookie.indexOf(";",
e),-1===c&&(c=document.cookie.length),decodeURI(document.cookie.substring(e,c))}return""}var f={en:"gb",da:"dk",cs:"cz",el:"gr",hi:"in",ko:"kr",sv:"se",zh:"cn"};return{mixin:function(c,e){for(var d=Array.prototype.slice.call(arguments,1),b=d.shift();b;){for(var a in b)b.hasOwnProperty(a)&&(c[a]=b[a]);b=d.shift()}return c},replace:g,inherit:function(c,e,d){var b=function(){};b.prototype=c.prototype;e.prototype=new b;for(var a in d)d.hasOwnProperty(a)&&(e.prototype[a]=d[a])},trim:function(c){return c.replace(/(^\s+)|(\s+$)/g,
"")},setCookie:i,getCookie:j,clearCookie:function(c){i(c,"",-1)},createTempUserId:function(){var c=j("ppTmpUser");c||(c=Math.floor(1E8*Math.random())+""+(new Date).getTime(),i("ppTmpUser",c,360));return c},addProtocolToUrl:function(c){0!==c.indexOf("http://")&&0!==c.indexOf("https://")&&(c="http://"+c);return c},ensureReplaced:function(c,e){return 0===c.indexOf("$")?e:c},removeTags:function(c){return"string"===typeof c?c.replace(/<([a-zA-Z0-9]*|\n)+>/g,"").replace(/<\/([a-zA-Z0-9]*|\n)+>/g,""):c},
escapeTags:function(c){return"string"===typeof c?c.replace(/</g,"&lt;").replace(/>/g,"&gt;"):c},extendWith:function(c,e){for(var d in e)e.hasOwnProperty(d)&&typeof("function"===e[d])&&(c[d]=l(e[d],c))},getBrowserLanguage:function(){var c="undefined"===typeof window?"en":window.navigator.userLanguage||window.navigator.language||"en";if(2===c.length){var e=f[c];return e?[c,e].join("-"):[c,c].join("-")}return c},getDefaultDialect:function(c){return f[c]?f[c]:c},toArray:function(c){return c instanceof
Array?c:[c]}}}();
nokia.places.settings=function(){function g(){var a=this.jslocation||nokia.maps;if(a&&a.util&&a.util.services)return a.util.services}function l(b){var c=g(),b=f(b,{S_URL:d,APPID:a,TOKEN:m,LANG:p});return c?c.addNlpParams(b):b}var i=nokia.places.utils.util,j=nokia.Settings,f=i.replace,c=i.ensureReplaced,e=c("http://api.places.maps.ovi.com/rest/v1/places","http://api.places.maps.ovi.com/rest/v1/places"),d=c("http://places.nlp.nokia.com/places/v1","http://s.pbapi.places.public.devbln.europe.nokia.com/places/v1"),b=
c("http://geo.nlp.nokia.com/search/6.2","http://geo.nlp.nokia.com/search/6.2"),a="",m="",h=c("${cnContext}",!1),n="&app_id={APPID}&app_code={TOKEN}",k=[];k.push("callback=nokia.places.comm.data.clb['{CALLBACK_ID}']");g()?n="":k.push(n);k.push("Accept-Language={LANG}");var k=k.join("&"),q="{S_URL}/discover/search/?"+k+"&",o="{S_URL}/suggest/?"+k+"&",r="{S_URL}/discover/explore/places?"+k+"&",h=h?"":"&int=true",s="{S_URL}/places/{PLACE_ID}?"+k,t="{S_URL}/places/{PLACE_ID}/media/images?offset={START}&size={LIMIT}&"+
k,u="{S_URL}/places/{PLACE_ID}/media/reviews?offset={START}&size={LIMIT}&"+k,v="{S_URL}/places/{PLACE_ID}/related/recommended?size={LIMIT}&"+k,w="{S_URL}/reversegeocode.json?prox={LAT},{LONG},1000&gen=1&mode=retrieveAddresses&jsoncallback=nokia.places.comm.data.clb['{CALLBACK_ID}']"+n+"&language={LANG}"+h,x="{S_URL}/geocode.json?gen=1&searchtext={LOC}&jsoncallback=nokia.places.comm.data.clb['{CALLBACK_ID}']"+n+h,p=i.getBrowserLanguage();j&&(a=j.appId,m=j.authenticationToken,j.addObserver("appId",
function(b){b!==a&&(a=b)}),j.addObserver("authenticationToken",function(a){a!==m&&(m=a)}));i=function(){};i.prototype={getPlaceUrl:function(a){var b=l(s);return f(b,{PLACE_ID:a})},getPlaceImagesUrl:function(a,b,c){var m=l(t);return f(m,{PLACE_ID:a,START:b||0,LIMIT:c||5})},getReviewsUrl:function(a,b){var c=l(u);return f(c,{PLACE_ID:a,LIMIT:b.limit||"5",START:b.start||"0"})},getRecommendationsUrl:function(a,b){var c=l(v);return f(c,{PLACE_ID:a,LIMIT:b||5})},getRatingUrl:function(a){return f("{S_URL}/{PLACE_ID}/ugc/ratings.js;callback={CALLBACK_ID}?",
{PLACE_ID:a,S_URL:e})},getRatingPostUrl:function(a){return f("{S_URL}/{PLACE_ID}/ugc/ratings?",{PLACE_ID:a,S_URL:e})},getSearchUrl:function(){return l(q)+"&"},getCategorySearchUrl:function(){return l(r)+"&"},getSuggestUrl:function(){return l(o)+"&"},getLocale:function(){return p},getClbTemplate:function(){return"callback=nokia.places.comm.data.clb['{CALLBACK_ID}']"},getReverseGeoUrl:function(c,h){var d=f(w,{LAT:c,LONG:h,S_URL:b,APPID:a,TOKEN:m,LANG:p}),e=g();return e?e.addNlpParams(d):d},getGeoCodeUrl:function(c){var c=
f(x,{LOC:c,S_URL:b,APPID:a,TOKEN:m,LANG:p}),h=g();return h?h.addNlpParams(c):c},setPlacesServerUrl:function(a){d=a},getPlacesServerUrl:function(){return d},getServices:g,setLocale:function(a){p=a},setAppContext:function(b){a=b.appId;m=b.authenticationToken;if(j){j.set("appId",a);j.set("authenticationToken",m)}},getAppContext:function(){return{appId:a,authToken:m}},commTimeout:1E4,revision:c("-1","0"),version:c("beta5-SNAPSHOT","0")};i.prototype.constructor=i;return new i}();
nokia.places.comm.core=function(){function g(f){f&&f.parentNode&&f.parentNode.removeChild(f)}function l(){var f=j.getElementById(i);f||(f=j.createElement("div"),f.setAttribute("id",i),f.style.display="none",j.body.appendChild(f));return f}var i="nokiaPlacesTransport",j=document;return{get:function(f,c){var e=l(),d=j.createElement("script");d.setAttribute("src",f);d.setAttribute("type","text/javascript");"Microsoft Internet Explorer"===navigator.appName?d.onreadystatechange=function(){if("loaded"===
this.readyState||"complete"===this.readyState)g(this),"function"===typeof c&&c()}:d.onload=function(){g(this);"function"===typeof c&&c()};e.appendChild(d);return d},post:function(f,c,e,d){var b=l(),a=j.createElement("iframe");a.style.display="none";b.appendChild(a);setTimeout(function(){var b=a.contentWindow||a.contentDocument;a.doc=b.document?b.document:b;b=a.doc.createElement("form");b.method="post";b.action=f;b.setAttribute("accept-charset","utf-8");b.setAttribute("enctype","multipart/form-data");
b.setAttribute("encoding","multipart/form-data");var h=a.doc.createElement("input");h.type="text";h.name="user-id";h.value=d||"";b.appendChild(h);h=a.doc.createElement("input");h.type="text";h.name="entity";h.value=c;b.appendChild(h);a.doc.body.appendChild(b);var n=function(){setTimeout(function(){g(a)},1);"function"===typeof e&&e()};a.onload=function(){n()};a.onreadystatechange=function(){"complete"===this.readyState&&n()};b.submit()},1)}}}();
nokia.places.comm.data=function(){function g(){return""+ ++e}function l(d,b){var a=function(m,h){m&&400<=m.status&&(m={responseStatus:m.status,message:m.error_description||m.message},h="ERROR",window.console&&"function"===typeof window.console.error&&window.console.error("Error "+m.responseStatus+" - "+m.message));"function"===typeof b&&b(m,h||"OK");clearTimeout(a.timeout);delete c[d]};a.timeout=setTimeout(function(){window.console&&"function"===typeof window.console.error&&window.console.error("Timeout - cannot connect to the server");
a(null,"ERROR")},f.commTimeout);return a}var i=nokia.places,j=i.comm.core,f=i.settings,c={},e=100;return{performRequest:function(d,b,a){a=a||g();d=d.replace("{CALLBACK_ID}",a);c[a]=l(a,b);j.get(d,null,a);return a},performNoCbRequest:function(c){j.get(c)},performPostRequest:function(c,b,a,m){j.post(c,b,a,m)},abortRequest:function(d){if("undefinded"===typeof d||!c[d])return!1;c[d].timeout&&clearTimeout(c[d].timeout);c[d]=function(){delete c[d]}},getCallBackId:g,getSeed:function(){return e},clb:c}}();
(function(g){g.ovi=this.ovi||{};g.ovi.player={};g.ovi.player.places={};g.ovi.player.places.Com={};g.ovi.player.places.Com.data=function(g,i){nokia.places.comm.data.clb[""+g.callback](i)}})(this);
nokia.places.data.dataTransformer=function(){function g(b){return{latitude:b[0],longitude:b[1]}}function l(b){if(b instanceof Array)return{topLeft:{latitude:b[3],longitude:b[0]},bottomRight:{latitude:b[1],longitude:b[2]}}}function i(b){if(b)return{name:b.title,categoryId:b.id,icon:b.icon}}function j(b){var a;if(!b)return!1;if((a=b.results)&&a.next){var m=b.results.next;b.results.getNext=function(a){if(a&&a.onComplete){var b=a.onComplete;m+="&"+e.getClbTemplate();return c(m,function(a,c){"function"===
typeof b&&(c===d&&(a=j(a)),b(a,c))})}}}delete b.next;a=b.items||b.results.items;if(b.search){b.search.context&&(b.search.location=b.search.context.location,delete b.search.context);var h=b.search.location;h.position&&(h.position=g(h.position));h.bbox&&(h.boundingBox=l(h.bbox),delete h.bbox)}if(a)for(var h=0,f=a.length;h<f;h++){var k=a[h],q=k.href.match(/([\w\d]{8}-[\w\d]{32})/),o=k.category;o.icon=k.icon.replace(/(_\d{2})?\.icon/,".icon");k.id?(k.placeId=k.id,delete k.id):q&&q[1]&&(k.placeId=q[1]);
k.position=g(k.position);k.bbox&&(k.boundingBox=l(k.bbox),delete k.bbox);k.category=i(o);delete k.refId;delete k.type}return b}function f(b){if(!b)return!1;if(b.next){var a=b.next;b.getNext=function(b){if(b&&b.onComplete){var h=b.onComplete;a+="&"+e.getClbTemplate();return c(a,function(a,b){"function"===typeof h&&(b===d&&(a=f(a)),h(a,b))})}}}delete b.next;delete b.create;if(b.items)for(var m=0,h=b.items.length;m<h;m++){var n=b.items[m];if(n){var k=n.supplier;n.supplier={name:k.title,supplierId:k.id,
icon:k.icon};delete n.id}}return b}var c=nokia.places.comm.data.performRequest,e=nokia.places.settings,d="OK";return{transformPlace:function(b){if(!b)return!1;b.location.position=g(b.location.position);b.location.bbox&&(b.location.bbox=l(b.location.bbox));if(b.media){var a=b.media;a.reviews&&(a.reviews.available?a.reviews=f(a.reviews):delete a.reviews);a.editorials&&(a.editorials=f(a.editorials));a.images&&(a.images.available?a.images=f(a.images):delete a.images);a.links&&(a.links=f(a.links));a.images||
a.editorials||a.reviews||a.links?b.media=a:delete b.media}if(a=b.supplier)b.supplier={name:a.title,supplierId:a.id};for(var a=0,c=b.categories.length;a<c;a++)b.categories[a]=i(b.categories[a]);delete b.refId;return b},transformSearchResults:j,transformReverseGeo:function(b){if(b){var a={location:{}};a.location.position={latitude:parseFloat(b.Location.DisplayPosition.Latitude),longitude:parseFloat(b.Location.DisplayPosition.Longitude)};var c=a.location,b=b.Location.Address,h={},d,e,f;for(f in b)if(b.hasOwnProperty(f))if(e=
b[f],"AdditionalData"!==f)d="Label"===f?"text":"Country"===f?"countryCode":f.charAt(0).toLowerCase()+f.substr(1),h[d]=e;else{d=0;for(var g=e.length;d<g;d++){var i=e[d];"CountryName"===i.key?h.country=i.value:"StateName"===i.key&&(h.state=i.value)}}c.address=h;a.name=a.location.address.text;return a}},transformMediaObject:f,transformRating:function(b){var a={average:0,count:0};b&&(a={average:b.rating||0,count:b.ratingCount||0});return a}}}();
nokia.places.manager=function(){function g(b){if(b){var a=b.placeId,c=b.onComplete;if(a&&"function"===typeof c)return b=i.getPlaceImagesUrl(a,b.start,b.limit),f(b,function(a,b){b===d&&(a=e.transformMediaObject(a));c(a,b)})}}var l=nokia.places,i=l.settings,j=l.comm.data.performPostRequest,f=l.comm.data.performRequest,c=l.utils.util,e=l.data.dataTransformer,d="OK";return{getPlaceData:function(b){if(b){var a=b.onComplete;if((b.placeId||b.href)&&a)return b=b.href?b.href+"&"+i.getClbTemplate():i.getPlaceUrl(b.placeId),
f(b,function(b,c){c===d&&(b=e.transformPlace(b));"function"===typeof a&&a(b,c)})}},getRating:function(b){if(b){var a=b.placeId,d=b.onComplete;if(a&&d)return b=i.getRatingUrl(a),f(b,function(a,b){var f={count:0,average:0};if(a&&a.averageRatings&&a.averageRatings.averageRating)for(var g=c.toArray(a.averageRatings.averageRating),i,j=0,l=g.length;j<l;j++)i=g[j],"OVERALL"===i.ratingType&&(f=e.transformRating(i));d(f,b)})}},getReviews:function(b){if(b){var a=b.placeId,c=b.onComplete;if(a&&c)return b=i.getReviewsUrl(a,
b),f(b,function(a,b){"function"===typeof c&&(b===d&&(a=e.transformMediaObject(a)),c(a,b))})}},getMedia:g,getImages:g,postRating:function(b){if(b){var a=b.placeId,c=parseInt(b.ratingValue,10);if(a&&c){var c=5<c?5:1>c?1:c,a=i.getRatingPostUrl(a),c="{ratings:{rating:[{value:"+c+",type:'OVERALL'}]}}",d=l.utils.util.createTempUserId();j(a,c,b.onComplete,d)}}}}}();
nokia.places.search.nsp=function(){function g(a){var b=[],c=a.searchCenter;a.limit&&b.push("size="+encodeURIComponent(a.limit));a.searchTerm&&b.push("q="+encodeURIComponent(a.searchTerm));a.category&&b.push("cat="+encodeURIComponent(a.category));"object"===typeof a.boundingBox&&"object"===typeof a.boundingBox.topLeft&&"object"===typeof a.boundingBox.bottomRight?b.push("X-Map-Viewport="+a.boundingBox.topLeft.longitude+","+a.boundingBox.bottomRight.latitude+","+a.boundingBox.bottomRight.longitude+","+
a.boundingBox.topLeft.latitude):c&&("number"===typeof c.longitude&&"number"===typeof c.latitude)&&b.push("at="+c.latitude+","+c.longitude);return b.join("&")}function l(a,f){var h=d.getSearchUrl()+g(a);return c.performRequest(h,function(c,d){d===b&&(c=e.transformSearchResults(c),a.onComplete(c,d))},f)}function i(a,f){var h=d.getCategorySearchUrl()+g(a);return c.performRequest(h,function(c,d){d===b&&(c=e.transformSearchResults(c),a.onComplete(c,d))},f)}function j(a,f){var e=d.getSuggestUrl()+g(a);
return c.performRequest(e,function(c,d){if(d===b)a.onComplete(c,d)},f)}var f=nokia.places,c=f.comm.data,e=f.data.dataTransformer,d=f.settings,b="OK";return{search:function(a,b){var d=a.useGeoLocation,f,e,g={latitude:0,longitude:0},o=c.getCallBackId(),r=!0===b?j:a.category?i:l;try{f=navigator?navigator.geolocation:null}catch(s){}!e&&d&&f?(f.getCurrentPosition(function(b){e={latitude:b.coords.latitude,longitude:b.coords.longitude};a.searchCenter=e;r(a,o)},function(){a.searchCenter=g;r(a,o)},{timeout:6E3}),
e=g):(a.searchCenter=e||a.searchCenter||g,r(a,o));return o}}}();
nokia.places.search.manager=function(){var g=nokia.places,l=g.settings,i=g.search.nsp,j=g.comm.data.performRequest,f=g.data.dataTransformer;return{findPlaces:function(c){if(c&&c.searchTerm&&c.onComplete)return i.search(c)},findPlacesByCategory:function(c){if(c&&c.category&&c.onComplete)return i.search(c)},suggestPlaces:function(c){if(c&&c.searchTerm&&c.onComplete)return i.search(c,!0)},findRecommendations:function(c){if(c){var e=c.placeId,d=c.onComplete;if(e&&"function"===typeof d)return c=l.getRecommendationsUrl(e,
c.limit),j(c,function(b,a){"OK"===a?d(f.transformSearchResults(b),a):d({},a)})}},reverseGeoCode:function(c){var c=c||{},e=c.latitude,d=c.longitude,b=c.onComplete,c=l.getReverseGeoUrl(c.latitude,c.longitude);if(e&&d&&"function"===typeof b)return j(c,function(a){if(a&&a.Response&&a.Response.View)if(a.Response.View.length){for(var a=a.Response.View[0].Result,c,d=0,e=a.length;d<e;d++)if(c=a[d],c.Location.Address.Street){b(f.transformReverseGeo(c),"OK");return}b(f.transformReverseGeo(a[0]),"OK")}else b("",
"OK");else b(a?a.Details:"","ERROR")})},geoCode:function(c){var c=c||{},e=c.address,d=c.searchTerm,b=c.onComplete,a,g=[];if(c.onComplete&&(d||e)){if(e)for(a in e)e.hasOwnProperty(a)&&g.push(e[a]);else g.push(d);d=encodeURIComponent(g.join(","));c=l.getGeoCodeUrl(d);return j(c,function(a){a&&a.Response?a.Response.View&&a.Response.View[0]&&a.Response.View[0].Result?b(f.transformReverseGeo(a.Response.View[0].Result[0]),"OK"):b(null,"OK"):b(a,"ERROR")})}}}}();