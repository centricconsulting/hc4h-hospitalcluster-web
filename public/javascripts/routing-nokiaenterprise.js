(function(){ovi.provide("nokia.maps.routing.component.ContextMenuHandler");
(function(h){h.routing.component.ContextMenuHandler=function(g,f){function c(a,b,c){var q;var j;if(c==="finished"&&(q=(j=(a=a.routes[0])&&a.shape,a=j)&&new e(a,{pen:new nokia.maps.util.Pen({lineWidth:5,strokeColor:"#00F8",lineJoin:"round"})}),a=q))r.objects.add(a),m.mapDisplay.zoomTo(r.getBoundingBox()),p.ss=a}function a(){var a;(a=p.ss)&&r.objects.remove(a);if(p.Cf&&p.df){n=new b;n.addCoordinate(p.Cf.coordinate);for(k=0;p.Ue&&k<p.Ue.length;k++)n.addCoordinate(p.Ue[k].coordinate);n.addCoordinate(p.df.coordinate);
a=p.Do=new nokia.maps.routing.Manager;a.addObserver("state",c);a.calculateRoute(n,[{type:"shortest",transportModes:["car"],options:""}])}}var h=nokia.maps.map.StandardMarker,b=nokia.maps.routing.WaypointParameterList,e=nokia.maps.map.Polyline,l=g.target,d,n,k,m=this,p=m.us||(m.us={}),r=p.container||(p.container=new nokia.maps.map.Container);m.mapDisplay.objects.indexOf(r)<0&&m.mapDisplay.objects.add(r);l instanceof nokia.maps.map.Marker&&l.isRoutingMarker?f.addEntry("__i18n_rightClickMenu.removeRoutePoint__",
function(){if(l===p.Cf)p.Cf=null;if(l===p.df)p.df=null;p.Ue&&(idx=p.Ue.indexOf(l))>=0&&p.Ue.splice(idx,1);r.objects.remove(l);a()},1):l instanceof nokia.maps.map.Display&&(d=l.pixelToGeo(g.displayX,g.displayY),f.addEntry("__i18n_rightClickMenu.setStartWaypoint__",function(){p.Cf?p.Cf.set("coordinate",d):r.objects.add(p.Cf=new h(d,{text:"A",isRoutingMarker:!0}));a()},1),f.addEntry("__i18n_rightClickMenu.addWaypoint__",function(){var b=p.Ue||(p.Ue=new ovi.Array),c=new h(d,{isRoutingMarker:!0});b.push(c);
r.objects.add(c);a()},1),f.addEntry("__i18n_rightClickMenu.setDestinationWaypoint__",function(){p.df?p.df.set("coordinate",d):r.objects.add(p.df=new h(d,{text:"B",isRoutingMarker:!0}));a()},1))}})(nokia.maps);ovi.provide("nokia.maps.routing.component.RouteResultSet");
(function(h){var g=h.map;h.routing.component.RouteResultSet=new ovi.Class({initialize:function(f,c){var a=this.container=new g.Container,j=c||{},b=f.waypoints,e=f.mode.transportModes,l;l=f.shape;var d,n,k=g.StandardMarker;n=g.Polyline;d=j.width||5;j=j.color||"#00F8";l&&(n=new n(l,{pen:new h.util.Pen({lineWidth:d,strokeColor:j,lineJoin:"round"})}),a.objects.add(n));if(b){l=b.length;n=e==="walk"?b[0].originalPosition:b[0].mappedPosition;n=new k(n,{text:"A",identifier:"waypoints"});a.objects.add(n);
for(d=1;d<l-1;d++)n=e==="walk"?b[d].originalPosition:b[d].mappedPosition,n=new k(n,{text:"",identifier:"waypoints",pos:d-1}),a.objects.add(n);n=e==="walk"?b[l-1].originalPosition:b[l-1].mappedPosition;n=new k(n,{text:"B",identifier:"waypoints"});a.objects.add(n)}},container:null})})(nokia.maps);ovi.provide("nokia.maps.routing.WaypointParameterList");
nokia.maps.routing.WaypointParameterList=new ovi.Class({initialize:function(){this.coords=[];this.places=[];this.locations=[];this.waypointList=[]},addCoordinate:function(h){this.waypointList.push(h);this.coords.push(h)},addPlace:function(h){this.waypointList.push(h);this.places.push(h)},addLocation:function(h){this.waypointList.push(h);this.locations.push(h)},size:function(){return this.waypointList.length||this.coords.length+this.places.length+this.locations.length},clear:function(){this.coords=
[];this.places=[];this.locations=[];this.waypointList=[]},toCoordinates:function(){var h=[],g,f,c;g=0;for(f=this.waypointList.length;g<f;g++)c=this.waypointList[g],"latitude"in c&&"longitude"in c?this.Yr(c,h):"locations"in c?this.as(c,h):("displayPosition"in c||"navigationPosition"in c)&&this.Am(c,h);this.waypointList.length==0&&(this.Zr(h),this.bs(h),this.$r(h));return h},Yr:function(h,g){g.push(h)},as:function(h,g){for(var f=0,c=h.locations.length;f<c;f++)this.Am(h.locations[f],g)},Am:function(h,
g){h.displayPosition?g.push(h.displayPosition):h.navigationPosition&&g.push(h.navigationPosition)},Zr:function(h){for(var g=0,f=this.coords.length;g<f;g++)h.push(this.coords[g])},bs:function(h){for(var g=0,f=this.places.length;g<f;g++)this.Am(h,this.places[g].locations)},$r:function(h,g){var g=g||this.locations,f,c,a;c=0;for(a=this.locations.length;c<a;c++)f=g[c],f.displayPosition?h.push(f.displayPosition):f.navigationPosition&&h.push(f.navigationPosition)}});ovi.provide("nokia.maps.routing.Maneuver");
ovi.provide("nokia.maps.routing.Mode");ovi.provide("nokia.maps.routing.Route");ovi.provide("nokia.maps.routing.RouteLeg");ovi.provide("nokia.maps.routing.RouteSegment");ovi.provide("nokia.maps.routing.RouteSummary");ovi.provide("nokia.maps.routing.ServiceError");ovi.provide("nokia.maps.routing.Waypoint");ovi.provide("nokia.maps.routing.component.IsolineResultSet");
(function(h){h.routing.component.IsolineResultSet=new ovi.Class({initialize:function(g,f){var c=this.container=new h.map.Container,a=f||{},j,b=h.map.Polygon;j=a.brush||{color:"#00F4"};a=a.pen||{strokeColor:"#00F8",lineWidth:5};g&&(o=new b(g,{pen:a,brush:j}),c.objects.add(o))},container:null})})(nokia.maps);ovi.provide("nokia.maps.util.services");
(function(h){function g(a){this.ni=a||Number.POSITIVE_INFINITY;for(var a=[],c=0;c<36;c++)a[c]=Math.floor(Math.random()*16);a[14]=4;a[19]=a[19]&3|8;for(c=0;c<36;c++)a[c]="0123456789ABCDEF"[a[c]];a[8]=a[13]=a[18]=a[23]="-";this.id=a.join("");this.init()}var f=nokia.maps.util,c=f.now,a=null,a=null,j=f.getRootNameSpace("nokia.maps").Settings;g.prototype={isAlive:function(){return c()<this.$g+this.ni},init:function(){this.$g=c()}};g.requestSessionId=function(){if(!a||!a.isAlive())a=new g(nokia.maps.config.sessionTTL);
a.init();return a.id};ovi.extend(h,{getBaseURL:function(a,c,f){var d=a.get("secureConnection"),g=null,h=null,j=a.get(c+"."+f+".baseUrl")||a.get(c+".baseUrl"),p=a.get(c+"."+f+".secure.baseUrl")||a.get(c+".secure.baseUrl"),r=a.get(c+"."+f+".secure.interface")||q,q=a.get(c+"."+f+".interface")||a.get(c+".interface");if(d=="force")return p&&(g=p,h=r||q,g+=h?h+"?":""),g;d=="prefer"&&(g=p,h=r);g||(g=j);h||(h=q||"");h!=""&&(h+="?");g+=h;return g},addNlpParams:function(a,c){var f="SID_"+g.requestSessionId(),
f=["app_id="+encodeURI(j.appId),(c?"token=":"app_code=")+encodeURI(j.authenticationToken),"xnlp="+encodeURI("CL_JSMv2.2.4,"+f)].join("&");a+=/\?/.test(a)?"&":"?";return a+f}});nokia.maps.util.Session=g})(nokia.maps.util.services);ovi.provide("nokia.maps.routing.navteq.protocol");
nokia.maps.routing.navteq.protocol={Mode:{type:1,transportModes:1,options:1,trafficMode:1},ug:function(h){return h.latitude+","+h.longitude},Wr:function(h){for(var g="",f=h.locations,h=0;h<f.length;h++)g+=this.Co(f[h],h);return g},Co:function(h,g){var f="",c,a;(g||0)===0&&h.displayPosition&&(f+=this.ug(h.displayPosition));if(c=h.navigationPositions)for(a=0;a<c.length;a++)f+="!"+this.ug(c[a]),h.address&&h.address.street&&(f+=";"+encodeURIComponent(h.address.street));else h.navigationPosition?(f+="!"+
this.ug(h.navigationPosition),h.address&&h.address.street&&(f+=";"+encodeURIComponent(h.address.street))):throwIllegalArgument("navigation position is not specified in location!");return f}};ovi.provide("nokia.maps.routing._packaging.package");ovi.provide("nokia.maps.routing.Manager");
(function(h){var g=h.routing.Manager=new ovi.Class({Extends:h.util.OObject,initialize:function(f,c){var a=f||{};this.rg=c||new h.Config;if(this.constructor===g)return new g.tb(a);this._super(a)},destroy:function(){this.tb=null},Statics:{setDefImpl:function(f){return this.tb||(this.tb=f),!1}}})})(nokia.maps);ovi.provide("nokia.maps.routing.navteq.protocolV72");
nokia.maps.routing.navteq.protocolV72=ovi.extend({},nokia.maps.routing.navteq.protocol,{getCalculateRouteUrl:function(h,g,f,c,a){var j=[],b,e=ovi.type(f)==="array"?f[0]:f,l,f=[];g instanceof nokia.maps.routing.WaypointParameterList||nokia.maps.util.throwIllegalArgument("The argument in calculateRoute request is illegal");g.size()<2&&throwIllegalArgument("Less than two waypoints submitted to calculateRoute call");h+="routeattributes=shape&maneuverattributes=shape&jsonAttributes=1";for(b in c)h+="&"+
b+"="+c[b];c=g.waypointList;for(g=0;g<c.length;g++)if(b=c[g],"latitude"in b&&"longitude"in b)h+="&waypoint"+g+"=geo!"+this.ug(b);else if("locations"in b)h+="&waypoint"+g+"=street!"+this.Wr(b);else if("displayPosition"in b||"navigationPositions"in b||"navigationPosition"in b)h+="&waypoint"+g+"=street!"+this.Co(b);h+="&language="+a;for(l in e)this.Mode[l]||nokia.maps.util.c('the argument "'+l+'" in mode of calculateRoute Request is illegal');e.type&&(j[j.length]=e.type);e.transportModes&&(j[j.length]=
e.transportModes.join(","));e.trafficMode&&(j[j.length]="traffic:"+e.trafficMode);l=e.options||[];ovi.type(l)=="string"&&(l=l.split(","));if(l){for(a=e=0;a<l.length;a++)switch(l[a]){case "avoidTollroad":f[e++]="tollroad:-1";break;case "avoidMotorway":f[e++]="motorway:-1";break;case "avoidBoatFerry":f[e++]="boatFerry:-1";break;case "avoidRailFerry":f[e++]="railFerry:-1";break;case "avoidPublicTransport":f[e++]="publicTransport:-1";break;case "avoidTunnel":f[e++]="tunnel:-1";break;case "avoidDirtRoad":f[e++]=
"dirtRoad:-1";break;case "avoidPark":f[e++]="park:-1";break;case "preferHOVLane":f[e++]="HOVLane:1";break;case "avoidStairs":f[e++]="stairs:-1"}j[j.length]=f.join(",")}h+="&mode="+j.join(";");return h}});ovi.provide("nokia.maps.routing.navteq.Manager");
(function(h){var g=h.util,f=g.getRootNameSpace("nokia.maps").Settings,c=h.geo,a=c.BoundingBox,j=c.Coordinate,b=c.Shape,c=h.Config,e=g.isArray,l=g.services,d=h.net.Request,h=nokia.maps.routing.navteq.Manager=new ovi.Class({initialize:function(a,b){this.Uh=new d(d.JSONP,{callbackKey:"jsoncallback",autoSkip:!0});this.gs=ovi.buildNS(nokia.maps.config.routing.protocol);this.addObserver("_shapeParsed",this.Ep);this._super(a,b)},Extends:nokia.maps.routing.Manager,Statics:{Uq:function(){var a={waypoint:"waypoints",
leg:"legs",link:"links",maneuver:"maneuvers",feature:"features"};return function(b){for(var c=[],d="";b;){for(var f in b)if(d=a[f],a[f]?(b[a[f]]=b[f],delete b[f]):f=="_type"?delete b[f]:d=f,e(b[d])){if(f!="Shape"&&f!="TransportModes")for(var g=0;g<b[d].length;g++)c[c.length]=b[d][g]}else typeof b[d]=="object"&&(c[c.length]=b[d]);c.length>0?b=c.pop():(delete c,b=!1)}}}()},state:"initial",state:"initial",routes:[],vt:"shape",nt:"direction,shape",mq:{},Ep:!1,em:0,dm:0,getRoutes:function(){return this.routes},
getErrorCause:function(){return this.state=="failed"?this.io:null},calculateRoute:function(a,b){var c=l.addNlpParams(this.gs.getCalculateRouteUrl(l.getBaseURL(this.rg,"routing","calculateroute"),a,b,this.mq,f.defaultLanguage));this.At=c;this.Hq=this.Uh.send(c,ovi.bind(this,this.calculateRouteCallback));this.set("state","started",!0)},clear:function(){this.routes=[];this.isolines=[]},calculateRouteCallback:function(a){this.routes=this.ts(a)},Ep:function(a,b,c){if(c)a.set("state","finished"),a.set("_shapeParsed",
!1),a.em=0,a.dm=0},ts:function(b){var c=b.id,d=b.response;if(b.timeout)this.io=this.Zo({type:"SystemError",subtype:"Timeout",details:"request times out"}),this.set("state","failed");else if(d.error||d.type&&d.subtype)this.io=this.Zo(d.error||d),this.set("state","failed");else{nokia.maps.routing.navteq.Manager.Uq(d);for(var b=d.response.route,e,f,g,d=0;d<b.length;d++){this.$o(b[d],c);for(e=0;e<b[d].waypoints.length;e++)this.vm(b[d].waypoints[e]);if(b[d].boundingBox)b[d].boundingBox=a.coverAll([new j(b[d].boundingBox.topLeft.latitude,
b[d].boundingBox.topLeft.longitude,void 0,!0),new j(b[d].boundingBox.bottomRight.latitude,b[d].boundingBox.bottomRight.longitude,void 0,!0)]);this.pq(b[d]);if(b[d].mode.features){b[d].mode.options=[];for(e=0;e<b[d].mode.features.length;e++)b[d].mode.options.push(this.Tq[b[d].mode.features[e].value]);delete b[d].mode.features}if(b[d].legs)for(e=0;e<b[d].legs.length;e++){this.vm(b[d].legs[e].start);this.vm(b[d].legs[e].end);for(f=0;f<b[d].legs[e].maneuvers.length;f++)g=b[d].legs[e].maneuvers[f],g.shape&&
this.$o(g,c),g.position=new j(g.position.latitude,g.position.longitude,void 0,!0)}}return b}},pq:function(a){a.getStart=function(){return a.waypoints[0]};a.getDestination=function(){return a.waypoints[a.waypoints.length-1]};a.getManeuvers=function(){for(var b=[],c=0;c<a.legs.length;c++)b=b.concat(a.legs[c].maneuvers);return b}},vm:function(a){a.linkId&&delete a.linkId;a.mappedPosition=new j(a.mappedPosition.latitude,a.mappedPosition.longitude,void 0,!0);a.originalPosition&&(a.originalPosition=new j(a.originalPosition.latitude,
a.originalPosition.longitude,void 0,!0))},$o:function(a,c){var d=this;d.em++;b.fromLatLngArray(a.shape.join(",").split(","),!1,function(b){d.dm++;if(d.Hq==c)a.shape=b,d.em==d.dm&&d.set("_shapeParsed",!0)})},Tq:{tollroad:"avoidTollroad",motorway:"avoidMotorway",boatFerry:"avoidBoatFerry",railFerry:"avoidRailFerry",publicTransport:"avoidPublicTransport",tunnel:"avoidTunnel",dirtRoad:"avoidDirtRoad",park:"avoidPark",HOVLane:"preferHOVLane",stairs:"avoidStairs"},Zo:function(a){var b=a.details;a.additionalData&&
(b+=" Key: "+a.additionalData[0].key+", Value: "+a.additionalData[0].value);return{type:a.type.charAt(0).toLowerCase()+a.type.substr(1),subtype:a.subtype.charAt(0).toLowerCase()+a.subtype.substr(1),message:b}}});nokia.maps.routing.Manager.setDefImpl(h);c.setDefaultsNS("routing",{baseUrl:nokia.maps.config.routing.baseUrl,"secure.baseUrl":nokia.maps.config.routing["secure.baseUrl"],"calculateroute.interface":"calculateroute.json"},!0)})(nokia.maps);ovi.provide("nokia.maps.routing._packaging.package-nokiaenterprise");})();