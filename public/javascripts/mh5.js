/*
 * Copyright (C) 2012, Nokia gate5 GmbH Berlin
 *
 * These coded instructions, statements, and computer programs contain
 * unpublished proprietary information of Nokia gate5 GmbH, and are
 * copy protected by law. They may not be disclosed to third parties
 * or copied or duplicated in any form, in whole or in part, without
 * the specific, prior written permission of Nokia gate5 GmbH.
 */
(function(g,a,b,d,e){var h=e.call([]);if(!g.isArray)g.isArray=function(f){return e.call(f)===h};if(!b.trim)b.trim=function(){return this.replace(/^\s*/,"").replace(/\s*$/,"")};if(!a.bind)a.bind=function(f){var c=this,a;return 1<arguments.length?(a=d.call(arguments,1),function(){return c.apply(f,arguments.length?a.concat(d.call(arguments)):a)}):function(){return arguments.length?c.apply(f,arguments):c.call(f)}};window.history.pushState||function(f,c){function a(f,h,b,e){history_js.setStorage(b,{state:f,
title:h});history_js.hash=b;e?(b||(b=c.hash||"#"),c.replace(b)):c.hash=b}if(!("pushState"in f.history))history_js={},"sessionStorage"in f&&f.JSON?(history_js.setStorage=function(c,a){f.sessionStorage[c]=JSON.stringify(a)},history_js.getStorage=function(c){return f.sessionStorage[c]?JSON.parse(f.sessionStorage[c]):void 0}):(history_js.fake_storage={},history_js.setStorage=function(c,f){history_js.fake_storage[c]=f},history_js.getStorage=function(c){return history_js.fake_storage[c]}),f.history.pushState=
function(c,f,h){a(c,f,h,!1)},f.history.replaceState=function(c,f,h){a(c,f,h,!0)},history_js.hashchange=function(){var a=c.hash;if(a!==history_js.hash)history_js.hash=a,a=history_js.hash?history_js.getStorage(history_js.hash):{},"onpopstate"in f&&"function"===typeof f.onpopstate&&f.onpopstate.apply(f,[{state:a?a.state:null}])},"onhashchange"in f?f.onhashchange=history_js.hashchange:history_js.hashInterval=setInterval(function(){c.hash!==history_js.hash&&history_js.hashchange()},100),c.hash&&history_js.hashchange()}(window,
document.location)})(Array,Function.prototype,String.prototype,[].slice,{}.toString);
(function(){if(!this.nokia||!this.nokia.mh5){var g={},a={},b=b||this.mh5Config||{};nokia=this.nokia||{};nokia.mh5=this.nokia.mh5={assetsPath:"",win:b.win||this,doc:b.doc||this.document,modulePaths:b.modulePaths||{},buildNS:function(a){var c;for(var a=a.split("."),b=0,h=nokia.mh5.win,f;f=a[b++];)c=h[f]=h[f]||{isNs:!0},h=c;return h},provide:function(b){a[b]=1;return nokia.mh5.buildNS(b)},require:function(b){if(a[b])return nokia.mh5.resolve(b);if(g[b])throw Error("Circular Reference in require chain: "+
g);g[b]=1;nokia.mh5.buildNS(b);var e=nokia.mh5.getLoadPath(b);try{nokia.mh5._getScript(e)}catch(h){throw Error("Could not load "+b+", reason: "+h.message);}finally{delete g[b]}a[b]||(a[b]=1);return nokia.mh5.resolve(b)},_getScript:function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.send(null);var h=b.status;if(!(!h&&location&&"file:"===location.protocol||200<=h&&300>h||304===h||1223===h||0===h))throw Error("Unable to load "+a+" status: "+b.status);return nokia.mh5.win.eval(b.responseText)},
getLoadPath:function(a,b){var h=nokia.mh5.modulePaths[a];if(!h)for(var f=a.split("."),c=f.pop(),j=[];f.length;){h=f.join(".");if(h=nokia.mh5.modulePaths[h]){h+=j.join("/");h+="/"!==h.charAt(h.length-1)?"/"+c:c;break}j.splice(0,0,f.pop())}return h+("."+(b||"js"))}};nokia.mh5.modulePaths["nokia.mh5"]=nokia.mh5.modulePaths["nokia.mh5"]||function(){for(var a=document.getElementsByTagName("script"),b=0,h=/(^|\/|\\)core[\.\w]*?\.js$/i,f="",c,j,i;c=a[b++];)if(c=c.src||"",j=c.match(h)){if(-1===c.indexOf("://")){f=
nokia.mh5.win.location.href;i=f.indexOf("#");var g=f.indexOf("?");i=i>g&&-1<g?g:i;f=-1<i?f.substring(0,i):f;f=f.substring(0,f.lastIndexOf("/")+1)}i=f+c.substring(0,j.index);i="/"===i.charAt(i.length-1)?i:i+"/"}return i}()}}).call(this);
nokia.mh5.each=function(g,a,b){if(!g)return null;var d=0,e=g.length,h,b=b||g;if("number"!==typeof e||"[object Object]"===Object.prototype.toString.call(g)&&!(e-1 in g))for(h in g){if(g.hasOwnProperty(h)&&!1===a.call(b,g[h],h,g))break}else for(h=g[0];d<e&&!1!==a.call(b,h,d,g);h=g[++d]);return g};
nokia.mh5.extend=function(g,a){for(var b=Object,d=b.defineProperty,e=b.getOwnPropertyNames,b=b.getOwnPropertyDescriptor,h=[].slice.call(arguments,1),f=0,c=h.length,j,i,m,l,n;f<c;++f)for(a=h[f],l=a?e(a):[],j=0,i=l.length;j<i;++j)m=l[j],(n=b(a,m))?n.enumerable&&("function"!==typeof a||"prototype"!==m)&&d(g,m,n):g[m]=a[m];return g};
nokia.mh5.extendDeep=function(g,a){for(var b in a)if(a.hasOwnProperty(b))if(a[b]&&g[b]&&"object"===typeof g[b]&&!Array.isArray(g[b])){var d=g[b];g[b]={};nokia.mh5.extend(g[b],d);nokia.mh5.extendDeep(g[b],a[b])}else a[b]&&"object"===typeof a[b]&&!Array.isArray(a[b])?(g[b]={},nokia.mh5.extendDeep(g[b],a[b])):g[b]=a[b];return g};
nokia.mh5.type=function(g){return null===g&&"null"||void 0===g&&"undefined"||g.callee&&"arguments"||"object"===typeof g&&"number"===typeof g.length&&!g.propertyIsEnumerable("length")&&"array"||g instanceof Date&&"date"||typeof g};nokia.mh5.resolve=function(g,a){a=a||nokia.mh5.win;return!g?a:g.split(".").reduce(function(a,d){return a&&a[d]},a)};
nokia.mh5.Class=function(g){function a(a,i){var g=!i,l;g?i=typeof a===f?a():a:typeof i===f&&(i=i(a[e]));l=c.call(i,d)?i[d]:!g?function(){a.apply(this,arguments)}:function(){};g?(b.prototype=i,l[e]=new b):(nokia.mh5.extend(l,a),b[e]=a[e],nokia.mh5.extend(l[e]=new b,i));l[e][d]=l;c.call(i,h)&&nokia.mh5.extend(l,i[h]);return l}var b=function(){},d="constructor",e="prototype",h="statics",f="function",c=g.Object[e].hasOwnProperty;a[e]=g.Function[e];return a}(this);nokia.mh5.buildNS("nokia.mh5.i18n_languages");
nokia.mh5.i18n_languages.en={"Error.applicationCredential":"appId or appCode is missing. Please apply for API credentials at http://nka.fi/EvZeT.","Error.controlProperty":"Control property is not defined","Error.prepareBindings":"%value% can't be bound because %snmspa% can't be resolved","Error.propertyCannotBeOverwritten":"Property: '%name%' cannot be overwritten","Error.customContentNotAllowed":"You can't use custom content with the name %name% because it's already in use","Error.unableToRemove":"Removing '%name%' is not possible",
"Error.routeTooLong":"Walking routes aren't available for routes longer than %maxWalkingDistance%.","Error.tooLongWalkingDistance":"Your destination isn't within walking distance of your current location.","Warning.placeId":"`id` property in place object was changed to `placeId`","Notification.addedToFavourites":"Added to your Favourites","Notification.cantFindLocation":"Can't find your location. Please enter your starting point above.","Notification.connectionError":"Please check your connection and try again",
"Notification.destInWalkingDistance":"Destination is within walking distance","Notification.error":"There was a problem","Notification.favouritesNoSaved":"Couldn't save Favourite","Notification.goOnline":"Connect to internet to search for places and addresses","Notification.goOnlineForRouting":"Connect to internet to get a route","Notification.goOnlinePlaceHolder":"Connect to internet to search","Notification.lookingForCurrentPosition":"Finding your current location","Notification.noGPSSignal":"Can't find your current location",
"Notification.noModeAvailable":"%mode% mode is unavailable","Notification.noPublicTransportService":"Public transport routing isn't available here","Notification.noResult":"No results","Notification.noResultFound":"No results found","Notification.noRoutingService":"Sorry. Routes aren't available just now. Please try later.","Notification.offRoute":"You seem to be off route by %value%","Notification.placeRemovedByOwner":"Sorry.<br>We don't have any info about this place anymore.","Notification.placeError":"Couldn't show you this place just now. <br>Please try later.",
"Notification.positionNotAvailable":"Can't find your current location","Notification.removedFromFavourites":"Removed from your Favourites","Notification.routeCalculation":"Getting your route","Notification.searchProblem":"There's a problem at the moment. Please try searching again later.","Notification.serverError":"Sorry. There's a problem on our end. Please search again later.","Notification.unableToLoadImage":"Couldn't load the image","Notification.trafficInBeta":"Traffic view is still in beta.",
eating:"Eating out",shopping:"Shopping","going-out":"Going out",sights:"Sights",maps:"Views",layers:"Traffic",mapControl:"Map control",mapTermsOfUse:"Terms of Use",about:"About",beta:"beta",basic:"basic",businessOwner:"Business owner",call:"Call",cancel:"Cancel",done:"Done",favourite:"Favourite",favourites:"Favourites",feedback:"Feedback",from:"From",guides:"Guides",highest:"highest",hr:"hr",min:"min",km:"km",location:"location",minApprox:"min approx",more:"More",nearbyPlaces:"Nearby places",ok:"Ok",
place:"place",refresh:"Refresh",retry:"Retry",reviews:"Reviews",route:"Route",save:"Save",search:"Search",searchPlaces:"Search for places",searching:"Searching",send:"Send",sending:"Sending",signin:"Sign in",signout:"Sign out",share:"Share",source:"Source",start:"Start",submit:"Submit",take:"Take",hi:"Hi %name%!",thankYou:"Thank you.",to:"To",towards:"towards",web:"Web",welcome:"Welcome!",sms:"SMS",tel:"tel",email:"Email",shareVia:"share via",imagesProvidedBy:"Images from ",contentProvidedBy:"Content from ",
openingTimes:"Opening hours",placeDescription:"Place description",followFor:"Follow for",saveMapArea:"Save a map area",paymentMethods:"Payment methods",PT:"Public transport",addingA:"Adding a",removingA:"Removing a",currentLocation:"Current location",messageHere:"Message here",shareAPlace:"Share a place","EP.idLikeTo":"Hey, here's something for you to check out on Nokia Maps.","SMS.plsEnterNum":"Please enter the recipient's number<br />(including country code, e.g. +441234567890)","SMS.plsCheckNum":"Please check the phone number",
"SMS.alsoShort":"Add a short message (if you want to):","SMS.enterCaptcha":"Enter here the characters you see below","SMS.wrongCaptcha":"Please try another security code","SMS.enterCode":"Enter the code here","SMS.unableToSend":"Couldn't send your message. Please try again later.","FV.startSaving":"Start saving them now!","FV.startSavingHint":"The places you love are at your fingertips when you add them to your Favourites.","FV.takeAllFavourites":"Sign in and take your Favourites with you.","FV.simplyTap":"Just tap the blue star on the place page.",
"FV.tapTheHighlighted":"Tap the yellow star, and the place is no longer in your list.","FV.syncing":"Syncing","FV.syncedFavourites":"Everything is synced","FV.addedButUnsyncedFavourites":"Added but not yet synced","FV.addedNotSignedIn":"Added to Favourites","FV.addedSignedIn":"Added to Favourites and syncing","FV.removedNotSignedIn":"Removed from Favourites","FV.removedSignedIn":"Removed from Favourites and syncing","FV.signInToSyncronize":"Sign in to sync","FV.couldNotSync":"Couldn't sync","RA.arriveAt":"Arrive at",
"RA.departFrom":"Depart from","RA.drive":"drive","RA.walk":"walk","RA.walkTo":"Walk to","RA.disclaimer":"Transport information is provided by local transport agencies and is subject to change. More detailed and up-to-date information on schedules and services may be available on the agency website:","UI.SettingsDialog.mapView":"Map view","UI.SettingsDialog.satView":"Satellite view","UI.SettingsDialog.PTView":"Public transport view","UI.SettingsDialog.trafficView":"Live traffic view","UI.SettingsDialog.Km":"Kilometres",
"UI.SettingsDialog.Miles":"Miles","UI.SettingsDialog.Accidents":"Accidents","UI.SettingsDialog.Congestions":"Congestion","UI.SettingsDialog.Constructions":"Construction","UI.SettingsDialog.Others":"Other","UI.SettingsDialog.CommunityMaps":"Community view","UI.SettingsDialog.CommunityMapFootnote":"Community maps are living maps - created and updated by users all over the world","maps.BP.bookmark":"To get the most from Nokia Maps, add our app as a bookmark to your home screen.","maps.BP.install":"To install the app, tap the button %dir% and then 'Add to Home Screen'.",
"maps.CVD.details":"Level of detail you can expect:","maps.CVD.viewDetails":"Level of detail in current view:","maps.CVD.tooLarge":"This area is too large. Move and zoom to centre on the neighbourhood you want to save.","maps.CVD.goOnline":"You need a data connection to save the map.","maps.CVD.rangeOfDetails":"Here's the range of detail you can see in saved map areas. Keep in mind, the more detail you want, the smaller the area of your map.","maps.CVD.world":"Basic details","maps.CVD.country":"Some details",
"maps.CVD.city":"Average details","maps.CVD.district":"Lots of details","maps.CVD.street":"Maximum details","maps.CVD.worldDesc":"See continents, countries, cities, motorways, road numbers and forests","maps.CVD.countryDesc":"See countries, cities, districts, motorways, main streets, road numbers, airports, forests and lakes","maps.CVD.cityDesc":"See cities, districts, detailed street grids, railways &amp; stations, major public transport, parks and lakes","maps.CVD.districtDesc":"See districts, more detailed street grids, railways, all public transport, buildings, parks and paths",
"maps.CVD.streetDesc":"See all streets and names, railways, all public transport, all buildings, parks and paths","maps.SPD.startDownload":"Start your download","maps.SPD.savingArea":"Saving your map area","maps.SPD.instructionStart":"Map downloads can be large, so remember to use Wi-Fi.<br><br>Don't close this app while saving your map, and make sure your screensaver doesn't switch on.","maps.SPD.instructionLoad":"Map downloads can be large, so remember to use Wi-Fi.<br><br>Don't close this app while saving your map, and make sure your screensaver doesn't switch on.",
"maps.SPD.instructionFinished":"Your map's been saved.<br>You can find it now in your springboard.<br><br><span style='font-weight: bold'>Keep in mind that saving a new map area always replaces the last one you saved.</span>","maps.SPD.keepInMind":"Keep in mind that saving a new map area always replaces the last one you saved.","maps.SPD.minZoom":"Your min zoom level","maps.SPD.maxZoom":"Your max zoom level","maps.SPD.waiting":"Waiting for download to start","maps.SPD.smtUnexpected":"There was a problem during the download.",
"maps.SB.saveMap":"Save a map area","maps.SB.viewMap":"View your saved map","maps.NPS.recommend":"How likely are you to recommend Nokia Maps to a friend or colleague?","maps.NPS.notLikely":"Not at all likely","maps.NPS.extremelyLikely":"Extremely likely","maps.NPS.why":"Please tell us why you gave this score","maps.NPS.enterMessage":"Enter message here...","maps.NPS.email":"Enter email address","maps.NPS.NPP":'Your information will be treated according to the <a href="http://nokia.mobi/privacy/policy" target="blank">Nokia Privacy Policy</a>.',
"maps.NPS.noSend":"Unable to send. Please try again.","maps.NPS.contact":"Nokia can contact me for details","maps.Nav.headDirectionforDistance":"Head %direction% for %distance%","maps.Nav.reachedDestination":"You have reached your destination","maps.Nav.speeding":"If you're still walking, you walk very fast! Navigation will start again when you've slowed down.","maps.Nav.tryAgain":"The download didn't work","maps.Nav.disclaimerTitle":"Using audio directions","maps.Nav.disclaimerPoint1":"Be aware of your surroundings and keep an eye open for cars and other urban challenges.",
"maps.Nav.disclaimerPoint2":"Make sure your phone's display doesn't go dark, or you might not be able to hear the navigation instructions clearly. Also, be sure to download a voice file first (1.9MB).","maps.Nav.disclaimerPoint3":"Using Nokia services may involve large amounts of data moving through your service provider's network. Not all services may be available or 100% accurate all the time. Using this service could also involve sending information about your location.","maps.Nav.disclaimerPoint4":'By tapping \'Load audio\', you confirm that you have read and agree to the <a href="http://nokia.mobi/privacy/services/terms/nokia-service" onclick="event.stopPropagation();" target="blank">Nokia Service Terms</a> and <a href="http://nokia.mobi/privacy/policy" onclick="event.stopPropagation();" target="blank">Privacy Policy</a>. For more information <a href="http://nokia.mobi/privacy/services/map-apps" onclick="event.stopPropagation();" target="blank">click here</a>.',
"maps.Nav.success":"Download finished","maps.Nav.load":"Load audio","maps.Nav.start":"Start journey","maps.Traffic.incidentDescription":"on %origin% towards %direction%","maps.Traffic.incidentDescriptionNoDirection":"on %origin%","maps.Traffic.incidentAt":"at %start%","maps.Traffic.incidentUnidir":"from %start% to %end%","maps.Traffic.incidentBidir":"between %start% and %end%","maps.Traffic.incidentStartTime":"Start time","maps.Traffic.incidentEndTime":"Approx end time","maps.Traffic.incidentDateFormat":"%month%/%day%/%year% %hour%:%minute%",
"maps.Traffic.criticalityTitle":"Severity","maps.Traffic.critical":"Critical","maps.Traffic.major":"Major","maps.Traffic.minor":"Minor"};nokia.mh5.provide("nokia.mh5.platform");
(function(g){var a=g.navigator,b=a.userAgent.toLowerCase(),d=b.match(/\w{2}-\w{2}/)&&RegExp.lastMatch||a.language||a.browserLanguage,e=nokia.mh5.win.location.href,h=g.outerHeight*g.outerWidth/(g.devicePixelRatio||1),h=/lo=tablet/.test(e)||!/lo=phone/.test(e)&&!/ip(?:hone|od)/.test(b)&&(/gt-p1000/.test(b)||614400<h||/iPad/.test(a.platform)),d=d.toLowerCase();nokia.mh5.platform={iphone:/iPhone/.test(a.platform),ipod:/iPod/.test(a.platform),ipad:/iPad/.test(a.platform),ios:/(iPhone)|(iPod)|(iPad)/.test(a.platform),
android:/android/.test(b),playbook:/playbook/.test(b),blackberry:/blackberry/.test(b),tablet:h,phone:!h,android_webview:!!nokia.mh5.win.android_js_interface,n9:/nokian9/.test(b),ios_webview:/(iPhone)|(iPod)|(iPad)/.test(a.platform)&&/phonegap/.test(b),ie:/msie/.test(b),language:d||a.language.toLowerCase()||a.browserLanguage,backButton:/back=on/.test(e),cssTransform3dSupported:function(){var a=nokia.mh5.doc.createElement("div"),c=["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective",
"msPerspective"],b=!1,h;for(h in c)if(c[h]in a.style){b=!0;break}a.className="mh5_cssTransform3dTest";nokia.mh5.doc.body.appendChild(a);b=b&&"relative"===nokia.mh5.win.getComputedStyle(a,null).position;a.parentNode&&a.parentNode.removeChild(a);return b}(),hideAddressBar:function(a){var c="undefined"==typeof g.orientation||0===g.orientation||180==g.orientation,b;if(nokia.mh5.platform.iphone||nokia.mh5.platform.ipod)g.document.body.style.minHeight=(c?416:268)+"px",b=setTimeout(function(){clearTimeout(b);
g.scrollTo(0,0)},0);else if(nokia.mh5.platform.android)var h=setTimeout(function(){clearTimeout(h);a&&"orientationchange"===a.type&&g.scrollTo(0,0);var c=g.devicePixelRatio;if(!c||1>c)c=0.9;g.document.body.style.minHeight=g.outerHeight/c+"px";b=setTimeout(function(){clearTimeout(b);g.scrollTo(0,1)},1)},nokia.mh5.platform.hideAddressBar.DELAY)}};nokia.mh5.platform.hideAddressBar.DELAY=200;if(nokia.mh5.platform.ios)nokia.mh5.platform.ios={io4:-1!==b.indexOf("os 4_"),io5:-1!==b.indexOf("os 5_")};if(nokia.mh5.platform.android)a=
/android ([0-9].[0-9])/.exec(b),b=/(Chrome)/.exec(b),nokia.mh5.platform.android={version:a&&0<a.length&&a[1],browser:b?"chrome":"default"};nokia.mh5.platform.undetectable=!(nokia.mh5.platform.ios||nokia.mh5.platform.android||nokia.mh5.platform.blackberry||nokia.mh5.platform.playbook)})(this);nokia.mh5.provide("nokia.mh5.event");
nokia.mh5.event&&nokia.mh5.event.fire||function(g){function a(c){var a=c.replace(y,"");return function(b,f,h,e){if(!x.call(q,"on"+f)||!1!==q["on"+f](a,b,f,h,e))b[c](x.call(H,f)?H[f]:f,h,e)}}function b(c,a,b,f){c==C?u(c,a,b,f):w.push("add",c,a,b,f)}function d(c,a,b,f){c==C?z(c,a,b,f):w.push("remove",c,a,b,f)}function e(c){g[this](c,f,!0);g.documentElement[this](c,f,!0)}function h(c,a,b,f,h){var e=g.createEvent("Event");e.initEvent(x.call(H,a)?H[a]:a,x.call(b,"bubbles")?!!b.bubbles:f,x.call(b,"cancelable")?
!!b.cancelable:h);e.data=b;e.name=a;c.dispatchEvent(e);return e}function f(f){var j=(f.touches||[f])[0].target,f=/^touch/.test(f.type);if(w){if(!f&&(/input/i.test(j.nodeName)||nokia.mh5.platform.android))f="ontouchend"in g;F.forEach(e,v);Object.defineProperty(q,"isTouch",{value:f});H=q.isTouch?{down:"touchstart",move:"touchmove",up:"touchend"}:{down:"mousedown",move:"mousemove",up:"mouseup"};H.press=H.down;H.release=H.up;J=u;K=z;I=h;c(A);j=0;for(f=w.length;j<f;j+=5)if("string"==typeof w[j])q[w[j]](w[j+
1],w[j+2],w[j+3],w[j+4]);else I(w[j],w[j+1],w[j+2],w[j+3],w[j+4]);a=F=b=d=e=w=null}}function c(c){var a=q.isTouch,a={type:o,mouse:!a,touch:a};for(A=null;c.length;)c.shift()(a)}function j(c,a,b){"function"==typeof c.handleEvent?c.handleEvent(this):c.call(this.target,this);this.stopped&&b.splice(0,b.length)}function i(){this.stopped=!0}function m(){this.defaultPrevented=!0}var l=["insertedintodocument"],n="__evt__"+Math.random(),o="pointerdetect",q={one:function(c,a,b,f){[].concat(a).forEach(function(a){q.add(c,
a,function L(h){q.remove(c,a,L,f);j.call(h,b)},f)});return q},add:function(a,b,f,h){[].concat(b).forEach(function(b){if(!a||a===C||a instanceof E)if(b===o)A?A.push(f):c([f]);else if(~l.indexOf(b))q["on"+b]("add",a,b,f,h);else J(a,b,f,!!h);else{var e=a[n]||(a[n]={}),e=e[b]||(e[b]=[]);0>e.indexOf(f)&&e.push(f)}});return q},remove:function(c,a,b,f){[].concat(a).forEach(function(a){if(!c||c===C||c instanceof E)if(a===o)A&&(a=A.indexOf(b),~a&&A.splice(a,1));else if(~l.indexOf(a))q["on"+a]("remove",c,a,
b,f);else K(c,a,b,!!f);else{var h=c[n]||(c[n]={}),h=h[a]||(h[a]=[]),a=h.indexOf(b);~a&&h.splice(a,1)}});return q},fire:function(c,a,b,f,h){var e;[].concat(a).forEach(function(a){!c||c===C||c instanceof E?e=I(c||C,a,b||{},null==f?!0:!!f,null==h?!0:!!h):((c[n]||{})[a]||[]).slice(0).forEach(j,e={target:c,currentTarget:c,type:a,data:b,stopPropagation:b&&b.stopPropagation||i,preventDefault:b&&b.preventDefault||m})});return e}},x=q.hasOwnProperty,C=g.defaultView,E=C.Node||C.HTMLElement,F="touchstart,touchmove,touchend,mousedown,mousemove,mouseup,mousewheel,DOMMouseScroll".split(","),
y="EventListener",B="add"+y,v="remove"+y,w=[],A=[],u=a(B),z=a(v),J=b,K=d,I=function(c,a,b,f,e){c==C?h(c,a,b,f,e):w.push(c,a,b,f,e)},H={};F.forEach(e,B);Object.defineProperty(nokia.mh5,"event",{writable:!1,configurable:!1,enumerable:!0,value:Object.defineProperties(q,{add:{value:q.add},remove:{value:q.remove},fire:{value:q.fire}})})}(nokia.mh5.doc);nokia.mh5.provide("nokia.mh5.utils");
(function(g){function a(c,a){return void 0!==this[a]?this[a]:""}var b={},d=g.localStorage||{getItem:function(c){return d["_"+c]},setItem:function(c,a){d["_"+c]=a}},e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},h={},f=nokia.mh5.utils={place:{getCategoryIconForFav:function(c){var a={accommodation:"01",hotel:"01",motel:"01",hostel:"01",camping:"14","business-services":"02","atm-bank-exchange":"15","police-emergency":"19","post-office":"20","tourist-information":"21","petrol-station":"18",
"car-rental":"17","car-dealer-repair":"16","travel-agency":"02","communication-media":"02","business-industry":"02",service:"02","eat-drink":"03",restaurant:"03","snacks-fast-food":"03","bar-pub":"22","coffee-tea":"23",facilities:"04","hospital-health-care-facility":"26","government-community-facility":"25","education-facility":"04",library:"27","fair-convention-facility":"24","parking-facility":"28","toilet-rest-area":"29","sports-facility-venue":"30",facility:"04","going-out":"05","dance-night-club":"33",
cinema:"32","theatre-music-culture":"05",casino:"31","administrative-areas-buildings":"06","administrative-region":"06","city-town-village":"35","street-square":"06","outdoor-area-complex":"06",building:"06","leisure-outdoor":"07",recreation:"07","amusement-holiday-park":"34","natural-geographical":"08","body-of-water":"36","mountain-hill":"08","undersea-feature":"08","forest-heath-vegetation":"08",shopping:"09","kiosk-convenience-store":"09",mall:"09","department-store":"09","food-drink":"09",bookshop:"09",
pharmacy:"37","electronics-shop":"09","hardware-house-garden-shop":"09","clothing-accessories-shop":"09","sport-outdoor-shop":"09",shop:"09","sights-museums":"10","landmark-attraction":"38",museum:"10","religious-place":"39",transport:"11",airport:"40","railway-station":"43","public-transport":"11","ferry-terminal":"41","taxi-stand":"42"};return(a[c]?a[c]:"06")+"_01.icon.mh5.basic.png"},getCategoryIcon:function(c){var a=nokia.mh5.assetsPath+"img/categories/",b;if(c.categoryIcon)return c.categoryIcon;
if(!c.icon)c.icon="06.icon";b=c.icon.match(/((\d+)(_\d{2})?\.icon)/);a+=c.favourite&&!b[4]?b[2]+"_01.icon":b[1];return a+".mh5.basic.png"},categoryIdentifier:function(){for(var c=["business-services",["service",215,207,258,"business-services",269,"atm-bank-exchange",47,"car-rental",20,"car-dealer-repair",2,46,51,56,"travel-agency",277,"communication-media",278,"business-industry",5],"transport",["transport",272,218,53,"airport",43,"railway-station",41,"public-transport",58,"ferry-terminal",35,"taxi-stand",
216],"shopping",["food-drink",143,"shop",23,"shopping",270,142,23,"clothing-accessories",205,"clothing-accessories-shop",205,"mall",24,"department-store",189,"electronics",196,"electronics-shop",196,"hardware-house-garden",194,"hardware-house-garden-shop",194,"bookshop",276,"sport-outdoor-shop",191,"kiosk-24-7-convenience-store",197,"kiosk-convenience-store",197],"accommodation",["accommodation",271,"hostel",173,"hotel",38,"motel",174,"camping",32],"going-out",["going-out",274,"dance-or-night-club",
203,"dance-night-club",203,"casino",3,"cinema",4,"theatre-music-culture",181],"facilities",["facilities",261,212,268,"facility",261,212,"fair-convention-facility",7,"government-or-community-facility",12,"government-community-facility",12,"library",31,"parking-facility",39],"natural-geographical",["natural-geographical",265,"body-of-water",262,"mountain-or-hill",45,"undersea-feature",260,"forest-heat-or-other-vegetation",259,"forest-heath-vegetation",259],"administrative-areas-buildings",["administrative-region",
279,"city-town-or-village",283,"city-town-village",283,"outdoor-area-complex",263,"building",280,"administrative-areas-buildings",266],"eat-drink",["bar-pub",33,"eat-drink",275,"restaurant",22,"coffee-tea",63,"snacks-fast-food",64],"leisure-outdoor",["amusement-or-holiday-park",1,"amusement-holiday-park",1,"leisure-outdoor",267,"recreation",48],"sights-museums",["sights-museums",273,213,"landmark-attraction",27,211,213,163,153,150,147,148,149,184,"museum",14],"address",["address",284],"religious-place",
["religious-place",158],"pharmacy",["pharmacy",49],"education-facility",["education-facility",106],"hospital-health-care-facility",["hospital-or-health-care-facility",200,209,"hospital-health-care-facility",200,209],"sport-facility-venue",["sport-outdoor",220,"sports-outdoor",220,"sport-facility-venue",220,"sports-facility-venue",220],"police-emergency",["police-emergency",40],"post-office",["post-office",19],"tourist-information",["tourist-information",28],"petrol-station",["petrol-station",17]],
a={},b={},f=[].indexOf,h=[].forEach,e=function(c){var h=""+this;"number"==typeof c&&9E6>c&&(b[c+9E6]=h,a.hasOwnProperty(h)||(a[h]=[]),0>f.call(a[h],c+9E6)&&a[h].push(c+9E6));b[c]=h},d=0,g=c.length;d<g;d+=2)h.call(c[d+1],e,c[d]);return function(c,f){var h=b[c];return f?a[h].join(","):h}}()},getLocalStorageValue:function(c){return d.getItem(c)},setLocalStorageValue:function(c,a){try{d.setItem(c,a)}catch(b){return!1}return!0},formatString:function(c,b){return c.replace(/%([^%]+)%/g,a.bind(b))},escapeHTML:function(c){return(""+
c).replace(/&(?!\w+;)|[<>"']/g,function(c){return e[c]||c})},cacheObject:function(c,a){if(void 0===a)return b[c];b[c]=a},purify:function(c){if(!(c instanceof Object))return c;var a={},b;for(b in c)if(c.hasOwnProperty(b)&&!("_bindings"===b||c[b]instanceof HTMLElement))a[b]=c[b];return a},formatDistance:function(c,a){return"mi"==a?161>=c?10*Math.round(3.281*c/10)+"ft":(160900>c?(c/1609).toFixed(1):Math.round(c/1609))+"mi":1E3>c?Math.round(c)+"m":(1E5>c?(c/1E3).toFixed(1):Math.round(c/1E3))+"km"},formatTime:function(c){var a=
Math.round(c/60);return 20<a&&55>a?5*Math.ceil(a/5)+"min":55<=a?0.5*Math.ceil(c/1800)+"hr":a+"min"},formatURLParams:function(c){return Object.keys(c).map(function(a){return encodeURIComponent(a)+"="+encodeURIComponent(c[a]+"")}).join("&")},uuid4:function(){var c=Math.random,a=("0000000"+((4294967296*c()&4294922239|16384)>>>0).toString(16)).slice(-8),b=("0000000"+((4294967296*c()&3221225471|2147483648)>>>0).toString(16)).slice(-8);return[("0000000"+(4294967296*c()>>>0).toString(16)).slice(-8),a.slice(0,
4),a.slice(4),b.slice(0,4),b.slice(4)+("0000000"+(4294967296*c()>>>0).toString(16)).slice(-8)].join("-")},isPlace:function(c){return!(!c.placeId||!c.placeId.match(/([\w\d]{8}-[\w\d]{32})/))},getApiSession:function(){return h}},c=function(){var a=864E5,b=Date.now();!h.timestamp||b-h.timestamp>a?(h.id="CL_MH5v1.0.2,SID_"+f.uuid4().replace(/-/g,""),h.timestamp=b,nokia.mh5.event.fire(nokia.mh5,"newapisession",h)):a=b-h.timestamp;nokia.mh5.win.setTimeout(c,a+10)};c()})(this);nokia.mh5.provide("nokia.mh5.i18n");
nokia.mh5.i18n=function(){function g(c,a){if(c in d)return c=d[c],a?b(c,a):c}var a=/\/(combined\.js|mh5\.js|src\/).*$/,b=nokia.mh5.utils.formatString,d={},e=this,h,f;[].forEach.call(document.querySelectorAll("script"),function(c){!f&&a.test(c.src)&&(f=c.src.replace(a,"")+"/lang/")});Object.defineProperty(g,"language",{get:function(){return h},set:function(c){h=c;e.nokia_mh5_i18n=nokia.mh5.i18n_languages[c];d=e.nokia_mh5_i18n;delete e.nokia_mh5_i18n;nokia.mh5.utils.setLocalStorageValue("nokia.mh5.i18n",
h)}});g.getIsoLanguage=function(){return h.replace(/-/,"_")};"nokia_mh5_i18n"in e?(d=e.nokia_mh5_i18n,delete e.nokia_mh5_i18n):g.language=nokia.mh5.utils.getLocalStorageValue("nokia.mh5.i18n")||"en";return g}.call(this);nokia.mh5.provide("nokia.mh5.jsonp");
nokia.mh5.jsonp=function(){var g=0,a=window.document,b;return function(d,e,h){var f="MH5_"+g++,c=a.createElement("script"),j=function(){try{delete window[f]}catch(a){window[f]=null}c.parentNode.removeChild(c)},i=setTimeout(function(){window[f].call(this,{error:"timeout"})},~~h||15E3);nokia.mh5.event.add(c,"error",function(){});b||(b=a.head||a.getElementsByTagName("head")[0]||a.documentElement);window[f]=function(){j();clearTimeout(i);e.apply(this,arguments)};b.insertBefore(c,b.lastChild).src=d+"="+
f;return{uri:d,timeout:h,cancel:function(){clearTimeout(i);return c&&c.parentNode?(window[f]=j,!0):!1}}}}();nokia.mh5.provide("nokia.mh5.connectors.story.StoryAdapter");
(function(){var g=nokia.mh5.i18n,a="",b="initializing";nokia.mh5.connectors.story.StoryAdapter={msgList:{"000":g("Notification.connectionError"),"010":g("Notification.connectionError"),"020":g("Notification.serverError"),207:g("Notification.serverError"),400:g("Notification.serverError"),403:g("Notification.connectionError"),404:g("Notification.connectionError"),412:g("Notification.connectionError"),500:g("Notification.serverError")},createShareLink:function(a){return link=a.placeId?"http://maps.nokia.com/services/place/"+
a.placeId:"http://maps.nokia.com/map="+a.latitude+","+a.longitude+",16/title="+encodeURIComponent(a.name)},shortLink:function(a,b){nokia.mh5.jsonp("http://m.here.com/releases/1.8.50/server/ushare/short.php?longUrl="+encodeURIComponent(a)+"&jsonp",function(a){b(a?a.shortUrl:"")})},init:function(d){if("initialized"!=b){var e=function(h){var f=h||{};!h||f.error||!f.sectoken?(f.success=!1,f.errorMessage=this.msgList["000"]):(f.success=!!(200==f.retCode||403==f.retCode),f.success?(a=f.sectoken,b="initialized"):
f.errorMessage=this.msgList[f.retCode+""]);d(f)}.bind(this);nokia.mh5.jsonp("http://m.here.com/releases/1.8.50/server/ushare/auth.php?jsonp",e)}else d({success:!0})},_getState:function(){return b},getCaptcha:function(d){if("initialized"==b){var e=function(a){var b=a||{};if(a.error)b.success=!1,b.errorMessage=this.msgList["000"];else if(b.success=200==b.result.retCode,!b.success)b.errorMessage=this.msgList[b.result.retCode+""];d(b)}.bind(this);nokia.mh5.jsonp("http://m.here.com/releases/1.8.50/server/ushare/captcha.php?sectoken="+
a+"&jsonp",e)}else d({success:!1,errorMessage:this.msgList["010"]})},share:function(d,e){e.url=nokia.mh5.connectors.story.StoryAdapter.createShareLink(e.place);var h="";if("initialized"==b){var f;f=function(c){var a=c||{};if(!c||c.error)a.success=!1,a.errorMessage=this.msgList["000"],d(a);else if(a.success=200==a.result.retCode,!a.success)a.errorMessage=this.msgList[a.result.retCode+""];d(a)}.bind(this);switch(e.targets){case "default@sm":h="http://m.here.com/releases/1.8.50/server/ushare/share.php?sectoken="+
a+"&version=1.1&captchaId="+encodeURIComponent(e.captcha.captchaId)+"&captchaVerifyText="+encodeURIComponent(e.captcha.captchaVerifyText)+"&targets=default@sm&type="+encodeURIComponent(e.type)+"&msg="+encodeURIComponent(e.msg)+"&participantSMSPhone="+encodeURIComponent(e.participantSMSPhone)+"&phoneNumber=&title="+encodeURIComponent(e.title)+"&url="+encodeURIComponent(e.url)+(e.place.placeId?"&shareDataObj="+this.encodeShareData(e.place):"");break;case "default@vk":case "default@fb":case "default@tw":case "default@gb":case "default@me":h=
"http://m.here.com/releases/1.8.50/server/ushare/share.php?sectoken="+a+"&version=1.1&targets="+e.targets+"&type="+encodeURIComponent(e.type)+"&title="+encodeURIComponent(e.title)+"&url="+encodeURIComponent(e.url)+"&shareDataObj="+this.encodeShareData(e.place);break;default:d({success:!1,errorMessage:this.msgList["020"]})}nokia.mh5.jsonp(h+"&jsonp",f)}else d({success:!1,errorMessage:this.msgList["010"]})},encodeShareData:function(a){return encodeURIComponent(JSON.stringify(a.placeId?{serviceName:"Nokia Maps",
serviceURL:"http://maps.nokia.com",descriptions:{shareString1:a.name,shareString2:a.address,shareString3:a.categoryGroup+" / "+a.category,shareString4:"",shareString5:a.phone},location:{placesId:a.placeId,latitude:""+a.latitude,longitude:""+a.longitude,streetName:a.address,houseNumber:"",cityName:"",stateOrProvince:"",postalCode:"",districtName:"",countryCode:"",countryName:""}}:{serviceName:"Nokia Maps",serviceURL:"http://maps.nokia.com",descriptions:{shareString1:a.name},location:{placesId:"",latitude:""+
a.latitude,longitude:""+a.longitude,streetName:a.address,houseNumber:"",cityName:"",stateOrProvince:"",postalCode:"",districtName:"",countryCode:"",countryName:""}}))}}})();nokia.mh5.provide("nokia.mh5.dom");
(function(g){function a(c){if(!g.jstestdriver)return c.stopPropagation(),!1}function b(c){c=h.defaultView.getComputedStyle(c,null);return 1E3*(parseFloat(c.getPropertyValue("-webkit-transition-duration")||c.getPropertyValue("-moz-transition-duration")||c.getPropertyValue("transition-duration"))||0)}var d=g.RegExp,e=nokia.mh5.doc.body,h=g.document;h.addEventListener("touchstart",function(){},!0);var f=nokia.mh5.dom={touchStart:"down",touchMove:"move",touchEnd:"up",contains:function(c,a){return c.contains?
c.contains(a):!!(c.compareDocumentPosition(a)&16)},transformProperty:""===nokia.mh5.platform.vendorPrefix?"transform":nokia.mh5.platform.vendorPrefix+"Transform",dimensions:function(c){return"scrollTo"in c&&c.document?(c=c.document.documentElement,{width:c.clientWidth,height:c.clientHeight}):{width:c.offsetWidth,height:c.offsetHeight}},addClass:function(c,a){f.hasClass(c,a)||(c.className+=(c.className?" ":"")+a)},hasClass:function(c,a){return(new d("(?:^|\\s+)"+a+"(?:\\s+|$)","g")).test(c.className)},
removeClass:function(){for(var c=1,a=arguments.length,b=arguments[0];c<a;c++)b.className=b.className.replace(new d("(?:^|\\s+)"+arguments[c]+"(\\s+|$)","g"),"$1").trim()},addEvent:nokia.mh5.event.add,removeEvent:nokia.mh5.event.remove,fireEvent:nokia.mh5.event.fire,query:function(c,a){return Array.prototype.slice.call((a||h).querySelectorAll(c))},byId:function(c,a){return(a||h).getElementById(c)},createHyperlinkHTML:function(c,a){for(var b="",f=Object.keys(c),h=0;h<f.length;h++)var e=f[h],b=b+(e+
"='"+c[e]+"' ");c.target||(b+="target='_blank' ");return"<a "+(b+'onclick="if(event._fake) {event.preventDefault();event.stopPropagation()};"')+">"+(a?a:"")+"</a>"},transition:function(){var c,f=arguments.length,h,d;"function"===typeof arguments[f-1]&&(c=arguments[f-1],f--);var g=Array.prototype.slice.call(arguments,0,f),n=function(){h&&(clearTimeout(h),h=0,nokia.mh5.dom.removeEvent(e,"tap",a,!0),nokia.mh5.dom.removeEvent(g[0].node,"webkitTransitionEnd",n,!1),nokia.mh5.dom.removeEvent(g[0].node,"MSTransitionEnd",
n,!1),c&&setTimeout(c,0))};nokia.mh5.dom.addEvent(e,"tap",a,!0);g.forEach(function(c){c.fromTransformClass&&nokia.mh5.dom.addClass(c.node,c.fromTransformClass)});setTimeout(function(){g.forEach(function(c){c.fromTransformClass&&nokia.mh5.dom.removeClass(c.node,c.fromTransformClass);nokia.mh5.dom.addClass(c.node,c.transitionClass);nokia.mh5.dom.addClass(c.node,c.toTransformClass)});d=b(g[0].node)+2E3;h=setTimeout(n,d)},0);nokia.mh5.dom.addEvent(g[0].node,"webkitTransitionEnd",n,!1);nokia.mh5.dom.addEvent(g[0].node,
"MSTransitionEnd",n,!1)},doTransition:function(c){var b=c.node,f=c.parentNode||b.parentNode||e,h=c.previousNode||!1,d=c.type+"Transition";c.transition=!0;if(!b)return!1;d=nokia.mh5.dom[d];nokia.mh5.dom.addEvent(e,"tap",a,!0);c.isHistory&&!c.persistance?f.insertBefore(b,h):(h&&nokia.mh5.dom.addClass(h,"mh5_transition_center"),"fade"===c.type&&nokia.mh5.dom.addClass(c.fadeNode?c.fadeNode:b,"in"===c.mode?"mh5_transition_hide":"mh5_transition_show"),"out"!==c.mode&&!c.persistence&&f.appendChild(b));if(c.onNodeAttached)c.onNodeAttached();
d(c)},slideTransition:function(c){var b=c.previousNode,f=c.node,d=0,g="mh5_transition_"+(c.isHistory?"right":"left"),n="mh5_transition_"+(c.isHistory?"left":"right"),o;c.transition?(nokia.mh5.dom.removeClass(f,"[A-Za-z0-9_]*transition[A-Za-z0-9_]*"),nokia.mh5.dom.addClass(f,n),setTimeout(function(){nokia.mh5.dom.addClass(b,"mh5_transition_slide");nokia.mh5.dom.addClass(f,"mh5_transition_slide");var a=h.defaultView.getComputedStyle(c.node,null);c.duration=1E3*(parseFloat(a.getPropertyValue("-webkit-transition-duration")||
a.getPropertyValue("-moz-transition-duration")||a.getPropertyValue("transition-duration"))||0);d=setTimeout(o,c.duration+2E3);setTimeout(function(){nokia.mh5.dom.removeClass(f,n);nokia.mh5.dom.removeClass(b,"mh5_transition_center");nokia.mh5.dom.addClass(b,g)},0)},0)):d=setTimeout(o,1);o=function(){d&&(clearTimeout(d),d=0,nokia.mh5.dom.removeEvent(e,"tap",a,!0),nokia.mh5.dom.removeEvent(f,"webkitTransitionEnd",o,!1),nokia.mh5.dom.removeClass(b,"mh5_transition_slide"),nokia.mh5.dom.removeClass(f,"mh5_transition_slide"),
nokia.mh5.dom.removeClass(b,g),b.parentNode&&b.parentNode.removeChild(b),c.callback&&c.callback())};nokia.mh5.dom.addEvent(f,"webkitTransitionEnd",o,!1)},fadeTransition:function(c){c.fadeNode=c.fadeNode||c.node;if(!c.transition)return!1;var b=0,f=c.isHistory,d;setTimeout(function(){nokia.mh5.dom.addClass(c.fadeNode,"mh5_transition_fade");var a=h.defaultView.getComputedStyle(c.node,null);c.duration=1E3*(parseFloat(a.getPropertyValue("-webkit-transition-duration")||a.getPropertyValue("-moz-transition-duration")||
a.getPropertyValue("-ms-transition-duration")||a.getPropertyValue("transition-duration"))||0);b=setTimeout(d,c.duration+2E3);f||(nokia.mh5.dom.addClass(c.fadeNode,"mh5_transition_"+("in"===c.mode?"show":"hide")),nokia.mh5.dom.removeClass(c.fadeNode,"mh5_transition_"+("in"===c.mode?"hide":"show")))},0);d=function(){b&&(clearTimeout(b),b=0,"out"===c.mode&&!c.persistence&&c.node.parentNode&&c.node.parentNode.removeChild(c.node),nokia.mh5.dom.removeEvent(e,"tap",a,!0),nokia.mh5.dom.removeEvent(c.node,
"webkitTransitionEnd",d,!1),nokia.mh5.dom.removeEvent(c.node,"MSTransitionEnd",d,!1),nokia.mh5.dom.removeEvent(c.node,"tap",d),nokia.mh5.dom.removeClass(c.node,"mh5_transition_fade"),nokia.mh5.dom.removeClass(c.fadeNode,"in"===c.mode?"mh5_transition_show":"mh5_transition_hide"),c.callback&&c.callback())};nokia.mh5.dom.addEvent(c.node,"webkitTransitionEnd",d,!1);nokia.mh5.dom.addEvent(c.node,"MSTransitionEnd",d,!1)}}})(this);nokia.mh5.provide("nokia.mh5.history");
(function(){var g=[],a=nokia.mh5.win.history,b=-1;nokia.mh5.history={back:function(){a.back()},pushState:function(d,e,h){g[++b]=d;a.pushState({index:b},e,h);nokia.mh5.event.fire(nokia.mh5.history,"historypositionchange",{state:d,position:b,historyLength:g.length})},replaceState:function(d,e,h){-1===b&&(b=0);g[b]=d;a.replaceState({index:b},e,h)},reset:function(){g=[];b=-1}};Object.defineProperty(nokia.mh5.history,"length",{get:function(){return g.length}});Object.defineProperty(nokia.mh5.history,"position",
{get:function(){return b}});nokia.mh5.win.onpopstate=function(d){if(nokia.mh5.history.catchNextOnPopState){nokia.mh5.history.catchNextOnPopState(d.state?g[d.state.index]:null);delete nokia.mh5.history.catchNextOnPopState;var e=nokia.mh5.win.onpopstate;nokia.mh5.win.onpopstate=function(){nokia.mh5.win.onpopstate=e};a.forward()}else if(d.state){var h=d.state.index>b;b=d.state.index;d=h?b:b+1;if(g[d])(d=g[d].onPopState)&&d(g[b],h),nokia.mh5.event.fire(nokia.mh5.history,"historypositionchange",{state:g[b],
position:b,historyLength:g.length})}}})();nokia.mh5.provide("nokia.mh5.event.ontap");
(function(){function g(){nokia.mh5.dom.addClass(this,"mh5_active")}function a(){nokia.mh5.dom.removeClass(this,"mh5_active")}function b(a){a.stopPropagation();a=a.touches[0];c=this._tap_={x:a.screenX,y:a.screenY,c:!0,e:a};g.call(this)}function d(a){if((c=this._tap_)&&c.c)a=a.touches[0],c.c=10>h(c.x-a.screenX)&&10>h(c.y-a.screenY)}function e(b){b.stopPropagation();if(c=this._tap_)delete this._tap_,a.call(this),c.c&&(this.noPreventDefault||b.preventDefault(),f.fire(this,"tap",c.e))}var h=Math.abs,f=
nokia.mh5.event,c;f.ontap=function(c,h,m,l,n){f.isTouch?(f[c](h,"down",b,n),f[c](h,"move",d,n),f[c](h,"up",e,n),h[c+"EventListener"]("tap",l,n)):(f[c](h,"down",g,n),f[c](h,"mouseout",a,n),f[c](h,"up",a,n),f[c](h,"click",l,n))}})();nokia.mh5.provide("nokia.mh5.event.onviewportchange");
(function(g,a,b,d,e,h,f){function c(c){g.event.fire(c,"viewportchange",this)}function j(b){e=0;a.forEach(c,b)}function i(c){clearTimeout(e);e=setTimeout(j,g.platform.hideAddressBar.DELAY+50,c)}g.win.addEventListener("orientationchange",i,!0);g.win.addEventListener("resize",i,!0);g.win.addEventListener("focus",i,!0);g.event.onviewportchange=function(c,e,i,g,j){h=a.indexOf(e);f=b[h]&&b[h].indexOf(g);0>h?(h=a.push(e)-1,b[h]=[g],d[h]=[f=0]):0>f&&(f=b[h].push(g)-1,d[h].push(f));d[h][f]+="add"==c?1:-1;
1>d[h][f]&&(d[h].splice(f,1),b[h].splice(f,1),b[h].length||a.splice(h,1));e[c+"EventListener"]("viewportchange",g,j)}})(nokia.mh5,[],[],[],0);nokia.mh5.provide("nokia.mh5.ui.Control");
nokia.mh5.ui.Control=new nokia.mh5.Class(function(){function g(a,b,f,c){if(!a._bindings||!a._bindings[b])return-1;a=a._bindings[b];for(b=a.length-1;0<=b;--b)if(a[b].object===f&&a[b].property===c)return b;return-1}var a=function(a,b){var f=a.indexOf(b);return-1!==f&&f===a.length-b.length},b=function(a,b,f,c){a._bindings=a._bindings||{};a._bindings[b]=a._bindings[b]||[];a._bindings[b].push({object:f,property:c});var d=Object.getOwnPropertyDescriptor(a,b)||Object.getOwnPropertyDescriptor(a.constructor.prototype,
b);if(!d||!d.set){var i=a[b];Object.defineProperty(a,b,{get:function(){return i},set:function(c){if(!(i===c&&"object"!==typeof i&&!Array.isArray(i))){var f=i;i=c;var d,g;if(a._bindings[b])for(var j=a._bindings[b].length-1;0<=j;--j)d=a._bindings[b][j].object,g=a._bindings[b][j].property,"function"===typeof g?g.call(d,c,f):d[g]=c}}})}"function"===typeof c?c.call(f,a[b]):f[c]=a[b]},d=function(a,b,f,c){a._bindings=a._bindings||{};a._bindings[b]=a._bindings[b]||[];a._bindings[b].push({object:f,property:c});
"function"!==nokia.mh5.type(c)&&(f[c]=a[b]);var d="change";if((a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement)&&"value"===b)d="keyup";nokia.mh5.dom.addEvent(a,d,function(){"function"===nokia.mh5.type(c)?c.call(f,a[b]):f[c]=a[b]})};return{statics:{watch:function(a,h,f,c){a instanceof HTMLElement?d(a,h,f,c):b(a,h,f,c)},bindingExists:function(a,b,f,c){return-1<g(a,b,f,c)},removeBinding:function(a,b,f,c){f=g(a,b,f,c);-1<f&&(c=a._bindings[b],c.splice(f,1),0===c.length&&delete a._bindings[b])}},
constructor:function(a,b){this._attachTouchHandler=this._attachTouchHandler.bind(this);nokia.mh5.extend(this,a);this.parent=b;this.root=nokia.mh5.doc.createElement(this.rootHtmlElementName||"div");(this.hScroll||this.vScroll)&&this._setupScrolling();if(this.innerHTML)this.getContentRoot().innerHTML=this.innerHTML;!this.dontBind&&!b&&(this.prepareBindings(),this.prepareDidChangeNotifications());this.cssClass&&0<this.cssClass.length&&nokia.mh5.dom.addClass(this.root,this.cssClass);if(this.id)this.root.id=
this.id;this.onClick&&this._attachTouchHandler();if(void 0===this.visible)this.visible=!0;nokia.mh5.each(this.listeners,function(a,c){nokia.mh5.event.add(this,c,a)},this)},getRootOwnerByClass:function(a){for(var b=this;"parent"in b&&!(b instanceof a);)b=b.parent;return b},_setupScrolling:function(){var a=this;a.scrollContainer=nokia.mh5.doc.createElement("div");a.root.appendChild(a.scrollContainer);a.scrollContainer.style.display="inline-block";var b=nokia.mh5.doc.createElement(a.scrollContainerElementName||
"div");a.scrollContainer.appendChild(b);var f,c,d,i,g;a._scroll=new iScroll(a.root,{hScroll:a.hScroll,hScrollbar:!1===a.hScrollbar?!1:!0,vScroll:a.vScroll,vScrollbar:!1===a.vScrollbar?!1:!0,hideScrollbar:!0,bounce:!1===a.bounce?!1:!0,scrollbarClass:"mh5_scrollbar"+(a.scrollbarClass?" "+a.scrollbarClass:""),onBeforeScrollStart:function(b){f=b.touches?b.touches[0]:b;c=f.pageX;d=f.pageY;a._scrolled=!1},onBeforeScrollMove:function(b){f=b.touches?b.touches[0]:b;i=Math.abs(f.pageX-c);g=Math.abs(f.pageY-
d);(!a.vScroll&&i>g||!a.hScroll&&g>i)&&b.preventDefault();a._scrolled=!0},checkDOMChanges:!0});a._scroll.refresh=a._scroll.refresh.bind(a._scroll);a.hScroll&&nokia.mh5.dom.addClass(a.scrollContainer,"mh5_hScroll");a.vScroll&&nokia.mh5.dom.addClass(a.scrollContainer,"mh5_vScroll")},_attachTouchHandler:function(){nokia.mh5.dom.addEvent(this.root,"tap",function(a){if(!this._isScrolled())this.onClick(a)}.bind(this),!1)},_isScrolled:function(){return!this._scrolled||400>=(new Date).getTime()-this._scroll.startTime?
!1:!0},visibleDidChange:function(a){nokia.mh5.dom[a?"removeClass":"addClass"](this.root,"mh5_hidden")},prepareBindings:function(){var b=nokia.mh5.ui.Control,h;for(h in this)if(a(h,"Binding")){var f=this[h],c=h.slice(0,-7),d=f.split("#"),i=2===d.length?d[0]:null,g=2===d.length?d[1]:d[0],l=null,d=g.split("."),d=d[d.length-1],g=g.substring(0,g.indexOf("."+d)),l=null,l="this"===i?this:i?nokia.mh5.require(i):nokia.mh5.win;if(!l)throw Error(nokia.mh5.i18n("Error.prepareBindings",{value:f,snmspa:i}));l=
nokia.mh5.resolve(g,l);b.watch(l,d,this,c)}},prepareDidChangeNotifications:function(){var b=nokia.mh5.ui.Control,h,f,c;for(c in this)a(c,"DidChange")&&(h=this[c],f=c.slice(0,-9),b.watch(this,f,this,h))},getContentRoot:function(){return this.scrollContainer?this.scrollContainer.children[0]:this.root}}});nokia.mh5.provide("nokia.mh5.ui.AutoLayout");nokia.mh5.ui.AutoLayout=new nokia.mh5.Class({constructor:function(g){this.setProperties(g)},setProperties:function(g){nokia.mh5.extend(this,g)},reset:function(){}});
nokia.mh5.provide("nokia.mh5.ui.Container");
nokia.mh5.ui.Container=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){var a=nokia.mh5.i18n;return{constructor:function(b,d){nokia.mh5.extendDeep(this,b);for(var e=this.children=this.children||[],h=nokia.mh5.doc.createDocumentFragment(),f,c,j=0,i=e.length;j<i;j++)if(b=f=this[e[j]]){c=b.control;if(!c)throw Error(a("Error.controlProperty"),f);this[e[j]]=f=new c(b,this);f.root&&h.appendChild(f.root)}e=this.dontBind;if(!d)this.dontBind=!0;g.constructor.call(this,{},d);this.dontBind=e;this.getContentRoot().appendChild(h);
b=this.layout||{};c=b.type||nokia.mh5.ui.AutoLayout;this.layout=new c(b);this.layout.setProperties({container:this});this.parent||(this.build(),this.dontBind||(this.prepareBindings(),this.prepareDidChangeNotifications()))},build:function(){for(var a,d=0,e=this.children.length;d<e;d++)a=this.children[d],this[a]&&this[a].build&&this[a].build()},prepareDidChangeNotifications:function(){for(var a,d=0,e=this.children.length;d<e;d++)a=this.children[d],(a=this[a])&&a.prepareDidChangeNotifications&&!a.dontBind&&
a.prepareDidChangeNotifications();g.constructor.prototype.prepareDidChangeNotifications.call(this)},prepareBindings:function(){for(var a,d=0,e=this.children.length;d<e;d++)a=this.children[d],(a=this[a])&&a.prepareBindings&&!a.dontBind&&a.prepareBindings();g.constructor.prototype.prepareBindings.call(this)},add:function(a,d){this.children=this.children.concat(d);this[d]=a;a.parent=this;a.root&&this.getContentRoot().appendChild(a.root)},insertBefore:function(a,d,e){var h=this.children.indexOf(e);if(-1!==
h)e=this[e],this.children=this.children.concat([]),this.children.splice(h,0,d),this[d]=a,a.parent=this,a.root&&e.root&&this.getContentRoot().insertBefore(a.root,e.root)},remove:function(a){var d=this.children.indexOf(a);if(-1!==d){var e=this[a];delete this[a];this.children=this.children.concat([]);this.children.splice(d,1);e.root&&this.getContentRoot().removeChild(e.root)}}}});nokia.mh5.provide("nokia.mh5.ui.ColumnLayout");
nokia.mh5.ui.ColumnLayout=new nokia.mh5.Class(nokia.mh5.ui.AutoLayout,function(g){return{setProperties:function(a){g.setProperties.call(this,a);if(a=this.container)a=a.getContentRoot(),"stretch"===this.align&&nokia.mh5.dom.addClass(a,"stretch"),nokia.mh5.dom.addClass(a,"mh5_ColumnLayout")},reset:function(){g.reset.call(this);var a=this.container.getContentRoot();nokia.mh5.dom.removeClass(a,"mh5_ColumnLayout");nokia.mh5.dom.removeClass(a,"stretch")}}});nokia.mh5.provide("nokia.mh5.ui.RowLayout");
nokia.mh5.ui.RowLayout=new nokia.mh5.Class(nokia.mh5.ui.AutoLayout,function(g){return{setProperties:function(a){g.setProperties.call(this,a);if(a=this.container)a=a.getContentRoot(),"stretch"===this.align&&nokia.mh5.dom.addClass(a,"stretch"),nokia.mh5.dom.addClass(a,"mh5_RowLayout")},reset:function(){g.reset.call(this);var a=this.container.getContentRoot();nokia.mh5.dom.removeClass(a,"mh5_RowLayout");nokia.mh5.dom.removeClass(a,"stretch")}}});nokia.mh5.provide("nokia.mh5.ui.List");
nokia.mh5.ui.List=new nokia.mh5.Class(nokia.mh5.ui.Container,function(g){return{cssClass:"mh5_List",rootHtmlElementName:"ul",scrollContainerElementName:"ul",layout:{type:nokia.mh5.ui.RowLayout},itemClass:new nokia.mh5.Class(nokia.mh5.ui.Control,function(a){return{rootHtmlElementName:"li",cssClass:"mh5_DefaultListItem",constructor:function(b,d){a.constructor.call(this,b,d);this.update()},update:function(){var a="";this.icon&&(a+="<img src='"+this.icon+"'></img>");this.text&&(a+="<div>"+this.text+"</div>");
this.root.innerHTML=a}}}),constructor:function(a,b){this.items=[];this.renderedItems=[];var a=a||{},d=a.onClick;delete a.onClick;if(a.hScroll||a.vScroll)this.rootHtmlElementName="div";g.constructor.call(this,a,b);this.onClick=d;var e=this.getContentRoot();e.noPreventDefault=!!a.noPreventDefault;nokia.mh5.dom.addEvent(e,"tap",function(a){if(!a._fake&&e.hasChildNodes())for(var a=(a.hasOwnProperty("data")?a.data.target:null)||a.target,a=1!=a.nodeType?a.parentNode:a,b=0,c=e.childNodes.length;b<c;b++)if(nokia.mh5.dom.contains(e.children[b],
a)){if(this.onClick)this.onClick(b,e.children[b]);nokia.mh5.event.fire(this,"tap",{index:b,item:this.items[b]});break}}.bind(this),!0);a.onClick=d},add:function(a,b,d){if(void 0===b)b=this.items.length;var e=[b,0],h=nokia.mh5.doc.createDocumentFragment(),f,c,g=[],i=this.getContentRoot();Array.isArray(a)||(a=[a]);d||(e=e.concat(a),this.items.splice.apply(this.items,e));for(d=0,c=a.length;d<c;d++)f=this._createItem(a[d]),g.push(f),h.appendChild(f.root);i.children[b]?i.insertBefore(h,i.children[b]):
i.appendChild(h);e.length=2;e=e.concat(g);this.renderedItems.splice.apply(this.renderedItems,e);this._scroll&&setTimeout(this._scroll.refresh,0)},remove:function(a){if(a===this.items)this.items=[];else{Array.isArray(a)||(a=[a]);var b,d=a.length,e=0;for(_listRoot=this.getContentRoot();e<d;e++)b=this.items.indexOf(a[e]),-1<b&&(this.items.splice(b,1),this.renderedItems.splice(b,1),_listRoot.removeChild(_listRoot.children[b]))}},_createItem:function(a){var b={};if(this.itemMapping)for(k in this.itemMapping)b[k]=
a[this.itemMapping[k]];else for(k in a)a.hasOwnProperty(k)&&(b[k]=a[k]);return b.itemClass?new b.itemClass(b,this):new this.itemClass(b,this)},itemsDidChange:function(a){for(var b=this.getContentRoot(),d=this.renderedItems.length-1;0<=d;d--)b.removeChild(this.renderedItems[d].root);this.renderedItems=[];this.add(a,0,!0)},update:function(a,b){if(a&&void 0!=b){var d=this.getContentRoot();if(this.items[b]){var e=this._createItem(a);this.items[b]=a;this.renderedItems[b]=e;d.replaceChild(e.root,d.children[b])}}else this.itemsDidChange(this.items)},
scrollTo:function(a,b){this._scroll&&this._scroll.scrollTo(a,b,300)},scrollToElement:function(a){this._scroll&&this.renderedItems[a]&&this._scroll.scrollToElement(this.renderedItems[a].root,300)}}});nokia.mh5.provide("nokia.mh5.ui.Button");
nokia.mh5.ui.Button=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){return{rootHtmlElementName:"a",cssClass:"mh5_Button",constructor:function(a,b){a=a||{};this._userOnClick=a.onClick;delete a.onClick;g.constructor.call(this,a,b);a.onClick=this._userOnClick;this.update()},onClick:function(a){a&&a.stopPropagation();if(!this.disabled){var b=this.root;this.link?(b.href=this.link,setTimeout(function(){b.removeAttribute("href")},1E3)):a&&a.preventDefault();this._userOnClick&&this._userOnClick.apply(this,
arguments)}},textDidChange:function(){this.update()},iconDidChange:function(){this.update()},disabledDidChange:function(a){nokia.mh5.dom[a?"addClass":"removeClass"](this.root,"mh5_disabled")},update:function(){var a=this.icon,b=this.iconClass,d=this.text||"",e=this.root,h=this.disabled,f="";if(this.target)e.target=this.target;e.className=(this.cssClass||"")+(""!==d?" mh5_textButton":"");nokia.mh5.dom[h?"addClass":"removeClass"](e,"mh5_disabled");a&&(f+="<img src='"+a+"'/>");b&&(f+="<div class='"+
b+"'/>");d&&(f+="<div class='mh5_ButtonText'>"+d+"</div>");e.innerHTML=f;this.visibleDidChange(this.visible)}}});nokia.mh5.provide("nokia.mh5.ui.Notification");
nokia.mh5.ui.Notification=new nokia.mh5.Class(nokia.mh5.ui.Button,function(g){return{statics:{TIMEOUT_DEFAULT:3E3,TIMEOUT_INFINITY:0},cssClass:"mh5_Notification",innerHTML:'<div class="mh5_NotificationText"></div>',timeout:3E3,textDidChange:function(){this.update()},visibleDidChange:function(a){g.visibleDidChange.call(this,a);if(void 0!==this._timeoutId)clearTimeout(this._timeoutId),this._timeoutId=void 0;if(this.visible&&0<this.timeout)this._timeoutId=setTimeout(function(){this.visible=!1}.bind(this),
this.timeout)},update:function(){this.root.children[0].innerHTML!=this.text&&this.visibleDidChange(this.visible);this.root.children[0].innerHTML=this.text?this.text:""}}});nokia.mh5.provide("nokia.mh5.ui.Rating");
nokia.mh5.ui.Rating=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){return{value:0,count:0,cssClass:"mh5_Rating",constructor:function(a,b){g.constructor.call(this,a,b);this.update()},update:function(){var a="",b=0,d=Math.min(5,Math.round(2*this.value)/2);if(0===d)this.root.innerHTML="";else{for(;++b<=d;)a+='<div class="star"></div>';0!=Math.round(d)-d&&(b++,a+='<div class="halfstar"></div>');for(;5>=b++;)a+='<div class="nostar"></div>';0<this.count&&(a+='<div class="count">('+this.count+")</div>");
this.root.innerHTML=a}},countDidChange:function(){this.update()},valueDidChange:function(){this.update()}}});nokia.mh5.provide("nokia.mh5.components.PlaceSummary");
nokia.mh5.components.PlaceSummary=new nokia.mh5.Class(nokia.mh5.ui.Container,function(g){var a=nokia.mh5.i18n;return{cssClass:"mh5_PlaceSummary mh5_standardBackgroundColorDark",layout:{type:nokia.mh5.ui.ColumnLayout},children:["details"],details:{control:nokia.mh5.ui.Container,cssClass:"details"},constructor:function(a){g.constructor.call(this,a);this.update()},update:function(b){if(b){var d="";b.name&&(d+="<h1>"+b.name+"</h1>");b.categoryTitle&&(d+="<h3>"+b.categoryTitle+"</h3>");b.address&&b.address!==
b.name&&(d+='<h2 class="address">'+b.address.replace(/\n/g,", ")+"</h2>");if(b.ratingValue){if(!this.ratingComponent)this.ratingComponent=new nokia.mh5.ui.Rating;this.ratingComponent.value=b.ratingValue;this.ratingComponent.count=b.ratingCount;d+=this.ratingComponent.root.outerHTML}b.providerName&&(d+='<div class="mh5_source">'+a("source")+": "+b.providerName+"</div>");this.details&&(this.details.root.innerHTML=d)}else this.clear()},clear:function(){this.details.root.innerHTML=""}}});nokia.mh5.provide("nokia.mh5.connectors.story.StoryListItem");
nokia.mh5.connectors.story.StoryListItem=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){return{rootHtmlElementName:"li",cssClass:"mh5_ListItem",constructor:function(a){g.constructor.call(this,a);this.update()},update:function(){var a,b;a='<div class="mh5_ColumnLayout"><div class="mh5_icon"></div>'+('<div class="name">'+this.text+"</div>");a+='<div class="status"></div></div>';this.href?(b=this.root.appendChild(nokia.mh5.doc.createElement("a")),b.href=this.href,b.target="_blank"):b=this.root;
b.innerHTML=a}}});nokia.mh5.provide("nokia.mh5.ui.TextInput");
nokia.mh5.ui.TextInput=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){var a=function(a){var d=nokia.mh5.doc.createElement("input");d.setAttribute("type",a);return"text"!==d.type||"datetime"===a};return{cssClass:"mh5_TextInput",placeholder:"",value:"",constructor:function(b,d){var e=nokia.mh5.event.add,b=b||{};b.clear=void 0!==b.clear?b.clear:!0;this.innerHTML="<form  class='mh5_ColumnLayout stretch'><input type='"+(b.type?a(b.type)?b.type:"text":"text")+"' autocomplete='off'>"+(!nokia.mh5.platform.android&&
b.clear?"<div class='mh5_TextInputClear mh5_hidden'></div>":"")+"</form>";g.constructor.call(this,b,d);var h=this.root.children[0],f=h.children[0],c=h.children[1];this.input=f;this.placeholderDidChange();if(this.value)f.value=this.value;nokia.mh5.ui.Control.watch(this,"placeholder",this,this.placeholderDidChange);nokia.mh5.ui.Control.watch(f,"value",this,"value");var j=this;e(f,"focus",function(a){if(nokia.mh5.platform.android&&nokia.mh5.dom.hasClass(nokia.mh5.doc.body,"mh5_hwacc_body"))j._restoreHWAcceleration=
!0,nokia.mh5.dom.removeClass(nokia.mh5.doc.body,"mh5_hwacc_body");nokia.mh5.platform.ios&&nokia.mh5.event.fire(nokia.mh5.win,"hideAddressBar",{},!0,!0);nokia.mh5.dom.addClass(j.root,"focus");0<j.value.length&&c&&nokia.mh5.dom.removeClass(c,"mh5_hidden");if(j.onFocus)j.onFocus(a);nokia.mh5.event.fire(j,"focus",a)});e(f,"blur",function(a){if(j._restoreHWAcceleration)nokia.mh5.dom.addClass(nokia.mh5.doc.body,"mh5_hwacc_body"),j._restoreHWAcceleration=!1;nokia.mh5.dom.removeClass(j.root,"focus");c&&nokia.mh5.dom.addClass(c,
"mh5_hidden");if(j.onBlur)j.onBlur(a);nokia.mh5.event.fire(j,"blur",a)});c&&nokia.mh5.dom.addEvent(c,"down",function(a){a.stopPropagation();a.preventDefault();j.value="";f.value=""},!0);e(h,"submit",function(a){j.value=f.value;f.blur();a.preventDefault();a.stopPropagation();nokia.mh5.event.fire(this,"submit",a);return!1}.bind(this),!0)},isFocused:function(){return nokia.mh5.dom.hasClass(this.root,"focus")},blur:function(){this.root.children[0].children[0].blur()},focus:function(){this.root.children[0].children[0].focus()},
valueDidChange:function(){var a=this.root.children[0].children[1],d=this.root.children[0].children[0];if(d.value!==this.value)d.value=this.value||"";if(a&&this.isFocused())nokia.mh5.dom[0<this.value.length?"removeClass":"addClass"](a,"mh5_hidden")},placeholderDidChange:function(a){if(a&&this.input&&"placeholder"in this.input)this.input.placeholder=a}}});nokia.mh5.provide("nokia.mh5.ui.TextArea");
nokia.mh5.ui.TextArea=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){return{cssClass:"mh5_ColumnLayout stretch",rootHtmlElementName:"div",constructor:function(a,b){this.innerHTML='<textarea class="mh5_TextArea"></textarea>';g.constructor.call(this,a,b);var d=this.root.children[0],e=this;nokia.mh5.ui.Control.watch(d,"value",this,"value");nokia.mh5.dom.addEvent(d,"focus",function(a){if(nokia.mh5.platform.android&&nokia.mh5.dom.hasClass(nokia.mh5.doc.body,"mh5_hwacc_body"))e._restoreHWAcceleration=
!0,nokia.mh5.dom.removeClass(nokia.mh5.doc.body,"mh5_hwacc_body");nokia.mh5.event.fire(e,"focus",a)});nokia.mh5.dom.addEvent(d,"blur",function(a){if(e._restoreHWAcceleration)nokia.mh5.dom.addClass(nokia.mh5.doc.body,"mh5_hwacc_body"),e._restoreHWAcceleration=!1;nokia.mh5.event.fire(e,"blur",a)});if(this.placeholder&&"placeholder"in d)d.placeholder=this.placeholder;this.rows&&(d.rows=this.rows);this.maxlength&&(d.maxLength=this.maxlength)}}});nokia.mh5.provide("nokia.mh5.ui.Page");
nokia.mh5.ui.Page=new nokia.mh5.Class(nokia.mh5.ui.Container,function(){return{cssClass:"mh5_Page",visible:!1,model:null,getHash:function(){return"{}"},getNavigationState:function(){return this.model?nokia.mh5.utils.purify(this.model):{}},intoView:function(g){var a=nokia.mh5.dom.query(g)[0];a&&setTimeout(function(){window.scroll&&window.scroll(0,a.offsetTop)},1E3)},setModel:function(g){this.model=g}}});nokia.mh5.provide("nokia.mh5.connectors.story.BasePlugin");
nokia.mh5.connectors.story.BasePlugin=new nokia.mh5.Class(nokia.mh5.ui.Page,function(g){return{constructor:function(a,b){g.constructor.call(this);this.story=b;this.prevView=a;this.callSequenceIndex=-1;this.callSequence=[];this.genericCB=this.genericCB.bind(this)},showView:function(a){this.originOnpopstate=nokia.mh5.win.onpopstate;nokia.mh5.win.onpopstate=function(){this.hideView(a)}.bind(this);this.prevView.parentElement.replaceChild(a,this.prevView)},hideView:function(a){nokia.mh5.win.onpopstate=
this.originOnpopstate;nokia.mh5.win.history.forward();this.root.parentNode&&a.parentElement.replaceChild(this.prevView,a)},_nextStep:function(a){this.callSequenceIndex+=a||1;if(this.callSequenceIndex<this.callSequence.length)if(a=this.callSequence[this.callSequenceIndex],"adapter"==a.target)nokia.mh5.connectors.story.StoryAdapter[a.asyncMethod](this.genericCB,a.arg);else{if("plugin"==a.target)this[a.asyncMethod](this.genericCB,a.arg)}else this.callback({success:!0})},genericCB:function(a){this.callSequence[this.callSequenceIndex].cb.call(this,
a)},processSequence:function(){this.callSequence&&this.callSequenceIndex&&this.callback&&this._nextStep()}}});nokia.mh5.provide("nokia.mh5.connectors.story.SmsPlugin");
nokia.mh5.connectors.story.SmsPlugin=new nokia.mh5.Class(nokia.mh5.connectors.story.BasePlugin,function(g){var a=nokia.mh5.i18n;return{cssClass:"mh5_smsShare",children:"header,notification,phoneNumberLabel,phoneNumberLabel_error,phoneNumberInput,messageLabel,messageInput,securityCodeLabel,securityCodeLabel_error,image,text,actions".split(","),layout:{type:nokia.mh5.ui.RowLayout},header:{control:nokia.mh5.ui.Container,rootHtmlElementName:"header",cssClass:"mh5_header mh5_standardBackgroundColorDark",
children:["headline","placeSummary"],headline:{control:nokia.mh5.ui.Control,rootHtmlElementName:"h1",cssClass:"mh5_headline",innerHTML:a("shareVia")+" "+a("sms")},placeSummary:{control:nokia.mh5.components.PlaceSummary}},notification:{control:nokia.mh5.ui.Notification,visible:!1},phoneNumberLabel:{control:nokia.mh5.ui.Control,cssClass:"mh5_Label",rootHtmlElementName:"label",innerHTML:a("SMS.plsEnterNum")},phoneNumberLabel_error:{control:nokia.mh5.ui.Control,cssClass:"mh5_Label error",visible:!1,rootHtmlElementName:"label",
innerHTML:a("SMS.plsCheckNum")},phoneNumberInput:{control:nokia.mh5.ui.TextInput,type:a("tel"),clear:!1,value:"+"},messageLabel:{control:nokia.mh5.ui.Control,cssClass:"mh5_Label",rootHtmlElementName:"label",innerHTML:a("SMS.alsoShort")},messageInput:{control:nokia.mh5.ui.TextArea,rows:3,maxlength:140,placeholder:a("messageHere")+"..."},securityCodeLabel:{control:nokia.mh5.ui.Control,cssClass:"mh5_Label",rootHtmlElementName:"label",innerHTML:a("SMS.enterCaptcha")},securityCodeLabel_error:{control:nokia.mh5.ui.Control,
rootHtmlElementName:"label",cssClass:"mh5_Label error",innerHTML:a("SMS.wrongCaptcha"),visible:!1},image:{control:nokia.mh5.ui.Control,rootHtmlElementName:"img",cssClass:"mh5_captchaImage",src:"",srcDidChange:function(a){this.root.src=a}},text:{control:nokia.mh5.ui.TextInput,clear:!1,placeholder:a("SMS.enterCode")+"...",valueDidChange:function(a){if(0===a.length)this.parent.actions.submitButton.disabled=!0;else if(this.parent.actions.submitButton.disabled)this.parent.actions.submitButton.disabled=
!1}},actions:{control:nokia.mh5.ui.Container,cssClass:"mh5_right",children:["cancelButton","submitButton"],cancelButton:{control:nokia.mh5.ui.Button,cssClass:"mh5_Button mh5_textButton",text:a("cancel"),build:function(){this.root.addEventListener("touchstart",function(a){a.stopPropagation();a.preventDefault()})},onClick:nokia.mh5.history.back},submitButton:{control:nokia.mh5.ui.Button,cssClass:"mh5_Button mh5_textButton",disabled:!0,text:a("submit")}},constructor:function(a,d){g.constructor.call(this,
a,d);this.header.placeSummary.update(this.story.data);this.actions.submitButton.update();this.callSequence=[{target:"adapter",asyncMethod:"getCaptcha",cb:this._getCaptchaCallback,arg:null},{target:"plugin",asyncMethod:"_displayForm",cb:this._displayFormCallback,arg:{}},{target:"adapter",asyncMethod:"share",cb:this._shareCallback,arg:{}}];this.metadata={}},performShare:function(a){this.callback=function(d){this.actions.submitButton.disabled=!1;d.success?(this.notification.text="The SMS was sent successfully!",
this.notification.timeout=nokia.mh5.ui.Notification.TIMEOUT_DEFAULT,this.notification.visible=!0,nokia.mh5.win.scrollTo(0,0),setTimeout(function(){this.notification.visible=!1;this.hideView(this.root);a(d)}.bind(this),nokia.mh5.ui.Notification.TIMEOUT_DEFAULT)):(this.hideView(this.root),a(d))}.bind(this);this.processSequence()},_getCaptchaCallback:function(b){if(b.success&&b.result)this.metadata.captcha=b.result.captcha,this.callSequence[1].arg.url=this.metadata.captcha.captchaUrl,this.callSequence[1].arg.captchaWidth=
this.metadata.captcha.captchaWidth,this.callSequence[1].arg.captchaHeight=this.metadata.captcha.captchaHeight,this._nextStep();else{var d=a("Notification.connectionError");this.root.parentNode?(this.notification.text=d,this.notification.timeout=nokia.mh5.ui.Notification.TIMEOUT_DEFAULT,this.notification.visible=!0,nokia.mh5.win.scrollTo(0,0)):(b.errorMessage=d,this.callback(b))}},_shareCallback:function(b){this.notification.visible=!1;b.success?this._nextStep():b.result&&409===b.result.targets[0].retCode?
(this.securityCodeLabel_error.visible=!0,this.text.value="",this.text.root.children[0].children[0].focus(),this._nextStep(-2)):b.result&&400===b.result.targets[0].retCode?(this.phoneNumberLabel_error.visible=!0,this._nextStep(-2)):(this.notification.text=a("SMS.unableToSend"),this.notification.timeout=nokia.mh5.ui.Notification.TIMEOUT_DEFAULT,this.notification.visible=!0,nokia.mh5.win.scrollTo(0,0),this._nextStep(-1))},_displayForm:function(a,d){this.image.src=d.url;this.image.root.width=d.captchaWidth||
200;this.image.root.height=d.captchaHeight||50;this.actions.submitButton.disabled=!this._formInitialized;if(!this._formInitialized)this._formInitialized=!0,this._initializeFormControls(a,d)},_initializeFormControls:function(b){var d=this;this.actions.submitButton.onClick=function(){var e={success:!0,placeTitle:this.story.data.name,phoneNumber:d.phoneNumberInput.value.replace(/[^+0-9]/gi,""),message:d.messageInput.value,captchaVerifyText:this.text.value};this.phoneNumberLabel_error.visible=!1;this.securityCodeLabel_error.visible=
!1;this.notification.text=a("sending");this.notification.timeout=nokia.mh5.ui.Notification.TIMEOUT_INFINITY;this.notification.visible=!0;this.actions.submitButton.disabled=!0;nokia.mh5.win.scrollTo(0,0);b(e)}.bind(this);this.showView(this.root)},_displayFormCallback:function(a){this.metadata.captcha.captchaVerifyText=a.captchaVerifyText;this.metadata.participantSMSPhone=a.phoneNumber;this.metadata.msg=a.message;this.metadata.title=a.placeTitle;this.metadata.place=this.story.data;this.metadata.targets=
"default@sm";this.metadata.type="place";this.callSequence[2].arg=this.metadata;a.success?this._nextStep():this.callback(a)},visibleDidChange:function(a){if(!a)this.notification.visible=!1}}});nokia.mh5.provide("nokia.mh5.connectors.story.EmailPlugin");
nokia.mh5.connectors.story.EmailPlugin=new nokia.mh5.Class(nokia.mh5.ui.Page,function(){var g=nokia.mh5.i18n;return{constructor:function(a,b){this.story=b},performShare:function(a){var b=this.story.data,d=(b.name+"").replace(/\s+/g," "),e=nokia.mh5.connectors.story.StoryAdapter.createShareLink(b),h;nokia.mh5.connectors.story.StoryAdapter.shortLink(e,function(f){if(f)h=g("EP.idLikeTo")+": "+f+"\n\n"+(b.placeId?b.name+"\n":"")+b.address,h=h.replace(/\r/g,""),nokia.mh5.win.location.href="mailto:?subject="+
encodeURIComponent(d)+"&body="+encodeURIComponent(h);setTimeout(function(){a({success:!!f})},500)})}}});nokia.mh5.provide("nokia.mh5.connectors.story.StoryCreator");
nokia.mh5.connectors.story.StoryCreator=new nokia.mh5.Class(nokia.mh5.ui.Container,function(){var g=nokia.mh5.i18n,a=g("Notification.connectionError"),b=[{name:"facebookCreator",text:"Facebook",cssClass:"mh5_ListItem mh5_share Facebook",symbol:"fb"},{name:"twitterCreator",text:"Twitter",cssClass:"mh5_ListItem mh5_share Twitter",symbol:"tw"},{name:"emailCreator",klass:nokia.mh5.connectors.story.EmailPlugin,text:g("email"),cssClass:"mh5_ListItem mh5_share Email"},{name:"smsCreator",klass:nokia.mh5.connectors.story.SmsPlugin,
text:g("sms"),cssClass:"mh5_ListItem mh5_share SMS"},{name:"gbookmarkCreator",text:"Google Bookmarks",cssClass:"mh5_ListItem mh5_share GBookmark",symbol:"gb"},{name:"meneameCreator",text:"Meneame",cssClass:"mh5_ListItem mh5_share Meneame",symbol:"me"},{name:"vKontakteCreator",text:"VKontakte",cssClass:"mh5_ListItem mh5_share VKontakte",symbol:"vk"}];return{cssClass:"mh5_StoryCreator",children:["header","notification","container"],layout:{type:nokia.mh5.ui.RowLayout},header:{control:nokia.mh5.ui.Container,
layout:{type:nokia.mh5.ui.ColumnLayout},rootHtmlElementName:"header",cssClass:"mh5_header mh5_standardBackgroundColorDark",children:["backButton","headerData"],backButton:{control:nokia.mh5.ui.Button,cssClass:"mh5_Button mh5_back",build:function(){this.root.addEventListener("touchstart",function(a){a.stopPropagation();a.preventDefault()})},onClick:nokia.mh5.history.back},headerData:{control:nokia.mh5.ui.Container,layout:{type:nokia.mh5.ui.RowLayout},children:["headline","placeSummary"],headline:{control:nokia.mh5.ui.Control,
rootHtmlElementName:"h1",cssClass:"mh5_headline",innerHTML:g("shareAPlace")},placeSummary:{control:nokia.mh5.components.PlaceSummary}}},notification:{control:nokia.mh5.ui.Notification,visible:!1},container:{control:nokia.mh5.ui.List,itemClass:nokia.mh5.connectors.story.StoryListItem,items:b,onClick:function(a){this.parent.launchShare(a,this.root.children[a])},noPreventDefault:!0},visibleDidChange:function(a){if(!a)this.notification.visible=!1},launchShare:function(d,e){function h(b){c._hideSpinner(e);
!b||b.success?nokia.mh5.app.controller.back():(c.notification.text=b.errorMessage||a,c.notification.visible=!0)}var f=b[d],c=this;this._showSpinner(e);"emailCreator"===f.name?(new f.klass(this.root,this.story)).performShare(h):"smsCreator"===f.name?nokia.mh5.platform.ios_webview&&nokia.mh5.platform.iphone?window.shareNative(this.story,h):nokia.mh5.connectors.story.StoryAdapter.init(function(a){c._hideSpinner(e);a.success?(new f.klass(c.root,c.story)).performShare(h):h(a)}):setTimeout(h,100)},_showSpinner:function(a){a&&
nokia.mh5.dom.addClass(a,"loading")},_hideSpinner:function(a){a&&nokia.mh5.dom.removeClass(a,"loading")},update:function(a){var e,h;this.story=a;e=a.data.name;a=a.data;h=nokia.mh5.connectors.story.StoryAdapter.createShareLink(a);this.header.headerData.placeSummary.update(a);for(var f=0;f<b.length;f++){var c=b[f];if(void 0!==c.symbol)c.href="http://m.here.com/releases/1.8.50/server/ushare/ushare.php?sectoken=&version=1.1&targets=default@"+c.symbol+"&type="+encodeURIComponent("place")+"&title="+encodeURIComponent(e)+
"&url="+encodeURIComponent(h)+"&shareDataObj="+encodeURIComponent(JSON.stringify(a.placeId?{serviceName:"Nokia Maps",serviceURL:"http://maps.nokia.com",descriptions:{shareString1:a.name,shareString2:a.address,shareString3:a.categoryGroup+" / "+a.category,shareString4:"",shareString5:a.phone},location:{placesId:a.placeId||a.id,latitude:""+a.latitude,longitude:""+a.longitude,streetName:a.address,houseNumber:"",cityName:"",stateOrProvince:"",postalCode:"",districtName:"",countryCode:"",countryName:""}}:
{serviceName:"Nokia Maps",serviceURL:"http://maps.nokia.com",descriptions:{shareString1:a.name},location:{placesId:"",latitude:""+a.latitude,longitude:""+a.longitude,streetName:a.address,houseNumber:"",cityName:"",stateOrProvince:"",postalCode:"",districtName:"",countryCode:"",countryName:""}}))}this.container.items=b}}});nokia.mh5.provide("nokia.mh5.geolocation");
nokia.mh5.geolocation=function(g,a){function b(){w&&F.clearWatch(w);B=w=0}function d(c){a.fire(y,c,J)}function e(a){var b=!B;B=1;v=m;J=a;z=a.coords;d(b?f:c)}function h(){b();try{w=F.watchPosition(e,function(a){B?d(i,b(),v=n):2<a.code?setTimeout(h,250):d(j,b(),v=o)},{enableHighAccuracy:q,timeout:x,maximumAge:C})}catch(a){v=l,d(j,b())}}var f="positionactivate",c="positionchange",j="positionerror",i="positionlost",m="active",l="denied",n="lost",o="error",q=!0,x=6E4,C=1E4,E=Object.defineProperty,F=nokia.mh5.win.navigator.geolocation,
y={},B=0,v=F?"inactive":"disabled",w=0,A="complete"==document.readyState,u,z,J;E(y,"enableHighAccuracy",{get:function(){return q},set:function(a){q!==a&&(q=null==a?!0:!!a,B&&h())}});E(y,"timeout",{get:function(){return x},set:function(a){x!==a&&(x=null==a?6E4:a,B&&h())}});E(y,"maximumAge",{get:function(){return C},set:function(a){C!==a&&(C=null==a?1E4:a,B&&h())}});E(y,"latitude",{get:function(){return B&&z.latitude}});E(y,"longitude",{get:function(){return B&&z.longitude}});E(y,"available",{get:function(){return!!B}});
E(y,"status",{get:function(){return v}});E(y,"coords",{get:function(){return z}});E(y,"deactivate",{value:function(){B&&(b(),v="inactive",d("positiondeactivate"))}});E(y,"activate",{value:function(a){if(!(B||"disabled"===v)){v="waiting";a||(a={});if(!A)return u=a;var c=a.enableHighAccuracy;q=null==c?!0:!!c;c=a.timeout;x=null==c?6E4:c;a=a.maximumAge;C=null==a?1E4:a;h()}}});E(y,"disable",{value:function(){B&&b();v="disabled"}});A||a.add(g,"DOMContentLoaded",function I(){A=!0;a.remove(g,"DOMContentLoaded",
I);u&&y.activate(u)});a.add(g,"beforeunload",b);a.add(g,"unload",b);return y}(nokia.mh5.win,nokia.mh5.event);nokia.mh5.provide("nokia.mh5.math");
(function(){function g(a,f){var g=a.longitude*b,m=a.latitude*b,l=f.longitude*b,n=f.latitude*b,g=d(m)*d(n)+e(m)*e(n)*e(g-l);1<g&&(g=1);-1>g&&(g=-1);return h(g)}var a=Math.PI,b=a/180,d=Math.sin,e=Math.cos,h=Math.acos,f=nokia.mh5.math={bearing:function(c,f){var i=c.longitude*b,m=f.longitude*b,l=c.latitude*b,n=f.latitude*b,o=g(c,f),l=o?(d(n)-d(l)*e(o))/(d(o)*e(l)):1;1<l&&(l=1);-1>l&&(l=-1);return 0<=d(m-i)?h(l):2*a-h(l)},pointDistance:function(a,b){return 6371E3*g(a,b)},segmentDistance:function(a,b,h){var e=
f.bearing(b,a),l=f.bearing(b,h),n=g(b,h),h=g(h,a),a=g(b,a);return n<1/6371E3?6371E3*a:0===a||0===h?0:0>(a*a+n*n-h*h)/(2*a*n)||0>(n*n+h*h-a*a)/(2*n*h)?-1:6371E3*Math.abs(Math.asin(d(a)*d(e-l)))},speed:function(a,b){return 1E3*f.pointDistance(a.coords,b.coords)/(b.timestamp-a.timestamp)}}})(this);nokia.mh5.provide("nokia.mh5.components.favourites");
(function(){var g=JSON.parse,a=JSON.stringify,b=nokia.mh5.utils.getLocalStorageValue,d=nokia.mh5.utils.setLocalStorageValue,e=nokia.mh5.utils.formatString;nokia.mh5.components.favourites={changedFavourite:null,_generateID:function(){var a=g(b("favourites")||"{}"),f=1,c;do c="FAV_"+f++;while(a[c]);return c},_findFavourite:function(a,b,c){var e=a.placeId,d,g;for(g in b)if(b.hasOwnProperty(g)&&(d=b[g])&&!d.deleted&&(e?d.placeId===e:a.latitude===d.latitude&&a.longitude===d.longitude))return c?{id:g,fav:d}:
d},_queue:function(a,b,c,e){var d=this.__queue=this.__queue||[],g=this.__dangling=this.__dangling||[];this.__idc=this.__idc||0;var l=this,n=function(a){if(g[a])delete g[a];else if(d[0].tid&&clearTimeout(d[0].tid),d[0].c&&d[0].c.apply(this,Array.prototype.slice.call(arguments,1)),d.shift(),0<d.length){this.__idc++;d[0].tid=setTimeout(function(a){var c=d[0];n(a);g[a]=c},d[0].t,this.__idc);var c=function(a){return function(){n.apply(l,[a].concat(Array.prototype.slice.call(arguments,0)))}}(this.__idc);
d[0].f.apply(l,d[0].p?[d[0].p,c]:[c])}}.bind(this);d.push({f:a,p:b,c:c,t:e});1===d.length&&(d.unshift([]),n())},add:function(h,f){var c=g(b("favourites")||"{}"),e=this._generateID(),i;h.favourite=!0;c[e]={address:h.address,categoryGroup:h.categoryGroup,latitude:h.latitude,longitude:h.longitude,name:h.name,placeId:h.placeId,ratingCount:h.ratingCount,ratingValue:h.ratingValue,date:+new Date};i=d("favourites",a(c));nokia.mh5.sso.isAuthenticated()?this.addServerFav(h,function(b){c[b.id]=c[e];delete c[e];
d("favourites",a(c));h.inSync=!0;f&&f()},function(){f&&f()}):f&&f();nokia.mh5.components.favourites.changedFavourite=h;return i},get:function(a){var f=g(b("favourites")||"{}"),c=[],d;for(d in f)if(f.hasOwnProperty(d)){var e=f[d];delete e.categoryIcon;e.favourite=!0;var m=e.categoryGroup;if(e.categories&&e.categories[0]&&e.categories[0].categoryId)m=e.categories[0].categoryId;e.icon=nokia.mh5.utils.place.getCategoryIconForFav(m)}if(a)return Array.isArray(a)?(a.forEach(function(a){(a=this._findFavourite(a,
f))&&c.push(a)},this),c):this._findFavourite(a,f);for(var l in f)f.hasOwnProperty(l)&&!f[l].deleted&&c.push(f[l]);return c},set:function(h){var f=g(b("favourites")||"{}"),c=this._findFavourite(h,f,!0);if(!c||!c.placeId)return!1;f[c.placeId]={address:h.address,categoryGroup:h.categoryGroup,latitude:h.latitude,longitude:h.longitude,name:h.name,placeId:h.placeId,ratingCount:h.ratingCount,ratingValue:h.ratingValue,date:+new Date};return result=d("favourites",a(f))},remove:function(h,f){var c=g(b("favourites")||
"{}"),e=this._findFavourite(h,c,!0);if(e&&e.fav)e.fav.inSync?(e.fav.deleted=!0,e.fav.inSync=!1):delete c[e.id];delete h.favourite;d("favourites",a(c));nokia.mh5.components.favourites.changedFavourite=h;nokia.mh5.sso.isAuthenticated()?this.removeServerFav(e.id,function(){delete c[e.id];d("favourites",a(c));f&&f()}):f&&f()},clear:function(h){var f=g(b("favourites")||"{}"),c={};if(h)for(var e in f)f.hasOwnProperty(e)&&!f[e].inSync&&(c[e]=f[e]);d("favourites",a(c))},synchronize:function(a){this._queue(this._synchronize,
null,a,3E4)},_synchronize:function(h){var f=this;f.listServerFavs(function(c){if(c.data){for(var e={},i,m={},c=c.data,l=0,n=c.length;l<n;l++)i=c[l],e[i.id]=i;var m=g(b("favourites")||"{}"),o=0,q=Object.keys(m),x=function(a){var c=q[o++];if(c)if(i=e[c],b=m[c],b.inSync)!i||i.deleted?delete m[c]:i&&i.updatedTime>b.updatedTime&&(m[c]=f.mapServerToClient(i)),x(a);else if(b.deleted)i?f.removeServerFav(i.id,function(){delete e[c];delete m[c];x(a)}):(delete m[c],x(a));else if(i)if(i.deleted)delete m[c],x(a);
else{if(!i.deleted&&!b.deleted){var b=f.mapServerToClient(e[c]);b.inSync=!0;m[c]=b;x(a)}}else f.addServerFav(b,function(h){b.inSync=!0;b.updatedTime=h.updatedTime;e[c]=f.mapClientToServer(b);m[h.id]=m[c];delete m[c];x(a)});else a&&a()};x(function(){for(var c in e)if(i=e[c],b=m[c],!i.deleted&&!b){var b=f.mapServerToClient(i);b.inSync=!0;m[c]=b}d("favourites",a(m));h&&h()})}})},mapServerToClient:function(a){var b=a.location||{},c=b.position||{},b=b.address?b.address.text?b.address.text:nokia.mh5.adapters.Search.formatAddress(b.address):
null,c={name:a.name,latitude:c.latitude||null,longitude:c.longitude||null,address:b,favourite:!0,updatedTime:a.updatedTime};if(a.placesId&&(c.placeId=a.placesId,a.categories&&a.categories.length))c.categoryGroup=a.categories[0].categoryId;return c},mapClientToServer:function(a){var b={type:"favoritePlace",name:a.name,location:{position:{latitude:parseFloat(a.latitude),longitude:parseFloat(a.longitude)},address:{text:a.address}}};if(a.categories&&a.categories[0]&&a.categories[0].categoryId)b.icon=
nokia.mh5.utils.place.getCategoryIconForFav(a.categories[0].categoryId);if(a.placeId)b.placesId=a.placeId,b.categories=[{categoryId:a.categoryGroup}];return b},addServerFav:function(a,b){var c=e("http://demo.maps.public.devbln.europe.nokia.com/mh5test/server/scbe/index.php?%action%&app_id=%appId%&app_code=%appCode%&jsonp",{action:"add="+encodeURIComponent(JSON.stringify(this.mapClientToServer(a))),appId:nokia.mh5.appId,appCode:nokia.mh5.appCode});nokia.mh5.jsonp(c,function(a){b&&b(a)})},removeServerFav:function(a,
b){var c=e("http://demo.maps.public.devbln.europe.nokia.com/mh5test/server/scbe/index.php?%action%&app_id=%appId%&app_code=%appCode%&jsonp",{action:"delete="+encodeURIComponent(a),appId:nokia.mh5.appId,appCode:nokia.mh5.appCode});nokia.mh5.jsonp(c,function(){b&&b()})},listServerFavs:function(a){var b=e("http://demo.maps.public.devbln.europe.nokia.com/mh5test/server/scbe/index.php?%action%&app_id=%appId%&app_code=%appCode%&jsonp",{action:"list",appId:nokia.mh5.appId,appCode:nokia.mh5.appCode});nokia.mh5.jsonp(b,
function(c){a&&a(c)})},favouritize:function(a){this.get(a).forEach(function(b){a.filter(function(a){return a.placeId===b.placeId})[0].favourite=!0});return a}}})();nokia.mh5.provide("nokia.mh5.components.settings");
(function(){var g={mapSchema:"normal.day",cartoPois:!1,unitSystem:"km",analyticsEnabled:!0,trafficIncidentsEnabled:!1,trafficAccidentsEnabled:!0,trafficCongestionsEnabled:!0,trafficConstructionsEnabled:!0,trafficOthersEnabled:!0},a=JSON.parse(nokia.mh5.utils.getLocalStorageValue("settings")||"{}");nokia.mh5.components.settings={current:nokia.mh5.utils.getLocalStorageValue("settings")?function(){for(var b in a)a.hasOwnProperty(b)&&(g[b]=a[b]);return g}():g,get:function(a){return nokia.mh5.components.settings.current[a]},
set:function(b,d){a[b]=d;nokia.mh5.utils.setLocalStorageValue("settings",JSON.stringify(a));nokia.mh5.components.settings.current[b]=d}}})();nokia.mh5.provide("nokia.mh5.components.PlaceListItem");
nokia.mh5.components.PlaceListItem=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){return{rootHtmlElementName:"li",cssClass:"mh5_ListItem",constructor:function(a,b){g.constructor.call(this,a,b);this.update()},update:function(){var a,b=!(!this.address&&!this.ratingValue);a="<div>"+('<img src="'+nokia.mh5.utils.place.getCategoryIcon(this)+'"></img>');b&&(a+="<div>");this.distance&&(a+='<div class="mh5_ColumnLayout"><div>');a+='<div class="mh5_ListItem_name">'+this.name+"</div>";this.placeId&&this.address&&
(a+='<div class="mh5_ListItem_address">'+this.address.replace(/\n/g,", ")+"</div>");if(this.distance){var d=nokia.mh5.utils.formatDistance(this.distance,nokia.mh5.components.settings.current.unitSystem);a+='</div><div class="mh5_ListItem_distance">'+d+"</div></div>"}if(this.ratingValue){if(!this._rating)this._rating=new nokia.mh5.ui.Rating;this._rating.value=this.ratingValue;a+=this._rating.root.outerHTML}b&&(a+="</div>");this.root.innerHTML=a+"</div>"}}});nokia.mh5.provide("nokia.mh5.maps.sso");
nokia.mh5.sso=function(){var g=nokia.mh5.event,a=nokia.mh5.win,b=nokia.mh5.utils,d,e,h=function(f){f?(d=f,b.setLocalStorageValue("sso_user",JSON.stringify(f))):d=a.localStorage.removeItem("sso_user")};return{init:function(){var f;g.add(a,"message",function(c){if(-1!=="http://demo.maps.public.devbln.europe.nokia.com,http://localhost:4224,http://localhost,http://192.168.56.112:4224,http://stg.m.maps.nokia.com,http://qa.mh5.public.devbln.europe.nokia.com,http://m.maps.nokia.com,http://convos.americas.nokia.com:8080,http://bsmacvm03.americas.nokia.com:8080,http://conversations-dev.americas.nokia.com:9090/,http://api.qa.pulse.nokia.com,https://ci.ovi.com,https://account.nokia.com".split(",").indexOf(c.origin)){if(c=
JSON.parse(c.data)){if(e)e.visible=!1;c.error||(h(c),g.fire(a,"sso_signin",c))}nokia.mh5.app.controller.current.page.visible=!0}});(f=b.getLocalStorageValue("sso_user"))&&(d=JSON.parse(f));this.isAuthenticated()},login:function(){return nokia.mh5.platform.android_webview?(e=new nokia.mh5.internals.LoginDialog,!0):a.open("http://demo.maps.public.devbln.europe.nokia.com/mh5test/server/sso/login.php")},logout:function(b){nokia.mh5.jsonp("http://demo.maps.public.devbln.europe.nokia.com/mh5test/server/sso/logout.php?jsonp",
function(){h();g.fire(a,"sso_signout");"function"===typeof b&&b()},1E4);e&&(e=null)},isAuthenticated:function(){if(d){var b=Math.round(Date.now()/1E3);if(!d.validuntil||d.validuntil<b)d=a.localStorage.removeItem("sso_user"),g.fire(a,"sso_signout")}return!!d},getUserData:function(a){return!this.isAuthenticated()?void 0:a?d[a]:d}}}();nokia.mh5.provide("nokia.mh5.maps.analytics");
(function(){var g=Math.round(1E4*Math.random()),a=!1,b=!1,d=nokia.mh5.components.settings,e=!0;nokia.mh5.ui.Control.watch(d.current,"analyticsEnabled",d.current,function(){e=this.analyticsEnabled});nokia.mh5.maps.analytics.log=function(h){if(e){var f=["http://metrics.nokia.com/b/ss/nokiaglobalmwg0prod".concat("/5/",g,"?D=~&ch=ovi:maps:mw&c6=ovimapsmwg0")],c;!b&&/[?&]cid=([^&#?]+)/.test(window.location.href)&&(f.push("&v0="+RegExp.$1),b=!0);for(c in h)h.hasOwnProperty(c)&&f.push("&"+c+"="+h[c]);!a&&
document.referrer&&(f.push("&r="+document.referrer+"&c30=~r&v30=~r"),a=!0);if(nokia.mh5.platform.android_webview||nokia.mh5.platform.ios_webview)f.push("&c50="+(nokia.mh5.platform.android_webview?"android native":"ios native")+"&v50=~c50");(new Image).src=encodeURI(f.join(""))}};nokia.mh5.maps.analytics.getPlaceId=function(a){return a.placeId||a.latitude+","+a.longitude};nokia.mh5.maps.analytics.getContext=function(a){var b="";a&&a.href&&(a=a.href.match(/context=([^?]+)/))&&a[1]&&(b=a[1]);return b};
nokia.mh5.maps.analytics.logIfVisible=function(a,b){a.visible&&!a._wasLogged&&nokia.mh5.maps.analytics.log(b);a._wasLogged=a.visible}})();nokia.mh5.provide("nokia.mh5.connectors.favourites.FavouritesViewer");
nokia.mh5.connectors.favourites.FavouritesViewer=new nokia.mh5.Class(nokia.mh5.ui.Page,function(g){var a,b=nokia.mh5.i18n,d=nokia.mh5.win,e=nokia.mh5.ui.Button,h=nokia.mh5.ui.Control,f=nokia.mh5.ui.Container,c=nokia.mh5.ui.RowLayout,j=nokia.mh5.ui.Notification,i=nokia.mh5.ui.List,m=nokia.mh5.event,l=nokia.mh5.sso,n=nokia.mh5.components.favourites,o=function(){var c=l.isAuthenticated(),b=a.header;b.signin.visible=!c&&!nokia.mh5.platform.android_webview;b.refresh.visible=c};return{cssClass:"mh5_FavouritesViewer",
children:["header","noFavourites","favourites","notification"],layout:{type:c},header:{control:f,layout:{type:nokia.mh5.ui.ColumnLayout},cssClass:"mh5_ssoContainer",children:["title","signin","refresh"],title:{control:h,cssClass:"mh5_title",rootHtmlElementName:"h1",build:function(){var a=function(){var a=l.getUserData("greetingname");return(a?a+"'s ":" ")+b("favourites")};this.root.innerHTML=a();m.add(nokia.mh5.win,["sso_signin","sso_signout"],function(){this.root.innerHTML=a()}.bind(this))}},signin:{control:e,
cssClass:"mh5_action mh5_SignIn mh5_baseColor",build:function(){this.root.onclick=l.login},text:b("signin")},refresh:{control:e,cssClass:"mh5_action mh5_Refresh mh5_baseColor",onClick:function(){this.parent.parent.update()},text:b("refresh"),visible:!1}},noFavourites:{control:h,cssClass:"mh5_noFavourites mh5_RowLayout",visible:!1,innerHTML:'<div class="mh5_divider"></div><h3>'+b("FV.startSaving")+"</h3><div>"+b("FV.startSavingHint")+'</div><ul> <li><div class="mh5_icon"></div><div class="itemtext"><h3>'+
b("addingA")+" "+b("favourite")+"</h3><p>"+b("FV.simplyTap")+'</p></div></li><li><div class="mh5_icon mh5_active"></div><div class="itemtext"><h3>'+b("removingA")+" "+b("favourite")+"</h3><p>"+b("FV.tapTheHighlighted")+'</p></div></li></ul><div class="mh5_divider"></div>'},favourites:{control:f,layout:{type:c},children:["header","list"],cssClass:"mh5_favourites mh5_primaryColorBright",visible:!1,header:{control:h,id:"header",rootHtmlElementName:"h1",visible:!1,innerHTML:b("FV.syncedFavourites")},
list:{control:i,id:"list",itemClass:nokia.mh5.components.PlaceListItem,itemsDidChange:function(a){var c=nokia.mh5.geolocation;if(a&&c.available)for(var b=0,f=a.length;b<f;b++)a[b].distance=nokia.mh5.math.pointDistance(c.coords,a[b]);this.constructor.prototype.itemsDidChange.apply(this,arguments)},onClick:function(a){var c=nokia.mh5.maps.analytics;c.log({gn:"favourites:place",c32:"open place",v32:"~c32",c44:c.getPlaceId(this.items[a]),v44:"~c44"});nokia.mh5.app.controller.details(this.items[a])}}},
notification:{control:j,visible:!1},constructor:function(){g.constructor.call(this);a=this;m.add(nokia.mh5.win,["sso_signin","sso_signout"],function(c){o();"sso_signout"===c.type&&n.clear();a.update()});o()},update:function(){a=this;var c=a.notification,f=a.favourites,e=a.noFavourites,h=function(){var a=n.get();e.visible=0===a.length;f.visible=!e.visible;f.list.items=a},g;l.isAuthenticated()?(g=d.setTimeout(function(){c.timeout=j.TIMEOUT_DEFAULT;c.text=b("FV.couldNotSync")},15E3),c.timeout=j.TIMEOUT_INFINITY,
c.text=b("FV.syncing"),c.visible=!0,n.synchronize(function(){h();d.clearTimeout(g);c.timeout=j.TIMEOUT_DEFAULT;c.text=b("FV.syncedFavourites")})):h()},visibleDidChange:function(a){a&&this.update();g.visibleDidChange.apply(this,arguments)}}});nokia.mh5.provide("nokia.mh5.app.controller");
(function(){var g=nokia.mh5.history,a={},b={},d=function(a,b){return{page:a,params:b,onPopState:function(a,b){nokia.mh5.app.controller.currentViewState=a;nokia.mh5.app.controller.switchTo(a.page,a.params,{dontPushToHistory:!0,isHistory:!b})}}},e=nokia.mh5.app.controller={queue:[],setConfiguration:function(a){b=a},getPage:function(e){return b[e]?a[e]||(a[e]=new nokia.mh5.ui.Page(b[e])):new (nokia.mh5.require(e))},resetViewCache:function(){a={}},getMap:function(){var a=this.current.page;return a.map?
a.map:a.children.map(function(b){return nokia.mh5.resolve(b+".map",a)}).filter(function(a){return!!a&&a instanceof nokia.mh5.components.Map}).pop()},switchTo:function(a,b,c){var d=this.domNode||nokia.mh5.doc.body,g=this.current,m=e.getPage(a);if(this.inTransition)this.queue.unshift(arguments);else if(this.current={name:a,page:m},b&&m.setModel(b),c&&c.replaceLastHistoryEntry?this.updateHistoryEntry():(!c||!c.dontPushToHistory)&&this.pushHistoryEntry(this.current.name,m.getNavigationState(),m.getHash()),
!(g&&g.name===a))if(g)this.inTransition=!0,d={type:"slide",parentNode:d,node:m.root,previousNode:g.page.root,isHistory:c&&c.isHistory,onNodeAttached:function(){if(!m.visible)m.visible=!0,c&&c.intoView&&m.intoView&&m.intoView(c.intoView)},callback:function(){this.inTransition=!1;g.page.visible=!1;if(0<this.queue.length)setTimeout(function(){this.switchTo.apply(this,this.queue.shift())}.bind(this),0);else{var a=document.createEvent("Event");a.initEvent("hideAddressBar",!0,!0);nokia.mh5.win.dispatchEvent(a)}}.bind(this)},
nokia.mh5.dom.doTransition(d);else if(d.appendChild(m.root),!m.visible)m.visible=!0,c&&c.intoView&&m.intoView&&m.intoView(c.intoView)},updateHistoryEntry:function(){if(this.browserHistory){var a=this.current.name,b=this.current.page,c=this.currentViewState=d(a,b.getNavigationState()),e=this.manipulateUrl?"#action="+mappings[a]+"&params="+encodeURIComponent(b.getHash())+"&bmk=1":"";b.model.traffic&&(e+="&traffic=true");g.replaceState(c,a,e)}},pushHistoryEntry:function(a,b,c){if(this.browserHistory)b=
this.currentViewState=d(a,b),c=mappings[a]&&this.manipulateUrl?"#action="+mappings[a]+"&params="+encodeURIComponent(c)+"&bmk=1":"",g.pushState(b,a,c)},back:function(){this.browserHistory&&g.back()},showOnMap:function(a){this.switchTo("search",a)},route:function(a){if(a&&a.from&&a.to){var b="walk";5E3<nokia.mh5.math.pointDistance(a.from,a.to)&&(b="drive");a.parameters=a.parameters||{};a.parameters.mode=b}this.switchTo("route",a)},share:function(a){this.switchTo("share",{data:a})},details:function(a){this.switchTo("search",
{selection:a,mapMode:!0,showDetails:!0})}}})();nokia.mh5.provide("nokia.mh5.adapters.Search");
(function(){var g=nokia.mh5.i18n,a=nokia.mh5.utils,b=nokia.mh5.geolocation,d=Object.prototype.hasOwnProperty;nokia.mh5.adapters.Search={merge:function(a,b){for(var f in b)d.call(b,f)&&("object"===nokia.mh5.type(a[f])&&"object"===nokia.mh5.type(b[f])?b[f]!==a[f]&&b[f]!==a&&(a[f]=nokia.mh5.adapters.Search.merge(a[f],b[f])):void 0===a[f]&&(a[f]=b[f]));return a},formatAddress:function(a){if(!a)return"";var b=a.addrCountryCode||a.countryCode,f=a.addrCountryName||a.country||b,c=a.addrCityName||a.city,d=
c,g=a.addrStateCode||a.state,m=a.addrPostalCode||a.postCode,l=a.addrStreetName||a.thoroughfare&&a.thoroughfare.name,a=a.addrHouseNumber||a.thoroughfare&&a.thoroughfare.number,b=b&&-1<"USA CAN NZL IND GBR AUS IRL FRA LKA".indexOf(b),n=[];l&&(a?n.push(b?a+" "+l:l+" "+a):n.push(l));c&&(b?(g&&(d+=", "+g),m&&(d+=" "+m),n.push(d)):n.push(m?m+" "+c:c));f&&n.push(f);return n.join(", ")},map:function(a,b){var f=nokia.mh5.math.pointDistance,f={address:b.vicinity,placeId:b.id,icon:b.icon,href:b.href,categoryName:b.category.id,
latitude:b.position[0],longitude:b.position[1],distance:a&&f(a,{latitude:b.position[0],longitude:b.position[1]}),name:b.title,ratingValue:b.averageRating};if(b.bbox)f.boundingBox=[{latitude:b.bbox[3],longitude:b.bbox[0]},{latitude:b.bbox[1],longitude:b.bbox[2]}];if(nokia.mh5.components.favourites.get(f))f.favourite=!0;return f},fetch:function(d,h,f,c){var j=nokia.mh5,i=j.adapters.Search,m=i.merge,l,n,o=h&&h.appId||j.appId,q=h&&h.appCode||j.appCode;if(a.isPlace(d))if(l="placeId="+d.placeId,n=a.cacheObject(l))m(d,
n),f(d);else{if(!o||!q)throw Error(g("Error.applicationCredential"));h={app_id:o,app_code:q,ScreenSize:j.win.innerWidth+"x"+j.win.innerHeight,lang:nokia.mh5.i18n.language,xnlp:a.getApiSession().id};d.href?h.placeUrl=d.href:h.place=d.placeId;if(b.available)h.geolocation="geo:".concat(b.latitude,",",b.longitude,";u=",b.coords.accuracy);j.jsonp("http://m.here.com/releases/1.8.50/server/index.php?"+a.formatURLParams(h)+"&jsonp",function(b){if(b&&b.name&&b.latitude&&b.longitude){m(d,b);var h=nokia.mh5.components.favourites.get(d);
if(h)d.favourite=!0,h.categoryGroup!==b.categoryGroup&&nokia.mh5.components.favourites.set(b);a.cacheObject(l,a.purify(d));f(d)}else c&&c(b.error),a.cacheObject(l,null)},2E4)}else if(!d.longitude||!d.latitude)c&&c();else if(l="lat="+d.latitude+"&lon="+d.longitude,n=a.cacheObject(l))m(d,n),f(d);else{d.name=d.name||d.address;if(j=nokia.mh5.components.favourites.get(d))d.favourite=!0,j.categoryGroup!==d.categoryGroup&&nokia.mh5.components.favourites.set(d);d.name?(a.cacheObject(l,a.purify(d)),f(d,!0)):
i.reverseGeoCode(d,h,function(b){d.name=d.address=b.name;a.cacheObject(l,a.purify(d));f(d)})}},getRecommendations:function(d,h,f,c){var j=nokia.mh5,i=j.adapters.Search.merge,m,l;l=h&&h.appId||j.appId;var n=h&&h.appCode||j.appCode;if(!d.longitude||!d.latitude)c&&c();else if(m=d.placeId?"placeId="+d.placeId:"lat="+d.latitude+"&lon="+d.longitude,(c=a.cacheObject(m))&&c.recommendations)i(d,c),f(c);else{if(!l||!n)throw Error(g("Error.applicationCredential"));l={app_id:l,app_code:n,lat:d.latitude,lon:d.longitude,
xnlp:a.getApiSession().id};if(d.placeId)l.place=d.placeId;if(h&&h.init)l.init="true";if(b.available)l.geolocation="geo:".concat(b.latitude,",",b.longitude,";u=",b.coords.accuracy);return j.jsonp("http://m.here.com/releases/1.8.50/server/index.php?"+a.formatURLParams(l)+"&jsonp",function(b){i(d,b);a.cacheObject(m,a.purify(d));f(d)},5E3)}},search:function(d,h,f,c){nokia.mh5.each(h,function(a,b){"function"===typeof a&&(h[b]=a())});var j=h.center||h.map.center,i=h.box||h.map.box,m=i[0],i=i[1],l=h.position||
h.map&&h.map.position,n=h.suggestions,o="http://places.nlp.nokia.com/places/v1/"+(n?"suggest/":"discover/search/"),q=h.appId||nokia.mh5.appId,x=h.appCode||nokia.mh5.appCode;if(!q||!x)throw Error(g("Error.applicationCredential"));d={app_code:x,app_id:q,q:d,at:j.latitude+","+j.longitude,size:h.limit||(n?4:25),tf:"plain",xnlp:a.getApiSession().id};m.longitude&&i.latitude&&i.longitude&&m.latitude&&(d["X-Map-Viewport"]="".concat(m.longitude,",",i.latitude,",",i.longitude,",",m.latitude));if(b.available)d.geolocation=
"geo:".concat(b.latitude,",",b.longitude,";u=",b.coords.accuracy);nokia.mh5.jsonp(o+"?"+a.formatURLParams(d)+"&callback",function(a){if(a.error){if(c){var b;"timeout"===a.error&&(b=g("Notification.searchProblem"));c(b)}}else if(n)f(a.suggestions||[]);else{var a=a.results&&a.results.items||[],d,a=a.map(this.map.bind(this,l));h.map&&0<a.length&&(d=this._getBoundingBox(a,h.map));f({results:a,box:d})}}.bind(this),1E4)},getSuggestions:function(a,b,f,c){var d=b.suggestions;b.suggestions=!0;this.search(a,
b,f,c);b.suggestions=d},reverseGeoCode:function(b,d,f,c){var j=d&&d.appId||nokia.mh5.appId,d=d&&d.appCode||nokia.mh5.appCode;if(!j||!d)throw Error(g("Error.applicationCredential"));nokia.mh5.jsonp("http://geo.nlp.nokia.com/search/6.2/reversegeocode.json".concat("?token="+d+"&app_id="+j,"&prox=",b.latitude,",",b.longitude,"&mode=retrieveAddresses","&xnlp=",a.getApiSession().id,"&jsoncallback"),function(a){var b,d;!a.error&&a.Response&&a.Response.View&&a.Response.View[0]&&a.Response.View[0].Result&&
a.Response.View[0].Result[0]?(a=a.Response.View[0].Result[0],b=a.Location.DisplayPosition,d=a.Location.Address.Label,f({name:d,address:d,latitude:b.Latitude,longitude:b.Longitude,properties:a.Location.Address})):c&&("timeout"===a.error&&(b=g("Notification.searchProblem")),c(b))},1E4)},_getBoundingBox:function(a,b){var f=a[0].boundingBox,c=[];if(!f){for(var d=0,g=a.length;d<g;d++)f=a[d],f.hasOwnerContent||c.push(f);c.push(b.center);f=b._map.getZoomLevelFor(c);b.covers(c)?17>f&&17>b.zoom?f=c:(b.zoom=
16,f=b.box):12<=f?f=c:(b.zoom=12,b.center=c[0],f=b.box)}return f}}})();nokia.mh5.provide("nokia.mh5.l10n");nokia.mh5.l10n={imperial:{us:1,gb:1,lr:1,mm:1},tileLanguageMap:{ar:"ARA",zh:"CHI",es:"SPA",fr:"FRE",it:"ITA",de:"GER",ru:"RUS"}};nokia.mh5.provide("nokia.mh5.components.Traffic");
(function(){var g={Accidents:"Accident",Constructions:"Construction",Congestions:"Congestion",Others:"DisabledVehicle,RoadHazard,MassTransit,OtherNews,Weather,Misc,PlannedEvent"},a=function(a){return this=="routeInfo"in a.data},b=function(a){return a.data.incident},d="http://traffic.nlp.nokia.com/traffic/6.0/",e=nokia.mh5.event,h=nokia.mh5.i18n,f=nokia.mh5.components.settings,c=nokia.mh5.utils;nokia.mh5.components.Traffic=new nokia.mh5.Class(nokia.mh5.ui.Container,function(j){function i(a,b){return a.location.latitude-
b.location.latitude||a.location.longitude-b.location.longitude}function m(a,b){return a.incident.criticality-b.incident.criticality||b.incident.id-a.incident.id}function l(a,b){return nokia.mh5.assetsPath+"img/mapsymbols/tmc_"+a+"_"+b+"_pole.png"}function n(a){var b=[];if(0<a.length){b.push(a[0]);for(var c=1;c<a.length;++c){var f=b[b.length-1],d=a[c];0===i(f,d)?b[b.length-1]=0<m(f,d)?d:f:b.push(d)}}return b}function o(a){var b=60*(60*(24*a.getDay()+a.getHours())+a.getMinutes())+a.getSeconds();return function(a,
f,e,h){a=d+"tiles/"+h+"/"+a+"/"+f+"/256/png32";f={app_id:nokia.mh5.appId,token:nokia.mh5.appCode};f.pattern_time=b;return a+"?"+c.formatURLParams(f)}}function q(a){return a.TYPE&&a.content&&a.TYPE==this}function x(a){var b,c,f,d,e;if(a.LOCATION&&a.LOCATION.GEOLOC&&a.LOCATION.GEOLOC.ORIGIN){d=a.LOCATION.GEOLOC.ORIGIN;c={id:""+a.TRAFFICITEMID,startTime:new Date(Date.parse(a.STARTTIME)),endTime:new Date(Date.parse(a.ENDTIME))};b={location:{latitude:d.LATITUDE,longitude:d.LONGITUDE}};f="high";if(a.CRITICALITY&&
a.CRITICALITY.ID)c.criticality=a.CRITICALITY.ID|0,"0"===a.CRITICALITY.ID?f="blocking":"1"===a.CRITICALITY.ID&&(f="veryhigh");switch(a.TRAFFICITEMTYPEDESC){case "CONSTRUCTION":b.icon=l(f,"roadworks");break;case "ACCIDENT":b.icon=l(f,"accident");break;case "CONGESTION":b.icon=l(f,"congestion");break;default:b.icon=l(f,"other")}if(a.TRAFFICITEMDETAIL&&a.TRAFFICITEMDETAIL.ROADCLOSED)c.criticality=0,b.icon=l("blocking","closure");c.type=a.TRAFFICITEMTYPEDESC[0]+a.TRAFFICITEMTYPEDESC.slice(1).toLowerCase();
if(a.LOCATION.DEFINED&&a.LOCATION.DEFINED.ORIGIN){d=a.LOCATION.DEFINED.ORIGIN;e=d.POINT.DESCRIPTION;f=d.DIRECTION.DESCRIPTION;if(e)d=e.filter(q,"LOCAL")[0],c.origin=d&&d.content;if(f)d=f.filter(q,"LOCAL")[0],c.direction=d&&d.content}else if(a.LOCATION.INTERSECTION&&a.LOCATION.INTERSECTION.ORIGIN)d=a.LOCATION.INTERSECTION.ORIGIN,e=a.LOCATION.INTERSECTION.TO,c.origin=d.STREET1&&d.STREET1.ADDRESS1,c.start=d.STREET2&&d.STREET2.ADDRESS1,c.end=e&&e.STREET2&&e.STREET2.ADDRESS1;if(a.RDSTMCLOCATIONS&&a.RDSTMCLOCATIONS.RDSTMC&&
0<a.RDSTMCLOCATIONS.RDSTMC.length){f=a.RDSTMCLOCATIONS.RDSTMC;e=f[0];var h=1;for(d=e.ALERTC;h<f.length;){if(f[h].DIRECTION&&f[h].DIRECTION!==e.DIRECTION){c.bidirectional=!0;break}h+=1}c.start=e.ORIGIN&&e.ORIGIN.LOCATIONDESC;c.end=e.TO&&e.TO.LOCATIONDESC;c.description=d&&d.DESCRIPTION&&d.DESCRIPTION.replace(/\s*\(Q\)\s*/g," ").replace(/\s*\(([^\/]*)\/\/[^\)]*\)\s*/g," $1 ").replace(/\s*--\s*/," ").replace(/^\s*/,"").replace(/\s*$/,"")}d=a.TRAFFICITEMDESCRIPTION&&a.TRAFFICITEMDESCRIPTION.filter(q,"desc")[0];
c.description=c.description||d&&d.content;b.incident=c}return b}return{_map:null,_mapReady:!1,_currentRequest:null,displayIncidents:!1,statics:{getTrafficTypes:function(){return Object.keys(g)},removeNonTrafficPois:function(a){var b=a.getPois();a.removePoi(b.filter(function(a){return!a.data.incident}))}},_clearIncidentsFromMap:function(){this._map.removePoi(this._map.getPois().filter(function(a){return a.data.incident&&!a.originalImage}))},_resetPois:function(a){this._clearIncidentsFromMap();for(var c=
this._map.infoBubbles.filter(b)[0],d=0,f=a.length;d<f;d++)if(!c||!(a[d].location.latitude==c.data.latitude&&a[d].location.longitude==c.data.longitude)){var e=this._map.createPoi(a[d].icon,a[d].location),g=a[d].incident,o=g.origin,i=g.direction;e.data.name=g.type;if(o)e.data.description=h("maps.Traffic.incidentDescription"+(i?"":"NoDirection"),{origin:o,direction:i});e.data.icon=a[d].icon;e.data.incident=g}},_processIncidentsResponse:function(a){var b=[],c=this._timeTravelDate||new Date;a.TRAFFICITEMS&&
a.TRAFFICITEMS.TRAFFICITEM&&(b=a.TRAFFICITEMS.TRAFFICITEM.map(x).filter(function(a){return a&&a.incident.startTime<=c&&a.incident.endTime>=c}));b.sort(i);b=n(b);b.sort(m);40<b.length&&b.splice(39,b.length-40);this._currentRequest=null;this._incidentPois=b;this._resetPois(b)},_types:function(a){return g[a]},_getType:function(){var a=[],b=this;nokia.mh5.each(nokia.mh5.components.Traffic.getTrafficTypes(),function(c){f.get("traffic"+c+"Enabled")&&a.push(b._types(c))});return a.join(",")},_reloadIncidents:function(a,
b){if("undefined"!==typeof a&&"undefined"!==typeof b&&"undefined"!==typeof b[0]&&!isNaN(b[0].latitude)){var e=this._map.geoToPoint(this._map.center),h=this._getType(),g=f.get("trafficIncidentsEnabled"),o=this;e.x=e.x/256|0;e.y=e.y/256|0;if(this.displayIncidents&&h&&g&&8<a){var i=d+"incidents.json?"+c.formatURLParams({app_id:nokia.mh5.appId,token:nokia.mh5.appCode,bbox:b[0].latitude+","+b[0].longitude+";"+b[1].latitude+","+b[1].longitude,status:"active",type:h,criticality:"critical,major,minor",xnlp:c.getApiSession().id})+
"&jsoncallback";if(i+o._timeTravelDate!==o._incidentsUri){if(o._currentRequest)o._currentRequest.cancel(),o._currentRequest=null;o._timeoutId&&nokia.mh5.win.clearTimeout(o._timeoutId);o._timeoutId=nokia.mh5.win.setTimeout(function(){delete o._timeoutId;h=o._getType();if(o.displayIncidents&&h)o._currentRequest=nokia.mh5.jsonp(i,o._processIncidentsResponse)},1E3);o._incidentsUri=i+o._timeTravelDate}else o._resetPois(o._incidentPois)}else o._clearIncidentsFromMap()}},_showInfoBubble:function(b){var c=
{content:["title","description"],left:b.data.icon,listeners:this._map.infoBubbleParams&&this._map.infoBubbleParams.listeners};this._map.hideInfoBubble(this._map.infoBubbles.filter(a,!1));this._map.showInfoBubble(b,c)},constructor:function(a,b){this._onReady=this._onReady.bind(this);this._onZoom=this._onZoom.bind(this);this._onMove=this._onMove.bind(this);this._onPoiClick=this._onPoiClick.bind(this);this._processIncidentsResponse=this._processIncidentsResponse.bind(this);this._incidentPois=[];Object.defineProperty(this,
"map",{get:function(){return this._map},set:function(a){this._map&&(e.remove(this._map,"ready",this._onReady),e.remove(this._map._map,"mapzoomchange",this._onZoom),e.remove(this._map._map,"mapmoveend",this._onMove),e.remove(this._map._map,"poiclick",this._onPoiClick));if(this._map=a)e.add(this._map,"ready",this._onReady),e.add(this._map._map,"mapzoomchange",this._onZoom),e.add(this._map._map,"mapmoveend",this._onMove),e.add(this._map._map,"poiclick",this._onPoiClick)}});j.constructor.call(this,a,
b)},mapSchemaBinding:"nokia.mh5.components.settings#current.mapSchema",mapSchemaDidChange:function(a){if(a&&"normal.day.traffic"==a){var a=nokia.mh5.app.controller.current,b=this._map,c;if(a&&a.page.timeTraveling)c=a.page.header.route.mode.timetravel,c.day.backToDefault(),c.time.backToDefault(),a.page.resetNotification();b&&b.hasLayer("timeTravelTraffic")&&b.removeLayer("timeTravelTraffic")}},_onReady:function(){this._mapReady=!0;if(f.get("trafficIncidentsEnabled"))this.displayIncidents=!0,this._reloadIncidents(this._map.zoom,
this._map.box)},_onZoom:function(a){if(8>=a.data.newValue){var c=this._map.infoBubbles.filter(b)[0];c&&this._map.hideInfoBubble(c)}a.data.oldValue!==a.data.newValue&&this._reloadIncidents(a.data.newValue,this._map.box)},_onMove:function(){this._reloadIncidents(this._map.zoom,this._map.box)},_onPoiClick:function(a){var b=a.data[0];b.data&&b.data.incident&&!b.infoBubble&&(this._showInfoBubble(b),a.preventDefault())},enableTraffic:function(){this.displayIncidents=!0;f.set("mapSchema","normal.day.traffic");
f.set("trafficIncidentsEnabled",!0);nokia.mh5.components.Traffic.getTrafficTypes().forEach(function(a){f.set("traffic"+a+"Enabled",!0)})},enableTimeTravelTraffic:function(a){var c=this._map;this._timeTravelDate=a=a||new Date;var d=this._map.infoBubbles.filter(b)[0];d&&d.data.incident.endTime<this._timeTravelDate&&c.hideInfoBubble(d);this._reloadIncidents(c.zoom,c.box);"normal.day.traffic"==f.get("mapSchema")&&!c.hasLayer("timeTravelTraffic")&&(f.set("mapSchema","normal.day"),c.addLayer(o(a),"timeTravelTraffic"))},
disableTimeTravelTraffic:function(){this._timeTravelDate=null;this._map.hasLayer("timeTravelTraffic")&&this._map.removeLayer("timeTravelTraffic");this._reloadIncidents(this._map.zoom,this._map.box)},reloadIncidents:function(){this._reloadIncidents(this._map.zoom,this._map.box)},showIncidents:function(){if(!this.displayIncidents)this.displayIncidents=!0,this._reloadIncidents(this._map.zoom,this._map.box)},hideIncidents:function(){if(this.displayIncidents){this.displayIncidents=!1;if(this._currentRequest)this._currentRequest.cancel(),
this._currentRequest=null;this._clearIncidentsFromMap()}},checkInfoBubbleOnIncidentsChange:function(){var a=this._map.infoBubbles.filter(b)[0];a&&(!f.get("trafficIncidentsEnabled")||!f.get("traffic"+a.data.incident.type+"sEnabled"))&&this._map.hideInfoBubble(a)}}})})();nokia.mh5.provide("nokia.mh5.ui.Dialog");
nokia.mh5.ui.Dialog=new nokia.mh5.Class(nokia.mh5.ui.Container,function(g){var a=function(a){a.preventDefault&&a.stopPropagation&&(a.preventDefault(),a.stopPropagation())},b=nokia.mh5.dom.addEvent,d=nokia.mh5.dom.removeEvent;return{cssClass:"mh5_modal",animationName:"fading",children:["content"],content:{control:nokia.mh5.ui.Container,cssClass:"mh5_Dialog"},allowScrolling:!1,closeOnTap:!1,disableUpdatePosition:!1,constructor:function(a,b){g.constructor.call(this,a,b);this.update&&this.update();this._updatePosition()},
build:function(){["_closeDialog","_updatePosition","_delayedUpdatePosition","_onPointerDetect"].forEach(function(a){this[a]=this[a].bind(this)},this);g.build.call(this);if(this._scroll||this.content._scroll)nokia.mh5.win.setTimeout((this._scroll||this.content._scroll).refresh,0)},_closeDialog:function(b){b&&a(b);if(this.visible)this.visible=!1},_onPointerDetect:function(d){this.closeOnTap&&b(this.root,d.touch?"down":"tap",this._closeDialog);this.allowScrolling||(d.touch?b(this.root,"move",a):b(nokia.mh5.win,
"scroll",this._closeDialog))},_addHandlers:function(){b(nokia.mh5.win,"pointerdetect",this._onPointerDetect,!1);b(nokia.mh5.win,"viewportchange",this._delayedUpdatePosition,!1)},_removeHandlers:function(){d(nokia.mh5.win,"pointerdetect",this._onPointerDetect,!1);d(nokia.mh5.win,"viewportchange",this._delayedUpdatePosition,!1)},visibleDidChange:function(a){var b={type:"fade",mode:"in",node:this.root,parentNode:this.parent?this.parent.root:null};if(a)this._addHandlers(),nokia.mh5.history.catchNextOnPopState=
this._closeDialog;else if(this.root.parentNode){this._removeHandlers();delete nokia.mh5.history.catchNextOnPopState;if(this.withoutAnimation){var d=this.root,c=d.parentNode;if(this.onClose)this.onClose();setTimeout(function(){c&&c.removeChild(d)},0);return}b.mode="out";if(this.onClose)b.callback=this.onClose.bind(this)}if(nokia.mh5.platform.android&&4>nokia.mh5.platform.android.version)b.fadeNode=this.root.firstChild;nokia.mh5.dom.doTransition(b)},_delayedUpdatePosition:function(){nokia.mh5.win.setTimeout(this._updatePosition,
400)},_updatePosition:function(){if(!this.disableUpdatePosition)if(this.allowScrolling){if(this.content&&this.content.root)this.root.style.cssText="min-height: 100%;height: "+Math.max(nokia.mh5.win.innerHeight,this.content.root.offsetHeight)+"px;overflow-x: hidden"}else this.root.style.cssText="height: "+(nokia.mh5.win.innerHeight+1)+"px;overflow: hidden;margin-top: "+nokia.mh5.win.pageYOffset+"px;"}}});nokia.mh5.provide("nokia.mh5.ui.SegmentedButton");
nokia.mh5.ui.SegmentedButton=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){return{cssClass:"mh5_SegmentedButton mh5_ColumnLayout",_selectedIndex:void 0,constructor:function(a,b){a.items=a.items||[];g.constructor.call(this,a,b);this.update()},_clickHandler:function(a){if(!(this._selectedIndex===a||this.items[a].disabled))if(void 0!==this._selectedIndex&&nokia.mh5.dom.removeClass(this.root.children[this._selectedIndex],"mh5_selected"),nokia.mh5.dom.addClass(this.root.children[a],"mh5_selected"),
this._selectedIndex=a,this.onValueChange)this.onValueChange(this.items[a].value||a)},select:function(a){if(null==a)this._selectedIndex=void 0;else{for(var b=0,d=this.items.length;b<d;b++)if(this.items[b].value===a){this._clickHandler(b);return}this.items[a]&&this._clickHandler(a)}},update:function(){var a=nokia.mh5.doc.createDocumentFragment(),b,d;for(d in this.items)this.items.hasOwnProperty(d)&&(b=this._createItem(this,parseInt(d,10)),a.appendChild(b.root));this.root.innerHTML="";this.root.appendChild(a)},
_createItem:function(a,b){var d=this,e=a.items[b],h=b===a._selectedIndex?["mh5_selected"]:[],f=!e.name&&e.iconClass?"":e.name||"Item "+(b+1);e.cssClass&&h.push(e.cssClass);e.disabled&&h.push("mh5_disabled");return new nokia.mh5.ui.Control({cssClass:h.join(" "),onClick:function(a){d._clickHandler(b);a.stopPropagation()},innerHTML:e.iconClass?"<div class='"+e.iconClass+"'/>":"<div>"+f+"</div>"})},add:function(a){this.items.push(a);this.update()},remove:function(a){for(var b=null,d=[],e=0,h=this.items.length;e<
h;e++)d.push(this.items[e]),this.items[e].value===a&&(b=e);!b&&this.items[a]&&(b=a);if(b){this.items=[];this.items=d.slice(0,b).concat(d.slice(b+1));if(b<=this._selectedIndex)this._selectedIndex=b===this._selectedIndex?void 0:this._selectedIndex-1;this.update()}}}});nokia.mh5.provide("nokia.mh5.ui.RadioItem");
nokia.mh5.ui.RadioItem=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){return{rootHtmlElementName:"li",cssClass:"mh5_ListItem",constructor:function(a,b){g.constructor.call(this,a,b);this.update()},update:function(){this.root.innerHTML="<div class='mh5_name'>"+this.title+"</div><div class='mh5_status'></div>";nokia.mh5.dom[this.disabled?"addClass":"removeClass"](this.root,"mh5_disabled")}}});nokia.mh5.provide("nokia.mh5.ui.SettingsDialog");
(function(){var g=nokia.mh5.components.settings,a=nokia.mh5.dom,b=nokia.mh5.event,d=nokia.mh5.ui,e=d.Container,h=d.Control,f=d.List,c=d.RadioItem;nokia.mh5.ui.SettingsDialog=new nokia.mh5.Class(nokia.mh5.ui.Dialog,function(j){var i=nokia.mh5.i18n,m;return{cssClass:"mh5_SettingsDialog",allowScrolling:!0,constructor:function(a,b){var c=this.content.children.indexOf("settingsToggleIndicator"),d,f;if(!a.traffic&&~c)d=this.content.settingsToggle,f=d.items,this.content.children.splice(c,1),delete d.onValueChange,
f.pop(),f[0].name=i("mapControl"),f[0].cssClass+=" mh5_box-flex1";j.constructor.call(this,a,b)},content:{control:e,cssClass:"mh5_SettingsDialogContainer",vScroll:!0,bounce:!1,layout:{type:d.RowLayout,align:"strech"},children:"mapOffset,settingsToggle,settingsToggleBorder,settingsToggleIndicator,settingsList,fillup".split(","),mapOffset:{control:e,cssClass:"mh5_mapOffset"},settingsToggle:{control:d.SegmentedButton,cssClass:"mh5_SettingsToggle mh5_ColumnLayout mh5_standardBackgroundColorDark",items:[{name:i("maps"),
value:"maps",cssClass:"settings_maps"},{name:i("layers"),value:"layers",cssClass:"settings_layers"}],onValueChange:function(a){var b=this.parent.settingsList,c=this.root.querySelector(".mh5_selected"),c=Math.round(c.offsetLeft+c.offsetWidth/2);this.parent.settingsToggleIndicator.root.style[nokia.mh5.dom.transformProperty]="translateX("+c+"px)";"maps"==a?(b.maps.visible=!0,b.layers.visible=!1):(b.maps.visible=!1,b.layers.visible=!0);this.parent.parent.resize()}},settingsToggleBorder:{control:h,cssClass:"mh5_SettingsIndicatorBorder"},
settingsToggleIndicator:{control:h,cssClass:"mh5_SettingsIndicator",innerHTML:"<div></div>"},settingsList:{control:e,cssClass:"mh5_SettingsList mh5_standardBackgroundColorDark",children:["maps","layers"],maps:{control:e,children:["mapModeRadioGroup","communityMap","unitSystemToggle","footnote"],mapModeRadioGroup:{control:f,cssClass:"mh5_mapTypes mh5_List",itemClass:c,items:[{title:i("UI.SettingsDialog.mapView"),schema:"normal.day"},{title:i("UI.SettingsDialog.satView"),schema:"hybrid.day"},{title:i("UI.SettingsDialog.PTView"),
schema:"normal.day.transit"},{title:i("UI.SettingsDialog.trafficView"),schema:"normal.day.traffic"}],listeners:{tap:function(b){var c=b.data.index,d=b.data.item,b=b.data.community,f=this.parent.communityMap,e=f.renderedItems[0],h=b||a.hasClass(e.root,"mh5_selected")&&2>c;if(!d.disabled){var i=this.getContentRoot();a.removeClass(i.children[m],"mh5_selected");a.addClass(i.children[c],"mh5_selected");d=h?d.schema+".community":d.schema;d!==g.get("mapSchema")&&(g.set("mapSchema",d),nokia.mh5.maps.analytics.log({gn:"settings",
c32:"change schema",v32:"~c32"}));m=c;e.disabled=f.items[0].disabled=1<c;e.update();b&&a.addClass(e.root,"mh5_selected")}}}},communityMap:{control:f,itemClass:c,cssClass:"mh5_List mh5_RowLayout mh5_TrafficOnOff mh5_CommunityMap",items:[{title:i("UI.SettingsDialog.CommunityMaps")+"*",value:!0}],listeners:{tap:function(b){var c=this.root.children[0],d=a.hasClass(c,"mh5_selected"),f=g.get("mapSchema");b.data.item.disabled||(a[d?"removeClass":"addClass"](c,"mh5_selected"),g.set("mapSchema",d?f.slice(0,
-10):f+".community"))}}},unitSystemToggle:{control:d.SegmentedButton,cssClass:"mh5_SegmentedButton mh5_UnitSystemToggle mh5_ColumnLayout",items:[{name:i("UI.SettingsDialog.Km"),value:"km"},{name:i("UI.SettingsDialog.Miles"),value:"mi"}],onValueChange:function(a){g.get("unitSystem")!=a&&(g.set("unitSystem",a),nokia.mh5.maps.analytics.log({gn:"settings",c32:"change units",v32:"~c32"}))}},footnote:{control:h,cssClass:"mh5_CommunityFootnote",innerHTML:"<p>* "+i("UI.SettingsDialog.CommunityMapFootnote")+
"</p>"}},layers:{control:e,children:["trafficOnOffSwitch","trafficSettingsContainer","criticalitySigns"],visible:!1,trafficOnOffSwitch:{control:f,itemClass:c,cssClass:"mh5_List mh5_RowLayout mh5_TrafficOnOff",items:{title:"Traffic Incidents",value:!0},onClick:function(){var a=this.root.children[0],b=this.getRootOwnerByClass(d.SettingsDialog);nokia.mh5.maps.analytics.log({gn:"settings",c32:!nokia.mh5.dom.hasClass(a,"mh5_select")?"incidents on":"incidents off",v32:"~32"});b._changeIncidents(a,"Incidents")}},
trafficSettingsContainer:{control:f,itemClass:new nokia.mh5.Class(h,function(b){return{rootHtmlElementName:"li",cssClass:"mh5_ListItem",constructor:function(a,c){b.constructor.call(this,a,c);this.update()},update:function(){a[this.disabled?"addClass":"removeClass"](this.root,"mh5_disabled");var b=document.createDocumentFragment(),c=document.createElement("div");c.className="mh5_image mh5_image"+this.title;b.appendChild(c);c=document.createElement("div");c.className="mh5_name";c.innerHTML=this.title;
b.appendChild(c);c=document.createElement("div");c.className="mh5_status";b.appendChild(c);this.root.appendChild(b)}}}),cssClass:"mh5_List mh5_RowLayout mh5_TrafficSettings",items:nokia.mh5.components.Traffic.getTrafficTypes().map(function(a){return{title:i("UI.SettingsDialog."+a),value:a}}),onClick:function(a){if(!this.items[a].disabled){var b=this.root.children[a],a=this.items[a].value;this.getRootOwnerByClass(d.SettingsDialog)._changeIncidents(b,a)}}},criticalitySigns:{control:f,cssClass:"mh5_criticalitySigns",
itemClass:new nokia.mh5.Class(h,function(a){return{rootHtmlElementName:"li",cssClass:"mh5_CriticalitySign",constructor:function(b,c){a.constructor.call(this,b,c);this.update()},update:function(){this.root.innerHTML='<div class="text">'+i("maps.Traffic."+this.type)+'</div> <div class="img img_'+this.type+'"></div>'}}}),items:[{type:"minor"},{type:"major"},{type:"critical"}]}}},fillup:{control:h,cssClass:"mh5_fillup mh5_standardBackgroundColorDark"}},build:function(){this.resize=this.resize.bind(this);
this.onGlobalTap=this.onGlobalTap.bind(this);j.build.call(this)},resize:function(){var b=this.content,c=b.getContentRoot();a[c.offsetHeight>this.root.offsetHeight?"addClass":"removeClass"](b.root,"mh5_autoHeight");nokia.mh5.win.setTimeout(b._scroll.refresh,1)},_update:function(){this.visible&&(this._updateMapModeSelection(),this._updateUnitSystem(),this._updateTrafficIncidentSelection(),this._updateTrafficOnOffButton(),this.resize())},onGlobalTap:function(b){(!a.contains(this.root,b.target)||this.content.mapOffset.root===
b.target)&&this._closeDialog(b)},visibleDidChange:function(c){var d=this;c?(b.add(nokia.mh5.win,"viewportchange",d.resize,!1),b.add(nokia.mh5.doc.body,a.touchStart,d.onGlobalTap,!0),b.add(nokia.mh5.doc.body,"focus",d.onGlobalTap,!0),setTimeout(function(){d.content.settingsToggle.select("maps");d.resize()},1),this._update()):(b.remove(nokia.mh5.win,"viewportchange",d.resize,!1),b.remove(nokia.mh5.doc.body,a.touchStart,d.onGlobalTap,!0),b.remove(nokia.mh5.doc.body,"focus",d.onGlobalTap,!0));j.visibleDidChange.apply(d,
arguments)},_updateUnitSystem:function(){this.content.settingsList.maps.unitSystemToggle.select(g.get("unitSystem"))},_updateTrafficIncidentSelection:function(){var b=this.content.settingsList.layers.trafficSettingsContainer;nokia.mh5.each(nokia.mh5.components.Traffic.getTrafficTypes(),function(c){var d=g.get("traffic"+c+"Enabled"),f=b.renderedItems.filter(function(a){return a.value===c})[0].root;a[d?"addClass":"removeClass"](f,"mh5_selected")})},_updateTrafficOnOffButton:function(){var b=g.get("trafficIncidentsEnabled");
a[b?"addClass":"removeClass"](this.content.settingsList.layers.trafficOnOffSwitch.renderedItems[0].root,"mh5_selected")},_updateMapModeSelection:function(){var a=this.content.settingsList.maps.mapModeRadioGroup,c=g.get("mapSchema"),d=/\bcommunity$/.test(c),f=a.items;"normal.day.grey"==c&&(c="normal.day.transit");if(c)for(var e in f){if(f[e].schema===c||d&&f[e].schema===c.slice(0,-10)){m=e;break}}else m=0;b.fire(a,"tap",{index:m,item:f[m],community:d})},_changeIncidents:function(b,c){var d=a.hasClass(b,
"mh5_selected");g.set("traffic"+c+"Enabled",!d);a[d?"removeClass":"addClass"](b,"mh5_selected");d=nokia.mh5.app.controller.current.page.traffic;d.checkInfoBubbleOnIncidentsChange();if(g.get("trafficIncidentsEnabled"))d["Incidents"==c?"showIncidents":"reloadIncidents"]();else d.hideIncidents()}}})})();nokia.mh5.provide("nokia.mh5.components.InfoBubble");
nokia.mh5.components.InfoBubble=function(){function g(a,b){u.font=b;u.textBaseline="bottom";u.fillStyle="rgb(255,255,255)";return u.measureText(a||" ").width}function a(a,b,c){for(var d=g(a,b);c<d;)a=a.substr(0,a.length-2)+"\u2026",d=g(a,b);return{text:a,textWidth:d}}function b(a){return Math.round(16*a/12)}function d(a,b){setTimeout(a.next=function(){return(b=a.shift())?!!b(a)||!0:!1},0);return a}function e(a,b,c){var d=(c||a.params)[b];"string"==typeof d?(c=new Image,c.src=d,c.onload=a.next,a[b]=
c):d.width||d.height?(a[b]=(c||a.params)[b],a.next()):d instanceof Image&&(d.addEventListener("load",function t(){d.removeEventListener("load",t,!1);a.next()},!1),a[b]=d)}function h(a){e(a,"left")}function f(a){e(a,"right")}function c(a){e(a,"image")}function j(a){y.star.src=nokia.mh5.assetsPath+"img/fullstar_icon.png";e(a,"star",y)}function i(a){y.hstar.src=nokia.mh5.assetsPath+"img/halfstar_icon.png";e(a,"hstar",y)}function m(a){y.estar.src=nokia.mh5.assetsPath+"img/emptystar_icon.png";e(a,"estar",
y)}function l(a,b,c){u.save();u.beginPath();u.strokeStyle="#FFFFFF";u.moveTo(a,b);u.lineTo(a,c-b);u.stroke();u.closePath();u.restore()}function n(c){var d=document.createElement("CANVAS"),f=c.params,e=nokia.mh5.extend({},c.data),h=c.left||F,g=c.right||F,i=c.image||F,j=0,n=Number.MAX_VALUE,m=0,v=0,L=0,A=0,B="background"in f?f.background:"rgba(0,15,26,0.85)",w=b(f.borderRadius||2),M=b(1),N=b(14),R=b(12),ka=f.maxWidth||Number.MAX_VALUE,Z,P=0,$=300,aa=f.content,ga,ha,ia;E.forEach(function(a){a in f&&
f[a]&&(e["title"==a?"name":a]=f[a])});Array.isArray(aa)&&3<aa.length&&(aa=aa.slice(0,3));u=d.getContext("2d");if(i!=F)L+=i.width+(B?26:0);else{if(h!=F&&(L+=26+h.width,Z||g!=F))L+=1;if(g!=F&&(L+=26+g.width,Z||h!=F))L+=1}if(aa&&i==F){-1!=aa.indexOf("rating")&&e.ratingValue&&(A+=16,P=70,Z=!0);$=Math.max(ka-L-26,P);if(-1!=aa.indexOf("title")&&e.name)A+=N+6,ka=a(e.name,"bold 14pt Arial",$),ga=ka.text,P=Math.max(P,ka.textWidth),Z=!0;if(-1!=aa.indexOf("description")&&e.description)A+=R+6,ka=a(e.description,
"12pt Arial",$),ha=ka.text,P=Math.max(P,ka.textWidth),Z=!0;if(-1!=aa.indexOf("more")&&e.more)A+=R+6,ka=a(e.more,"12pt Arial",$),ia=ka.text,P=Math.max(P,ka.textWidth),Z=!0}Z&&(L+=P+26);A&&(A-=6);A=Math.max(A,h.height,g.height,i.height)+(B?16:0);d.width=L;d.height=A+(B?16:0);B&&C(d.width,A,M,w,B);if(i!=F)u.drawImage(i,B?m+13:0,B?~~((A-i.height)/2):0);else{h!=F&&(m+=13,u.drawImage(h,m,~~((A-h.height)/2)),m+=h.width+13,(Z||g!=F)&&f.leftDelimiter&&l(m,8,A),j=m);if(Z){m+=13;u.textBaseline="top";u.fillStyle=
"#FFFFFF";v=o(ga,"bold 14pt Arial",m,v,6,N);v=o(ha,"12pt Arial",m,v,6,R);v=o(ia,"12pt Arial",m,v,6,R);if(-1!=aa.indexOf("rating")){r=0;for(v+=6;r<~~e.ratingValue;)q(y.star,r++,m,v);for(r<e.ratingValue&&q(y.hstar,r++,m,v);5>r;)q(y.estar,r++,m,v)}m=m+P+13}g!=F&&(n=m,Z&&f.rightDelimiter&&l(m,8,A),u.drawImage(g,m+13,~~((A-g.height)/2)))}B&&(u.translate(L/2,A-1),x(B));u=null;nokia.mh5.event.add(d,"down",function(a){var b=f.listeners,c,d=a.offsetX||a.data.offsetX,a=a.offsetY||a.data.offsetY;if(b){if(b.leftclick&&
d<j)c=b.leftclick;else if(b.rightclick&&d>n)c=b.rightclick;else if(b.click)c=b.click;c&&c.call(this,{clickedPoint:{x:d,y:a}})}}.bind(this),!1);d.leftDelimiter=j;d.rightDelimiter=n;c.callback(d)}function o(a,b,c,d,f,e){if(a)f=d+=f,u.font=b,u.fillText(a,c,f),d+=e;return d}function q(a,b,c,d){u.drawImage(a,c+14*b,d)}function x(a){u.beginPath();u.moveTo(6,0);u.lineTo(0,14);u.lineTo(-6,0);u.closePath();u.fillStyle="rgb(255,255,255)";u.fill();u.fillStyle=a;u.fill();u.translate(0,14);u.save();u.scale(1.9,
1);u.beginPath();u.arc(0,0,2.6,0,2*Math.PI,!1);u.fillStyle="rgba(0,0,0,0.35)";u.fill();u.closePath();u.restore()}function C(a,b,c,d,f){var e=c/2,h=d+e,g=a-h,i=b-h;u.fillStyle=f;u.lineWidth=c;u.lineCap="round";u.moveTo(h,e);a=[g,e,g,h,d,w,A,a-e,i,g,i,d,A,v,h,b-e,h,i,d,v,B,e,h,h,h,d,B,w];b=0;for(c=a.length;b<c;)u.lineTo(a[b++],a[b++]),u.arc(a[b++],a[b++],a[b++],a[b++],a[b++]);u.fill()}document.createElement("CANVAS");var E=["title","description","more"],F={height:0,width:0},y={star:new Image,hstar:new Image,
estar:new Image},B=Math.PI,v=B/2,w=3*v,A=0;b(16);var u;return function(a,b,e){this.data=a;this.params=b;this.parent=b.parent;d([function(d){d.params=b;d.data=a;d.callback=e;b.hasOwnProperty("left")&&b.left&&d.unshift(h);b.hasOwnProperty("right")&&b.right&&d.unshift(f);b.hasOwnProperty("image")&&b.image&&d.unshift(c);b.hasOwnProperty("content")&&~b.content.indexOf("rating")&&(d.unshift(j),d.unshift(i),d.unshift(m));d.next()},n.bind(this)])}}();nokia.mh5.provide("nokia.mh5.internals.Map");
nokia.mh5.internals.Map=function(g){function a(a){var b=0,c=0;do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{x:b,y:c}}function b(a,b){var c=nokia.mh5.event,d=c.add,f,e,h,i=g.navigator.msPointerEnabled?"touchstart":"down";d(a,i,function pc(o){c.remove(a,i,pc);f=c.isTouch||g.navigator.msPointerEnabled;b.init(f?"touch":"mouse");f?(e=b.touch,h=b.gesture,g.navigator.msPointerEnabled?(d(a,Wa,e.start),d(a,Xa,e.move),d(a,Ya,e.end)):(d(a,"down",e.start),d(a,"move",e.move),d(a,"up",e.end)),
d(a,Rb,h.start),d(a,Ea,h.change),d(a,xa,h.end),e.start(o)):(e=b.mouse,d(a,"down",e.down),d(a,"move",e.move),d(a,"up",e.up),d(a,qc,e.wheel),d(a,rc,e.wheel),e.down(o));c=d=f=e=h=null})}function d(a,b,c){function d(a,b,c,g,i,o,p,j,t,z,n,m){var p=p+(j-p)*n,K=W(a+p*t),l=W(b+p*z);K!=i||l!=o?(h.move(K-c,l-g),e=q(d,m,a,b,K,l,i,o,p,j,t,z,n,m)):f(h.end())}function f(){x(e);e=0}var e=0,h={kick:function(a,b,c,g){var c=9*c,i=9*g,g=D(c*c+i*i),c=c/g,i=i/g,o=!0;e&&f();!C(c)&&!C(i)?(h.start(),d(a,b,a,b,W(a+g*c),W(b+
g*i),0,g,c,i,0.2,17)):o=!o;return o},stop:f,start:a||J,move:b||J,end:c||J};return h}function e(e,h,z){var n,K,l,C,D,A;function y(a){Ra&&Sb(a||s[ca])}function w(){1===va&&ia(oa,ra)}function ia(a,b){var c=oa=a,d=ra=b,c=c+n,d=d+K,f=!!Za,e=f&&Za.length,g=sa.add,i=~~(c/O),o=~~(d/O),p=c%O,j=d%O,d=pa-p,c=qa-j,t,q,i=i-(p=U(d/O)),o=o-(j=U(c/O)),d=d-O*p,c=c-O*j;G.clear();for(sa.clear();d<h;){j=c;for(p=o;j<z;){g("".concat(i,"-",p,"-",S,"-",Fa),i,p,d,j);if(f)for(t=0;t<e;)(q=Za[t](i,p,za,S,V,Fa))&&g(q,i,p,d,j,
q),++t;j+=O;++p}d+=O;++i}Ga&&Aa.call(Xa(),Ua);Ba&&Aa.call(sc(),Qb);wb&&drawBuildings();Ub()}function Z(a,b,c,d){G.strokeStyle=a||Ab;G.lineWidth=b||Bb;G.lineCap=c||hb;G.lineJoin=d||hb}function wa(a,b){for(var c=a.length,d=2*c,f=new Vb(d),e;c--;)e=ja(a[c],b),f[--d]=e.y,f[--d]=e.x;return f}function Va(a,b){for(var c=a.length,d=new Vb(c),f;c--;)f={},f[ea]=a[c],f[fa]=a[c-1],f=ja(f,b),d[c--]=f.y,d[c]=f.x;return d}function nc(a,b,c){for(var d="",f,e;c--;)f=0,e=1<<c,0!==(a&e)&&f++,0!==(b&e)&&(f+=2),d+=f;
return d}function xa(){return null!=oa&&(la=$a({x:oa,y:ra},V))}function Sb(a){if(a){var b=ja(a,V);Ra=!ia(b.x-l,b.y-C);la={};la[fa]=a[fa];la[ea]=a[ea];j(s,"centerset",la)}}function Tb(a,b){"shape"in a&&(a=a.shape);for(var c=s.size,d=ta,f=O<<ta,e=[],h=[],g=0,i=0,o=a.length,p,j;g<o;++g)P(j=a[g])&&(j={latitude:j,longitude:a[++g]}),p=ja(j,f),e[i]=p.x,h[i++]=p.y;g=H.apply(I,e);i=H.apply(I,h);o=t.apply(I,e);p=t.apply(I,h);o=e=o-g;for(p=h=p-i;c.height<p||c.width<o;)p/=2,o/=2,--d;if(b)s[ca]=$a({x:e/2+g,y:h/
2+i},f),s.zoom=d;return d<=ta&&Ha<=d?d:0}function zb(a){this.width=a;this._int32Vector=[]}function kb(a){for(var b=O<<S,c=ja(a[0],b),b=ja(a[1],b),c=((b.x/O|0)+1-(c.x/O|0))*((b.y/O|0)+1-(c.y/O|0)),a=S,b=c;a++<ta&&(b+=c<<=2)<kb.max;);return--a}function Cb(a){var b=!Ca;Ca="online"==a.type;aa=$.src=Ca?ab.settings.defaultImage||Db.settings.defaultImage:nokia.mh5.assetsPath+"img/empty_tile_offline.png";b&&(sa.clear(),sa.gc(),y())}function lb(a,b,c,d,f,e,h,g){return(g-b)*(f-a)>(e-b)*(h-a)!=(g-d)*(f-c)>(e-
d)*(h-c)&&(e-b)*(c-a)>(d-b)*(f-a)!=(g-b)*(c-a)>(d-b)*(h-a)}function Qb(a){var b=a.shape,c=a.style,a=oa-pa,d=ra-qa,f=h+a,e=z+d,g=0,i=0,o=b.length,p,j,t;Z(c.color,c.width,c.cap,c.join);for(G.beginPath();g<o;){c=b[g];p=b[g+1];switch(!0){case a<=c&&d<=p&&c<=f&&p<=e:i&&(G.moveTo(b[g-2]-a,b[g-1]-d),i=0);case !i++:g?G.lineTo(c-a,p-d):G.moveTo(c-a,p-d);break;case lb(j=b[g-2],t=b[g-1],c,p,a,d,f,e):case lb(j,t,c,p,f,d,a,e):G.moveTo(j-a,t-d),G.lineTo(c-a,p-d),i=0}g+=2}G.stroke()}function sc(){bb[S]||Aa.call(Ba,
Ta,bb[S]=[]);return bb[S]}function mb(a){return a&&fa in a&&ea in a&&!a.shape}function Ta(a,b){var c=P(a[0])||mb(a[0])?a:a.shape;bb[S][b]={style:a==c?0:a,shape:P(c[0])?Va(c,V):wa(c,V)}}function tc(a){var a=a.shape||a,b=this.x,c=this.y,d=a.length,f=0,e=!1,h,g,i,o,p,j,z;i=a[d-2];for(o=a[d-1];f<d;)h=a[f++],g=a[f++],h>i?(p=i,z=h,j=o,o=g):(p=h,z=i,j=g),h<b==b<=i&&(c-j)*(z-p)<(o-j)*(b-p)&&(e=!e),i=h,o=g;return e}function Ua(a){for(var b=a.shape,a=a.style,c=oa-pa,d=ra-qa,f=h+c,e=z+d,g=0,i=b.length,o,p,j,
t;g<i;){o=b[g];p=b[g+1];if(c<=o&&d<=p&&o<=f&&p<=e||lb(j=b[g-2],t=b[g-1],o,p,c,d,f,e)||lb(j,t,o,p,f,d,c,e)){G.beginPath();G.fillStyle=a.color||"rgba(100,100,100,.1)";G.moveTo(b[0]-c,b[1]-d);for(g=2;g<i;)G.lineTo(b[g]-c,b[g+1]-d),g+=2;G.fill();G.fillStyle=Eb;break}g+=2}}function Wa(a,b){return Ia[S][b].shape.length!=(a.shape||a).length}function Xa(){if(!Ia[S]||Fb.call(Ga,Wa).length)Aa.call(Ga,Ya,Ia[S]=[]);return Ia[S]}function Ya(a,b){var c=P(a[0])||mb(a[0])?a:a.shape;Ia[S][b]={origin:Ga[b],style:a==
c?0:a,shape:P(c[0])?Va(c,V):wa(c,V)}}function ja(a,b){var c=a[ea]/360+0.5,d=H(1,t(0,0.5-p(L(R+N*a[fa]/180))/M/2));return{x:W(c*b),y:W(d*b)}}function $a(a,b){var c=a.x/b,d=a.y/b,f={};f[fa]=0>=d?90:1<=d?-90:ka*(2*Q(Y(M*(1-2*d)))-N);f[ea]=360*(1===c?1:(c%1+1)%1)-180;return f}var Ja=uc(),cb=e.appendChild(ha()),G=cb.getContext("2d"),ya=a(cb);D=0;A=0;l=0;C=0;n=0;K=0;var s={},Ea=0,Ra=0,va=1,wb=0,Ca=E.onLine,Da=!0,Ka=!0,db=0,Ba=null,Za=null,bb=[],Ab=Wb,Eb="rgba(0,0,0,1)",Bb=9,hb="round",Gb=0,Hb=0,eb="%[1-4]%.maps.nlp.nokia.com",
fb="maptile",Ib="newest",Ga=null,Xb,Ia,oa,ra,la,V,S,Fa,za,pa,qa,La,Ma,sa,ab,Db,nb,Ub,ua,Yb,Sa,ba,T,Jb,Na,ma,Zb,ob="",pb="",qb;try{G.mozImageSmoothingEnabled=!1}catch(Rb){}v(s,"box",la={get:function(){var a=ja(s[ca],V),b;a.x-=pa;a.y-=qa;b=$a(a,V);a.x+=h;a.y+=z;a=$a(a,V);return[b,a]},set:function(a){Tb(a,!0)}});v(s,"bbox",la);v(s,"apiKey",{set:function(a){ob=nokia.mh5.utils.formatURLParams({app_id:a.appId,token:a.appCode})},get:function(){return ob}});pb=nokia.mh5.utils.formatURLParams({xnlp:nokia.mh5.utils.getApiSession().id});
f(nokia.mh5,"newapisession",function(a){pb=nokia.mh5.utils.formatURLParams({xnlp:a.data.id})});v(s,ca,la={get:function(){return la||xa()},set:Sb});v(s,"centre",la);la=0;ma={resetDefault:function(){ma.defaultPrevented=!1},preventDefault:function(){ma.defaultPrevented=!0}};v(s,"geoToPoint",{value:function(a){return ja(a,V)}});v(s,"getZoomLevelFor",{value:Tb});v(s,"layer",{get:function(){return Za},set:function(a){Za=a&&[].concat(a)}});v(s,"move",{value:function(a,b){ia(oa+a,ra+b);(a||b)&&(la=0)}});
zb.prototype.set=function(a,b,c){var d,f,e,g;for(d=0;d<c;d++)for(f=0;f<c;f++)e=a+d,g=b+f,e=g*this.width+e,g=e>>5,this._int32Vector[g]|=1<<e-(g<<5)};zb.prototype.get=function(a,b){a=b*this.width+a;b=a>>5;return this._int32Vector[b]&1<<a-(b<<5)};kb.max=2200;v(s,"maxStorableZoom",{value:function(a){a||(a=s.box);return kb(a)}});v(s,"areaToTiles",{value:function(a){a||(a=s.box);var b=a,c=S,a=kb(a),c=t(c,Ha),a=H(a,ta),d=[],f=[4,3,2,1],e=O<<c,g=ja(b[0],e),h=ja(b[1],e),b=g.x/O|0,g=g.y/O|0,e=(h.x/O|0)+1,h=
(h.y/O|0)+1,i=e-b,o=h-g,p,j,z,n,K;for(n=c;n<=a;n++){K=new zb(i,o);for(j=b;j<e;j++)for(z=g;z<h;)if(K.get(j-b,z-g))z++;else{for(c=0;p=f[c];c++)if(0===j%p&&0===z%p&&j-b+p<=i&&z-g+p<=o){d.push({x:j,y:z,z:n,size:p});K.set(j-b,z-g,p);break}z+=p||1}i<<=1;o<<=1;b<<=1;e<<=1;g<<=1;h<<=1}return d}});v(s,"offset",{get:function(){return{left:ya.x,top:ya.y}},set:function(a){ya={x:~~(na.call(a,"x")?a.x:a.left)||0,y:~~(na.call(a,"y")?a.y:a.top)||0}}});v(s,"geometry",{get:function(){return{left:D,top:A}},set:function(a){D=
~~(na.call(a,"x")?a.x:a.left)||0;A=~~(na.call(a,"y")?a.y:a.top)||0;l=void 0;C=void 0;l=W(D/2);C=W(A/2)}});g.addEventListener("online",Cb,!1);g.addEventListener("offline",Cb,!1);(function(a){function b(a,c){var d=a.zIndex_,f=c.zIndex_;return d===f?0:d<f?-1:1}function c(){l.sort(b)}function d(a){return"string"!=typeof a&&a.constructor!=B&&!(a instanceof Image)}function f(a,b){var c=a.info_;if("string"==typeof c.text){var d=i.createElement("canvas"),e=d.getContext("2d"),g=b.width,h=b.height,o=c.text,
p;c||(c={});d.width=g;d.height=h;e.drawImage(b,0,0,g,h);e.textBaseline=c.textBaseline||"top";e.fillStyle=c.fillStyle||c.color||"rgb(255,255,255)";e.font=c.font||"bold "+(c.fontHeight||~~(h/3)+"px")+" sans-serif";p=e.measureText(o||"").width;e.fillText(o,c.x||(g-p)/2,c.y||~~(h/3-3));c=d}else c=b;a.img_=c}function e(){var a=this._,b,c;for(this.onload=null;a.length;)b=a.shift(),b.loaded=1,this===b.img_&&f(b,this),(c=b.onload)&&c.call(b)}function g(){var a=rb.call(Q,this);~a&&(Q.splice(a,1),ua(this,V),
l.push(this),w())}function o(a){var b=a.height/2;if(b=X(a.x-this.x)<a.width/2&&X(a.y-b-this.y)<b)a.clickedPoint.x=this.x-a.x,a.clickedPoint.y=this.y-a.y;return b}function p(a){a.loaded?(ua(a,V),l.push(a),w()):(Q.push(a),a.onload=g)}function j(a){var b=rb.call(Q,a);~b?Q.splice(b,1):~(b=rb.call(l,a))&&l.splice(b,1)}var t={writable:!0,value:null},m={},l=[],Q=[],J=0,C,I,D;Jb=function(b,c){var d=ja(a[ca],V);d.x+=b-pa+n;d.y+=c-qa+K;return Fb.call(l,o,d).concat(T&&X(T.x-d.x)<T.width/2&&X(T.y-d.y)<T.height/
2&&T||[]).reverse()};nb=function(a,b,c){var d,f,e=a.scale_,c=a.y-c,g=null!=a.locationX?a.locationX:0.5,h=null!=a.locationY?a.locationY:1;G.drawImage(a.image,a.x-b-(d=a.width/va*e)*g,c-(f=a.height/va*e)*h,d,f)};Ub=function(){for(var a=oa-pa+n,b=ra-qa+K,c=h+a,d=z+b,f=0,e=0,g=l.length,i,o,p,j,t,q=[[],[],[]];f<g;)p=l[f++],e=p.x,j=p.y,a<e&&b<j&&e<c&&j<d&&(p.privileged_?t=p:null!=p.privilegeLevel?q[p.privilegeLevel].push(p):nb(p,a,b));for(f=0;j=q[f];f++)for(e=0;e<j.length;e++)nb(j[e],a,b);if((p=T)&&p.loaded)if(e=
p.x,j=p.y,a<e&&b<j&&e<c&&j<d){j-=b;e-=a;if(!Ka&&!Da&&(g=~~(ba[Kb]*V/4.007501668E7)))G.fillStyle="rgba(61,137,12,0.2)",G.drawCircle(e,j,g),G.fillStyle=Eb;G.drawImage(p.image,e-(i=p.width/va)/2,j-(o=p.height/va)/2,i,o)}(p=t)&&nb(p,a,b)};ua=function(a){var b=ja(a,V),c=a.img_;a.x=b.x;a.y=b.y;a.width=c.width;a.height=c.height};Yb=function(){Aa.call(l,ua);T&&ua(T)};Sa=function(a,b){var c=typeof a==Oa||a instanceof Image||d(a)?{image:a}:a,g=c.image;this.zIndex_=0;this.lt_=b[fa];this.ln_=b[ea];this.scale_||
(this.scale_=1);this.data=b;this.clickedPoint={x:0,y:0};this.info_=c;"string"==typeof g?na.call(m,g)?((c=this.img_=m[g])._.push(this),c.onload||e.call(c)):(c=this.img_=m[g]=new Image,c.onload=e,c._=[this],c.src=g,this.width=this.height=0):(f(this,g),this.loaded=1)};C={zIndex_:t,lt_:t,ln_:t,img_:t,info_:t,scale_:t,privileged_:t,clickedPoint:t,x:t,y:t,width:t,height:t,data:t,onload:t,loaded:t,constructor:{value:I=Sa},zIndex:{enumerable:!0,get:function(){return this.zIndex_},set:function(a){this.zIndex_=
a;x(J);J=q(c,60)}},toJSON:{value:function(a){var b={};for(a in this)!na.call(C,a)&&!/_$/.test(a)&&(b[a]=this[a]);b.icon=this.img_.src;b[fa]=this.lt_;b[ea]=this.ln_;return b}},image:{enumerable:!0,get:function(){return this.img_},set:function(a){a instanceof Image||d(a)?(f(this,a),ua(this)):(j(this),typeof a==Oa?this.info_.image=a:this.info_=a,this.loaded=0,I.call(this,this.info_,this),p(this));w()}},isPosition:{enumerable:!0,get:function(){return this==T}},privileged:{enumerable:!0,get:function(){return!!this.privileged_},
set:function(a){var b;if(a){for(b=l.length;b--;)l[b].privileged_=!1;b=rb.call(l,this);~b&&(l.push(this),l.splice(b,1))}this.privileged_=!!a;w()}},coordinate:D={get:function(){return this},set:function(a){this.lt_=a[fa];this.ln_=a[ea];ua(this);w()}},coords:D,latitude:{enumerable:!0,get:function(){return this.lt_},set:function(a){this.lt_=a;ua(this);w()}},scale:{get:function(){return this.scale_},set:function(a){this.scale_=a;w()}},longitude:{enumerable:!0,get:function(){return this.ln_},set:function(a){this.ln_=
a;ua(this);w()}}};ib?Sa=ga($b+"Poi"+ac,C):Lb(Sa.prototype,C);v(a,"addPoi",{value:function(a){Aa.call([].concat(a),p);x(J);J=q(c,60)}});v(a,"createPoi",{value:function(a,b){p(a=new Sa(a,b));return a}});v(a,"removePoi",{value:function(a){null==a?(Q=[],l=[]):Aa.call([].concat(a),j);w()}})})(s);v(s,"pointToGeo",{value:function(a){return $a(a,V)}});v(s,"position",{get:function(){function a(b){b=b.coords||b.data.coords;ba[fa]=b[fa];ba[ea]=b[ea];ba[Kb]=b[Kb];ba.heading=b.heading;ba.speed=b.speed;ba.available=
!0;if(T)Ka=Da=!1,T.coords=b,j(s,gb,ba);else if(ba.marker)T=new Sa(nokia.mh5.assetsPath+"img/position.png",b),T.onload=function(){if(T)ua(T),T.loaded=1,w()},T.image.width&&ua(T),h(ba)}function b(a){d();i(a)}function d(a){ba.available=!1;T=null;w();a&&j(s,sb,ba)}var e=nokia.mh5.geolocation,g=function(){c(e,type,data)},h,i;ba={marker:!0,deactivate:function(){g(Mb,d);g(sb,d);g(Nb,a);g(gb,a);g(tb,b);e.deactivate();d()},activate:function(c,g){if("disabled"==e.status)return g({type:tb});h=c;i=g;if(T)return h(ba);
f(e,Mb,d);f(e,sb,d);f(e,Nb,a);f(e,gb,a);f(e,tb,b);e.available?a({data:e}):e.activate()},toJSON:function(){var a={};a[fa]=ba[fa];a[ea]=ba[ea];return a},available:!1};return function(){return ba}}()});v(s,"route",{get:function(){return Ba&&1==Ba.length?Ba[0]:Ba},set:function(a){a?(bb=[],Ba=!bc(a)||P(a[0])||mb(a[0])?[a]:a):Ba=null;w()}});v(s,"shape",{get:function(){return Xb},set:function(a){a?(Ia=[],Xb=a,Ga=!bc(a)||P(a[0])||mb(a[0])?[a]:a):Ga=null;w()}});v(s,"scale",{get:function(){return va},set:function(a){1===
va&&1!==a&&(j(s,cc,{}),Da=!0);G.clearRect(0,0,h,z);va=a;G.save();G.setTransform(a,0,0,a,-a*(La-n)+(La-n),-a*(Ma-K)+(Ma-K));ia(oa,ra);G.restore()}});v(s,Pa,{get:function(){return Gb?dc+".traffic":Fa},set:function(a){Gb=Hb=0;(Gb=/\btraffic\b/.test(a))?(Fa=dc+".grey",fb="traffictile",eb="maps.nlp.nokia.com",Ib="newest"):(Hb=/\bcommunity$/.test(a))?(Fa=a,eb="%[1-4]%.communitymaptiles.nokia.com/tilehub/live/",fb=~a.indexOf("hybrid")?"sat":"map"):(Fa=a,fb="maptile",eb="%[1-4]%.maps.nlp.nokia.com",Ib="newest");
sa.clear();sa.gc();y()}});v(s,"size",{get:function(){return{width:h,height:z}},set:function(a){var b=Ra&&s[ca];na.call(a,"width")?(h=a.width,z=a.height):(h=a[0],z=a[1]);pa=La=~~(h/2);qa=Ma=~~(z/2);cb.width=h;cb.height=z;G.font="7pt sans-serif";G.textBaseline="top";G.fillStyle=Eb;Z();y(b)}});Lb(s,{restore:{value:function(){var a=Ja.get(ca),b=Ja.get(Qa),c=Ja.get(Pa);Ja.get(vc);null!=b&&(s[Qa]=b);null!=c&&(s[Pa]=c);a&&(s[ca]=a);return!!a}},save:{value:function(){var a=s[Pa],b=s[Qa],c=Ra&&s[ca];a&&Ja.set(Pa,
a);b&&Ja.set(Qa,b);c&&(c={},c[fa]=s[ca][fa],c[ea]=s[ca][ea],Ja.set(ca,c))}}});v(s,"tileServer",{get:function(){return ab},set:function(a){var b;ab=a||Db;Ca?(b=ab.settings.defaultImage)&&(aa=$.src=b):Cb({});sa.clear();sa.gc();y()}});v(s,"tileLang",{get:function(){return qb},set:function(a){qb=a}});Db={settings:{defaultImage:nokia.mh5.assetsPath+"img/empty_tile.png"},create:function(a,b,c){var d=new Image;d.src=Hb?"http://".concat(eb.replace(/\%\[1\-4\]\%/,1+c%4),fb,"/png/",nc(b,c,a),"?",ob,"&",pb):
"http://".concat(eb.replace(/\%\[1\-4\]\%/,1+c%4),"/maptile/2.1/",fb,"/",Ib,"/",Fa,"/",a,"/",b,"/",c,"/",O,"/png8","?",ob,"&",pb,"&",qb?"lg="+qb:"");return d}};(function(){function a(){1===s.scale&&(h=!0,s.moveTo(d))}function b(){h||(s.tracking=!1);h=!1}var d=s.position,e=!1,g,h;v(s,"tracking",{get:function(){return e},set:function(i){i=!!i;i!=e&&(g=(e=i)?f:c,ma.resetDefault(),e?(j(s,ec,ma),ma.defaultPrevented||(d.available&&a(),h=!1)):j(s,fc,ma),g(s,gb,a),g(s,Ob,b),g(s,Pb,b))}})})();(function(){function a(){Ca&&
(this._layer&&(d[this._id]=1),delete f[this._id])}function b(){this.loaded=1;if((Da||Ka)&&!--h)Da=Ka=!1;g||(g=o(w,500))}function c(a){if(!(a in this))f[a].onload=null,f[a].src=aa,delete f[a]}var d={},f={},e={},g=0,h=0;o(function(){Ca&&(Na||sa.gc())},/iP(?:ad|od|hone)/.test(F)?1E4:wc);sa={gc:function(){Aa.call(gc(f),c,e)},add:function(c,g,i,o,p,j){var t=f[c];e[c]=1;if(!t&&(s.tracking||!Na)){if(j){if(!(c in d))t=f[c]=new Image,t.src=j,t._layer=!0}else t=f[c]=ab.create(S,(g%za+za)%za,(i%za+za)%za);if(t)t.onload=
b,t.onerror=a,t._id=c}else t&&t.loaded?t.complete&&G.drawImage(t,o,p):((!Ca||!Da&&!Ka)&&j!=c&&$.complete&&G.drawImage($,o,p),++h)},clear:function(){h=0;e={}}}})();v(s,"toJSON",{value:function(a){a={_:a};a[ca]=s[ca];a[Qa]=s[Qa];a[Pa]=s[Pa];return a}});Zb=function(a){a=t(H(a,ta),Ha);if(S!=a){var b=Ra&&s[ca];Ra&&(s.scale=da(2,a-S));Da=!1;Ka=!0;16<a?(Ab=xc,Bb=8):(Ab=Wb,Bb=5);V=O<<a;za=1<<a;j(s,hc,{oldValue:S,newValue:a});S=a;Z();Ca&&sa.gc();Yb();s.route=s.route;va=1;y(b)}else va=1};v(s,Qa,{get:function(){return S},
set:function(a){Zb(a)}});Lb(s,{MAX_ZOOM_LEVEL:{get:function(){return ta},set:function(a){ta=null==a?yc:a}},MIN_ZOOM_LEVEL:{get:function(){return Ha},set:function(a){Ha=null==a?zc:a}}});var O=256;(function(){function a(b){f(s,b,this)}function b(a){c(s,a,this)}function d(a,b){[ic,jc,Ob,kc,lc,hc,cc,Pb,mc,ec,fc,gb,sb,tb,Nb,Mb].forEach(a,b)}var e=[],g=[],h;v(s,"addNotifications",{value:function(b){h=e.indexOf(b);0>h&&(h=e.push(b)-1,d(a,g[h]={handleEvent:function(a){j(b,a.type,a.data)}}))}});v(s,"dropNotifications",
{value:function(a){h=e.indexOf(a);-1<h&&(d(b,g[h]),e.splice(h,1),g.splice(h,1))}})})();b(cb,function(){function a(b,c){var d=s.geoToPoint(s.center),f=s.size;return s.pointToGeo({x:d.x-f.width/2+b,y:d.y-f.height/2+c})}function b(c,d){e();j(s,lc,a(c,d))}function c(){db&&(x(db),La=pa,Ma=qa,db=0,++s.zoom)}function f(a,b){if(2===t(s.scale+0.1,2))s.scale+=0.1,db=q(f,30,a,b);else{s.scale=2;var d=G.drawImage,e=G.clearRect,g=G.drawCircle,h=G.lineTo;G.drawImage=G.clearRect=G.drawCircle=G.lineTo=J;c();s.move(a,
b);G.drawImage=d;G.clearRect=e;G.drawCircle=g;G.lineTo=h}}function e(){x(y);y=0}function g(a,b){e();b.length&&j(s,Ac,b);if(a.length){if(!a[0].privileged_)a:{for(var c=0,d=a.length,f;d--;){f=a[d];if(f.privileged_){a.splice(d,1);a.unshift(f);f.privileged=1;break a}if("privilegeLevel"in f&&(!("privilegeLevel"in a[c])||f.privilegeLevel>a[c].privilegeLevel))c=d}0<c&&a.unshift(a.splice(c,1)[0])}j(s,ic,a)}}function h(a){if(!M&&(A(a),!Na&&!(ub<X(L-U)||ub<X(da-ha)))){vb(a);var c=(W||a.pageX)-ya.x,a=(jb||a.pageY)-
ya.y,d=Jb(c,a),i;i=c;var o=a;if(Ga){var p=ja(s[ca],V);p.x+=i-pa+n;p.y+=o-qa+K;i=Fb.call(Ia[S],tc,p).reverse()}else i=[];d.length||i.length?(e(),y=q(g,P,d,i)):y?(e(),ma.resetDefault(),j(s,Pb,ma),!ma.defaultPrevented&&s.zoom<ta&&(c-=pa-n,a-=qa-K,La+=c,Ma+=a,db=q(f,P,c,a))):(La=pa,Ma=qa,y=q(b,P,c,a))}}function i(a){w?(Oa=new u,vb(a),a=(a.touches||[a])[0],U=a.clientX,ha=a.clientY,B?s.move(yb=N-U,xb=ga-ha):B=(ub<X(L-U)||ub<X(da-ha))&&p(),N=U,ga=ha):(a=(a.touches||[a])[0],N=a.clientX,ga=a.clientY)}function o(){z(la=
0);j(s,kc,{})}function p(){E();Ka=Da=!1;ma.resetDefault();j(s,Ob,ma);return!ma.defaultPrevented}function z(a){L=U=N=yb=da=ha=ga=xb=0;return a}function Q(){return 100>new u-Oa&&z(F.kick(N,ga,yb,xb))}function I(){Na=0}function D(){Ea=0;w=1}function E(){x($);$=0}function Y(){E();M=1;j(s,mc,a(W-ya.x,jb-ya.y))}function H(){1!==R&&(s.scale=R);aa=q(H,20)}var P=250,A=ib?function(a){a.pageX=a.clientX+m.scrollLeft;a.pageY=a.clientY+m.scrollTop}:J,F=d(function(){Na=1},function(a,b){s.move(a,b)},function(){Na=
0;ia(oa,ra);o()}),y=0,$=0,w=1,B=1,M=0,aa=0,L,da,N,ga,U,ha,W,jb,yb,xb,Oa,R;v(s,"moveTo",{value:function(a){var a=ja(a,V),b=a.x-oa-l,a=a.y-ra-C;p()&&F.kick(b+pa,a+qa,b/9,a/9)}});return{init:function(a){"mouse"==a&&(w=0)},mouse:{down:function(a){A(a);$=q(Y,800);c();F.stop();vb(a);Oa=M=0;L=N=U=a.clientX;da=ga=ha=a.clientY;W=a.pageX;jb=a.pageY;w=1;B=0},move:function(a){A(a);w&&(B||(B=p()));i(a);w||(a=Jb(a.pageX-ya.x,a.pageY-ya.y),a.length&&j(s,jc,a))},up:function(a){E();N!=L||ga!=da?Q()||o():w&&q(I,50)&&
h(a);w=0},wheel:function(a){var b=0>(a.detail||a.wheelDelta)?1:-1;na.call(a,"wheelDelta")||oc&&(b*=-1);s.zoom-=b}},touch:{start:function(a){var b=a.touches,d=b.length;vb(a);if(!(1<d)&&($=q(Y,800),c(),Oa=M=0,w))F.stop(),B=0,w=2>d,a=b[0],L=N=U=a.clientX,da=ga=ha=a.clientY,W=a.pageX,jb=a.pageY},move:function(a){i(a)},end:function(a){var b=a.touches;$&&E();w?B?Q()||o():(Na=0,h(a)):(w=!Ea&&2>b.length)&&ia(oa,ra)}},gesture:{start:function(){E();F.stop(I());Ea=1;xa(w=B=0);H(R=1)},change:function(a){R=a.scale},
end:function(){clearInterval(aa);s.zoom+=0.9>R?-(0.1>R?3:0.5>R?2:1):1.1<R?3<R?3:2<R?2:1:0;q(D,33)}},click:h}}(s));ib&&(s=ga($b+ac++,s)());s.tileServer=null;s.size=[h||e.offsetWidth,z||e.offsetHeight];s.zoom=12;s.schema="normal.day";return s}var h=nokia.mh5.event,f=h.add,c=h.remove,j=h.fire,i=g.document,m=i.documentElement,l=g.escape,n=g.unescape,o=g.setInterval,q=g.setTimeout,x=g.clearTimeout,C=g.isNaN,E=g.navigator,F=E.userAgent,y=g.Array,B=g.Object,v=B.defineProperty,w={}.__defineGetter__,A={}.__defineSetter__,
u=g.Date,z=g.Function,J=z(),K=g.JSON,I=g.Math,H=I.min,t=I.max,p=I.log,Q=I.atan,Y=I.exp,D=I.sqrt,da=I.pow,L=I.tan,W=I.round,U=I.ceil,X=I.abs,M=I.PI,N=M/2,R=M/4,ka=180/M,Z=2*M,P=function(a){return typeof a==Qb},$=new Image,aa,ga,ha,ia=!!i.createElement("canvas").getContext,wa=!!v,Va=!!w&&!!A,oc=!+"\u000b1",ib;if(wa)try{if(!v({},"_",{value:1})._)throw wa;}catch(nc){wa=!wa}ib=!(wa||Va);var $b="Gaia_",Qb="number",Oa="string";(new u).getFullYear();var Ta=ia?"addEventListener":"attachEvent",fa="latitude",
ea="longitude",ta=20,Ha=3,yc=ta,zc=Ha,ic="poiclick",jc="poiover",Ac="shapeclick",vc="position-available",Ob="mapmovestart",kc="mapmoveend",lc="mapclick",hc="mapzoomchange",cc="mapscalechange",Pb="mapdblclick",mc="maplongpress",ec="maptrackingstart",fc="maptrackingend",ca="center",Qa="zoom",Pa="schema",Kb="accuracy",gb="positionchange",sb="positionlost",tb="positionerror",Nb="positionactivate",Mb="positiondeactivate",xc="rgba(102,17,68,0.55)",Wb="rgba(102,17,68,0.69)",qc=(ia?"":"on")+"mousewheel",
rc="DOMMouseScroll",Wa="touchstart",Xa="touchmove",Ya="touchend",Rb="gesturestart",Ea="gesturechange",xa="gestureend",wc=6E4,ub=9,dc="normal.day";wa||(v=Va?function(a,b,c){na.call(c,"value")?a[b]=c.value:(na.call(c,"get")&&w.call(a,b,c.get),na.call(c,"set")&&A.call(a,b,c.set));return a}:function(a,b,c){a[b]=c;return a});var Lb=B.defineProperties||function(a,b){for(var c=gc(b),d=c.length,f;d--;)na.call(b,f=c[d])&&v(a,f,b[f])},gc=B.keys||function(a){var b=[],c=0,d;for(d in a)na.call(a,d)&&(b[c++]=d);
return b},wb=B.prototype,na=wb.hasOwnProperty,hb=wb.toString,Bc=hb.call([]),bc=y.isArray||function(a){return hb.call(a)==Bc},Ua=y.prototype,Fb=Ua.filter||function(a,b){for(var c=[],d=0;d<this.length;++d)a.call(b,this[d],d,this)&&c.push(this[d]);return c},Aa=Ua.forEach||function(a,b){for(var c=0;c<this.length;++c)a.call(b,this[c],c,this)},rb=Ua.indexOf||function(a){for(var b=this.length;b--&&this[b]!==a;);return b},Cc=Ua.slice,Vb=g.Int32Array||y;q(function(a){if(!a){var b=q,c=o,d=function(a,b,c,d){d=
Cc.call(d,2);return a(function(){b.apply(this,d)},c)};q=function(a,c){return d(b,a,c,arguments)};o=function(a,b){return d(c,a,b,arguments)}}},0,1);var vb=ia?function(a){a.preventDefault()}:function(a){(a||g.event).returnValue=!1};"on"+xa in i||Ta in i&&function(){function a(c,d,e){n=i.createEvent("Event");n.initEvent(e,f,f);n.scale=e==Ea?z=b(d)/t:e==xa?z:1;(c.target||i).dispatchEvent(n)}function b(a){j=a[0];K=j[c];l=j[d];j=a[a.length-1];q=j[c];m=j[d];return D(da(m-l,2)+da(q-K,2))}if(!i["_on"+xa]){var c=
"screenX",d="screenY",f=!0,e=!1,h=!1,o,p,j,t,z,n,K,q,l,m;g.navigator.msPointerEnabled&&function(a){function b(a,c,d){o=i.createEvent("Event");o.initEvent(d,f,f);o.touches=c;o.isTouch=!0;(a.target||i).dispatchEvent(o)}function c(a,f){g=a.pointerId;h=d[g];if(void 0!==h){e.splice(h,1);delete d[g];for(var i in d)d.hasOwnProperty(i)&&d[i]>h&&d[i]--;f&&b(a,e,Ya)}}var d={},e=[],g,h,o;nokia.mh5.event.add(a,"MSPointerDown",function(a){g=a.pointerId;if(void 0===d[g])d[g]=e.length,e[e.length]=a,b(a,e,Wa)});
nokia.mh5.event.add(a,"MSPointerMove",function(a){g=a.pointerId;void 0!==d[g]&&(e[d[g]]=a,b(a,e,Xa))});nokia.mh5.event.add(a,"MSPointerUp",function(a){c(a,!0)});nokia.mh5.event.add(a,"MSPointerCancel",function(a){c(a,!1)})}(i);i[Ta](Wa,function(c){c.target instanceof HTMLCanvasElement&&c.preventDefault();o=e;p=c.touches||[];e=1<p.length;e!=o&&(h=f,t=b(p),a(c,p,"gesturestart"))},f);i[Ta](Xa,function(b){e&&b.preventDefault();e&&!h&&a(b,b.touches||[],Ea);h=!1},f);i[Ta](Ya,function(b){p=b.touches||[];
e&&2>p.length&&(e=!1,a(b,p,xa))},f);i["_on"+xa]=f}}();var uc=function(){var a=K.stringify,b=K.parse,c=g.localStorage,d=0;return function(){var f={get:function(a){var c=""+i.cookie,d=c.indexOf((a=l(e+a))+"=");return~d?b(n(c.slice(d+a.length+1).split(";")[0])):null},set:function(b,c){var d=new u;d.setFullYear(d.getFullYear()+1);i.cookie="".concat(l(e+b),"=",l(a(c)),";","expires=",d.toGMTString())}},e=++d+"html5-map-";return{get:c?function(a){var d=c.getItem(e+a);try{return null===d?f.get(a):b(d)}catch(g){return null}}:
f.get,set:c?function(b,d){try{c.setItem(e+b,a(d))}catch(g){f.set(b,d)}}:f.set}}}();ia&&(ha=function(){function a(b,c,d){this.beginPath();this.arc(b,c,d,0,Z);this.fill()}return function(){var b=i.createElement("canvas"),c=b.getContext("2d");c.clear=J;c.drawCircle=a;return b}}());var ac=0;e.MAX_ZOOM_LEVEL=ta;e.MIN_ZOOM_LEVEL=Ha;return e}(this);nokia.mh5.provide("nokia.mh5.internals.CartoPOI");
nokia.mh5.internals.CartoPOI=nokia.mh5.Class(function(){function g(){if(this._timeout)clearTimeout(this._timeout),this._timeout=0}function a(a){var b;a.placeId=a.id;delete a.id;if(a.placeId&&!(a.placeId in this._cache)&&(a={categoryGroup:l(a.category),placeId:a.placeId,cartopoi:!0,latitude:a.lat,longitude:a.lon,name:a.location_name,categories:[{id:a.category,cartopoi:!0}],properties:{cartopoi:!0,placeId:a.placeId,priority:a.priority,title:a.location_name,geoLatitude:a.lat,geoLongitude:a.lon}},this._cache[a.placeId]=
1,b=l(a.categories[0].id)))a=this._map.createPoi(nokia.mh5.assetsPath+"img/mapsymbols/carto_POI_"+b+".png",a),a.zIndex=-1,this._draw.push(a)}function b(){this.parentNode&&this.parentNode.removeChild(this)}function d(){this._map.removePoi(this._drawn);this._poi={};this._cache={};this._drawn=[]}function e(a,b){a._zoomtimeout=0;if(b!==a._zoom)a._clearTimeout(),a._zoom=b,d.call(a),14<b&&(a._timeout=setTimeout(a._boundmove,1E3))}function h(){for(var a=this._wrapper,b=this._wrapper.infoBubbles,c,d=0,f=
b.length;d<f;d++)c=b[d],c.poi.data.cartopoi&&a.hideInfoBubble(c)}function f(a,b,c,d){14<d&&(this._poi[(d-3>>0)+"/"+(a/8>>0)+"/"+(b/8>>0)]=1)}function c(a){clearTimeout(this._zoomtimeout);this._zoomtimeout=setTimeout(e,1,this,a.data.newValue)}function j(){var c=nokia.mh5.doc,d=this,f=d._poi,e=[],g=[],h=0,i,j,l;if(m.onLine)for(j in f)++h,i=c.body.appendChild(c.createElement("script")),i.src="http://b.heatmaps.maps.svc.ovi.com/heatmaps/v2/mapsymbols.default/"+j+"/1024/jsonp?"+d._apiTrackingParams,i.onload=
i.onerror=b;if(h)l=function(){if(!--h){for(j in f)e=e.concat(f[j]);e.forEach(a,{_cache:d._cache,_map:d._map,_draw:g});d._drawn=d._drawn.concat(g)}},mapsymbols.callback=function(a,b){f[a]=b;l()};this._poi={};this._clearTimeout()}if(!("mapsymbols"in window))window.mapsymbols={};var i=nokia.mh5.event,m=nokia.mh5.win.navigator,l=nokia.mh5.utils.place.categoryIdentifier;return{constructor:function(a,b,e){var l=this;l._active=!1;l._bound=f.bind(l);l._boundmove=j.bind(l);l._boundzoom=c.bind(l);l._boundHideInfoBubble=
h.bind(l);l._boundCleanPois=d.bind(l);l._clearTimeout=g.bind(l);l._poi={};l._cache={};l._drawn=[];l._map=b;l._wrapper=a;l._zoom=0;l._timeout=0;l._zoomtimeout=0;var m=function(){l._apiTrackingParams=nokia.mh5.utils.formatURLParams({app_id:e.appId,app_code:e.appCode,xnlp:nokia.mh5.utils.getApiSession().id})};m();i.add(nokia.mh5,"newapisession",function(){m()})},activate:function(){if(!this._active){var a=this._map,b=[].concat(a.layer||[]);b.push(this._bound);a.layer=b;i.add(a,"mapscalechange",this._boundHideInfoBubble);
i.add(a,"mapscalechange",this._boundCleanPois);i.add(a,"mapzoomchange",this._boundzoom);i.add(a,"mapmoveend",this._boundmove);i.add(a,"mapmovestart",this._clearTimeout);this._boundzoom({data:{newValue:a.zoom}});this._active=!0}},deactivate:function(){if(this._active){var a=this._map,b=[].concat(a.layer);b.splice(b.indexOf(this._bound),1);a.removePoi(this._drawn);a.layer=b;i.remove(a,"mapscalechange",this._boundHideInfoBubble);i.remove(a,"mapscalechange",this._boundCleanPois);i.remove(a,"mapzoomchange",
this._boundzoom);i.remove(a,"mapmoveend",this._boundmove);i.remove(a,"mapmovestart",this._clearTimeout);e(this,0);this._active=!1}}}});nokia.mh5.provide("nokia.mh5.internals.SQLTileServer");
nokia.mh5.internals.SQLTileServer=nokia.mh5.Class(function(){function g(b,d,f,g,h){function p(){H=n.started=!1}function o(a){D.type=a;(n[x]||e).call(n,D)}function j(a,b){if(H)p(),D.message=(b||a).message,o("error"),t(),nokia.mh5.maps.analytics.log({gn:"map:download",c32:"map download failed",ev:"event33"})}function t(){H=null;n.started=!1;o("loadend")}function z(){n.started=!0;if(!H&&n.dbCreated){H=!H;for(var a=0;a<Q&&b.length;a++)q(b.pop())}}function l(b){Y=0;a(function(){n.dbCreated=!0;H&&(p(),
o("abort"),t(),nokia.mh5.maps.analytics.log({gn:"map:download",c32:"map download canceled by user",ev:"event34"}));b&&b()})}function m(){o("load");t();nokia.mh5.maps.analytics.log({gn:"map:download",c32:"map download completed",ev:"event35"})}function q(a){function e(g){i(l,J,function(e){function h(){x-=1;if(!x){n.downloaded+=Q;if(H)n.current+=p*p,n.estimated=n.downloaded/n.current*n.total,o("progress"),Y+=1,Y==E&&c(U,K,{p1x:d[0].latitude,p1y:d[0].longitude,p2x:d[1].latitude,p2y:d[1].longitude,minZoom:C,
maxZoom:I,schema:f},m,j);H&&b.length&&q(b.pop())}}z=a.z;g.forEach(function(b,d){I=Math.max(z,I);C=Math.min(z,C||I);var f={z:z,x:a.x+d%p,y:a.y+Math.floor(d/p),base64:b};if("idb"===N)f.id=[f.x,f.y,f.z].join(";");c(l,J,f,h,j,e);x+=1})})}var p=a.size,t,z,l=W?M:X,Q=0,x=0;nokia.mh5.jsonp("http://maps.nlp.nokia.com/maptile/2.1/maptile/newest/normal.day/"+a.z+"/"+a.x+"/"+a.y+"/256/png8?"+g+"&output=base64&range="+p+"x"+p+"&xnlp="+h+"&callback_func",function(c){if(c.error)return b.push(a),j(null,{message:c.error});
if(H){for(t=c.length;t--;Q+=c[t].length);e(c)}else b.push(a)})}var n=this,Q=3,C=0,I=0,D={data:n},E=b.length,Y=0,H;n.total=b.reduce(function(a,b){return a+b.size*b.size},0);n.current=0;n.downloaded=0;n.dbCreated=n.started=!1;n.stop=l;n.start=function(){null==H?l(z):z();nokia.mh5.maps.analytics.log({gn:"map:download",c32:"map download started",v32:"~c32",ev:"event32",c33:"lat0:"+d[0].latitude+",lon0:"+d[0].longitude+",lat1:"+d[1].latitude+",lon1:"+d[1].longitude,v33:"~c33"})};n.pause=p;n.resume=z;n[x]=
null}function a(a){a=a||e;b(function(){d(a)})}function b(a){a=a||e;i(U,K,function(b){if("sql"===N)q(b,E+K,[],function(){h(a)},e);else{var c=b.objectStore(K);c.openCursor().onsuccess=function(b){(b=b.target.result)?(c["delete"](b.key),b["continue"]()):a()}}})}function d(a){a=a||e;i(X,J,function(b){if("sql"===N)q(b,E+J,[],function(){l(a)},e);else{var c=b.objectStore(J);c.openCursor().onsuccess=function(b){(b=b.target.result)?(c["delete"](b.key),b["continue"]()):a()}}})}function e(){}function h(a){a=
a||e;"sql"===N?i(U,K,function(b){q(b,C+K+" ("+F+" "+z+", "+y+" "+z+", "+B+" "+z+", "+v+" "+z+", "+w+" "+z+", "+A+" "+z+", schema TEXT NOT NULL)",[],a,e)}):(M.createObjectStore(K,{autoIncrement:!0}),a())}function f(a){!X&&!W&&m(p,Q,Y,D,function(b){X=b;l(a)})}function c(a,b,c,d,f,e){if("sql"===N){var g=function(a){for(var e=Object.keys(c),g=[],h=[],i=0,p=e.length;i<p;i++)g.push("?"),h.push(c[e[i]]);q(a,"INSERT INTO "+b+" VALUES ("+g.join(",")+")",h,d,f)};e?g(e):i(a,b,g)}else a=(e||a.transaction([b],
"readwrite",0)).objectStore(b).put(c),a.onsuccess=d,a.onerror=f}function j(a,b,c,d){if("sql"===N)a[H](function(a){q(a,"SELECT * FROM "+b,[],function(a,b){d(b)})});else{var b=a.transaction([b]).objectStore(b),f=[];if(!c)b.openCursor().onsuccess=function(a){(a=a.target.result)?(f.push(a.value),a["continue"]()):d(f)}}}function i(a,b,c){if("sql"===N)a[I](c);else c(a[I]([b],"readwrite",0))}function m(a,b,c,d,f,e){"sql"===N?(e=window.openDatabase(a,b,c,d),f(e)):(a=R.open(a),a.onsuccess=function(a){f(a.target.result)},
a.onerror=e)}function l(a){a=a||e;"sql"===N?i(X,J,function(b){q(b,C+J+" (z "+u+", x "+u+", y "+u+", base64 TEXT)",[],a,e)}):(M.createObjectStore(J,{keyPath:"id"}),a())}function n(a){if(!L)throw"Web SQL not available";var b=this;b.settings=a||{};b.apiSessionId=nokia.mh5.utils.getApiSession().id;nokia.mh5.event.add(nokia.mh5,"newapisession",function(a){b.apiSessionId=a.data.id})}var o=function(a,b){o=a.item?function(a,b){return a.item(b)}:function(a,b){return a[b]};return o(a,b)},q=function(a,b,c,d,
f){a.executeSql(b,c,d,f)},x="onprogress",C="CREATE TABLE IF NOT EXISTS ",E="DROP TABLE ",F="tl_latitude",y="tl_longitude",B="br_latitude",v="br_longitude",w="MIN_ZOOM_LEVEL",A="MAX_ZOOM_LEVEL",u="INTEGER NOT NULL",z="TEXT NOT NULL",J="offline_tiles",K=J+"_bbox",I="transaction",H="readTransaction",t=window.openDatabase,p="m_nokia_maps",Q="1.0",Y="",D=47185920,da=52428800,L=!0,W=!nokia.mh5.platform.ios,U,X,M,N,R=window.indexedDB||window.mozIndexedDB;t?N="sql":R?N="idb":(N="none",L=!1);if("2.2"!=nokia.mh5.platform.android.version)if("undefined"!=
typeof PGSQLitePlugin)q=function(a,b,c,d,f){a.executeSql(c&&c.length?[b].concat(c):b,d,f)},W=!0,H=I,document.addEventListener("deviceready",function(){M=new PGSQLitePlugin(p+".sqlite3",function(){i(M,K,h);i(M,J,l)})},!1);else if(W)if(M=null,"sql"===N)for(;!M&&5242880<da;){try{M=U=X=t(p,Q,Y,da),M[I](h),M[I](l)}catch(ka){}da-=5242880}else{if("idb"===N)t=R.open(p,1),t.onsuccess=function(a){M=U=X=a.target.result;L=!0},t.onerror=function(){L=!1},t.onupgradeneeded=function(a){M=U=X=a.target.result;L=!0;
h();l()}}else try{m(p+"_flag",Q,Y,1024,function(a){U=a;i(a,K,h)})}catch(Z){L=!1}else L=!1;n.AVAILABLE=nokia.mh5.platform.offlineStorageSupported=L;g.prototype.onprogress=null;return{constructor:n,create:function(a,b,c){var d=this.settings,f=d.apiKey||"",e=new Image;apiSessionId=this.apiSessionId;tileLang=d.tileLang;if("sql"===N)X[H](function(g){q(g,"SELECT base64 FROM "+J+" WHERE z = ? AND x = ? AND y = ?",[a,b,c],function(g,h){var i=(h||g).rows;if(i.length)e.src="data:image/png;base64,"+o(i,0).base64;
else if(!d.offlineOnly)e.src="http://".concat(1+c%4,".maps.nlp.nokia.com","/maptile/2.1/","maptile","/newest/","normal.day","/",a,"/",b,"/",c,"/",256,"/png8?",f,"&",tileLang,"&","xnlp=",apiSessionId)})});else{var g=X.transaction([J]).objectStore(J).get([b,c,a].join(";"));g.onsuccess=function(){var h=g.result;if(h)e.src="data:image/png;base64,"+h.base64;else if(!d.offlineOnly)e.src="http://".concat(1+c%4,".maps.nlp.nokia.com","/maptile/2.1/","maptile","/newest/","normal.day","/",a,"/",b,"/",c,"/",
256,"/png8?",f,"&",tileLang,"&","xnlp=",apiSessionId)}}return e},getBoundingBox:function $(a){var b=W?M:U;b?j(b,K,null,function(b){"sql"===N?(b=b.rows,b.length?(f(),b=o(b,0),a([{latitude:1*b[F],longitude:1*b[y]},{latitude:1*b[B],longitude:1*b[v]}],1*b.MIN_ZOOM_LEVEL,1*b.MAX_ZOOM_LEVEL,b.schema)):a(null)):b[0]&&(b=b[0],a([{latitude:b.p1x,longitude:b.p1y},{latitude:b.p2x,longitude:b.p2y}],b.minZoom,b.maxZoom,b.schema))}):setTimeout($,100,a)},storeBoundingBox:function(a,b){if(!b)b=a.bbox;var c=new g(a.areaToTiles(b),
b,a.schema,this.settings.apiKey,this.apiSessionId);f(c);return c},removeBoundingBox:function(){a()}}});nokia.mh5.provide("nokia.mh5.components.Map");
nokia.mh5.components.Map=new nokia.mh5.Class(nokia.mh5.ui.Container,function(g){var a=nokia.mh5.i18n,b=nokia.mh5.event,d=nokia.mh5.platform,e=nokia.mh5.ui.Button,h=nokia.mh5.ui.Control,f=nokia.mh5.internals,c=3,j=function(){return"ongestureend"in nokia.mh5.doc||d.android_webview||d.ie||d.n9},i=nokia.mh5.win.setTimeout,m=nokia.mh5.win.clearTimeout,l=nokia.mh5.win.clearInterval,n=nokia.mh5.win.setInterval;return{children:["zoomButtons","positionButton","settingsButton","mapLogo"],cssClass:"mh5_Map mh5_hwacc_viewer",
statics:{MAX_ZOOM_LEVEL:f.Map.MAX_ZOOM_LEVEL,MIN_ZOOM_LEVEL:f.Map.MIN_ZOOM_LEVEL},passive:!1,zoomButtons:{control:nokia.mh5.ui.Container,children:["zoomin","zoomout"],visible:!j(),cssClass:"mh5_zoom",layout:new nokia.mh5.ui.RowLayout,zoomin:{control:e,cssClass:"mh5_Button mh5_zoomIn",onClick:function(){var a=this.parent.intervalId,b=this.parent.parent._map;"number"===typeof a&&l(a);if(b.zoom<b.MAX_ZOOM_LEVEL)a=this.parent.intervalId=n(function(){1.9>b.scale?b.scale+=0.09:(l(a),a=void 0,b.zoom++)}.bind(this),
33)}},zoomout:{control:e,cssClass:"mh5_Button mh5_zoomOut",onClick:function(){var a=this.parent.intervalId,b=this.parent.parent._map;"number"===typeof a&&l(a);if(b.zoom>b.MIN_ZOOM_LEVEL)a=this.parent.intervalId=n(function(){0.5<b.scale?b.scale-=0.05:(l(a),a=void 0,b.zoom--)}.bind(this),33)}}},positionButton:{control:e,cssClass:"mh5_Button position missing",onClick:function(){var a=this.parent._map;"available"===this.parent.positionStatus?a.tracking=!a.tracking:this.parent.initPositioning("buttonClicked")}},
settingsButton:{control:e,cssClass:"mh5_Button settings",onClick:function(){var a=this.parent,b=new nokia.mh5.ui.SettingsDialog({traffic:a.traffic,visibleDidChange:function(b){a.passive=b;this.constructor.prototype.visibleDidChange.apply(this,arguments)}},a);b.build();b.prepareBindings();b.prepareDidChangeNotifications()}},mapLogo:{control:h,cssClass:"mh5_mapLogo",innerHTML:'<div class="logo"></div><a>'+a("mapTermsOfUse")+"</a>",onClick:function(){nokia.mh5.maps&&nokia.mh5.maps.Application?nokia.mh5.app.controller.switchTo("nokia.mh5.maps.AboutPage"+
(d.android_webview||d.ios_webview?"Native":""),null,{intoView:".terms"}):nokia.mh5.win.open("http://m.here.com/tnc.html","_blank")}},infoBubbleParams:void 0,positionStatus:"uninitialized",isReady:!1,addressLookup:!0,dontBind:!0,initPositioning:function(a){var b=this,d=b._map,f=nokia.mh5.utils.getLocalStorageValue("mh5-isFirstTime");if(!this.passive&&"buttonClicked"!==a&&("uninitialized"===this.positionStatus||"unavailable"===this.positionStatus)){if(f&&JSON.parse(f))a={app_id:this.appId,app_code:this.appCode,
xnlp:nokia.mh5.utils.getApiSession().id},this._ipLookupRequest=nokia.mh5.jsonp("http://here.com/services/iplookup/get?"+nokia.mh5.utils.formatURLParams(a)+"&NORD&callback",function(a){delete this._ipLookupRequest;if("available"!==b.positionStatus&&!a.error&&!a.errors&&a.location)d.zoom=6,d.moveTo(a.location)});this.positionStatus="requesting";d.position.activate(function(a){this.positionStatus="available";if(this.moveToUserPosition)d.zoom=d.MAX_ZOOM_LEVEL-4,d.moveTo(a)}.bind(this),function(a){this.positionStatus=
1===a.code?"denied":"unavailable";if(!d.center||!d.center.longitude||!d.center.latitude)d.zoom=c}.bind(this))}},positionStatusDidChange:function(a){var b=this.positionButton&&this.positionButton.root;if(b)if("available"===a)nokia.mh5.dom.removeClass(b,"missing"),nokia.mh5.dom.addClass(b,"available");else if("unavailable"===a)nokia.mh5.dom.addClass(b,"missing"),nokia.mh5.dom.removeClass(b,"available"),this._map.tracking=!1;if(this.onPositionStatusChange)this.onPositionStatusChange(a)},_onPositionLost:function(){this.positionStatus=
"unavailable"},_setupMap:function(){var a=this.root,c=this._map;c.tileLang=nokia.mh5.l10n.tileLanguageMap[d.language.substr(0,2)];c.offset=function(a){var b=0,c=0;do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{top:c,left:b}}(a);c.size={width:a.offsetWidth,height:a.offsetHeight};Object.defineProperty(this,"pois",{set:function(a){var b=this.getPois();0<b.length&&this.removePoi(b);if(a&&0<a.length)for(var b=0,c=a.length;b<c;b++)this.createPoi(a[b].mapIcon||nokia.mh5.utils.place.getCategoryIcon(a[b]),
a[b])},get:function(){return this.getPois()}});h.watch(nokia.mh5.components.settings.current,"mapSchema",this,function(a){if(this.schema!==a)this.schema=a});this._onMapLongPress=this._onMapLongPress.bind(this);this._onPoiClick=this._onPoiClick.bind(this);this._onPositionLost=this._onPositionLost.bind(this);(a=this.listeners)&&nokia.mh5.each(a,function(a,d){b.add("ready"===d?this:c,d,a.bind(this))},this);b.add(c,"mapmoveend",c.save);b.add(c,"mapclick",function(a){a.defaultPrevented||this.hideInfoBubble()}.bind(this));
b.add(c,"maplongpress",this._onMapLongPress);b.add(c,"poiclick",this._onPoiClick);b.add(c,"positionlost",this._onPositionLost)},passiveDidChange:function(a){this.zoomButtons.visible=!j()&&!a;this.positionButton&&(this.positionButton.visible=!a);this.settingsButton&&(this.settingsButton.visible=!a);nokia.mh5.dom[a?"addClass":"removeClass"](this.root,"mh5_passive");if(d.android_webview)!a&&this.visible?nokia.mh5.components.Map.active=this:a&&delete nokia.mh5.components.Map.active},_onSchemaChange:function(a){var b=
this._map,c=this._server;if(c&&"normal.day"===a)try{c.getBoundingBox(function(a){if(null!==a)b.tileServer=c})}catch(d){}else b.tileServer=null;if(nokia.mh5.components.settings.current.mapSchema!==a)nokia.mh5.components.settings.current.mapSchema=a},_prepareAPI:function(){function a(c,d,f){var e={get:function(){return b[d]}};if(f)e.set=function(a){b[d]=a;"schema"===d&&c._onSchemaChange(a)};f=c[d];Object.defineProperty(c,d,e);f&&(c[d]=f)}var b=this._map;a(this,"position");a(this,"route",!0);a(this,
"center",!0);a(this,"box",!0);a(this,"offset",!0);a(this,"geometry",!0);a(this,"schema",!0);a(this,"size",!0);a(this,"zoom",!0);a(this,"tracking",!0);a(this,"apiKey",!0);a(this,"tileServer",!0);a(this,"shape",!0);this.moveTo=b.moveTo;this.geoToPoint=b.geoToPoint;this.pointToGeo=b.pointToGeo;this.save=b.save;this.restore=b.restore;this.move=b.move},createPoi:function(a,b){var c=this._map.createPoi(a,b);if(b.placeId)c.placeId=b.placeId;if(b.href)c.href=b.href;this._pois.push(c);return c},removePoi:function(a){this._map.removePoi(a);
if(a)for(var a=[].concat(a),b=0,c;b<a.length;b++)c=this._pois.indexOf(a[b]),~c&&this._pois.splice(c,1);else this._pois=[]},addPoi:function(a){this._map.addPoi(a);this._pois=this._pois.concat(a)},getPois:function(a,b){if(a){var c=this.comparePOIs,d=this._pois.filter(function(b){return c(b,a)});return a.placeId||b?d[0]:d}return this._pois},_onPoiClick:function(a){var b=a.data[0];b.infoBubble?(a=b.image,nokia.mh5.event.fire(a,"down",{offsetX:b.clickedPoint.x+a.width/2,offsetY:b.clickedPoint.y+a.height/
2})):a.defaultPrevented||(b.isPosition?this.addressLookup&&(this.hideInfoBubble(),this._triggerReverseGeoCoding(b)):b.data.name?(this.hideInfoBubble(),this.showInfoBubble(b)):this._triggerReverseGeoCoding(b))},_onMapLongPress:function(a){if(this.addressLookup&&!a.defaultPrevented)this.hideInfoBubble(),a.data.renderOnly=!0,this._triggerReverseGeoCoding(a.data)},_triggerReverseGeoCoding:function(a){var b=this,c=nokia.mh5.adapters.Search,d=a.data||a,f;c.reverseGeoCode(d,{appId:this.appId,appCode:this.appCode},
function(e){d.renderOnly&&(f=b.infoBubbleParams?nokia.mh5.extend({renderOnly:!0},b.infoBubbleParams):{content:["title"],maxWidth:245,renderOnly:!0},delete d.renderOnly);c.merge(d,e);b.hideInfoBubble();b.showInfoBubble(a,f)})},constructor:function(e,h){var o;this.getPoi=this.getPois;this.infoBubbles=[];this._pois=[];this._layer={};this.resize=this.resize.bind(this);this._orientationOrResizeHappened=0;var j,l;if(e){if(e.listeners)j=e.listeners,delete e.listeners;if(e.infobubble||e.infoBubble){if(e.infobubble)e.infoBubble=
e.infobubble;this.infoBubbleParams=e.infoBubble;delete e.infoBubble}}g.constructor.call(this,e,h);this.appId=this.appId||nokia.mh5.appId;this.appCode=this.appCode||nokia.mh5.appCode;if(!this.appId||!this.appCode)throw Error(a("Error.applicationCredential"));if(j)this.listeners=e.listeners=j;j=this.root;d.android&&nokia.mh5.dom.addEvent(j,"mousemove",function(a){a.stopPropagation();a.preventDefault()},!0);o=this._map=new f.Map(j,j.offsetWidth||10,j.offsetHeight||10),j=o;var n={appId:this.appId,appCode:this.appCode};
j.apiKey=n;j.tileLang=nokia.mh5.l10n.tileLanguageMap[nokia.mh5.i18n.language.substr(0,2)];this._cartoPOI=new f.CartoPOI(this,j,n);d.offlineStorageSupported&&(this._server=new f.SQLTileServer({apiKey:j.apiKey,tileLang:j.tileLang}));c=this._map.MIN_ZOOM_LEVEL;(!e||null==e.suggestions||e.suggestions)&&!this.passive&&this._cartoPOI.activate();this.prepareBindings();this.prepareDidChangeNotifications();if(!j.restore())j.center={latitude:52.52081,longitude:13.38855},j.zoom=c,this.moveToUserPosition=e&&
e.hasOwnProperty("moveToUserPosition")?!!e.moveToUserPosition:!0;if(l=this.positionButton)b.add(j,"maptrackingstart",function(){nokia.mh5.dom.addClass(l.root,"tracking")}),b.add(j,"maptrackingend",function(){nokia.mh5.dom.removeClass(l.root,"tracking")});this._prepareAPI();i(function(){this._setupMap();this.initPositioning()}.bind(this),0)},resize:function(){m(this._orientationOrResizeHappened);this._orientationOrResizeHappened=i(function(){var a=this.root,c=a.offsetWidth,a=a.offsetHeight;this._orientationOrResizeHappened=
0;if(c&&a){if(c!==this._map.size.width||a!==this._map.size.height)this._map.size={width:c,height:a};if(!this.isReady)this.isReady=!0,b.fire(this,"ready")}}.bind(this),d.hideAddressBar.DELAY+50)},visibleDidChange:function(a){g.visibleDidChange.call(this,a);if(a){if(nokia.mh5.dom.addEvent(nokia.mh5.win,"viewportchange",this.resize,!1),this.resize(),d.android_webview&&!this.passive)nokia.mh5.components.Map.active=this}else nokia.mh5.dom.removeEvent(nokia.mh5.win,"viewportchange",this.resize,!1),d.android_webview&&
nokia.mh5.components.Map.active===this&&delete nokia.mh5.components.Map.active},showInfoBubble:function(a,b){b=b||this.infoBubbleParams||{content:["title"],maxWidth:245};if(!a.infoBubble){if(!b.listeners&&this.infoBubbleParams&&this.infoBubbleParams.listeners)b.listeners=this.infoBubbleParams.listeners;a.infoBubble=!0;var c=this._map,d=this,f;d._infoBubbleAnimationTimerId&&(l(d._infoBubbleAnimationTimerId),delete d._infoBubbleAnimationTimerId);b.maxWidth=Math.max(d._map.size.width-50,245);if(!b.parent)b.parent=
d;a.image?a.originalImage=a.image:(f=c.createPoi(nokia.mh5.doc.createElement("CANVAS"),a),f.locationX=a.locationX,f.locationY=a.locationY,f.infoBubble=!0,delete f.data.infoBubble,a=f);f=new nokia.mh5.components.InfoBubble(a.data,b,function y(f){if(a.infoBubble)20>c.size.width?i(function(){y(f)},5):(a.image=f,"privilegeLevel"in b?a.privilegeLevel=b.privilegeLevel:a.privileged=!0,a.scale=0.7,d._infoBubbleAnimationTimerId=n(function(a){a.scale+=0.2;if(0.9<a.scale&&(l(d._infoBubbleAnimationTimerId),delete d._infoBubbleAnimationTimerId,
a.scale=1,!b.renderOnly)){var e=c.geoToPoint(c.center),g=c.geoToPoint(a),h=e.x,a=e.y,i=g.x,g=g.y,j=c.size,n=j.width/2,m=f.width/2,o=h+n,h=h-n,n=i-m,i=i+m;n<h?e.x-=h+16-n:o<i&&(e.x+=i+16-o);n=j.height/2;m=f.height;o=a+n;h=a-n;n=g-m;i=g+m;n<h?e.y-=h+16-n:o<i&&(e.y+=i+16-o);c.moveTo(c.pointToGeo(e))}},40,a))});f.poi=a;d.infoBubbles.push(f)}},hideInfoBubble:function(a){var b;if(a)Array.isArray(a)||(a=[a]);else{if(0===this.infoBubbles.length)return;a=this.infoBubbles;this.infoBubbles=[]}for(var c=0,d=
a.length;c<d;c++)b=a[c],this.infoBubbles.splice(this.infoBubbles.indexOf(b),1),b=b.poi,delete b.infoBubble,b.originalImage?(b.image=b.originalImage,delete b.originalImage,b.privileged=!1):this._map.removePoi(b)},addLayer:function(a,b){var c=this._map,d=[].concat(c.layer||[]);if(0>d.indexOf(a))c.layer=d.concat(a),"string"==typeof b&&(this._layer[b]=c.layer[c.layer.length-1])},removeLayer:function(a){var b,c,d=[].concat(this._map.layer||[]);switch(typeof a){case "string":if("function"==typeof(b=this._layer[a]))if(~(b=
d.indexOf(b)))d.splice(b,1),d.length?(this._map.layer=d,delete this._layer[a]):(this._map.layer=null,this._layer={});break;case "function":if(~(b=d.indexOf(a)))if(d.splice(b,1),d.length)for(c in this._map.layer=d,this._layer){if(this._layer[c]==a){delete this._layer[c];break}}else this._map.layer=null,this._layer={}}},hasLayer:function(a){return"string"==typeof a&&"function"==typeof this._layer[a]||"function"==typeof a&&~[].concat(this._map.layer||[]).indexOf(a)?!0:!1},comparePOIs:function(a,b){return a.placeId?
a.placeId===b.placeId:a.latitude===b.latitude&&a.longitude===b.longitude},covers:function(a){var b=this.box,c=this.geoToPoint,d=c(b[0]),f=c(b[1]);return!a.some(function(a){a=c(a);return a.x<d.x||a.x>f.x||a.y<d.y||a.y>f.y})},storeTiles:function(a){var b=this._server;if(b)return b=b.storeBoundingBox(this._map,a&&a.box),a&&a.callback&&(b.onprogress=a.callback),a&&!a.hold&&b.start(),b},showStoredTiles:function(a,b){var c=this._map,d=this._server;d?d.getBoundingBox(function(f,e,g){f?(c.tileServer=d,c.box=
f,c.zoom=e,c.schema=g,a&&a(f,e,g)):b&&b()}):b&&b()},removeStoredTiles:function(){this._server&&this._server.removeBoundingBox()}}});nokia.mh5.provide("nokia.mh5.components.RouteListItem");
nokia.mh5.components.RouteListItem=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){var a=nokia.mh5.i18n;return{rootHtmlElementName:"li",cssClass:"mh5_ListItem",constructor:function(a,d){g.constructor.call(this,a,d);this.update()},update:function(){var b;b=this.first&&" mh5_maneuver_start"||this.last&&" mh5_maneuver_end"||"";var d="";this.waypoint?(nokia.mh5.dom.addClass(this.root," mh5_pt"),d=0<=this.action.indexOf("Walk")?" mh5_pt_walk":" mh5_pt_tube",b='<div class="mh5_pt_waypoint'+b+'"><div><\!--waypoint icon--\></div>'+
("<div>"+this.waypoint+"</div>"),b+="</div>",this.last||(b+='<div class="mh5_pt_line" style="background-color:'+this.color+'"></div>',nokia.mh5.dom.addClass(this.root,d),b=b+'<div class="mh5_pt_action"><div><\!--action icon--\></div>'+("<div>"+this.action+"</div>"),b+="</div>"),this.root.innerHTML=b):((this.first||this.last)&&(this.iconIndex=0),b="<div>"+('<div class="mh5_ListItem_icon'+b+'"></div>'),this.distance&&(b+="<div>"),b+='<div class="mh5_ListItem_name">'+this.instruction+"</div>",this.distance&&
(b+='<div class="mh5_ListItem_address">'+a("followFor")+" <span>"+nokia.mh5.utils.formatDistance(this.distance,nokia.mh5.components.settings.current.unitSystem)+"</span></div>"),this.root.innerHTML=b+"</div></div>",this.root.firstChild.firstChild.style.backgroundPositionX=-3.6*this.iconIndex+"rem")}}});nokia.mh5.provide("nokia.mh5.adapters.Route");
(function(){function g(a){return!a.length||2>a.length?[]:a.map(function(b,c){var d=!c,f=c===a.length-1,e=f?/\.?\s*The trip takes.*<\/span>/:/\s*<span class="distance-description">.*<\/span>/,g=f&&a[c-1].shape?a[c-1].shape.slice(-2):b.shape,i=b.instruction.match(/<span class="direction">(\w+)<\/span>/),j=c&&!("action"in a[c-1])&&"forward"==b.direction,m=b.instruction.slice(0,4).toLowerCase();if("bear"==m&&i&&i[1])b.direction=m+(i[1].charAt(0).toUpperCase()+i[1].slice(1));return{action:d&&"depart"||
f&&"arrive"||!j&&b.direction,direction:f&&i&&i[1],instruction:b.instruction.replace(e,""),first:d,last:f,iconIndex:"action"in b?h[b.action]:h[b.direction],distance:b.length,latitude:b.position.latitude,longitude:b.position.longitude,shape:g&&g.reduce(function(a,b,c,d){return c%2?a:a.concat([{latitude:b,longitude:d[c+1]}])},f?[{latitude:g[g.length-2],longitude:g[g.length-1]}]:[])}})}function a(a){if(!a.length||2>a.length)return[];a[0].name=j;a[a.length-1].name=i;return a.map(function(b,d){var e,g=
"",h,i=0===d,j=d===a.length-1;e=i||j?f[i?0:2]+'<span class="mh5_pt_highlight">'+b.name+"</span>":"<span>"+f[1]+b.name+"</span>";if(!j)if(g=c[b.action],0===b.action){if((h=a[d+1])&&(h.name||h.line))g+='<span class="mh5_pt_highlight">'+(h.name!=b.name||!h.line?h.name:h.line)+"</span>"}else 1===b.action&&(g=0<=g.indexOf("{0}")?g.replace("{0}",'<span class="mh5_pt_highlight">'+(b.line||"")+"</span>"):g,g+='<span class="mh5_pt_highlight">'+b.direction+"</span><br>",g+='<span class="mh5_pt_light">For '+
b.stops+" stops</span>");return{waypoint:e,wIconIndex:0,action:g,aIconIndex:0,first:i,last:j,duration:b.duration,color:b.color,latitude:b.position.latitude,longitude:b.position.longitude}})}function b(a,b,c,f){var g,h,i=b.mode,j=a[0],y=a[a.length-1];"pt"===i?(g="http://m.here.com/releases/1.8.50/server/PublicTransport.php",h={app_id:b.appId,app_code:b.appCode,xnlp:e.getApiSession().id,slat:j.latitude,slon:j.longitude,dlat:y.latitude,dlon:y.longitude,date:(b.departure||new Date(Date.now()-6E4*(new Date).getTimezoneOffset()+
9E5)).toISOString().substr(0,19)},a="jsonp"):(g="http://route.nlp.nokia.com/routing/6.2/calculateroute.json",h={app_id:b.appId,token:b.appCode,mode:[b.type||"fastest","drive"==i?"car":"pedestrian","traffic:"+("walk"==i||!1===b.traffic?"disabled":"enabled")].join(";"),routeattributes:"sh,bb,sm",maneuverattributes:"po,le,ac,di"+("walk"===i?",sh":""),instructionformat:"html",jsonAttributes:"33",departure:b.departure&&b.departure.toISOString()||"now",language:d.getIsoLanguage(),xnlp:e.getApiSession().id},
a.forEach(function(a,b){h["waypoint"+b]=a.latitude+","+a.longitude}),b.features&&(h.mode+=";"+Object.keys(b.features).map(function(a){return a+":"+b.features[a]}).join(",")),a="jsoncallback");g+="?"+nokia.mh5.utils.formatURLParams(h)+"&"+a;m&&m.cancel();m=nokia.mh5.jsonp(g,function(a){a.error?f&&f(a.error):c(a.response)},15E3)}var d=nokia.mh5.i18n,e=nokia.mh5.utils,h={depart:0,departAirport:0,arrive:0,arriveAirport:0,arriveLeft:0,arriveRight:0,leftLoop:5,leftUTurn:3,sharpLeftTurn:11,leftTurn:9,slightLeftTurn:7,
"continue":0,slightRightTurn:6,rightTurn:8,sharpRightTurn:10,rightUTurn:2,rightLoop:4,leftExit:17,rightExit:16,leftRamp:19,rightRamp:18,leftFork:21,middleFork:1,rightFork:20,leftMerge:15,rightMerge:14,nameChange:1,trafficCircle:48,ferry:47,leftRoundaboutExit1:34,leftRoundaboutExit2:35,leftRoundaboutExit3:36,leftRoundaboutExit4:37,leftRoundaboutExit5:38,leftRoundaboutExit6:39,leftRoundaboutExit7:40,leftRoundaboutExit8:41,leftRoundaboutExit9:42,leftRoundaboutExit10:43,leftRoundaboutExit11:44,leftRoundaboutExit12:45,
rightRoundaboutExit1:22,rightRoundaboutExit2:23,rightRoundaboutExit3:24,rightRoundaboutExit4:25,rightRoundaboutExit5:26,rightRoundaboutExit6:27,rightRoundaboutExit7:28,rightRoundaboutExit8:29,rightRoundaboutExit9:30,rightRoundaboutExit10:31,rightRoundaboutExit11:32,rightRoundaboutExit12:33,forward:0,uTurnRight:2,bearRight:4,lightRight:6,right:8,hardRight:10,uTurnLeft:3,bearLeft:5,lightLeft:7,left:9,hardLeft:11},f=["<span>"+d("RA.departFrom")+"</span> ","Station ","<span>"+d("RA.arriveAt")+"</span> "],
c=["<span>"+d("RA.walkTo")+"</span> ","<span>"+d("take")+"</span> {0} <span>"+d("towards")+"</span> "],j="Start",i="",m;nokia.mh5.adapters.Route={fetch:function(c,f,e,h,m){var C,E,F=function(b){var c=b&&b.route&&(b.route[0]?b.route[0]:b.route),d="pt"==f.mode?a:g;if(c&&c.shape&&c.shape.length){b=c.summary;c={box:b.bbox||c.boundingBox&&[c.boundingBox.topLeft,c.boundingBox.bottomRight]||c.shape,shape:c.shape,summary:{distance:b.distance||0,time:b.trafficTime||b.baseTime},maneuvers:d(c.maneuvers||Array.prototype.concat.apply([],
c.leg.map(function(a){return a.maneuver})),this.ename)};if(b.disclaimers)c.summary.disclaimers=b.disclaimers;e(c)}else y.call(b&&b.error)},y=function(a){var b=f.mode;"timeout"===a?a=d("Notification.noRoutingService"):"pt"==b?"too near"===a?a=d("Notification.destInWalkingDistance"):"unavailable"===a&&(a=d("Notification.noPublicTransportService")):a||(b=d("Notification.noModeAvailable",{mode:d("RA."+b)}),a=b.charAt(0).toUpperCase()+b.slice(1));h(a||d("Notification.noRoutingService"))},B,v;if(Array.isArray(c)&&
2<=c.length)C=c[0],E=c[c.length-1];else if(c&&c.hasOwnProperty("latitude")&&c.hasOwnProperty("longitude")&&f&&f.hasOwnProperty("latitude")&&f.hasOwnProperty("longitude"))C=c,E=f,c=[C,E],f=e,e=h,h=m;else{h(d("Notification.error"));return}B=f.appId=f.appId||nokia.mh5.appId;v=f.appCode=f.appCode||nokia.mh5.appCode;h=h||function(){};if(!B||!v)throw Error(d("Error.applicationCredential"));if("pt"===f.mode)if(i=E.name,C.name)j=C.name;else var w=F,F=function(a){nokia.mh5.adapters.Search.reverseGeoCode(C,
{appId:B,appCode:v},function(b){j=b.name;w.call(this,a)},y)};b(c,f,F,y)}}})();nokia.mh5.provide("nokia.mh5.components.Navigation");nokia.mh5.provide("nokia.mh5.ui.ImageDialog");
nokia.mh5.ui.ImageDialog=new nokia.mh5.Class(nokia.mh5.ui.Dialog,function(g){var a=nokia.mh5.i18n;return{cssClass:"mh5_ImageDialog mh5_modal mh5_modalBg",children:["content","spinner","errorMessage","imageProviderText"],content:{control:nokia.mh5.ui.Control,rootHtmlElementName:"img",cssClass:"mh5_CarouselImage",visible:!1},spinner:{control:nokia.mh5.ui.Control,cssClass:"mh5_spinner_big_bright",visible:!0},errorMessage:{control:nokia.mh5.ui.Control,cssClass:"mh5_errorMessage",innerHTML:a("Notification.unableToLoadImage"),
visible:!1},imageProviderText:{control:nokia.mh5.ui.Control,cssClass:"mh5_imageProvider",visible:!1},constructor:function(a,d){a.closeOnTap=!0;g.constructor.call(this,a,d);var e=this,h=this.content.root,f=nokia.mh5.win.setTimeout(function(){nokia.mh5.dom.addClass(e.root,"mh5_loading")},50);h.onload=function(){nokia.mh5.win.clearTimeout(f);nokia.mh5.dom.removeClass(e.root,"mh5_loading");e.content.visible=!0;e.provider&&e._showimageProviderText(e.provider)};h.onerror=function(){nokia.mh5.win.clearTimeout(f);
nokia.mh5.dom.removeClass(e.root,"mh5_loading");e.errorMessage.visible=!0};h.src=a.src},_updatePosition:function(){g._updatePosition.call(this);this._updateTextPosition()},_updateTextPosition:function(){this.imageProviderText.root.style.top=this.content.root.offsetTop+this.content.root.offsetHeight+5+"px";this.imageProviderText.root.style.left=this.content.root.offsetLeft+"px"},_showimageProviderText:function(b){this.imageProviderText.root.innerHTML=a("source")+": "+b;this.imageProviderText.visible=
!0;this._updateTextPosition()}}});nokia.mh5.provide("nokia.mh5.ui.Carousel");
nokia.mh5.ui.Carousel=new nokia.mh5.Class(nokia.mh5.ui.Container,function(){return{cssClass:"mh5_Carousel",hScroll:!0,hScrollbar:!1,visible:!0,imagePool:[],onClick:function(g){g=(g.hasOwnProperty("data")?g.data.target:null)||g.target;"IMG"===g.tagName&&new nokia.mh5.ui.ImageDialog({src:g.getAttribute("data-image-src"),provider:g.getAttribute("data-image-provider")||"Business Owner"})},imagePoolDidChange:function(g){if(!g||0===g.length)this.getContentRoot().innerHTML="",this.visible=!1;else{var a=
"",b=0;g.forEach(function(b){a+='<img src="'+b.thumbnailSrc+'" data-image-src="'+b.imageSrc+'" data-image-provider="'+(b.providerName?b.providerName:"")+'" draggable = "false" />'});g=this.getContentRoot();g.innerHTML=a;for(var d=g.children,e=this,g=d.length-1;0<=g;--g){var h=d[g];h.onerror=function(){this.parentNode&&this.parentNode.removeChild(this)};h.onload=function(){b=b++;++b===d.length-1&&e._scroll&&e._scroll.refresh()}}this.visible=!!a}}}});nokia.mh5.provide("nokia.mh5.components.PlaceDetails");
nokia.mh5.components.PlaceDetails=new nokia.mh5.Class(nokia.mh5.ui.Container,function(g){var a=nokia.mh5.i18n,b=[{name:a("eating"),value:"eating",cssClass:"eating"},{name:a("shopping"),value:"shopping",cssClass:"shopping"},{name:a("going-out"),value:"going-out",cssClass:"goingOut"},{name:a("sights"),value:"sights",cssClass:"sights"},{name:a("PT"),value:"public-transport",cssClass:"publicTransport"}],d=["summary","recommendations","legalNote"],e=nokia.mh5.platform,h=nokia.mh5.dom;return{control:nokia.mh5.ui.Container,
children:"summary,actions,images,ad,ownerContent,guides,reviews,spinner,recommendations,fillup,legalNote".split(","),layout:{type:nokia.mh5.ui.RowLayout},summary:{control:nokia.mh5.components.PlaceSummary},actions:{control:nokia.mh5.ui.Container,cssClass:"mh5_placeActions actions stretch mh5_standardBackgroundColorDark",layout:{type:nokia.mh5.ui.ColumnLayout},children:["dial","share","route","website","addFavourite"],dial:{control:nokia.mh5.ui.Button,cssClass:"button contact mh5_primaryColorDark",
disabled:!0,text:a("call"),onClick:function(){var a=this.parent.parent;nokia.mh5.event.fire(a,"dial",a.place)}},share:{control:nokia.mh5.ui.Button,cssClass:"button share mh5_primaryColorDark",disabled:!0,onClick:function(){var a=this.parent.parent;nokia.mh5.event.fire(a,"share",a.place)},text:a("share")},route:{control:nokia.mh5.ui.Button,cssClass:"button route mh5_primaryColorDark",disabled:!0,onClick:function(){var a=this.parent.parent;nokia.mh5.event.fire(a,"route",a.place)},text:a("route")},website:{control:nokia.mh5.ui.Button,
cssClass:"button web mh5_primaryColorDark",disabled:!0,text:a("web"),target:"blank",onClick:function(){var a=this.parent.parent;nokia.mh5.event.fire(a,"website",a.place)}},addFavourite:{control:nokia.mh5.ui.Button,cssClass:"button favourite mh5_primaryColorDark",disabled:!0,text:a("favourite"),onClick:function(){var b=this.parent.parent,c=b.place,d=this.root,g=this.parent.parent.parent.notification,m=this;nokia.mh5.components.favourites.get(c)?(nokia.mh5.components.favourites.remove(c),h.removeClass(d,
"saved"),d="removed",nokia.mh5.sso.isAuthenticated()?(g.text=a("FV.removedSignedIn"),g.visible=!0,setTimeout(function(){m.parent.parent.parent.notification.text=a("FV.syncedFavourites");m.parent.parent.parent.notification.visible=!0},3E3)):(g.text=a("FV.removedNotSignedIn"),g.visible=!0)):nokia.mh5.components.favourites.add(c)?(h.addClass(d,"saved"),d="added",nokia.mh5.sso.isAuthenticated()?(g.text=a("FV.addedSignedIn"),g.visible=!0,setTimeout(function(){m.parent.parent.parent.notification.text=a("FV.syncedFavourites");
m.parent.parent.parent.notification.visible=!0},3E3)):(g.text=e.android_webview?a("FV.addedNotSignedIn"):a("FV.addedNotSignedIn")+". "+a("FV.signInToSyncronize")+".",g.visible=!0)):d="failed2add";nokia.mh5.event.fire(b,"favourite",nokia.mh5.extend({},c,{status:d}))}}},images:{control:nokia.mh5.ui.Carousel,clear:function(){this.imagePool=[]}},ad:{control:nokia.mh5.ui.Control,visible:!1},ownerContent:{control:nokia.mh5.ui.Control,cssClass:"mh5_PlaceDetailsData mh5_primaryColorBright",visible:!1,clear:function(){this.root.innerHTML=
""}},guides:{control:nokia.mh5.ui.Control,cssClass:"mh5_PlaceDetailsData mh5_primaryColorBright",visible:!1,update:function(b){this.clear();if(b){for(var c="",d,e=0,g=b.length;e<g;e++)d="",b[e].providerUrl&&(d=h.createHyperlinkHTML({href:b[e].providerUrl,"class":"mh5_link",target:"_blank"},a("more"))),c+='<div class="mh5_guide">',c+=b[e].providerIcon?'<img class="mh5_icon" src="'+b[e].providerIcon+'">':"",c+="<div>",c+='<h2 class="title">'+b[e].providerName+"</h2>",c+=this.parent._formatDescription(b[e].description,
d),c+="</div>",c+="</div>";this.root.innerHTML='<div class="mh5_guides"><h1 class="mh5_title">'+a("guides")+"</h1>"+c+"</div>";this.visible=!0}},clear:function(){this.root.innerHTML="";this.visible=!1}},reviews:{control:nokia.mh5.ui.Control,cssClass:"mh5_PlaceDetailsData mh5_primaryColorBright",visible:!1,update:function(b){this.clear();if(b){for(var c="",d,e=0,g=b.length;e<g;e++){d="";c+='<div class="mh5_review">';c+='<img class="mh5_icon" src="'+b[e].providerIcon+'">';c+="<div>";c+="<h2>"+(b[e].title||
this.parent.place.name)+"</h2>";if(b[e].ratingValue){var l=new nokia.mh5.ui.Rating;l.value=b[e].ratingValue;c+=l.root.outerHTML}b[e].url&&(d=h.createHyperlinkHTML({href:b[e].url,"class":"mh5_link",target:"_blank"},a("more")));c+=this.parent._formatDescription(b[e].description,d);c+='<p class="mh5_reviewFooter">Posted'+(b[e].userName?" by "+b[e].userName:"")+" on "+b[e].date+"</p>";c+="</div>";c+="</div>"}this.root.innerHTML='<div class="mh5_reviews"><h1 class="mh5_title">'+a("reviews")+"</h1>"+c+
"</div>";this.visible=!0}},clear:function(){this.root.innerHTML="";this.visible=!1}},spinner:{control:nokia.mh5.ui.Control,visible:!1,innerHTML:"<div class='mh5_spinner_big_dark'></div>",cssClass:"mh5_spinnerContainer"},recommendations:{control:nokia.mh5.ui.Container,cssClass:"mh5_nearby_places",layout:{type:nokia.mh5.ui.RowLayout},children:["title","categoryToggle","categoryToggleBorder","indicator","list"],visible:!1,indicator:{control:nokia.mh5.ui.Control,cssClass:"mh5_recommendationIndicator mh5_primaryBorderColorBright",
innerHTML:"<div></div>"},title:{control:nokia.mh5.ui.Control,rootHtmlElementName:"h1",cssClass:"mh5_title",innerHTML:a("nearbyPlaces"),visible:!1},categoryToggle:{control:nokia.mh5.ui.SegmentedButton,cssClass:"mh5_nearbyCategoryToggle mh5_ColumnLayout mh5_primaryColorBright",items:b,onValueChange:function(a){var b=this.parent,d=b.parent,g=this.root.querySelector(".mh5_selected"),g=Math.round(g.offsetLeft+g.offsetWidth/2);d._selectedNearbyCategory=a;b.list.items=d.place&&d.place.recommendations?nokia.mh5.components.favourites.favouritize(d.place.recommendations[a]):
[];b.indicator.root.style[(e.ie?"ms":"webkit")+"Transform"]="translateX("+g+"px)";nokia.mh5.win.setTimeout(function(){d.resize(!0)},1)}},categoryToggleBorder:{control:nokia.mh5.ui.Control,cssClass:"mh5_primaryBackgroundColorBright"},list:{control:nokia.mh5.ui.List,visible:!1,itemClass:nokia.mh5.components.PlaceListItem,listeners:{tap:function(a){var b=a.data.item,d=this.getRootOwnerByClass(nokia.mh5.components.PlaceDetails),e={placeId:b.placeId,href:b.href,latitude:b.latitude,longitude:b.longitude,
address:b.address,category:b.category,icon:b.icon,name:b.name};b.placeId&&"pt"===b.placeId.substring(0,2)&&delete e.placeId;a=nokia.mh5.event.fire(d,"nearby",{place:e,index:a.data.index});if(!a.defaultPrevented)d.place=e}}}},fillup:{control:nokia.mh5.ui.Control,cssClass:"mh5_fillup"},legalNote:{control:nokia.mh5.ui.Container,rootHtmlElementName:"footer",cssClass:"mh5_RowLayout mh5_secondaryColorBright",innerHTML:"&copy; "+(new Date).getFullYear()+" Nokia",children:["ownerContentProvider","imageProviders"],
clear:function(){this.ownerContentProvider.clear();this.imageProviders.clear()},ownerContentProvider:{control:nokia.mh5.ui.Control,cssClass:"mh5_provider",innerHTML:"",clear:function(){this.innerHTML="";this.visible=!1}},imageProviders:{control:nokia.mh5.ui.Control,cssClass:"mh5_provider",innerHTML:"",clear:function(){this.innerHTML="";this.visible=!1}}},adapter:nokia.mh5.adapters.Search,cssClass:"mh5_PlaceDetails",constructor:function(b,c){var e,h,m,l,n,o,q,x;this.resize=this.resize.bind(this);b||
(b={});for(m=0;o=d[m];m++)if(o in b)throw Error(a("Error.propertyCannotBeOverwritten",{name:o}));if(!b.hasOwnProperty("actions")||!0===b.actions)b.actions={};if(b.actions&&!b.actions.addFavourite)b.actions.addFavourite=null;g.constructor.call(this,b,c);if(this.customContent){e=[].concat(this.customContent);h=this.children;for(m=0;l=e[m];m++){n=l.control||nokia.mh5.ui.Control;n=new n(l,this);if(this[l.name])throw Error(a("Error.customContentNotAllowed",{name:l.name}));o=!this[l.name]&&l.name||"customContent"+
(m+1);q=l.after&&h.indexOf(l.after);x=q>=h.length-1;this[l.after&&x?"add":"insertBefore"](n,o,l.before||h[q+1])}}},build:function(){var a=this.parameters;Object.defineProperty(this,"parameters",{get:function(){return this._parameters},set:function(a){this._parameters={};nokia.mh5.each(a,function(a,b){this._parameters[b]="function"===typeof a?a.bind(this):a},this)}});if(a)this.parameters=a;e.ios&&h.addClass(this.root.firstChild.firstChild,"mh5_noFlicker");g.build.call(this)},resize:function(a){var b=
this.getContentRoot(),d=b.parentNode,e=this._selectedNearbyCategory,g=this.recommendations.categoryToggle;b.offsetHeight>this.root.offsetHeight?h.addClass(d,"mh5_fillupDisable"):h.removeClass(d,"mh5_fillupDisable");this._scroll&&nokia.mh5.win.setTimeout(this._scroll.refresh,1);this.images&&this.images._scroll&&nokia.mh5.win.setTimeout(this.images._scroll.refresh,1);!a&&this.visible&&e&&g.select(e)},remove:function(b){if(~d.indexOf(b))throw Error(a("Error.unableToRemove",{name:b}));g.remove.call(this,
b)},_setContentData:function(b){var c="",d=this.legalNote,e,g;if(b.imageProviders){e=[];g=0;for(var l=b.imageProviders.length;g<l;g++)e.push(b.imageProviders[g].url?h.createHyperlinkHTML({href:b.imageProviders[g].url,target:"_blank"},b.imageProviders[g].name):b.imageProviders[g].name);if(d)d.imageProviders.root.innerHTML=a("imagesProvidedBy")+e.join(", "),d.imageProviders.visible=!0}b.extended&&nokia.mh5.each(b.extended,function(a){c+=this._renderSimpleContent(a.label,a.text)},this);c+=this._renderSimpleContent(a("PT"),
b.publicTransport);if(this.ownerContent){if(b.ownerContent&&(g=b.ownerContent,c+=this._renderOwnerContent(g),g.providerName&&d))e=g.providerName,g.providerUrl?(g=g.providerUrl,d.ownerContentProvider.root.innerHTML=a("contentProvidedBy")+h.createHyperlinkHTML({href:g,target:"_blank"},e)):d.ownerContentProvider.root.innerHTML=a("contentProvidedBy")+e,d.ownerContentProvider.visible=!0;this.ownerContent.visible=!!c;this.ownerContent.root.innerHTML=c}this.guides&&this.guides.update(b.premiumContent);this.reviews&&
this.reviews.update(b.reviews)},_setRecommendations:function(a){var b=!1,d=a.recommendations,e=this.recommendations,g=e.categoryToggle,h,n;if(d){g.select(null);nokia.mh5.each(g.items,function(a){if(d&&d[a.value]&&d[a.value].length){if(b=!0,delete a.disabled,void 0===h)h=a.value}else if(a.disabled=!0,this._selectedNearbyCategory===a.value)this._selectedNearbyCategory=void 0}.bind(this));g.update();if(void 0===this._selectedNearbyCategory&&h)this._selectedNearbyCategory=h;if("public-transport"===this._selectedNearbyCategory){g=
d[this._selectedNearbyCategory];for(n=0;n<g.length;n++)if(g[n].name===a.name){d[this._selectedNearbyCategory].splice(n,1);break}}e.visible=b;e.title.visible=b;e.list.visible=b;e.categoryToggle.visible=b;this.resize()}else e.visible=!1},showError:function(b){var c=this.fillup,d=this.actions,b="not found"===b?a("Notification.placeRemovedByOwner"):a("Notification.placeError");d&&["dial","share","route","website","favourite"].forEach(function(a){if(d[a])d[a].disabled=!0});if(c){if(c)c.root.innerHTML=
'<div class="mh5_error">'+b+"</div>"}else this._errorMessage=b},_formatDescription:function(a,b){return!a?"":'<p class="mh5_description">'+a.replace(/\n{2,}/g,'</p><p class="mh5_description">').replace(/\n/g,"<br>")+(b||"")+"</p>"},_renderSimpleContent:function(a,b){return!a||!b?"":'<div class="mh5_placeData"><h2 class="title">'+a+"</h2>"+this._formatDescription(b)+"</div>"},_renderOwnerContent:function(b){return!b?"":'<div class="mh5_ownerContent"><h1 class="mh5_title">'+a("placeDescription")+"</h1>"+
this._formatDescription(b)+"</div>"},vScroll:!0,bounce:!1,place:null,parameters:{},placeDidChange:function(a){delete this._errorMessage;var b=nokia.mh5.adapters.Search,d=this.adapter||b;this.update();a&&d.fetch(a,this.parameters,function(a){b.merge(this.place,a);this.update();nokia.mh5.event.fire(this,"done");if(!a.recommendations)this.spinner.visible=!0,b.getRecommendations(a,this.parameters,function(a){this.spinner.visible=!1;this._setRecommendations(a);this.resize()}.bind(this))}.bind(this),function(){this.showError.apply(this,
arguments);nokia.mh5.event.fire(this,"done")}.bind(this))},unitSystemBinding:"nokia.mh5.components.settings#current.unitSystem",update:function(){var a=this.place,b,d,e,g,l,n,o;if(a){this.summary.update(a);b=this.actions;d=a.phone;if(e=!!nokia.mh5.components.favourites.get(a))a.favourite=!0;if(this.images)this.images.imagePool=a.gallery;this.legalNote.clear();this._setContentData(a);this._setRecommendations(a);if(this.fillup)this.fillup.root.innerHTML="";if(b){g=b.dial;l=b.share;n=b.route;o=b.website;
b=b.addFavourite;if(g)g.link="tel:"+d,g.disabled=!d,g.update();if(l&&a.name&&(a.placeId||a.longitude&&a.latitude))l.disabled=!1,l.update();if(n&&a.name&&(a.placeId||a.longitude&&a.latitude))n.disabled=!1;if(o)o.link=a.website,o.disabled=!a.website,o.update();if(b){if(a.name&&(a.placeId||a.longitude&&a.latitude))b.disabled=!1;h[e?"addClass":"removeClass"](b.root,"saved")}}this.resize();nokia.mh5.event.fire(this,"update",a)}},visibleDidChange:function(a){g.visibleDidChange.call(this,a);a?(h.addEvent(nokia.mh5.win,
"viewportchange",this.resize,!1),this.resize(),this._errorMessage&&(nokia.mh5.event.fire(this,"error",{message:this._errorMessage}),delete this._errorMessage)):h.removeEvent(nokia.mh5.win,"viewportchange",this.resize,!1)},unitSystemDidChange:function(){this.recommendations&&this.recommendations.list.renderedItems&&this.recommendations.list.renderedItems.forEach(function(a){a.update&&a.update()})}}});nokia.mh5.provide("nokia.mh5.components.Search");
nokia.mh5.components.Search=new nokia.mh5.Class(nokia.mh5.ui.Container,function(g){function a(){var a=e.getLocalStorageValue("history");return a?JSON.parse(a):[]}var b,d,e=nokia.mh5.utils,h=function(a){return a.toLowerCase().charAt(0)===d.toLowerCase()},f=function(a){return 0<=a.toLowerCase().indexOf(d)};return{statics:{SEARCH_COMPLETION:{add:function(b){if(b){var d=a(),f=d.indexOf(b),f=~f&&d.splice(f,1)[0];100<d.unshift(f||b)&&d.pop();e.setLocalStorageValue("history",JSON.stringify(d))}},get:function(c,
e,g){var m=this.searchAdapter,l=this.parameters,n=l&&l.limit,o,q,c=c.trim();b&&clearTimeout(b);2<c.length&&m&&m.getSuggestions?b=setTimeout(function(){b=null;l.limit=g;m.getSuggestions(c,l,e);l.limit=n},200):(o=a(),d=c.toLowerCase(),n=c&&1==c.length&&o.filter(h),q=!(n&&n.length)&&f,e((q?o.filter(q):n||o).splice(0,g||4)))}}},children:["input","completion"],input:{control:nokia.mh5.ui.TextInput,type:"search"},cssClass:"mh5_Search",completion:{control:nokia.mh5.ui.List,cssClass:"mh5_SearchCompletion",
visible:!1,itemClass:new nokia.mh5.Class(nokia.mh5.ui.Control,function(a){return{rootHtmlElementName:"li",constructor:function(b,d){a.constructor.call(this,b,d);var e=RegExp(this.parent.parent.query.replace(/[#-.]|[\[-\^]|[?|{}\/]/g,"\\$&"),"i");this.root.innerHTML=nokia.mh5.utils.escapeHTML(this.text).replace(e,'<span class="mh5_secondaryColorBright">$&</span>')}}}),listeners:{tap:function(a){var b=this.parent;b.query=a.data.item.text;b.input.blur();b.search()}}},searchAdapter:nokia.mh5.adapters.Search,
completionAdapter:nokia.mh5.components.Search.SEARCH_COMPLETION,parameters:{},constructor:function(a,b){this.searchAdapter=a.searchAdapter?a.searchAdapter:this.searchAdapter;this.completionAdapter=a.completionAdapter?a.completionAdapter:nokia.mh5.components.Search.SEARCH_COMPLETION;g.constructor.call(this,a,b)},build:function(){var a=nokia.mh5.event.add,b=this.input,d=this.query,e=this.parameters;Object.defineProperty(this,"parameters",{get:function(){return this._parameters},set:function(a){this._parameters=
{};nokia.mh5.each(a,function(a,b){this._parameters[b]="function"===typeof a?a.bind(this):a},this)}});if(e)this.parameters=e;Object.defineProperty(this,"query",{get:function(){return b.value},set:function(a){b.value=a}});if(d)this.query=d;this.completionAdapter&&nokia.mh5.ui.Control.watch(b,"value",this,this._updateCompletion);a(b,"submit",this.search.bind(this));a(b,"focus",this._onFocus.bind(this));a(b,"blur",this._onBlur.bind(this));g.build.call(this)},search:function(){var a=nokia.mh5.event.fire;
this.completion.visible=!1;this.query?(this.completionAdapter&&this.completionAdapter.add(this.query),a(this,"beforesearch",{query:this.query}).defaultPrevented||this.searchAdapter.search(this.query,this.parameters,function(b){a(this,"success",b)}.bind(this),function(b){a(this,"error",b)}.bind(this))):a(this,"clear")},_onFocus:function(){if(this.completionAdapter)this._updateCompletion(),this.completion.visible=!0},_onBlur:function(){var a=this.completion;a.visible&&setTimeout(function(){a.visible=
!1},nokia.mh5.platform.blackberry?1E3:250)},_updateCompletion:function(){var a=this.completion;this.completionAdapter.get.call(this,this.input.value,function(b){a.items=b.map(function(a){return{text:a}})},4)}}});nokia.mh5.provide("nokia.mh5.components.Route");
nokia.mh5.components.Route=new nokia.mh5.Class(nokia.mh5.ui.Container,function(g){var a=nokia.mh5.geolocation,b=nokia.mh5.i18n,d=b("currentLocation"),e=nokia.mh5.ui.Control.prototype.getRootOwnerByClass,h=new nokia.mh5.Class(nokia.mh5.ui.Control,function(){var a=nokia.mh5.dom.addClass,b=nokia.mh5.dom.removeClass;return{rootHtmlElementName:"li",innerHTML:"<div class='mh5_ListItem_name'>"+d+"</div><div></div>",update:function(d){var e=this.root.lastChild;switch(d){case "active":b(e,"mh5_spinner","mh5_hidden");
a(e,"mh5_position_available");break;case "waiting":b(e,"mh5_position_available","mh5_hidden");a(e,"mh5_spinner");break;default:b(e,"mh5_spinner","mh5_position_available"),a(e,"mh5_hidden")}}}}),f;return{routeAdapter:nokia.mh5.adapters.Route,constructor:f=function(a,b){this.routeAdapter=a.routeAdapter?a.routeAdapter:this.routeAdapter;g.constructor.call(this,a,b)},build:function(){var b=this.parameters||{mode:"walk"},h=this.from,i=this.to,m=nokia.mh5.event,l=m.add,n=m.fire,o=this.inputs.from,q=this.inputs.to,
m=function(b){var c=e.call(this,f),g=q==b.target?"to":"from",h=c[g+"List"],b=b.data.results,i=0<b.length;(h.visible=i)?h.items=b:this.input.value=c[g]&&c[g].name||"from"==g&&a.available&&d||""},x=function(a){n(e.call(this,f),"error",a.data)};Object.defineProperties(this,{parameters:{enumerable:!0,get:function(){return this._routeParameters},set:function(a){this._routeParameters={};nokia.mh5.each(a,function(a,b){this._routeParameters[b]="function"===typeof a?a.bind(this):a},this);this.mode.button.select(this._routeParameters.mode);
this.route()}},from:{enumerable:!0,get:function(){return this._from},set:function(a){this._from=a;this.inputs.from.input.value=a&&a.name||"";this.route()}},to:{enumerable:!0,get:function(){return this._to},set:function(a){this._to=a;this.inputs.to.input.value=a&&a.name||"";this.route()}}});!b.mode&&(b.mode="walk");b&&(this.parameters=b);h&&(this.from=h);i&&(this.to=i);l(o,"beforesearch",function(b){if(b.data.query==d)b.preventDefault(),a.available?this.parent.parent.from={name:d,latitude:a.latitude,
longitude:a.longitude}:o.input.value=""});l(o,"success",m);l(o,"error",x);l(o,"clear",function(){var b=e.call(this,f);b.from&&b.from.name!=d&&a.available?b.from={name:d,latitude:a.latitude,longitude:a.longitude}:(b.from=void 0,n(b,"clear"))});l(q,"success",m);l(q,"error",x);l(q,"clear",function(){e.call(this,f).to=void 0;n(e.call(this,f),"clear")});l(a,"positionactivate",function(){var b=this.inputs.from,c=b.completion.renderedItems;""===b.input.value&&(this.from={name:d,latitude:a.latitude,longitude:a.longitude});
c.length&&c[0].update&&c[0].update("active")}.bind(this));l(a,["positionerror","positiondeactivate","positionlost"],function(){this.inputs.from.input.value==d&&(this.from=void 0)}.bind(this));g.build.call(this)},cssClass:"mh5_Route",children:["inputs","mode","fromList","toList"],inputs:{control:nokia.mh5.ui.Container,cssClass:"mh5_inputs",layout:{type:nokia.mh5.ui.ColumnLayout},children:["from","to"],from:{control:nokia.mh5.components.Search,completionAdapter:{get:function(b,e){var f=a.status,g="active"==
f||"waiting"==f;nokia.mh5.components.Search.SEARCH_COMPLETION.get.call(this,b,function(a){g&&a.unshift(d);e(a)},g?3:4)},add:function(a){a!=d&&nokia.mh5.components.Search.SEARCH_COMPLETION.add(a)}},completion:{itemsDidChange:function(b){var e=b.length&&b[0].text==d,f=a.status;e&&(b[0].itemClass=h);this.constructor.prototype.itemsDidChange.call(this,b);e&&this.renderedItems[0].update(f)}},input:{placeholder:b("from"),cssClass:"mh5_TextInput mh5_secondaryColorBrightPH mh5_secondaryColorBright"}},to:{control:nokia.mh5.components.Search,
input:{placeholder:b("to"),cssClass:"mh5_TextInput mh5_secondaryColorBrightPH mh5_secondaryColorBright"}}},mode:{control:nokia.mh5.ui.Container,children:["button"],button:{control:nokia.mh5.ui.SegmentedButton,cssClass:"mh5_SegmentedIconButton mh5_mode mh5_ColumnLayout",items:["drive","walk","pt"].map(function(a){return{iconClass:"mh5_icon_"+a,value:a}}),onValueChange:function(a){var b=e.call(this,f),d=b.parameters;if(d.mode!==a)d.mode=a,b.route()}}},fromList:{control:nokia.mh5.ui.List,itemClass:nokia.mh5.components.PlaceListItem,
visible:!1,onClick:function(a){this.parent.from=this.items[a];this.visible=!1}},toList:{control:nokia.mh5.ui.List,itemClass:nokia.mh5.components.PlaceListItem,visible:!1,onClick:function(a){this.parent.to=this.items[a];this.visible=!1}},route:function(){var b=nokia.mh5.event.fire,e=this,f=e.from&&e.from.name!=d&&e.from||a.available&&a.coords,g=e.to,h=e.parameters,n;if(f&&g&&(n=b(e,"beforeroute",{from:f,to:g,parameters:h}),!n.defaultPrevented))n=f.name==d&&delete f.name,e._from=e._from||{},e._from.latitude=
f.latitude,e._from.longitude=f.longitude,e.routeAdapter.fetch([f,g],h,function(a){b(e,"success",a)},function(a){b(e,"error",{message:a})}),n&&(f.name=d)}}});nokia.mh5.provide("nokia.mh5.components.IncidentDetails");
nokia.mh5.components.IncidentDetails=new nokia.mh5.Class(nokia.mh5.ui.Container,function(g){function a(a){return 10>a?"0"+a:a}function b(b){return b.toLocaleDateString()+" "+b.getHours()+":"+a(b.getMinutes())+":"+a(b.getSeconds())}var d=nokia.mh5.dom,e=nokia.mh5.i18n,h=nokia.mh5.win,f=[e("maps.Traffic.critical"),e("maps.Traffic.major"),e("maps.Traffic.minor")];return{control:nokia.mh5.ui.Container,children:["filler","title","data","fillup"],layout:{type:nokia.mh5.ui.RowLayout},filler:{control:nokia.mh5.ui.Control,
cssClass:"mh5_incidentDetailsFiller",onClick:function(){this.parent.visible=!1}},title:{control:nokia.mh5.ui.Container,cssClass:"mh5_incidentDetailsTitle mh5_standardBackgroundColorDark"},data:{control:nokia.mh5.ui.Container,cssClass:"mh5_incidentDetailsData"},fillup:{control:nokia.mh5.ui.Control,cssClass:"mh5_fillup"},cssClass:"mh5_IncidentDetails",build:function(){this.resize=this.resize.bind(this);g.build.call(this)},resize:function(){var a=this.getContentRoot();d[a.offsetHeight>this.root.offsetHeight?
"addClass":"removeClass"](a.parentNode,"mh5_fillupDisable");this._scroll&&h.setTimeout(this._scroll.refresh,1)},vScroll:!0,bounce:!1,incident:null,incidentDidChange:function(a){if(a){var d,g=a.icon,a=a.incident;d="<p>"+(e("maps.Traffic.incidentStartTime")+": "+b(a.startTime)+"<br>"+e("maps.Traffic.incidentEndTime")+": "+b(a.endTime)+"</p>");this.title.root.innerHTML=d;d="<div class='header'><img src='"+g+"'></img><h1 class='mh5_title'>"+a.type+"</h1></div>"+(a.origin?"<p>"+e("maps.Traffic.incidentDescription"+
(a.direction?"":"NoDirection"),{origin:a.origin,direction:a.direction})+"</p>":"");g=a.end?a.bidirectional?"maps.Traffic.incidentBidir":"maps.Traffic.incidentUnidir":"maps.Traffic.incidentAt";d+="<p>"+(a.start?e(g,{start:a.start,end:a.end})+"<br>":"")+a.description+"</p><p>"+e("maps.Traffic.criticalityTitle")+": "+f[a.criticality]+"</p>";this.data.root.innerHTML=d}else this.title.root.innerHTML="",this.data.root.innerHTML="";var m=this;h.setTimeout(function(){m.resize()},500)},visibleDidChange:function(a){a?
(d.addEvent(h,"viewportchange",this.resize,!1),this.resize()):d.removeEvent(h,"viewportchange",this.resize,!1);g.visibleDidChange.call(this,a)}}});nokia.mh5.provide("nokia.mh5.maps.NavigationDisclaimerDialog");
nokia.mh5.maps.NavigationDisclaimerDialog=new nokia.mh5.Class(nokia.mh5.ui.Dialog,function(g){var a=nokia.mh5,b=a.i18n,d,e=a.ui.Container,h=a.ui.Control,f=a.ui.Button,c=a.event,j=a.platform,i=a.dom.query(".mh5_audio")[0],m;return{cssClass:"mh5_NavigationDisclaimerDialog mh5_modal mh5_modalBg",control:e,children:["contents"],contents:{control:e,layout:{type:a.ui.RowLayout},children:["header","content","buttonContainer"],header:{control:e,children:["headline"],cssClass:"mh5_dialogHeader",headline:{control:e,
rootHtmlElementName:"h1",cssClass:"mh5_title",innerHTML:b("maps.Nav.disclaimerTitle")+" <label>("+b("beta")+")</label>"}},content:{control:e,cssClass:"mh5_content",children:["instructions","successText","spinner"],instructions:{control:h,cssClass:"mh5_instructions mh5_primaryColorDark",innerHTML:"<ul><li>"+b("maps.Nav.disclaimerPoint1")+"</li><li>"+b("maps.Nav.disclaimerPoint2")+"</li><li>"+b("maps.Nav.disclaimerPoint3")+"</li><li>"+b("maps.Nav.disclaimerPoint4")+"</li></ul>"},successText:{control:h,
visible:!1,cssClass:"mh5_actionText",innerHTML:b("maps.Nav.success")},spinner:{control:h,visible:!1,cssClass:"mh5_spinner_big_bright"}},buttonContainer:{control:e,cssClass:"mh5_screenContainer",children:["buttons"],buttons:{control:e,cssClass:"mh5_buttonContainer",children:["cancelButton","downloadButton","startButton"],cancelButton:{control:f,cssClass:"mh5_Button mh5_textButton",text:b("cancel"),onClick:function(){d.visible=!1}},downloadButton:{control:f,cssClass:"mh5_Button mh5_textButton",text:b("maps.Nav.load")},
startButton:{control:f,cssClass:"mh5_Button mh5_textButton",visible:!1,text:b("maps.Nav.start"),onClick:function(){d._startJourney()}}}}},disableUpdatePosition:!0,allowScrolling:!0,build:function(){d=this;i&&i.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA&&~i.currentSrc.indexOf(a.components.settings.get("unitSystem")+"_audio.mp3")?(d._readyToStart(),d.contents.content.successText.visible=!1):c.add(d.contents.buttonContainer.buttons.downloadButton.root,"down",d._downloadAudio);g.build.call(this)},
_downloadAudio:function(){var b=d.contents.content,e=d.contents.buttonContainer.buttons.downloadButton,f=a.components.settings.get("unitSystem"),g=i&&!~i.currentSrc.indexOf(f+"_audio.mp3"),h=5;if(!i||g)g&&i.parentNode.removeChild(i),i=a.doc.createElement("audio"),i.src=j.android_webview?"http://m.maps.nokia.com/fw/audio/"+f+"_audio.mp3":a.assetsPath+"audio/"+f+"_audio.mp3",a.dom.addClass(i,"mh5_audio"),a.doc.body.appendChild(i),savedVolume=i.volume,i.volume=1.0E-8,i.play();c.add(i,"canplaythrough",
function E(){c.remove(i,"canplaythrough",E);a.win.clearTimeout(m);d._readyToStart()});c.add(i,"error",function F(){h--?i.load():(c.remove(i,"error",F),h=5,d._showError())});m=a.win.setTimeout(d._showError,15E3);b.spinner.visible=e.disabled=!0;j.ios&&i.readyState===HTMLMediaElement.HAVE_NOTHING?i.load():i.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA&&d._readyToStart()},_showError:function(){var c=d.contents.content,e=d.contents.buttonContainer.buttons.downloadButton;c.spinner.visible=e.disabled=
!1;e.text=b("retry");c.successText.root.innerHTML=b("maps.Nav.tryAgain");c.successText.visible=!0;a.win.clearTimeout(m)},_readyToStart:function(){var a=d.contents.content,b=d.contents.buttonContainer.buttons;a.spinner.visible=b.downloadButton.visible=!1;a.successText.visible=b.startButton.visible=!0},_startJourney:function(){d._closeDialog();d.onFinish&&d.onFinish()}}});nokia.mh5.provide("nokia.mh5.app.commonLayout");
(function(g){var a=Math.PI,b=a/2,d=3*b,e,h=nokia.mh5.maps.analytics,f=function(a){var b,c;j(a);if(a==nokia.mh5.app.controller.current.page.details&&a!=a.parent._shadowDetails)b=a.parent.map,(c=b.getPois(a.place,!0))&&b.moveTo(a.getMapCenterToShowPoiInGap(c,-c.image.height/2))},c=function(a){var b=nokia.mh5.maps.analytics;b.log({gn:"infobubble:place details",c44:b.getPlaceId(a),v44:"~c44",c19:b.getContext(a),v19:"~c19",c32:"infobubble click",v32:"~c32",ev:"prodView",v34:a.ownerContent?"prime":"not prime"})},
j=function(a){"_resizeTimeout"in a&&(g.clearTimeout(a._resizeTimeout),delete a._resizeTimeout)},i=function(a){return this=="routeInfo"in a.data},m=nokia.mh5.dom,l=nokia.mh5.event,n=nokia.mh5.geolocation,o=nokia.mh5.i18n,q=nokia.mh5.platform,x=nokia.mh5.utils,C=nokia.mh5.components.settings,E=nokia.mh5.math,F=function(a,b,c,d,e){var c=d.geoToPoint(d.center),f=d.size.width/2,g=d.size.height/2,a=d.geoToPoint(a);return d.pointToGeo({x:c.x-(d.size.width/2-(f-(c.x-a.x))),y:c.y-(e.offsetTop+e.offsetHeight/
2-(g-(c.y-a.y)))+b})},y=o("currentLocation"),B={map:function(){return this.parent.parent.parent.parent.map}},v=function(c,f,g,h,i){e.beginPath();e.moveTo(28*c,f*(15+i));e.lineTo(c*(18+i+h),f*(15+i));e.arc(c*(18+i+h),f*(15+i+h),h,0<f?d:b,0<c?a:0,0<c*f);e.lineTo(c*(18+i),f*g)},w=function(c,f,g){var h=g.time,i=g.distance,t=C.current.unitSystem,p=c.size,j=c.geoToPoint(f),l=c.geoToPoint(c.box[0]),f={summary:g,latitude:f.latitude,longitude:f.longitude,routeInfo:!0,locationX:160>j.x-l.x&&j.x-l.x<p.width/
2?0:1,locationY:50>=p.height-(j.y-l.y)?1:0},g=nokia.mh5.extend({background:!1,renderOnly:!0,privilegeLevel:0},c.infoBubbleParams);i&&h?h=x.formatDistance(i,t)+", "+x.formatTime(h):(h=600*Math.ceil(h/600),h=Math.floor(h/3600)+"hr "+h/60%60+"min");var j=h,h=document.createElement("canvas"),m=l=0,n=0,i=Math.round(32/12),o=Math.round(16/12),q=Math.round(160/12),u=0,t=f.locationX,p=f.locationY,w,M;e=h.getContext("2d");n+=q+4.5;e.font="10pt Arial";e.textBaseline="bottom";e.fillStyle="rgb(255,255,255)";
u=Math.max(u,e.measureText(j||" ").width);m+=u+16;n=n-4.5+10;h.width=m+16;h.height=n+14;e.save();e.translate(t?0:16,p?0:14);q=o/2;u=i+q;w=m-u;M=n-u;e.fillStyle="rgba(0,15,26,0.85)";e.lineWidth=o;e.lineCap="round";e.moveTo(u,q);m=[w,q,w,u,i,d,0,m-q,M,w,M,i,0,b,u,n-q,u,M,i,b,a,q,u,u,u,i,a,d];n=0;for(o=m.length;n<o;)e.lineTo(m[n++],m[n++]),e.arc(m[n++],m[n++],m[n++],m[n++],m[n++]);e.fill();e.textBaseline="top";e.fillStyle="#FFFFFF";e.font="10pt Arial";e.fillText(j,l+8,3.5);e.restore();j=t?-1:1;l=p?-1:
1;e.translate(h.width*t,h.height*p);v(j,l,h.height,i,-1);e.strokeStyle="rgb(255,255,255)";e.stroke();v(j,l,h.height,i,0);e.lineTo(0,0);e.closePath();e.fillStyle="rgba(0,15,26,0.85)";e.fill();g.image=h;c.showInfoBubble(f,g)},A={control:nokia.mh5.components.IncidentDetails,visible:!1,detailsPoi:null,visibleDidChange:function(a,b){var c=this,d=c.parent,e=d.map;if(a)e.passive=!0,e.hideInfoBubble(e.infoBubbles.filter(i,!1)),c.detailsPoi=e.createPoi(c.incident.icon,c.incident),c.detailsPoi.privileged=!0,
g.setTimeout(function(){m.transition({node:c.root,transitionClass:"mh5_transition_slide",fromTransformClass:"mh5_transition_bottom",toTransformClass:"mh5_transition_middle"},function(){m.removeClass(c.root,"mh5_transition_slide","mh5_transition_middle");e.moveTo(F(c.detailsPoi,-c.detailsPoi.image.height/2,c.getRootOwnerByClass(nokia.mh5.ui.Page),e,c.filler.root));g.setTimeout(function(){if(d.incidentDetails.visible)d.detailsClose.visible=!0},400)});c.constructor.prototype.visibleDidChange.call(c,
a,b)},0);else if(b){j(c);if(c.detailsPoi)e.removePoi(c.detailsPoi),c.detailsPoi=null;d.detailsClose.visible=!1;g.setTimeout(function(){m.transition({node:c.root,transitionClass:"mh5_transition_slide",fromTransformClass:"mh5_transition_middle",toTransformClass:"mh5_transition_bottom"},function(){c.constructor.prototype.visibleDidChange.call(c,a,b);m.removeClass(c.root,"mh5_transition_slide","mh5_transition_bottom");if(c===d.incidentDetails){e.passive=!1;var f=c.parent.model.selection;if(f){var f=e.getPois(f,
!0),g=nokia.mh5.extend({renderOnly:!0,left:f.data.icon},e.infoBubbleParams);g.content=["title","description"];e.showInfoBubble(f,g)}}})},0)}else c.constructor.prototype.visibleDidChange.call(c,a,b)}},u=new nokia.mh5.Class(nokia.mh5.ui.Control,function(){return{rootHtmlElementName:"li",cssClass:"noresults"}});nokia.mh5.app.commonLayout={pages:["search","route","share","favourites"],controller:nokia.mh5.app.controller,search:{children:"header,map,traffic,detailsClose,list,details,incidentDetails,notification".split(","),
layout:{type:nokia.mh5.ui.RowLayout},model:{query:"",data:[],selection:null,searchCenter:null,reset:function(){this.query="";this.data=[];this.searchCenter=this.selection=null}},adapter:nokia.mh5.adapters.Search,unitSystemBinding:"nokia.mh5.components.settings#current.unitSystem",onlineStatusBinding:"nokia.mh5.components.settings#current.isOnline",header:{control:nokia.mh5.ui.Container,layout:{type:nokia.mh5.ui.ColumnLayout,align:"stretch"},rootHtmlElementName:"header",cssClass:"mh5_baseBackgroundColor",
search:{control:nokia.mh5.components.Search,input:{cssClass:"mh5_TextInput mh5_secondaryColorBrightPH mh5_secondaryColorBright",placeholder:o("searchPlaces")},parameters:{map:function(){return this.parent.parent.map}},listeners:{beforesearch:function(){var a=this.parent.parent,b=a.model;b.reset();a.map.hideInfoBubble();b.searchCenter=a.map.center;b.query=this.query;a.details.visible=!1;a.incidentDetails.visible=!1;a.showNotification(C.get("isOnline")?o("searching")+"...":o("Notification.goOnline"))},
success:function(a){var b=a.data.results,a=a.data.box,c=this.parent.parent;c.resetNotification();0<b.length?(c.model.data=b,c.model.selection=b[0],c.map.hideInfoBubble(),c.map.showInfoBubble(c.map.getPois(b[0],!0)),c.map.box=a||b,nokia.mh5.app.controller.updateHistoryEntry(),c.map.save(),nokia.mh5.maps.analytics.log({gn:c.map.visible?"map:search results":"list:search results",c36:c.model.query,c37:c.model.data.length,v39:"+1",c32:"search performed",ev:"event14"})):c.map.visible&&c.showNotification(o("Notification.noResultFound"),
nokia.mh5.ui.Notification.TIMEOUT_DEFAULT)},error:function(){var a=this.parent.parent;a.resetNotification();a.showNotification(o("Notification.searchProblem"))},clear:function(){var a=this.parent.parent,b=a.details;a.model.reset();a.map.hideInfoBubble();a.resetNotification();b.visible=!1}}}},detailsClose:{control:nokia.mh5.ui.Control,visible:!1,cssClass:"mh5_showDetails"},map:{control:nokia.mh5.components.Map,infoBubble:{content:["title"],listeners:{click:function(){var a=this.parent.parent,b=nokia.mh5.app.controller;
c(this.data);a.model.mapMode=!0;b.updateHistoryEntry();(this.data.incident?a.incidentDetails:a.details).visible=!0;b.pushHistoryEntry("search",a.getNavigationState(),a.getHash())}}},settingsButton:{onClick:function(){var a=this.parent,b=new nokia.mh5.ui.SettingsDialog({traffic:a.traffic,visibleDidChange:function(b){a.passive=b;this.constructor.prototype.visibleDidChange.apply(this,arguments)}},this.getRootOwnerByClass(nokia.mh5.ui.Page));b.build();b.prepareBindings();b.prepareDidChangeNotifications()}},
listeners:{poiclick:function(a){a=a.data[0];a.infoBubble||h.log({gn:"map:infobubble",c44:h.getPlaceId(a.data),v44:"~c44",c19:h.getContext(a.data),v19:"~c19",c32:"poi click",ev:"event47",v32:"~c32"});this.parent.model.selection=a.data;nokia.mh5.app.controller.updateHistoryEntry()},maplongpress:function(a){this.parent.model.selection=a.data;nokia.mh5.app.controller.updateHistoryEntry()},mapclick:function(){var a=this.parent.model;if(a.selection)a.selection=null,nokia.mh5.app.controller.updateHistoryEntry()}}},
traffic:{control:nokia.mh5.components.Traffic,visible:!1},list:{control:nokia.mh5.ui.List,visible:!1,cssClass:"mh5_List mh5_searchResults"},openDetailsTracking:function(a){var b=nokia.mh5.maps.analytics;b.log({gn:"list:place details",c44:b.getPlaceId(a),v44:"~c44",c19:b.getContext(a),v19:"~c19",c32:"list item click",v32:"~c32",ev:"prodView",v34:a.ownerContent?"prime":"not prime"})},details:{control:nokia.mh5.components.PlaceDetails,visible:!1,customContent:{name:"mapoffset",cssClass:"mh5_PlaceDetailsMapOffset",
before:"summary",onClick:function(){this.parent.visible=!1}},build:function(){this.resize=this.resize.bind(this);this.constructor.prototype.build.apply(this,arguments)},resize:function(){this.constructor.prototype.resize.apply(this,arguments);if(this.visible)j(this),this._resizeTimeout=g.setTimeout(f,1E3,this)},listeners:{dial:function(a){h.log({gn:"place:contact",c44:h.getPlaceId(a.data),v44:"~c44",c19:h.getContext(a.data),v19:"~c19",c32:"place contact click",ev:"event21"})},nearby:function(a){var b=
a.data.place,c=a.data.index,d=this.getRootOwnerByClass(nokia.mh5.ui.Page),e=d.map,f=d.model,c=this.recommendations.list.renderedItems[c];h.log({gn:"place:place",c44:h.getPlaceId(b),v44:"~c44",c19:h.getContext(b),v19:"~c19",c32:"open nearby place",v32:"~c32"});j(this);if(d.transitionBetweenDetails){if(!c.distance)c.distance=1,c.update();m.query(".mh5_ListItem_distance",c.root)[0].innerHTML='<span class="mh5_spinner"></span>'}a.preventDefault();f.reset();0<e.getPois().length&&e.removePoi(d.map.getPois());
f.data=[b];f.selection=b;nokia.mh5.app.controller.pushHistoryEntry("search",d.getNavigationState(),d.getHash())},share:function(a){h.log({gn:"place:share",c44:h.getPlaceId(a.data),v44:"~c44",c19:h.getContext(a.data),v19:"~c19",c32:"place share click",v32:"~c32",ev:"event22"});nokia.mh5.app.controller.updateHistoryEntry();nokia.mh5.app.controller.share({data:a.data,metadata:{}})},route:function(a){h.log({gn:"place:directions",c44:h.getPlaceId(a.data),v44:"~c44",c19:h.getContext(a.data),v19:"~c19",
c32:"place directions click",v32:"~c32",ev:"event24"});nokia.mh5.app.controller.route({from:n.available&&{name:y,latitude:n.latitude,longitude:n.longitude},to:a.data})},website:function(a){h.log({gn:"place:website",c44:h.getPlaceId(a.data),v44:"~c44",c19:h.getContext(a.data),v19:"~c19",c32:"place website click",v32:"~c32",ev:"event25"})},favourite:function(a){switch(a.data.status){case "added":h.log({gn:"place details",c32:"place added to favourites",v32:"~c32",c44:h.getPlaceId(a.data),v44:"~v44"})}},
error:function(a){this.parent.showNotification(a.data.message,nokia.mh5.ui.Notification.TIMEOUT_DEFAULT)}},getMapCenterToShowPoiInGap:function(a,b){var c=this.getRootOwnerByClass(nokia.mh5.ui.Page);return F(a,b,c,c.map,c.details.mapoffset.root)},visibleDidChange:function(a,b){var c,d,e,f;a?(c=this.parent,d=c.map,e=this,d.passive=!0,d.hideInfoBubble(),c.traffic.hideIncidents(),d.removePoi(d.getPois()),f=d.createPoi(x.place.getCategoryIcon(e.place),e.place),g.setTimeout(function(){m.transition({node:e.root,
transitionClass:"mh5_transition_slide",fromTransformClass:"mh5_transition_bottom",toTransformClass:"mh5_transition_middle"},function(){m.removeClass(e.root,"mh5_transition_slide","mh5_transition_middle");d.moveTo(e.getMapCenterToShowPoiInGap.call(e,f,-f.image.height/2));g.setTimeout(function(){c.details.visible&&m.removeClass(c.detailsClose.root,"mh5_hidden")},400)});e.constructor.prototype.visibleDidChange.call(e,a,b)},0)):b?(e=this,c=e.parent,d=c.map,j(e),m.addClass(c.detailsClose.root,"mh5_hidden"),
g.setTimeout(function(){m.transition({node:e.root,transitionClass:"mh5_transition_slide",fromTransformClass:"mh5_transition_middle",toTransformClass:"mh5_transition_bottom"},function(){e.constructor.prototype.visibleDidChange.call(e,a,b);m.removeClass(e.root,"mh5_transition_slide","mh5_transition_bottom");if(e===c.details){d.passive=!1;var f=e.parent.model,g=f.selection;d.removePoi(d.getPois());f.data.forEach(function(a){d.createPoi(x.place.getCategoryIcon(a),a)});C.get("trafficIncidentsEnabled")&&
c.traffic.showIncidents();g&&d.showInfoBubble(!~f.data.indexOf(g)?g:d.getPois(g,!0),nokia.mh5.extend({renderOnly:!0},d.infoBubbleParams))}})},0)):this.constructor.prototype.visibleDidChange.apply(this,arguments)}},incidentDetails:A,notification:{control:nokia.mh5.ui.Notification,visible:!1},showNotification:function(a,b){var c=this.notification;c.text=a;c.timeout=b||nokia.mh5.ui.Notification.TIMEOUT_INFINITY;c.visible=!0},resetNotification:function(){var a=this.notification;a.timeout=nokia.mh5.ui.Notification.TIMEOUT_DEFAULT;
a.visible=!1},build:function(){this.constructor.prototype.build.call(this);if(this.transitionBetweenDetails)this._shadowDetails=new nokia.mh5.components.PlaceDetails(nokia.mh5.app.layout.search.details),this._shadowDetails.parent=this;this.traffic.map=this.map},setModel:function(a){function b(){var c=e.parent.details,f;c.visible&&a.showDetails?(d.passive=!0,d.hideInfoBubble(),d.removePoi(d.getPois()),f=d.createPoi(x.place.getCategoryIcon(a.selection),a.selection),d.moveTo(c.getMapCenterToShowPoiInGap(f,
-f.image.height/2))):c.visible=!!a.showDetails}var c=this.model,d=this.map,e=this.details,f=a.searchCenter,g=c.searchCenter;if(a&&a.hasOwnProperty("mapMode"))this.mapMode=a.mapMode||a.showDetails;if(a.data&&c.data!==a.data)c.reset(),c.data=a.data;if(f&&(!g||g.longitude!=f.longitude||g.latitude!=f.latitude))d.center=c.searchCenter=a.searchCenter;if(a.query&&c.query!==a.query&&(c.query=a.query,!a.data&&this.header&&this.header.search))this.header.search.query=a.query,this.header.search.search();if(!a.query&&
a.selection&&c.selection!==a.selection)if(0>c.data.indexOf(a.selection)){if(this.header&&this.header.search)this.header.search.query="";c.reset();e.adapter.fetch(a.selection,null,function(a){c.data=[a];c.selection=a;d.zoom=17;b()},function(){c.selection=a.selection;b()})}else c.selection=a.selection,b();else if(a.selection&&c.selection!==a.selection)c.selection=a.selection,b();if(a.selection&&a.selection.longitude&&a.selection.latitude&&!e.visible)d.center=a.selection;(c.selection&&a.showDetails||
e.visible)&&b()},unitSystemDidChange:function(){this.list.update()},onlineStatusDidChange:function(a){if(this.header&&this.header.search){var b=this.header.search;if(a){if(this._onlinePlaceHolder)b.input.placeholder=this._onlinePlaceHolder;this.resetNotification()}else b.query="",this._onlinePlaceHolder=b.input.placeholder,b.input.placeholder=o("Notification.goOnlinePlaceHolder"),this.model.reset(),this.map.hideInfoBubble()}},onFavouritesChanged:function(a){if(a){var b=this.map.getPois(a,!0),c=new Image;
if(b)c.src=x.place.getCategoryIcon(a),b.infoBubble?b.originalImage=c:c.onload=function(){b.image=c},this.list.update()}},_updateDetails:function(a){var b=this;if(a.incident)b.incidentDetails.incident=a;else if(b.details.visible&&b._shadowDetails){var c=function(){var a=b.details;l.remove(b._shadowDetails,"done",c);b.getContentRoot().insertBefore(b._shadowDetails.root,a.root.nextSibling);b._shadowDetails._scroll.scrollToElement(a.parent.root);b.details=b._shadowDetails;b.details._selectedNearbyCategory=
a._selectedNearbyCategory;b._shadowDetails=a;b._shadowDetails.visible=!1;b.details.visible=!0};l.add(b._shadowDetails,"done",c);b._shadowDetails.place=a}else b.details.place=a},getNavigationState:function(){var a=this.constructor.prototype.getNavigationState.call(this);a.showDetails=this.details.visible;return a},visibleDidChange:function(a,b){this.constructor.prototype.visibleDidChange.call(this,a);nokia.mh5.ui.Control[a?"watch":"removeBinding"](nokia.mh5.components.favourites,"changedFavourite",
this,this.onFavouritesChanged);a&&this.details.visible?this.details.resize():j(this.details);a&&!b&&this.traffic.reloadIncidents()}},route:{model:{from:null,to:null,parameters:{mode:"walk"},selection:null,data:[],reset:function(){this.selection=this.to=this.from=null;this.data=[]}},children:"header,map,traffic,maneuversContainer,detailsClose,incidentDetails,notification".split(","),layout:{type:nokia.mh5.ui.RowLayout},header:{control:nokia.mh5.ui.Container,rootHtmlElementName:"header",cssClass:"mh5_baseBackgroundColor",
children:["route"],route:{control:nokia.mh5.components.Route,children:["inputs","border","mode","fromList","toList"],border:{control:nokia.mh5.ui.Control,cssClass:"mh5_border mh5_secondaryBackgroundColorDark"},inputs:{from:{parameters:B},to:{parameters:B}},mode:{children:["button","timetravel","toggle","go"],cssClass:"mh5_bottomPart",layout:{type:nokia.mh5.ui.ColumnLayout},timetravel:{control:nokia.mh5.ui.Container,cssClass:"mh5_box-flex1"},toggle:{control:nokia.mh5.ui.Button,cssClass:"mh5_maneuvers",
visible:!1,onClick:function(){var a=this.parent.parent.parent.parent.maneuversContainer,b={type:"fade",mode:a.visible?"out":"in",node:a.root,persistence:!0,callback:a.visible&&function(){a.visible=!1;m.removeClass(this.root,"mh5_ListMode");l.fire(nokia.mh5.win,"hideAddressBar")}.bind(this)};nokia.mh5.maps.analytics.log({gn:"directions:maneuvers",c32:a.visible?"close maneuvers":"show maneuvers",v32:"~c32"});m.doTransition(b);if(!a.visible)a.visible=!0,m.addClass(this.root,"mh5_ListMode")},index:0},
go:{control:nokia.mh5.ui.Button,cssClass:"mh5_navigation",visible:!1,onClick:function(){var a=this.getRootOwnerByClass(nokia.mh5.ui.Page),b=this.parent.parent;n.available&&5E4<E.pointDistance(n.coords,b.to)?(b=C.current.unitSystem,a.showNotification(o("Error.tooLongWalkingDistance",{maxWalkingDistance:("mi"==b?30:50)+b}))):(new nokia.mh5.maps.NavigationDisclaimerDialog({onFinish:function(){var b=this.from;nokia.mh5.app.controller.navigate(this.to,(!("name"in b)||b.name==y)&&{shape:a.map.route,maneuvers:a.maneuversContainer.maneuvers.items});
nokia.mh5.maps.analytics.log({gn:"disclaimer",c32:"start navigation",v32:"~c32"})}.bind(b)}),nokia.mh5.maps.analytics.log({gn:"directions:disclaimer",c32:"disclaimer shown",v32:"~c32"}))}}},fromList:{visibleDidChange:function(a){this.constructor.prototype.visibleDidChange.call(this,a);if(a=this.parent.parent.parent)m[this.visible?"addClass":"removeClass"](a.notification.root,"mh5_listmode")}},toList:{visibleDidChange:function(a){this.constructor.prototype.visibleDidChange.call(this,a);if(a=this.parent.parent.parent)m[this.visible?
"addClass":"removeClass"](a.notification.root,"mh5_listmode")}}}},map:{control:nokia.mh5.components.Map,addressLookup:!1,moveToUserPosition:!1,infobubble:{content:["title"],listeners:{click:function(){var a=nokia.mh5.app.controller,b=this.data;b.incident?(b=this.parent.parent,a.updateHistoryEntry(),b.incidentDetails.visible=!0,a.pushHistoryEntry("route",b.getNavigationState(),b.getHash())):b.routeInfo||(c(b),a.details(b))}}},settingsButton:{onClick:function(){var a=this.parent,b=new nokia.mh5.ui.SettingsDialog({traffic:a.traffic,
visibleDidChange:function(b){a.passive=b;this.constructor.prototype.visibleDidChange.apply(this,arguments)}},this.getRootOwnerByClass(nokia.mh5.ui.Page));b.build();b.prepareBindings();b.prepareDidChangeNotifications()}},listeners:{poiclick:function(a){var b=a.data[0];this.parent.model.selection=b.data;nokia.mh5.app.controller.updateHistoryEntry();a.defaultPrevented||(a.preventDefault(),b.infoBubble||(this.hideInfoBubble(this.infoBubbles.filter(i,!1)),b.data.name?this.showInfoBubble(b):this._triggerReverseGeoCoding(b)))},
maplongpress:function(a){this.parent.model.selection=a.data;nokia.mh5.app.controller.updateHistoryEntry();this.hideInfoBubble(this.infoBubbles.filter(i,!1));a.preventDefault()},mapclick:function(a){var b=this.parent.model;if(b.selection)b.selection=null,nokia.mh5.app.controller.updateHistoryEntry();this.hideInfoBubble(this.infoBubbles.filter(i,!1));a.preventDefault()}},_triggerReverseGeoCoding:function(a){var b=this,c=nokia.mh5.adapters.Search,d=a.data;c.reverseGeoCode(d,{appId:this.appId,appCode:this.appCode},
function(e){c.merge(d,e);b.showInfoBubble(a,void 0)})}},traffic:{control:nokia.mh5.components.Traffic,visible:!1},unitSystemBinding:"nokia.mh5.components.settings#current.unitSystem",onlineStatusBinding:"nokia.mh5.components.settings#current.isOnline",unitSystemDidChange:function(){var a=this.model,b=this.map.infoBubbles.filter(i,!0)[0];b&&(this.map.hideInfoBubble(b),w(this.map,a.to,b.data.summary));this.maneuversContainer.maneuvers.renderedItems.forEach(function(a){a.update&&a.update()})},onlineStatusDidChange:function(a,
b){a&&!1===b?this.resetNotification():b&&this.showNotification(o("Notification.goOnline"))},maneuversContainer:{children:["maneuvers","disclaimer"],control:nokia.mh5.ui.Container,cssClass:"mh5_ManeuversContainer",visible:!1,maneuvers:{control:nokia.mh5.ui.List,cssClass:"mh5_List mh5_Maneuvers",itemClass:nokia.mh5.components.RouteListItem},disclaimer:{control:nokia.mh5.ui.Control,cssClass:"mh5_pt_disclaimer mh5_primaryColorBright",visible:!1}},detailsClose:{control:nokia.mh5.ui.Control,visible:!1,
cssClass:"mh5_showDetails"},incidentDetails:A,notification:{control:nokia.mh5.ui.Notification,visible:!1},_pushSearchResultListToHistory:!0,cssClass:"mh5_Page mh5_RoutePage mh5_TrafficPage",build:function(){var a=l.add,b=l.remove,c=this,d=c.map,e=c.header.route.inputs,f=e.from,h=e.to,j=f.input,Y=h.input,D=c.header.route,e=n.status,v=function(){b(c.map.root,"down",this._inputBlurBound);b(c.maneuversContainer.maneuvers.root,"down",this._inputBlurBound)},x=function(b){var d=this,e=D.inputs,f=Y==b.target?
"to":"from",g="from"==f?"to":"from",h=d.value===y&&n.available;c.map.tracking=!1;e[g].visible=!1;m.removeClass(d.root.firstChild,h?"mh5_current":"mh5_"+f);this._inputBlurBound=this._inputBlurBound||function(){h=d.value===y&&n.available;e[g].visible=!0;d.value&&m.addClass(d.root.firstChild,h?"mh5_current":"mh5_"+f);d.blur()};a(c.map.root,"down",this._inputBlurBound);a(c.maneuversContainer.maneuvers.root,"down",this._inputBlurBound)},A=function(a){c.incidentDetails.visible=!1;f==a.target&&a.data.query==
y?(a.preventDefault(),h.visible=!0):C.get("isOnline")?c.showNotification(o("searching")+"..."):(a.preventDefault(),(h==a.target?f:h).visible=!0,c.showNotification(o("Notification.goOnline")))},B=function(a){var b="from"==(h==a.target?"to":"from")?"to":"from",a=0<a.data.results.length;c.listMode=c.listMode||c.maneuversContainer.visible;c.resetNotification();if(a){if(c._pushSearchResultListToHistory)nokia.mh5.app.controller.pushHistoryEntry("route",c.getNavigationState(),c.getHash()),c._pushSearchResultListToHistory=
!1;c.maneuversContainer.visible=!1}else c.showNotification("No results found",nokia.mh5.ui.Notification.TIMEOUT_DEFAULT),D.inputs[b].visible=!0},F=function(a){var b=D.toList==a.target?"to":"from",e=c.model;D.mode.toggle.visible=c.maneuversContainer.visible=c.listMode;c.listMode=!1;m.addClass(D.inputs[b].input.root.firstChild,"mh5_"+b);D.inputs["to"==b?"from":"to"].visible=!0;c[b+"Poi"]&&d.removePoi(c[b+"Poi"]);c[b+"Poi"]=d.createPoi(nokia.mh5.assetsPath+"img/"+b+".png",a.data.item);c[b+"Poi"].privilegeLevel=
1;if(!n.available)e[b]=D[b],e.parameters=D.parameters,nokia.mh5.app.controller.updateHistoryEntry()};c.constructor.prototype.build.call(this);a(j,"focus",x);a(j,"blur",v);a(Y,"focus",x);a(Y,"blur",v);a(f,"beforesearch",A);a(h,"beforesearch",A);a(f,"success",B);a(h,"success",B);a(D,"beforeroute",function(a){var b=a.data,e=D.mode,f=this.inputs.from.input,g=this.inputs.to.input,h=b.from,p=b.to,i=b.parameters.mode,t=c.model;if("pt"==i)this.originalMapSchema=C.get("mapSchema"),C.set("mapSchema","normal.day.grey");
else if(this.originalMapSchema)C.set("mapSchema",this.originalMapSchema),this.originalMapSchema=null;d.box=[h,p];d._map.route=[];d.hideInfoBubble();c.fromPoi&&d.removePoi(c.fromPoi);c.toPoi&&d.removePoi(c.toPoi);m.removeClass(f.root.firstChild,"mh5_from","mh5_current");m.removeClass(g.root.firstChild,"mh5_to");c.fromPoi=d.createPoi(nokia.mh5.assetsPath+"img/from.png",h);c.toPoi=d.createPoi(nokia.mh5.assetsPath+"img/to.png",p);c.fromPoi.privilegeLevel=c.toPoi.privilegeLevel=1;m.addClass(f.root.firstChild,
h.name?"mh5_from":"mh5_current");m.addClass(g.root.firstChild,"mh5_to");t.from=h;t.to=p;t.parameters=b.parameters;c.visible&&nokia.mh5.app.controller.updateHistoryEntry();c.traffic&&c.traffic.reloadIncidents();"walk"==i&&5E4<E.pointDistance(h,p)?(b=C.current.unitSystem,c.showNotification(o("Error.routeTooLong",{maxWalkingDistance:("mi"==b?30:50)+b})),e.toggle.visible=e.go.visible=!1,a.preventDefault()):c.showNotification(o("Notification.routeCalculation"))});a(D,"success",function(a){var b=this.parameters.mode,
e=D.mode,f=D.inputs,a=a.data,h=c.model,p=d.infoBubbles.filter(i,!0)[0],t;t=a.shape;c.timeTraveling?c.showNotification(o("Notification.trafficInBeta"),nokia.mh5.ui.Notification.TIMEOUT_DEFAULT):c.resetNotification();nokia.mh5.dom["pt"==b&&a.summary.disclaimers?"addClass":"removeClass"](c.maneuversContainer.root,"mh5_pt_disclaimer");"pt"==b?(c.maneuversContainer.disclaimer.root.innerHTML=o("RA.disclaimer"),a.summary.disclaimers&&a.summary.disclaimers.forEach(function(a){c.maneuversContainer.disclaimer.root.innerHTML+=
m.createHyperlinkHTML({href:a.link,target:"_blank"},a.name)}),c.maneuversContainer.disclaimer.visible=!!a.summary.disclaimers):c.maneuversContainer.disclaimer.visible="pt"==b;c.maneuversContainer.maneuvers.items=a.maneuvers;e.toggle.visible=f.from.visible=f.to.visible=!0;g.setTimeout(function(){d._map.route=t},10);d.box=a.box||t;p&&d.hideInfoBubble(p);w(d,h.to,a.summary);c._pushSearchResultListToHistory=!0;nokia.mh5.maps.analytics.log({gn:"directions",c32:"route displayed",ev:"event26",c35:b,v35:"~c35"})});
a(D,"error",function(a){var b=D.mode;nokia.mh5.dom.removeClass(c.maneuversContainer.root,"mh5_pt_disclaimer");b.toggle.visible=c.listMode||c.maneuversContainer.visible;b.go.visible=!1;D.inputs.from.visible=D.inputs.to.visible=!0;c.maneuversContainer.disclaimer.visible=!1;c.showNotification(a.data.message||o("Notification.noRoutingService"),nokia.mh5.ui.Notification.TIMEOUT_DEFAULT);c.maneuversContainer.maneuvers.items=[{itemClass:u}];c._pushSearchResultListToHistory=!0});a(D,"clear",function(){var a=
D.inputs,b=D.mode,e=c.model;D.from||d.removePoi(c.fromPoi);D.to||d.removePoi(c.toPoi);d.route=[];var f=d.infoBubbles.filter(i,!0)[0];d.hideInfoBubble(f);c.maneuversContainer.maneuvers.items=[];a.from.visible=a.to.visible=!0;b.go.visible=b.toggle.visible=!1;e.from=D.from;e.to=D.to;e.parameters=D.parameters;nokia.mh5.app.controller.updateHistoryEntry()});a(D.fromList,"tap",F);a(D.toList,"tap",F);a(n,"positionactivate",function(){var a=D.mode.go,b=!(q.android&&2.2>=q.android.version)&&"walk"==D.parameters.mode;
D.to||c.resetNotification();if(!c.fromPoi)c.fromPoi=d.createPoi(nokia.mh5.assetsPath+"img/from.png",{latitude:n.latitude,longitude:n.longitude,name:y});c.fromPoi.privilegeLevel=1;j.value==y||""===j.value?(m.addClass(j.root.firstChild,"mh5_current"),a.visible=b&&!!D.to&&5E4>E.pointDistance(n.coords,D.to)):a.visible=b&&!(!D.to||!D.from)});a(n,["positionerror","positionlost","positiondeactivate"],function(){D.mode.go.visible=!1;D.from||c.showNotification(o("Notification.cantFindLocation"))});nokia.mh5.ui.Control.watch(this.model,
"selection",this,function(a){c.incidentDetails.incident=a&&a.incident?a:null});if(("inactive"==e||"waiting"==e||"error"==e)&&(!D.from||!D.from.latitude||!D.from.longitude))c.showNotification(o("Notification.lookingForCurrentPosition")),("inactive"==e||"error"==e)&&n.activate();this.traffic.map=d},showNotification:function(a,b){var c=this.notification;c.timeout=b||nokia.mh5.ui.Notification.TIMEOUT_INFINITY;c.text=a;c.visible=!0},resetNotification:function(){var a=this.notification;a.timeout=nokia.mh5.ui.Notification.TIMEOUT_DEFAULT;
a.visible=!1},visibleDidChange:function(a,b){var c=this.header.route,d=c.inputs,e=d.from.input,f=e.root.firstChild,d=d.to.input.root.firstChild,g=this.map;nokia.mh5.maps.analytics.logIfVisible(this,{gn:"directions",c32:"directions"});(g.visible=a)&&!b&&this.traffic.reloadIncidents();if(n.available&&(""===e.value||e.value==y)){if(!this.fromPoi)this.fromPoi=g.createPoi(nokia.mh5.assetsPath+"img/from.png",n.coords);this.fromPoi.privilegeLevel=1;e.value=y;m.addClass(f,"mh5_current")}else m.removeClass(f,
"mh5_from","mh5_current"),m.removeClass(d,"mh5_to"),c.from&&m.addClass(f,"mh5_from"),c.to&&m.addClass(d,"mh5_to")},setModel:function(a){var b=this.header.route,c=this.model,d=this.map,e=this.traffic,f=l.add;if(a.traffic&&!c.traffic)c.traffic=b.traffic=!0,c.parameters=b.parameters={mode:"drive"},C.isFirstTime=!1,f(n,"positionactivate",function(){d.zoom=11}),f(n,["positionerror","positionlost","positiondeactivate"],function(){d.zoom=9}),l.one(d,"ready",function(){e.enableTraffic()});if(!a.showDetails&&
this.incidentDetails.visible)this.incidentDetails.visible=!1;this._pushSearchResultListToHistory=!0;b.fromList.visible=b.toList.visible=!1;b.inputs.from.visible=b.inputs.to.visible=!0;if(this.listMode)this.maneuversContainer.visible=!0;f=function(){if(c.parameters!=a.parameters)c.parameters=b.parameters=a.parameters||b.parameters||{mode:"walk"};if(c.from!=a.from)c.from=b.from=a.from||b.from;if(c.to!=a.to)c.to=b.to=a.to||b.to;var d=b.inputs.from.input.value==y;b.inputs.from.input.value=c.from&&c.from.name||
(n.available?y:"");c.from&&(d=b.inputs.from.input.value==y,m.addClass(b.inputs.from.input.root.firstChild,d?"mh5_current":"mh5_from"));c.to?(b.inputs.to.input.value=c.to.name||"",m.addClass(b.inputs.to.input.root.firstChild,"mh5_to")):b.inputs.to.input.value=""};if(!1===d.isReady)l.one(d,"ready",f);else f()}},share:{children:["storyCreator"],model:{data:null},storyCreator:{control:nokia.mh5.connectors.story.StoryCreator},setModel:function(a){this.model.data=a.data;this.storyCreator.update(a.data)},
visibleDidChange:function(a){this.constructor.prototype.visibleDidChange.call(this,a);this.storyCreator.visible=a}},favourites:{children:["favourites"],cssClass:"mh5_Page mh5_FavouritePage",favourites:{control:nokia.mh5.connectors.favourites.FavouritesViewer},visibleDidChange:function(a){this.constructor.prototype.visibleDidChange.call(this,a);this.favourites.visible=a}}}})(nokia.mh5.win);nokia.mh5.provide("nokia.mh5.components.PlaceTabletListItem");
nokia.mh5.components.PlaceTabletListItem=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){return{rootHtmlElementName:"li",cssClass:"mh5_ListItem",constructor:function(a,b){g.constructor.call(this,a,b);this.update()},update:function(){var a,b=!(!this.distance||!this.ratingValue),d=/(\d+(\.\d+)?)(\w+)/;a=""+('<img src="'+nokia.mh5.utils.place.getCategoryIcon(this)+'"></img>');a=a+'<div class="mh5_RowLayout"><div class="mh5_ListItem_name">'+(!this.placeId&&this.name?this.name.split(",")[0]:this.name);
a+="</div>";this.address&&(a=a+'<div class="mh5_ListItem_address">'+(this.address.replace(/(.*?)\,\ (.*)/,'$1,<br><span class="mh5_ellipsis">$2</span>')+"</div>"));b&&(a+='<div class="mh5_ColumnLayout">');if(this.ratingValue)this._rating=this._rating||new nokia.mh5.ui.Rating,this._rating.value=this.ratingValue,a+=this._rating.root.outerHTML;this.distance&&(d=nokia.mh5.utils.formatDistance(this.distance,nokia.mh5.components.settings.current.unitSystem).match(d),a+='<div class="mh5_ListItem_distance"><span>'+
d[1]+"</span>"+d[3]+"</div>");b&&(a+="</div>");this.root.innerHTML=a}}});nokia.mh5.provide("nokia.mh5.app.tabletLayout");
(function(){nokia.mh5.app.tabletLayout={search:{cssClass:"mh5_Page mh5_SearchPage",header:{children:["search"]},list:{layout:{type:nokia.mh5.ui.ColumnLayout},itemClass:nokia.mh5.components.PlaceTabletListItem,hScroll:!0,itemsDidChange:function(a){this.constructor.prototype.itemsDidChange.call(this,a);this.visible=0<a.length?!0:!1;this.parent.map.resize()},listeners:{tap:function(a){var a=a.data.item,b=this.parent,d=b.map,e=nokia.mh5.app.controller;b.model.selection!==a?(this.parent.model.selection=
a,e.updateHistoryEntry(),d.hideInfoBubble(),d.showInfoBubble(d.getPois(a,!0))):(b.details.visible=!0,e.pushHistoryEntry("search",b.getNavigationState(),b.getHash()),b.openDetailsTracking(a))}}},build:function(){nokia.mh5.app.commonLayout.search.build.call(this);var a=this.header;if(a&&a.search){var b=a.search.input,d=nokia.mh5.event.add;d(b,"focus",function(){this.map.tracking=!1;if(!this._mapTapEventHandler)this._mapTapEventHandler=function(){b.blur();if(nokia.mh5.platform.android){var a=document.createElement("input");
a.setAttribute("type","text");document.body.appendChild(a);setTimeout(function(){a.focus();setTimeout(function(){a.setAttribute("style","display:none;");document.body.removeChild(a)},5)},5)}},d(this.map.root,"down",this._mapTapEventHandler);d(this.map.root,"down",this._mapTapEventHandler);d(this.list.root,"down",this._mapTapEventHandler)}.bind(this));d(b,"blur",function(){nokia.mh5.event.remove(this.map.root,"down",this._mapTapEventHandler);nokia.mh5.event.remove(this.list.root,"down",this._mapTapEventHandler)}.bind(this))}nokia.mh5.ui.Control.watch(this.model,
"selection",this,function(a,b){var d=this.list;if(b){var c=d.items.indexOf(b);0<=c&&(nokia.mh5.dom.removeClass(d.renderedItems[c].root,"mh5_selected"),nokia.mh5.dom.removeClass(d.root,"mh5_selected"))}if(a){this._updateDetails(a);var g=d.items.indexOf(a);if(0<=g&&(nokia.mh5.dom.addClass(d.renderedItems[g].root,"mh5_selected"),nokia.mh5.dom.addClass(d.root,"mh5_selected"),d._scroll)){var c=d.root.offsetLeft,i=d.root.offsetWidth,m=c+i,l=d.renderedItems[g].root.offsetLeft,g=d.renderedItems[g].root.offsetWidth,
n=l+g,o=d._scroll.x;l+o<c?d.scrollTo(-l+g/2,0):n+o>m&&d.scrollTo(-l+i-3*g/2,0)}}});nokia.mh5.ui.Control.watch(this.model,"data",this,function(a,b){if(0<a.length)this.list.items=a,a.forEach(function(a){this.map.createPoi(nokia.mh5.utils.place.getCategoryIcon(a),a)}.bind(this));else if(b&&0!==b.length)this.list.items=[],nokia.mh5.components.Traffic.removeNonTrafficPois(this.map)})},onFavouritesChanged:function(a){nokia.mh5.app.commonLayout.search.onFavouritesChanged.call(this,a);a=this.list.items.indexOf(this.model.selection);
0<=a&&nokia.mh5.dom.addClass(this.list.renderedItems[a].root,"mh5_selected")},unitSystemDidChange:function(){nokia.mh5.app.commonLayout.search.unitSystemDidChange.call(this);var a=this.list;if(this.model.selection){var b=a.items.indexOf(this.model.selection);0<=b&&(nokia.mh5.dom.addClass(a.renderedItems[b].root,"mh5_selected"),nokia.mh5.dom.addClass(a.root,"mh5_selected"))}},visibleDidChange:function(a){nokia.mh5.app.commonLayout.search.visibleDidChange.apply(this,arguments);this.map.visible=a}}};
var g={};nokia.mh5.extendDeep(g,nokia.mh5.app.commonLayout);nokia.mh5.extendDeep(g,nokia.mh5.app.tabletLayout);g.controller=nokia.mh5.app.commonLayout.controller;nokia.mh5.app.tabletLayout=g})(nokia.mh5.win);nokia.mh5.provide("nokia.mh5.app.phoneLayout");
(function(){var g=nokia.mh5.i18n;nokia.mh5.app.phoneLayout={search:{children:"header,map,traffic,detailsClose,list,details,incidentDetails,noResults,notification".split(","),cssClass:"mh5_Page mh5_SearchPage",noResults:{cssClass:"mh5_noresults",control:nokia.mh5.ui.Control,innerHTML:'<div class="mh5_noresultstxt">'+g("Notification.noResult")+"</div>",visible:!1},mapMode:!0,mapModeDidChange:function(a,b){if(void 0!==b){var d=this,e=d.map,g=d.details,f=d.model,c=0<f.data.length?d.list:d.noResults,j=
{type:"fade",mode:d.mapMode?"out":"in",node:c.root,persistence:!0};if(d.header)nokia.mh5.dom[a?"removeClass":"addClass"](d.header.toggle.root,"mh5_ListMode");d.mapMode?(j.callback=function(){e.resize();c.visible=!1;if(d._showDetailsAfterListFading&&f.selection)g.visible=!0,d._showDetailsAfterListFading=!1},e.visible=!0,nokia.mh5.event.fire(nokia.mh5.win,"hideAddressBar",{},!0,!0)):(j.callback=function(){e.visible=!1},c.visible=!0);nokia.mh5.dom.doTransition(j)}},header:{children:["search","toggle"],
layout:{type:nokia.mh5.ui.ColumnLayout},search:{listeners:{clear:function(){nokia.mh5.app.commonLayout.search.header.search.listeners.clear.call(this);var a=this.parent.parent;if(!a.mapMode)a.mapMode=!0,a.header.toggle.visible=!1;nokia.mh5.app.controller.updateHistoryEntry()}}},toggle:{control:nokia.mh5.ui.Button,cssClass:"mh5_Button mh5_modeToggle",visible:!1,onClick:function(){var a=this.parent.parent;nokia.mh5.maps.analytics.log({gn:a.mapMode?"map:list":"list:map",c32:a.mapMode?"list toggle":"map toggle",
v32:"~c32"});a.mapMode=!a.mapMode}}},list:{itemClass:nokia.mh5.components.PlaceListItem,itemsDidChange:function(a){this.constructor.prototype.itemsDidChange.call(this,a);var b=this.parent,d=b.header&&b.header.toggle,a=0<a.length;b.mapMode?d&&!b.details.visible&&(d.visible=a):(this.visible=a,b.noResults.visible=!a)},listeners:{tap:function(a){var a=a.data.item,b=this.parent,d=b.map,e=nokia.mh5.app.controller;if(b.model.selection!==a)b.model.selection=a,d.hideInfoBubble(),d.showInfoBubble(d.getPois(a,
!0));b.model.mapMode=!1;e.updateHistoryEntry();e.pushHistoryEntry("search",b.getNavigationState(),b.getHash());b._showDetailsAfterListFading=b.mapMode=!0;b.openDetailsTracking(a)}}},details:{visibleDidChange:function(a){var b=this.parent;if(b&&this!==b._shadowDetails){var d=b.header&&b.header.toggle;d&&(d.visible=!a&&0<b.model.data.length)}nokia.mh5.app.commonLayout.search.details.visibleDidChange.apply(this,arguments)}},incidentDetails:{visibleDidChange:function(a){var b=this.parent,d=b.header&&
b.header.toggle;if(d)d.visible=!a&&0<b.model.data.length;nokia.mh5.app.commonLayout.search.incidentDetails.visibleDidChange.apply(this,arguments)}},build:function(){nokia.mh5.app.commonLayout.search.build.call(this);var a=this.header;if(a&&a.search){var b=a.search.input,d=nokia.mh5.event.add;d(b,"focus",function(){this.map.tracking=!1;a.toggle.visible=!1;if(!this._mapTapEventHandler)this._mapTapEventHandler=function(){b.blur();if(nokia.mh5.platform.android){var a=document.createElement("input");a.setAttribute("type",
"text");document.body.appendChild(a);setTimeout(function(){a.focus();setTimeout(function(){a.setAttribute("style","display:none;");document.body.removeChild(a)},5)},5)}},d(this.map.root,"down",this._mapTapEventHandler)}.bind(this));d(b,"blur",function(){nokia.mh5.event.remove(this.map.root,"down",this._mapTapEventHandler);this._mapTapEventHandler=null;a.toggle.visible=!(!this.model.data.length&&this.mapMode||this.details.visible)}.bind(this))}nokia.mh5.ui.Control.watch(this.model,"data",this,function(a,
b){if(0<a.length)this.list.items=a,a.forEach(function(a){this.map.createPoi(nokia.mh5.utils.place.getCategoryIcon(a),a)}.bind(this));else if(b&&0!==b.length)this.list.items=[],nokia.mh5.components.Traffic.removeNonTrafficPois(this.map)});nokia.mh5.ui.Control.watch(this.model,"selection",this,function(a){a&&this._updateDetails(a)})},visibleDidChange:function(a){nokia.mh5.app.commonLayout.search.visibleDidChange.apply(this,arguments);if(this.mapMode)this.map.visible=a}}};g={};nokia.mh5.extendDeep(g,
nokia.mh5.app.commonLayout);nokia.mh5.extendDeep(g,nokia.mh5.app.phoneLayout);g.controller=nokia.mh5.app.commonLayout.controller;nokia.mh5.app.phoneLayout=g})(nokia.mh5.win);nokia.mh5.provide("nokia.mh5.app.configurator");
(function(){var g=nokia.mh5.resolve,a=nokia.mh5.components.settings,b=Object.prototype.hasOwnProperty,d={search:{searchAdapter:"header.search",placeholder:"header.search.input"}},e=["phone","tablet"],h=["from","to"];nokia.mh5.app.configure=function(f,c){var j,i,m,l,n=f.phoneLayout,o=f.tabletLayout,q=nokia.mh5.extendDeep,x=c.details&&c.details.customContent;c.distanceUnit&&a.set("unitSystem",c.distanceUnit);c.positionDisabled&&nokia.mh5.geolocation.disable();if(c.details&&(delete c.details.customContent,
m=n.search.details,l=o.search.details,q(m,c.details),q(l,c.details),x))m.customContent=[].concat(m.customContent).concat(x),l.customContent=[].concat(l.customContent).concat(x),c.details.customContent=x;if(b.call(c,"search")&&!c.search)n.search.header=o.search.header=null;if(c.map){c.map.schema&&a.set("mapSchema",c.map.schema);m=n.search.map;l=o.search.map;j=n.route.map;i=o.route.map;if(b.call(c.map,"positionButton")&&!c.map.positionButton)m.positionButton=l.positionButton=j.positionButton=i.positionButton=
null;if(b.call(c.map,"settingsButton")&&!c.map.settingsButton)m.settingsButton=l.settingsButton=j.settingsButton=i.settingsButton=null}if(c.route)for(m=0;l=e[m];m++)for(q=0;x=h[q];q++)if(i=c.route[x+"Placeholder"])j=f[l+"Layout"].route.header.route.inputs[x],j.input=j.input||{},j.input.placeholder=i;for(j in d)if(b.call(c,j)&&c[j])for(i in d[j])b.call(c[j],i)&&(m=g(d[j][i],n[j]),l=g(d[j][i],o[j]),m[i]=l[i]=c[j][i])}})(nokia.mh5.win);nokia.mh5.provide("nokia.mh5.app.Application");
(function(){var g=nokia.mh5.i18n,a=nokia.mh5.components.settings;nokia.mh5.app.Application=new nokia.mh5.Class(function(){return{layouts:["phoneLayout","tabletLayout"],phoneLayout:nokia.mh5.app.phoneLayout,tabletLayout:nokia.mh5.app.tabletLayout,constructor:function(a){nokia.mh5.extendDeep(this,a);if(this.appId)nokia.mh5.appId=this.appId;if(this.appCode)nokia.mh5.appCode=this.appCode;if(!nokia.mh5.appId||!nokia.mh5.appCode)throw Error(g("Error.applicationCredential"));this.configuration&&nokia.mh5.app.configure(this,
this.configuration);var d=this.getLayout(),e=nokia.mh5.app.layout=this[d],h=nokia.mh5.app.controller=e.controller;h.manipulateUrl=a.manipulateUrl||!1;h.browserHistory=void 0===this.browserHistory?!0:this.browserHistory;this.hideAddressBar&&(nokia.mh5.dom.addEvent(nokia.mh5.win,"load",nokia.mh5.platform.hideAddressBar,!1),nokia.mh5.dom.addEvent(nokia.mh5.win,"hideAddressBar",nokia.mh5.platform.hideAddressBar,!1),nokia.mh5.dom.addEvent(nokia.mh5.win,"orientationchange",nokia.mh5.platform.hideAddressBar,
!1),nokia.mh5.event.fire(nokia.mh5.win,"orientationchange",{},!0,!0));h.domNode=this.domNode?nokia.mh5.doc.querySelector(this.domNode):nokia.mh5.doc.body;this.bindIsOnline();nokia.mh5.sso.init();nokia.mh5.dom.addClass(h.domNode,"mh5_app");nokia.mh5.dom.addClass(h.domNode,"mh5_"+d);"default"===nokia.mh5.platform.android.browser&&4<=nokia.mh5.platform.android.version&&nokia.mh5.dom.addClass(h.domNode,"mh5_android4");h.setConfiguration(e);if(!e.pages||!e.pages.length)throw Error("no pages are defined in "+
d);if(!~e.pages.indexOf(e.initialPage))e.initialPage=e.pages[0];h.switchTo(e.initialPage,this.startParams||{},{replaceLastHistoryEntry:!0});this.checkForOfflineMaps()},checkForOfflineMaps:function(){function b(b){a.set("hasOfflineMaps",!!b)}var d=nokia.mh5,e=d.app.controller.getMap(),g=e&&e.schema;d.platform.offlineStorageSupported?"normal.day"==g&&!a.current.isOnline&&e.showStoredTiles(b,b):setTimeout(b,0,0)},bindIsOnline:function(){function b(b){a.set("isOnline","online"==b.type)}a.set("isOnline",
nokia.mh5.win.navigator.onLine);nokia.mh5.win.addEventListener("online",b,!1);nokia.mh5.win.addEventListener("offline",b,!1)},getLayout:function(){return 1==this.layouts.length?this.layouts[0]:nokia.mh5.platform.phone?"phoneLayout":"tabletLayout"}}});nokia.mh5.app.embed=function(a){return new nokia.mh5.app.Application(a)}})(nokia.mh5.win);nokia.mh5.provide("nokia.mh5.internals.LoginDialog");
nokia.mh5.internals.LoginDialog=new nokia.mh5.Class(nokia.mh5.ui.Dialog,function(){return{allowScrolling:!0,content:{cssClass:"mh5_LoginDialog",control:nokia.mh5.ui.Control,rootHtmlElementName:"iframe",build:function(){this.root.src="http://demo.maps.public.devbln.europe.nokia.com/mh5test/server/sso/login_frame.php"}}}});nokia.mh5.provide("nokia.mh5.xhr");
(function(){nokia.mh5.xhr=function(g){var a=new XMLHttpRequest,b=g.handler,d=g.errorHandler,e=g.uri;a.onreadystatechange=function(){if(4==a.readyState)if(a.status&&(200>a.status||299<a.status))d&&d(Error("nokia.mh5.xhr: Error while loading "+e+": "+a.statusText||"unknown error occured"));else if(b)try{var h;a:switch(g.handleAs){case "JSON":h=a.responseText?JSON.parse(a.responseText):{};break a;case "XML":h=a.responseXML||{};break a;default:h=a.responseText}b(h)}catch(f){d&&d(f)}};a.open(g.method||
"GET",e,!g.sync);g.headers&&nokia.mh5.each(g.headers,function(b,d){a.setRequestHeader(d,b)});if("withCredentials"in a)a.withCredentials=!0;a.send(g.payload||null)}})();nokia.mh5.provide("nokia.mh5.ui.ProgressBar");
nokia.mh5.ui.ProgressBar=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){return{rootHtmlElementName:"div",innerHTML:"<div class='left'></div><div class='right'></div><div class='overlay'><div><div class='left'></div><div class='right'></div></div></div>",cssClass:"mh5_ProgressBar",progressRatio:0,targetProgressRatio:0,progressIncrement:0.02,refreshTimeout:1E3/30,constructor:function(){g.constructor.apply(this,arguments);this.refresh=this.refresh.bind(this);this.update()},update:function(){this.refresh()},
setProgress:function(a){a=Math.min(1,a);this.targetProgressRatio=a=Math.max(0,a);this.refresh()},refresh:function(){var a=this.targetProgressRatio-this.progressRatio,b;if(a)b=Math.abs(a),b<=this.progressIncrement?this.progressRatio=this.targetProgressRatio:(a/=Math.abs(a),this.progressRatio+=a*this.progressIncrement,setTimeout(this.refresh,this.refreshTimeout)),this.updateProgressDOM()},updateProgressDOM:function(){var a=this.root.children[0],b=this.root.children[1],d=this.root.children[2],e=d.children[0],
g=a.clientWidth+b.clientWidth;d.style.width=this.progressRatio*(a.clientWidth+2*b.clientWidth)+"px";e.style.width=g+"px"}}});var mappings={search:"search",details:"search",route:"route"};
(function(g,a){function b(a){if(""===h)return a;a=a.charAt(0).toUpperCase()+a.substr(1);return h+a}var d=Math,e=a.createElement("div").style,h=function(){for(var a="t,webkitT,MozT,msT,OT".split(","),b,c=0,d=a.length;c<d;c++)if(b=a[c]+"ransform",b in e)return a[c].substr(0,a[c].length-1);return!1}(),f=h?"-"+h.toLowerCase()+"-":"",c=b("transform"),j=b("transitionProperty"),i=b("transitionDuration"),m=b("transformOrigin"),l=b("transitionTimingFunction"),n=b("transitionDelay"),o=/android/gi.test(navigator.appVersion),
q=/iphone|ipad/gi.test(navigator.appVersion),x=/hp-tablet/gi.test(navigator.appVersion),C=b("perspective")in e,E="ontouchstart"in g&&!x,F=!!h,y=b("transition")in e,B="onorientationchange"in g?"orientationchange":"resize",v=E?"touchstart":"mousedown",w=E?"touchmove":"mousemove",A=E?"touchend":"mouseup",u=E?"touchcancel":"mouseup",z="Moz"==h?"DOMMouseScroll":"mousewheel",J;J=!1===h?!1:{"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"}[h];var K=
function(){return g.requestAnimationFrame||g.webkitRequestAnimationFrame||g.mozRequestAnimationFrame||g.oRequestAnimationFrame||g.msRequestAnimationFrame||function(a){return setTimeout(a,1)}}(),I=g.cancelRequestAnimationFrame||g.webkitCancelAnimationFrame||g.webkitCancelRequestAnimationFrame||g.mozCancelRequestAnimationFrame||g.oCancelRequestAnimationFrame||g.msCancelRequestAnimationFrame||clearTimeout,H=C?" translateZ(0)":"",x=function(b,d){var e=this,h;e.wrapper="object"==typeof b?b:a.getElementById(b);
e.wrapper.style.overflow="hidden";e.scroller=e.wrapper.children[0];e.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,handleClick:!0,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:o,hideScrollbar:q,fadeScrollbar:q&&C,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(a){a.preventDefault()},onScrollStart:null,
onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(h in d)e.options[h]=d[h];e.x=e.options.x;e.y=e.options.y;e.options.useTransform=F&&e.options.useTransform;e.options.hScrollbar=e.options.hScroll&&e.options.hScrollbar;e.options.vScrollbar=e.options.vScroll&&e.options.vScrollbar;e.options.zoom=e.options.useTransform&&e.options.zoom;e.options.useTransition=y&&e.options.useTransition;e.options.zoom&&
o&&(H="");e.scroller.style[j]=e.options.useTransform?f+"transform":"top left";e.scroller.style[i]="0";e.scroller.style[m]="0 0";e.options.useTransition&&(e.scroller.style[l]="cubic-bezier(0.33,0.66,0.66,1)");e.options.useTransform?e.scroller.style[c]="translate("+e.x+"px,"+e.y+"px)"+H:e.scroller.style.cssText+=";position:absolute;top:"+e.y+"px;left:"+e.x+"px";if(e.options.useTransition)e.options.fixedScrollbar=!0;e.refresh();e._bind(B,g);e._bind(v);E||"none"!=e.options.wheelAction&&e._bind(z);if(e.options.checkDOMChanges)e.checkDOMTime=
setInterval(function(){e._checkDOMChanges()},500)};x.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(a){switch(a.type){case v:if(!E&&0!==a.button)break;this._start(a);break;case w:this._move(a);break;case A:case u:this._end(a);break;case B:this._resize();break;case z:this._wheel(a);break;case J:this._transitionEnd(a)}},_checkDOMChanges:function(){!this.moved&&!this.zoomed&&!(this.animating||this.scrollerW==
this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale)&&this.refresh()},_scrollbar:function(b){var e;if(this[b+"Scrollbar"]){if(!this[b+"ScrollbarWrapper"]){e=a.createElement("div");this.options.scrollbarClass?e.className=this.options.scrollbarClass+b.toUpperCase():e.style.cssText="position:absolute;z-index:100;"+("h"==b?"height:7px;bottom:1px;left:2px;right:"+(this.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(this.hScrollbar?"7":"2")+"px;top:2px;right:1px");
e.style.cssText+=";pointer-events:none;"+f+"transition-property:opacity;"+f+"transition-duration:"+(this.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(this.options.hideScrollbar?"0":"1");this.wrapper.appendChild(e);this[b+"ScrollbarWrapper"]=e;e=a.createElement("div");if(!this.options.scrollbarClass)e.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+f+"background-clip:padding-box;"+f+"box-sizing:border-box;"+("h"==b?
"height:100%":"width:100%")+";"+f+"border-radius:3px;border-radius:3px";e.style.cssText+=";pointer-events:none;"+f+"transition-property:"+f+"transform;"+f+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+f+"transition-duration:0;"+f+"transform: translate(0,0)"+H;this.options.useTransition&&(e.style.cssText+=";"+f+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)");this[b+"ScrollbarWrapper"].appendChild(e);this[b+"ScrollbarIndicator"]=e}"h"==b?(this.hScrollbarSize=this.hScrollbarWrapper.clientWidth,
this.hScrollbarIndicatorSize=d.max(d.round(this.hScrollbarSize*this.hScrollbarSize/this.scrollerW),8),this.hScrollbarIndicator.style.width=this.hScrollbarIndicatorSize+"px",this.hScrollbarMaxScroll=this.hScrollbarSize-this.hScrollbarIndicatorSize,this.hScrollbarProp=this.hScrollbarMaxScroll/this.maxScrollX):(this.vScrollbarSize=this.vScrollbarWrapper.clientHeight,this.vScrollbarIndicatorSize=d.max(d.round(this.vScrollbarSize*this.vScrollbarSize/this.scrollerH),8),this.vScrollbarIndicator.style.height=
this.vScrollbarIndicatorSize+"px",this.vScrollbarMaxScroll=this.vScrollbarSize-this.vScrollbarIndicatorSize,this.vScrollbarProp=this.vScrollbarMaxScroll/this.maxScrollY);this._scrollbarPos(b,!0)}else this[b+"ScrollbarWrapper"]&&(F&&(this[b+"ScrollbarIndicator"].style[c]=""),this[b+"ScrollbarWrapper"].parentNode.removeChild(this[b+"ScrollbarWrapper"]),this[b+"ScrollbarWrapper"]=null,this[b+"ScrollbarIndicator"]=null)},_resize:function(){var a=this;setTimeout(function(){a.refresh()},o?200:0)},_pos:function(a,
b){if(!this.zoomed)a=this.hScroll?a:0,b=this.vScroll?b:0,this.options.useTransform?this.scroller.style[c]="translate("+a+"px,"+b+"px) scale("+this.scale+")"+H:(a=d.round(a),b=d.round(b),this.scroller.style.left=a+"px",this.scroller.style.top=b+"px"),this.x=a,this.y=b,this._scrollbarPos("h"),this._scrollbarPos("v")},_scrollbarPos:function(a,b){var e="h"==a?this.x:this.y;if(this[a+"Scrollbar"])e*=this[a+"ScrollbarProp"],0>e?(this.options.fixedScrollbar||(e=this[a+"ScrollbarIndicatorSize"]+d.round(3*
e),8>e&&(e=8),this[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=e+"px"),e=0):e>this[a+"ScrollbarMaxScroll"]&&(this.options.fixedScrollbar?e=this[a+"ScrollbarMaxScroll"]:(e=this[a+"ScrollbarIndicatorSize"]-d.round(3*(e-this[a+"ScrollbarMaxScroll"])),8>e&&(e=8),this[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=e+"px",e=this[a+"ScrollbarMaxScroll"]+(this[a+"ScrollbarIndicatorSize"]-e))),this[a+"ScrollbarWrapper"].style[n]="0",this[a+"ScrollbarWrapper"].style.opacity=b&&this.options.hideScrollbar?
"0":"1",this[a+"ScrollbarIndicator"].style[c]="translate("+("h"==a?e+"px,0)":"0,"+e+"px)")+H},_start:function(a){var b=E?a.touches[0]:a,e,f;if(this.enabled){this.options.onBeforeScrollStart&&this.options.onBeforeScrollStart.call(this,a);(this.options.useTransition||this.options.zoom)&&this._transitionTime(0);this.zoomed=this.animating=this.moved=!1;this.dirY=this.dirX=this.absDistY=this.absDistX=this.distY=this.distX=0;if(this.options.zoom&&E&&1<a.touches.length)f=d.abs(a.touches[0].pageX-a.touches[1].pageX),
e=d.abs(a.touches[0].pageY-a.touches[1].pageY),this.touchesDistStart=d.sqrt(f*f+e*e),this.originX=d.abs(a.touches[0].pageX+a.touches[1].pageX-2*this.wrapperOffsetLeft)/2-this.x,this.originY=d.abs(a.touches[0].pageY+a.touches[1].pageY-2*this.wrapperOffsetTop)/2-this.y,this.options.onZoomStart&&this.options.onZoomStart.call(this,a);if(this.options.momentum&&(this.options.useTransform?(e=getComputedStyle(this.scroller,null)[c].replace(/[^0-9\-.,]/g,"").split(","),f=+e[4],e=+e[5]):(f=+getComputedStyle(this.scroller,
null).left.replace(/[^0-9-]/g,""),e=+getComputedStyle(this.scroller,null).top.replace(/[^0-9-]/g,"")),f!=this.x||e!=this.y))this.options.useTransition?this._unbind(J):I(this.aniTime),this.steps=[],this._pos(f,e),this.options.onScrollEnd&&this.options.onScrollEnd.call(this);this.absStartX=this.x;this.absStartY=this.y;this.startX=this.x;this.startY=this.y;this.pointX=b.pageX;this.pointY=b.pageY;this.startTime=a.timeStamp||Date.now();this.options.onScrollStart&&this.options.onScrollStart.call(this,a);
this._bind(w,g);this._bind(A,g);this._bind(u,g)}},_move:function(a){var b=E?a.touches[0]:a,e=b.pageX-this.pointX,f=b.pageY-this.pointY,g=this.x+e,h=this.y+f,i=a.timeStamp||Date.now();this.options.onBeforeScrollMove&&this.options.onBeforeScrollMove.call(this,a);if(this.options.zoom&&E&&1<a.touches.length)g=d.abs(a.touches[0].pageX-a.touches[1].pageX),h=d.abs(a.touches[0].pageY-a.touches[1].pageY),this.touchesDist=d.sqrt(g*g+h*h),this.zoomed=!0,b=1/this.touchesDistStart*this.touchesDist*this.scale,
b<this.options.zoomMin?b=0.5*this.options.zoomMin*Math.pow(2,b/this.options.zoomMin):b>this.options.zoomMax&&(b=2*this.options.zoomMax*Math.pow(0.5,this.options.zoomMax/b)),this.lastScale=b/this.scale,g=this.originX-this.originX*this.lastScale+this.x,h=this.originY-this.originY*this.lastScale+this.y,this.scroller.style[c]="translate("+g+"px,"+h+"px) scale("+b+")"+H,this.options.onZoom&&this.options.onZoom.call(this,a);else{this.pointX=b.pageX;this.pointY=b.pageY;if(0<g||g<this.maxScrollX)g=this.options.bounce?
this.x+e/2:0<=g||0<=this.maxScrollX?0:this.maxScrollX;if(h>this.minScrollY||h<this.maxScrollY)h=this.options.bounce?this.y+f/2:h>=this.minScrollY||0<=this.maxScrollY?this.minScrollY:this.maxScrollY;this.distX+=e;this.distY+=f;this.absDistX=d.abs(this.distX);this.absDistY=d.abs(this.distY);if(!(6>this.absDistX&&6>this.absDistY)){if(this.options.lockDirection)if(this.absDistX>this.absDistY+5)h=this.y,f=0;else if(this.absDistY>this.absDistX+5)g=this.x,e=0;this.moved=!0;this._pos(g,h);this.dirX=0<e?-1:
0>e?1:0;this.dirY=0<f?-1:0>f?1:0;if(300<i-this.startTime)this.startTime=i,this.startX=this.x,this.startY=this.y;this.options.onScrollMove&&this.options.onScrollMove.call(this,a)}}},_end:function(b){if(!(E&&0!==b.touches.length)){var e=this,f=E?b.changedTouches[0]:b,h,j,l={dist:0,time:0},m={dist:0,time:0},n=(b.timeStamp||Date.now())-e.startTime,o=e.x,q=e.y;e._unbind(w,g);e._unbind(A,g);e._unbind(u,g);e.options.onBeforeScrollEnd&&e.options.onBeforeScrollEnd.call(e,b);if(e.zoomed)o=e.scale*e.lastScale,
o=Math.max(e.options.zoomMin,o),o=Math.min(e.options.zoomMax,o),e.lastScale=o/e.scale,e.scale=o,e.x=e.originX-e.originX*e.lastScale+e.x,e.y=e.originY-e.originY*e.lastScale+e.y,e.scroller.style[i]="200ms",e.scroller.style[c]="translate("+e.x+"px,"+e.y+"px) scale("+e.scale+")"+H,e.zoomed=!1,e.refresh(),e.options.onZoomEnd&&e.options.onZoomEnd.call(e,b);else{if(e.moved){if(300>n&&e.options.momentum){l=o?e._momentum(o-e.startX,n,-e.x,e.scrollerW-e.wrapperW+e.x,e.options.bounce?e.wrapperW:0):l;m=q?e._momentum(q-
e.startY,n,-e.y,0>e.maxScrollY?e.scrollerH-e.wrapperH+e.y-e.minScrollY:0,e.options.bounce?e.wrapperH:0):m;o=e.x+l.dist;q=e.y+m.dist;if(0<e.x&&0<o||e.x<e.maxScrollX&&o<e.maxScrollX)l={dist:0,time:0};if(e.y>e.minScrollY&&q>e.minScrollY||e.y<e.maxScrollY&&q<e.maxScrollY)m={dist:0,time:0}}if(l.dist||m.dist){l=d.max(d.max(l.time,m.time),10);if(e.options.snap)m=o-e.absStartX,n=q-e.absStartY,d.abs(m)<e.options.snapThreshold&&d.abs(n)<e.options.snapThreshold?e.scrollTo(e.absStartX,e.absStartY,200):(m=e._snap(o,
q),o=m.x,q=m.y,l=d.max(m.time,l));e.scrollTo(d.round(o),d.round(q),l)}else e.options.snap?(m=o-e.absStartX,n=q-e.absStartY,d.abs(m)<e.options.snapThreshold&&d.abs(n)<e.options.snapThreshold?e.scrollTo(e.absStartX,e.absStartY,200):(m=e._snap(e.x,e.y),(m.x!=e.x||m.y!=e.y)&&e.scrollTo(m.x,m.y,m.time))):e._resetPos(200)}else{if(E)if(e.doubleTapTimer&&e.options.zoom)clearTimeout(e.doubleTapTimer),e.doubleTapTimer=null,e.options.onZoomStart&&e.options.onZoomStart.call(e,b),e.zoom(e.pointX,e.pointY,1==e.scale?
e.options.doubleTapZoom:1),e.options.onZoomEnd&&setTimeout(function(){e.options.onZoomEnd.call(e,b)},200);else if(this.options.handleClick)e.doubleTapTimer=setTimeout(function(){e.doubleTapTimer=null;for(h=f.target;1!=h.nodeType;)h=h.parentNode;if("SELECT"!=h.tagName&&"INPUT"!=h.tagName&&"TEXTAREA"!=h.tagName)j=a.createEvent("MouseEvents"),j.initMouseEvent("click",!0,!0,b.view,1,f.screenX,f.screenY,f.clientX,f.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,0,null),j._fake=!0,h.dispatchEvent(j)},
e.options.zoom?250:0);e._resetPos(400)}e.options.onTouchEnd&&e.options.onTouchEnd.call(e,b)}}},_resetPos:function(a){var b=0<=this.x?0:this.x<this.maxScrollX?this.maxScrollX:this.x,c=this.y>=this.minScrollY||0<this.maxScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y;if(b==this.x&&c==this.y){if(this.moved)this.moved=!1,this.options.onScrollEnd&&this.options.onScrollEnd.call(this);if(this.hScrollbar&&this.options.hideScrollbar)"webkit"==h&&(this.hScrollbarWrapper.style[n]="300ms"),
this.hScrollbarWrapper.style.opacity="0";if(this.vScrollbar&&this.options.hideScrollbar)"webkit"==h&&(this.vScrollbarWrapper.style[n]="300ms"),this.vScrollbarWrapper.style.opacity="0"}else this.scrollTo(b,c,a||0)},_wheel:function(a){var b=this,c,d;if("wheelDeltaX"in a)c=a.wheelDeltaX/12,d=a.wheelDeltaY/12;else if("wheelDelta"in a)c=d=a.wheelDelta/12;else if("detail"in a)c=d=3*-a.detail;else return;if("zoom"==b.options.wheelAction){d=b.scale*Math.pow(2,1/3*(d?d/Math.abs(d):0));if(d<b.options.zoomMin)d=
b.options.zoomMin;if(d>b.options.zoomMax)d=b.options.zoomMax;d!=b.scale&&(!b.wheelZoomCount&&b.options.onZoomStart&&b.options.onZoomStart.call(b,a),b.wheelZoomCount++,b.zoom(a.pageX,a.pageY,d,400),setTimeout(function(){b.wheelZoomCount--;!b.wheelZoomCount&&b.options.onZoomEnd&&b.options.onZoomEnd.call(b,a)},400))}else{c=b.x+c;d=b.y+d;if(0<c)c=0;else if(c<b.maxScrollX)c=b.maxScrollX;if(d>b.minScrollY)d=b.minScrollY;else if(d<b.maxScrollY)d=b.maxScrollY;0>b.maxScrollY&&b.scrollTo(c,d,0)}},_transitionEnd:function(a){a.target==
this.scroller&&(this._unbind(J),this._startAni())},_startAni:function(){var a=this,b=a.x,c=a.y,e=Date.now(),f,g,h;if(!a.animating)if(a.steps.length){f=a.steps.shift();if(f.x==b&&f.y==c)f.time=0;a.animating=!0;a.moved=!0;a.options.useTransition?(a._transitionTime(f.time),a._pos(f.x,f.y),a.animating=!1,f.time?a._bind(J):a._resetPos(0)):(h=function(){var i=Date.now();if(i>=e+f.time)a._pos(f.x,f.y),a.animating=!1,a.options.onAnimationEnd&&a.options.onAnimationEnd.call(a),a._startAni();else if(i=(i-e)/
f.time-1,g=d.sqrt(1-i*i),i=(f.x-b)*g+b,a._pos(i,(f.y-c)*g+c),a.animating)a.aniTime=K(h)},h())}else a._resetPos(400)},_transitionTime:function(a){a+="ms";this.scroller.style[i]=a;this.hScrollbar&&(this.hScrollbarIndicator.style[i]=a);this.vScrollbar&&(this.vScrollbarIndicator.style[i]=a)},_momentum:function(a,b,c,e,f){var b=d.abs(a)/b,g=b*b/0.0012,h=0,h=0;0<a&&g>c?(c+=f/(6/(6.0E-4*(g/b))),b=b*c/g,g=c):0>a&&g>e&&(e+=f/(6/(6.0E-4*(g/b))),b=b*e/g,g=e);return{dist:g*(0>a?-1:1),time:d.round(b/6.0E-4)}},
_offset:function(a){for(var b=-a.offsetLeft,c=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;a!=this.wrapper&&(b*=this.scale,c*=this.scale);return{left:b,top:c}},_snap:function(a,b){var c,e,f;f=this.pagesX.length-1;for(c=0,e=this.pagesX.length;c<e;c++)if(a>=this.pagesX[c]){f=c;break}f==this.currPageX&&0<f&&0>this.dirX&&f--;a=this.pagesX[f];e=(e=d.abs(a-this.pagesX[this.currPageX]))?500*(d.abs(this.x-a)/e):0;this.currPageX=f;f=this.pagesY.length-1;for(c=0;c<f;c++)if(b>=this.pagesY[c]){f=
c;break}f==this.currPageY&&0<f&&0>this.dirY&&f--;b=this.pagesY[f];c=(c=d.abs(b-this.pagesY[this.currPageY]))?500*(d.abs(this.y-b)/c):0;this.currPageY=f;f=d.round(d.max(e,c))||200;return{x:a,y:b,time:f}},_bind:function(a,b){(b||this.scroller).addEventListener(a,this,!0)},_unbind:function(a,b){(b||this.scroller).removeEventListener(a,this,!0)},destroy:function(){this.scroller.style[c]="";this.vScrollbar=this.hScrollbar=!1;this._scrollbar("h");this._scrollbar("v");this._unbind(B,g);this._unbind(v);this._unbind(w,
g);this._unbind(A,g);this._unbind(u,g);this.options.hasTouch||this._unbind(z);this.options.useTransition&&this._unbind(J);this.options.checkDOMChanges&&clearInterval(this.checkDOMTime);this.options.onDestroy&&this.options.onDestroy.call(this)},refresh:function(){var a,b,c,e=0;b=0;if(this.scale<this.options.zoomMin)this.scale=this.options.zoomMin;this.wrapperW=this.wrapper.clientWidth||1;this.wrapperH=this.wrapper.clientHeight||1;this.minScrollY=-this.options.topOffset||0;this.scrollerW=d.round(this.scroller.offsetWidth*
this.scale);this.scrollerH=d.round((this.scroller.offsetHeight+this.minScrollY)*this.scale);this.maxScrollX=this.wrapperW-this.scrollerW;this.maxScrollY=this.wrapperH-this.scrollerH+this.minScrollY;this.dirY=this.dirX=0;this.options.onRefresh&&this.options.onRefresh.call(this);this.hScroll=this.options.hScroll&&0>this.maxScrollX;this.vScroll=this.options.vScroll&&(!this.options.bounceLock&&!this.hScroll||this.scrollerH>this.wrapperH);this.hScrollbar=this.hScroll&&this.options.hScrollbar;this.vScrollbar=
this.vScroll&&this.options.vScrollbar&&this.scrollerH>this.wrapperH;a=this._offset(this.wrapper);this.wrapperOffsetLeft=-a.left;this.wrapperOffsetTop=-a.top;if("string"==typeof this.options.snap){this.pagesX=[];this.pagesY=[];c=this.scroller.querySelectorAll(this.options.snap);for(a=0,b=c.length;a<b;a++)e=this._offset(c[a]),e.left+=this.wrapperOffsetLeft,e.top+=this.wrapperOffsetTop,this.pagesX[a]=e.left<this.maxScrollX?this.maxScrollX:e.left*this.scale,this.pagesY[a]=e.top<this.maxScrollY?this.maxScrollY:
e.top*this.scale}else if(this.options.snap){for(this.pagesX=[];e>=this.maxScrollX;)this.pagesX[b]=e,e-=this.wrapperW,b++;this.maxScrollX%this.wrapperW&&(this.pagesX[this.pagesX.length]=this.maxScrollX-this.pagesX[this.pagesX.length-1]+this.pagesX[this.pagesX.length-1]);b=e=0;for(this.pagesY=[];e>=this.maxScrollY;)this.pagesY[b]=e,e-=this.wrapperH,b++;this.maxScrollY%this.wrapperH&&(this.pagesY[this.pagesY.length]=this.maxScrollY-this.pagesY[this.pagesY.length-1]+this.pagesY[this.pagesY.length-1])}this._scrollbar("h");
this._scrollbar("v");this.zoomed||(this.scroller.style[i]="0",this._resetPos(400))},scrollTo:function(a,b,c,d){var e=a;this.stop();e.length||(e=[{x:a,y:b,time:c,relative:d}]);for(a=0,b=e.length;a<b;a++){if(e[a].relative)e[a].x=this.x-e[a].x,e[a].y=this.y-e[a].y;this.steps.push({x:e[a].x,y:e[a].y,time:e[a].time||0})}this._startAni()},scrollToElement:function(a,b){var c;if(a=a.nodeType?a:this.scroller.querySelector(a))c=this._offset(a),c.left+=this.wrapperOffsetLeft,c.top+=this.wrapperOffsetTop,c.left=
0<c.left?0:c.left<this.maxScrollX?this.maxScrollX:c.left,c.top=c.top>this.minScrollY?this.minScrollY:c.top<this.maxScrollY?this.maxScrollY:c.top,b=void 0===b?d.max(2*d.abs(c.left),2*d.abs(c.top)):b,this.scrollTo(c.left,c.top,b)},scrollToPage:function(a,b,c){c=void 0===c?400:c;this.options.onScrollStart&&this.options.onScrollStart.call(this);if(this.options.snap)a="next"==a?this.currPageX+1:"prev"==a?this.currPageX-1:a,b="next"==b?this.currPageY+1:"prev"==b?this.currPageY-1:b,a=0>a?0:a>this.pagesX.length-
1?this.pagesX.length-1:a,b=0>b?0:b>this.pagesY.length-1?this.pagesY.length-1:b,this.currPageX=a,this.currPageY=b,a=this.pagesX[a],b=this.pagesY[b];else{a*=-this.wrapperW;b*=-this.wrapperH;if(a<this.maxScrollX)a=this.maxScrollX;if(b<this.maxScrollY)b=this.maxScrollY}this.scrollTo(a,b,c)},disable:function(){this.stop();this._resetPos(0);this.enabled=!1;this._unbind(w,g);this._unbind(A,g);this._unbind(u,g)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind(J):
I(this.aniTime);this.steps=[];this.animating=this.moved=!1},zoom:function(a,b,d,e){var f=d/this.scale;if(this.options.useTransform)this.zoomed=!0,e=void 0===e?200:e,a=a-this.wrapperOffsetLeft-this.x,b=b-this.wrapperOffsetTop-this.y,this.x=a-a*f+this.x,this.y=b-b*f+this.y,this.scale=d,this.refresh(),this.x=0<this.x?0:this.x<this.maxScrollX?this.maxScrollX:this.x,this.y=this.y>this.minScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y,this.scroller.style[i]=e+"ms",this.scroller.style[c]=
"translate("+this.x+"px,"+this.y+"px) scale("+d+")"+H,this.zoomed=!1},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}};e=null;"undefined"!==typeof exports?exports.iScroll=x:g.iScroll=x})(window,document);
